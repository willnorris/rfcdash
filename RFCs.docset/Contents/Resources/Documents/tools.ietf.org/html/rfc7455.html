<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7455 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:21 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-tissa-trill-oam-fm" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7455" name="DC.Identifier"/>
<meta content="March, 2015" name="DC.Date.Issued"/>
<meta content="Finn, Norman" name="DC.Creator"/>
<meta content="Senevirathne, Tissa" name="DC.Creator"/>
<meta content="Aldrin, Sam" name="DC.Creator"/>
<meta content="Kumar, Deepak" name="DC.Creator"/>
<meta content="Salam, Samer" name="DC.Creator"/>
<meta content="This document specifies Transparent Interconnection of Lots of Links
(TRILL) Operations, Administration, and Maintenance (OAM) fault
management. Methods in this document follow the CFM (Connectivity
Fault Management) framework defined in IEEE 802.1 and reuse OAM tools
where possible. Additional messages and TLVs are defined for TRILL-
specific applications or for cases where a different set of
information is required other than CFM as defined in IEEE 802.1. This
document updates RFC 6325." name="DC.Description.Abstract"/>
<meta content="Transparent Interconnection of Lots of Links (TRILL): Fault Management" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7455 - Transparent Interconnection of Lots of Links (TRILL): Fault Management</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7455.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7455" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-trill-oam-fm" title="draft-ietf-trill-oam-fm">draft-ietf-tril...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7455" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7455" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7455" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                   T. Senevirathne
Request for Comments: 7455                                       N. Finn
Updates: <a href="rfc6325.html">6325</a>                                                   S. Salam
Category: Standards Track                                       D. Kumar
ISSN: 2070-1721                                                    Cisco
                                                         D. Eastlake 3rd
                                                               S. Aldrin
                                                                   Y. Li
                                                                  Huawei
                                                              March 2015


 <span class="h1">Transparent Interconnection of Lots of Links (TRILL): Fault Management</span>

Abstract

   This document specifies Transparent Interconnection of Lots of Links
   (TRILL) Operations, Administration, and Maintenance (OAM) fault
   management.  Methods in this document follow the CFM (Connectivity
   Fault Management) framework defined in IEEE 802.1 and reuse OAM tools
   where possible.  Additional messages and TLVs are defined for TRILL-
   specific applications or for cases where a different set of
   information is required other than CFM as defined in IEEE 802.1.
   This document updates <a href="rfc6325.html">RFC 6325</a>.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7455">http://www.rfc-editor.org/info/rfc7455</a>.













<span class="grey">Senevirathne, et al.         Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


Copyright Notice

   Copyright (c) 2015 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





































<span class="grey">Senevirathne, et al.         Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-5">5</a>
   <a href="#section-2">2</a>. Conventions Used in This Document ...............................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. General Format of TRILL OAM Packets .............................<a href="#page-6">6</a>
      <a href="#section-3.1">3.1</a>. Identification of TRILL OAM Frames .........................<a href="#page-8">8</a>
      <a href="#section-3.2">3.2</a>. Use of TRILL OAM Alert Flag ................................<a href="#page-8">8</a>
           <a href="#section-3.2.1">3.2.1</a>. Handling of TRILL Frames with the "A" Flag ..........<a href="#page-9">9</a>
      <a href="#section-3.3">3.3</a>. OAM Capability Announcement ................................<a href="#page-9">9</a>
      <a href="#section-3.4">3.4</a>. Identification of the OAM Message .........................<a href="#page-10">10</a>
   <a href="#section-4">4</a>. TRILL OAM Layering vs. IEEE Layering ...........................<a href="#page-11">11</a>
      <a href="#section-4.1">4.1</a>. Processing at the ISS Layer ...............................<a href="#page-12">12</a>
           <a href="#section-4.1.1">4.1.1</a>. Receive Processing .................................<a href="#page-12">12</a>
           <a href="#section-4.1.2">4.1.2</a>. Transmit Processing ................................<a href="#page-12">12</a>
      <a href="#section-4.2">4.2</a>. End-Station VLAN and Priority Processing ..................<a href="#page-12">12</a>
           <a href="#section-4.2.1">4.2.1</a>. Receive Processing .................................<a href="#page-12">12</a>
           <a href="#section-4.2.2">4.2.2</a>. Transmit Processing ................................<a href="#page-12">12</a>
      <a href="#section-4.3">4.3</a>. TRILL Encapsulation and Decapsulation Layer ...............<a href="#page-12">12</a>
           <a href="#section-4.3.1">4.3.1</a>. Receive Processing for Unicast Packets .............<a href="#page-12">12</a>
           <a href="#section-4.3.2">4.3.2</a>. Transmit Processing for Unicast Packets ............<a href="#page-13">13</a>
           <a href="#section-4.3.3">4.3.3</a>. Receive Processing for Multicast Packets ...........<a href="#page-14">14</a>
           <a href="#section-4.3.4">4.3.4</a>. Transmit Processing of Multicast Packets ...........<a href="#page-15">15</a>
      <a href="#section-4.4">4.4</a>. TRILL OAM Layer Processing ................................<a href="#page-16">16</a>
   <a href="#section-5">5</a>. Maintenance Associations (MAs) in TRILL ........................<a href="#page-17">17</a>
   <a href="#section-6">6</a>. MEP Addressing .................................................<a href="#page-18">18</a>
      <a href="#section-6.1">6.1</a>. Use of MIP in TRILL .......................................<a href="#page-21">21</a>
   <a href="#section-7">7</a>. Continuity Check Message (CCM) .................................<a href="#page-22">22</a>
   <a href="#section-8">8</a>. TRILL OAM Message Channel ......................................<a href="#page-25">25</a>
      <a href="#section-8.1">8.1</a>. TRILL OAM Message Header ..................................<a href="#page-25">25</a>
      <a href="#section-8.2">8.2</a>. TRILL-Specific OAM OpCodes ................................<a href="#page-26">26</a>
      <a href="#section-8.3">8.3</a>. Format of TRILL OAM TLV ...................................<a href="#page-26">26</a>
      <a href="#section-8.4">8.4</a>. TRILL OAM TLVs ............................................<a href="#page-27">27</a>
           <a href="#section-8.4.1">8.4.1</a>. Common TLVs between CFM and TRILL ..................<a href="#page-27">27</a>
           <a href="#section-8.4.2">8.4.2</a>. TRILL OAM-Specific TLVs ............................<a href="#page-27">27</a>
           <a href="#section-8.4.3">8.4.3</a>. TRILL OAM Application Identifier TLV ...............<a href="#page-28">28</a>
           <a href="#section-8.4.4">8.4.4</a>. Out-of-Band Reply Address TLV ......................<a href="#page-30">30</a>
           <a href="#section-8.4.5">8.4.5</a>. Diagnostic Label TLV ...............................<a href="#page-31">31</a>
           <a href="#section-8.4.6">8.4.6</a>. Original Data Payload TLV ..........................<a href="#page-32">32</a>
           <a href="#section-8.4.7">8.4.7</a>. RBridge Scope TLV ..................................<a href="#page-32">32</a>
           <a href="#section-8.4.8">8.4.8</a>. Previous RBridge Nickname TLV ......................<a href="#page-33">33</a>
           <a href="#section-8.4.9">8.4.9</a>. Next-Hop RBridge List TLV ..........................<a href="#page-34">34</a>
           <a href="#section-8.4.10">8.4.10</a>. Multicast Receiver Port Count TLV .................<a href="#page-34">34</a>
           <a href="#section-8.4.11">8.4.11</a>. Flow Identifier TLV ...............................<a href="#page-35">35</a>
           <a href="#section-8.4.12">8.4.12</a>. Reflector Entropy TLV .............................<a href="#page-36">36</a>
           <a href="#section-8.4.13">8.4.13</a>. Authentication TLV ................................<a href="#page-37">37</a>






<span class="grey">Senevirathne, et al.         Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   <a href="#section-9">9</a>. Loopback Message ...............................................<a href="#page-38">38</a>
      <a href="#section-9.1">9.1</a>. Loopback Message Format ...................................<a href="#page-38">38</a>
      <a href="#section-9.2">9.2</a>. Theory of Operation .......................................<a href="#page-39">39</a>
           <a href="#section-9.2.1">9.2.1</a>. Actions by Originator RBridge ......................<a href="#page-39">39</a>
           <a href="#section-9.2.2">9.2.2</a>. Intermediate RBridge ...............................<a href="#page-39">39</a>
           <a href="#section-9.2.3">9.2.3</a>. Destination RBridge ................................<a href="#page-40">40</a>
   <a href="#section-10">10</a>. Path Trace Message ............................................<a href="#page-40">40</a>
      <a href="#section-10.1">10.1</a>. Theory of Operation ......................................<a href="#page-41">41</a>
           <a href="#section-10.1.1">10.1.1</a>. Actions by Originator RBridge .....................<a href="#page-41">41</a>
           <a href="#section-10.1.2">10.1.2</a>. Intermediate RBridge ..............................<a href="#page-42">42</a>
           <a href="#section-10.1.3">10.1.3</a>. Destination RBridge ...............................<a href="#page-43">43</a>
   <a href="#section-11">11</a>. Multi-Destination Tree Verification Message (MTVM) ............<a href="#page-43">43</a>
      <a href="#section-11.1">11.1</a>. MTVM Format ..............................................<a href="#page-44">44</a>
      <a href="#section-11.2">11.2</a>. Theory of Operation ......................................<a href="#page-44">44</a>
           <a href="#section-11.2.1">11.2.1</a>. Actions by Originator RBridge .....................<a href="#page-44">44</a>
           <a href="#section-11.2.2">11.2.2</a>. Receiving RBridge .................................<a href="#page-45">45</a>
           <a href="#section-11.2.3">11.2.3</a>. In-Scope RBridges .................................<a href="#page-45">45</a>
   <a href="#section-12">12</a>. Application of Continuity Check Message (CCM) in TRILL ........<a href="#page-46">46</a>
      <a href="#section-12.1">12.1</a>. CCM Error Notification ...................................<a href="#page-47">47</a>
      <a href="#section-12.2">12.2</a>. Theory of Operation ......................................<a href="#page-48">48</a>
           <a href="#section-12.2.1">12.2.1</a>. Actions by Originator RBridge .....................<a href="#page-48">48</a>
           <a href="#section-12.2.2">12.2.2</a>. Intermediate RBridge ..............................<a href="#page-49">49</a>
           <a href="#section-12.2.3">12.2.3</a>. Destination RBridge ...............................<a href="#page-49">49</a>
   <a href="#section-13">13</a>. Fragmented Reply ..............................................<a href="#page-50">50</a>
   <a href="#section-14">14</a>. Security Considerations .......................................<a href="#page-50">50</a>
   <a href="#section-15">15</a>. IANA Considerations ...........................................<a href="#page-52">52</a>
      <a href="#section-15.1">15.1</a>. OAM Capability Flags .....................................<a href="#page-52">52</a>
      <a href="#section-15.2">15.2</a>. CFM Code Points ..........................................<a href="#page-52">52</a>
      <a href="#section-15.3">15.3</a>. MAC Addresses ............................................<a href="#page-53">53</a>
      <a href="#section-15.4">15.4</a>. Return Codes and Sub-codes ...............................<a href="#page-53">53</a>
      <a href="#section-15.5">15.5</a>. TRILL Nickname Address Family ............................<a href="#page-54">54</a>
   <a href="#section-16">16</a>. References ....................................................<a href="#page-54">54</a>
      <a href="#section-16.1">16.1</a>. Normative References .....................................<a href="#page-54">54</a>
      <a href="#section-16.2">16.2</a>. Informative References ...................................<a href="#page-55">55</a>
   <a href="#appendix-A">Appendix A</a>. Backwards Compatibility ...............................<a href="#page-57">57</a>
      <a href="#appendix-A.1">A.1</a>.  Maintenance Point (MEP/MIP) Model ........................<a href="#page-57">57</a>
      <a href="#appendix-A.2">A.2</a>.  Data-Plane Encoding and Frame Identification .............<a href="#page-57">57</a>
   <a href="#appendix-B">Appendix B</a>. Base Mode for TRILL OAM ...............................<a href="#page-59">59</a>
   <a href="#appendix-C">Appendix C</a>. MAC Addresses Request .................................<a href="#page-61">61</a>
   Acknowledgments ...................................................<a href="#page-62">62</a>
   Authors' Addresses ................................................<a href="#page-62">62</a>










<span class="grey">Senevirathne, et al.         Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The general structure of TRILL OAM messages is presented in
   [<a href="rfc7174.html" title='"Transparent Interconnection of Lots of Links (TRILL) Operations, Administration, and Maintenance (OAM) Framework"'>RFC7174</a>].  TRILL OAM messages consist of six parts: Link Header,
   TRILL Header, Flow Entropy, OAM Ethertype, OAM Message Channel, and
   Link Trailer.

   The OAM Message Channel carries various control information and OAM-
   related data between TRILL switches, also known as RBridges or
   Routing Bridges.

   A common OAM Message Channel representation can be shared between
   different technologies.  This consistency between different OAM
   technologies promotes nested fault monitoring and isolation between
   technologies that share the same OAM framework.

   The TRILL OAM Message Channel is formatted as specified in IEEE
   Connectivity Fault Management (CFM) [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].

   The ITU-T Y.1731 [<a href="#ref-Y1731" title='"OAM functions and mechanisms for Ethernet based networks"'>Y1731</a>] standard utilizes the same messaging format
   as [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] OAM messages where applicable.  This document takes a
   similar stance and reuses [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] in TRILL OAM.  It is assumed that
   readers are familiar with [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] and [<a href="#ref-Y1731" title='"OAM functions and mechanisms for Ethernet based networks"'>Y1731</a>].  Readers who are not
   familiar with these documents are encouraged to review them.

   This document specifies TRILL OAM fault management.  It updates
   [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] as specified in <a href="#section-3.1">Section 3.1</a>.  TRILL performance monitoring
   is specified in [<a href="rfc7456.html" title='"Loss and Delay Measurement in Transparent Interconnection of Lots of Links (TRILL)"'>RFC7456</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Conventions%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Conventions Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   Capitalized IANA Considerations terms such as "Standards Action" are
   to be interpreted as described in [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].

   Acronyms used in the document include the following:

      CCM   - Continuity Check Message [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]

      DA    - Destination Address

      ECMP  - Equal-Cost Multipath

      FGL   - Fine-Grained Label




<span class="grey">Senevirathne, et al.         Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


      ISS   - Internal Sub-Layer Service [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]

      LBM   - Loopback Message [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]

      LBR   - Loopback Reply [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]

      MA    - Maintenance Association [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] [<a href="rfc7174.html" title='"Transparent Interconnection of Lots of Links (TRILL) Operations, Administration, and Maintenance (OAM) Framework"'>RFC7174</a>]

      MAC   - Media Access Control (MAC)

      MD    - Maintenance Domain [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]

      MEP   - Maintenance End Point [<a href="rfc7174.html" title='"Transparent Interconnection of Lots of Links (TRILL) Operations, Administration, and Maintenance (OAM) Framework"'>RFC7174</a>] [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]

      MIP   - Maintenance Intermediate Point [<a href="rfc7174.html" title='"Transparent Interconnection of Lots of Links (TRILL) Operations, Administration, and Maintenance (OAM) Framework"'>RFC7174</a>] [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]

      MP    - Maintenance Point [<a href="rfc7174.html" title='"Transparent Interconnection of Lots of Links (TRILL) Operations, Administration, and Maintenance (OAM) Framework"'>RFC7174</a>]

      MTVM  - Multi-destination Tree Verification Message

      MTVR  - Multi-destination Tree Verification Reply

      OAM   - Operations, Administration, and Maintenance [<a href="rfc6291.html" title='"Guidelines for the Use of the "'>RFC6291</a>]

      PRI   - Priority of Ethernet Frames [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]

      PTM   - Path Trace Message

      PTR   - Path Trace Reply

      SA    - Source Address

      SAP   - Service Access Point [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]

      TRILL - Transparent Interconnection of Lots of Links [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>]

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20General%20Format%20of%20TRILL%20OAM%20Packets"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  General Format of TRILL OAM Packets</span>

   The TRILL forwarding paradigm allows an implementation to select a
   path from a set of equal-cost paths to forward a unicast TRILL Data
   packet.  For multi-destination TRILL Data packets, a distribution
   tree is chosen by the TRILL switch that ingresses or creates the
   packet.  Selection of the path of choice is implementation dependent
   at each hop for unicast and at the ingress for multi-destination.
   However, it is a common practice to utilize Layer 2 through Layer 4
   information in the frame payload for path selection.





<span class="grey">Senevirathne, et al.         Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   For accurate monitoring and/or diagnostics, OAM messages are required
   to follow the same path as corresponding data packets.  [<a href="rfc7174.html" title='"Transparent Interconnection of Lots of Links (TRILL) Operations, Administration, and Maintenance (OAM) Framework"'>RFC7174</a>]
   presents the high-level format of OAM messages.  The details of the
   TRILL OAM frame format are defined in this document.

         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |                               |
         .    Link  Header               . Variable
         |                               |
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |                               |
         +    TRILL Header               + 6 or more bytes
         |                               |
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |                               |
         .   Flow Entropy                . 96 bytes
         .                               .
         |                               |
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |   OAM Ethertype               |
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |                               |
         .   OAM Message Channel         . Variable
         .                               .
         |                               |
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |     Link Trailer              | Variable
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

               Figure 1: Format of TRILL OAM Messages

   o  Link Header: Media-dependent header.  For Ethernet, this includes
      the Destination MAC, Source MAC, VLAN (optional), and Ethertype
      fields.

   o  TRILL Header: Fixed size of 6 bytes when the Extended Header is
      not included [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].

   o  Flow Entropy: A 96-byte, fixed-size field.  The rightmost bits of
      the field MUST be padded with zeros, up to 96 bytes, when the
      flow-entropy information is less than 96 bytes.  Flow Entropy
      enables emulation of the forwarding behavior of the desired data
      packets.  The Flow Entropy field starts with the Inner.MacDA.  The
      offset of the Inner.MacDA depends on whether extensions are
      included or not as specified in [<a href="rfc7179.html" title='"Transparent Interconnection of Lots of Links (TRILL): Header Extension"'>RFC7179</a>] and [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].  Such
      extensions are not commonly supported in current TRILL
      implementations.




<span class="grey">Senevirathne, et al.         Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  OAM Ethertype: A 16-bit Ethertype that identifies the OAM Message
      Channel that follows.  This document specifies using the Ethertype
      0x8902 allocated for CFM [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].

   o  OAM Message Channel: A variable-size section that carries OAM-
      related information.  The message format is as specified in
      [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].

   o  Link Trailer: Media-dependent trailer.  For Ethernet, this is the
      FCS (Frame Check Sequence).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Identification%20of%20TRILL%20OAM%20Frames"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Identification of TRILL OAM Frames</span>

   TRILL, as originally specified in [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>], did not have a specific
   flag or method to identify OAM frames.  This document updates
   [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] to include specific methods to identify TRILL OAM frames.
   <a href="#section-3.2">Section 3.2</a> explains the details of the method.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Use%20of%20TRILL%20OAM%20Alert%20Flag"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Use of TRILL OAM Alert Flag</span>

   The TRILL Header, as defined in [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>], has two reserved bits.
   This document specifies use of the reserved bit next to the Version
   field in the TRILL Header as the Alert flag.  The Alert flag will be
   denoted by "A".  RBridges MUST NOT use the "A" flag for forwarding
   decisions such as the selection of which ECMP path or multi-
   destination tree to select.

   Implementations that comply with this document MUST utilize the "A"
   flag and CFM Ethertype to identify TRILL OAM frames.

                                    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                    | V |A|R|M|Op-Length| Hop Count |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Egress RBridge Nickname     |  Ingress RBridge Nickname     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Options...
    +-+-+-+-+-+-+-+-+-+-+-+-

                 Figure 2: TRILL Header with the "A" Flag

   o  A (1 bit): Indicates this is a possible OAM frame and is subject
      to specific handling as specified in this document.

   All other TRILL Header fields carry the same meaning as defined in
   [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].






<span class="grey">Senevirathne, et al.         Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.%20%20Handling%20of%20TRILL%20Frames%20with%20the%20%22A%22%20Flag"></a><a class="selflink" href="#section-3.2.1" name="section-3.2.1">3.2.1</a>.  Handling of TRILL Frames with the "A" Flag</span>

   The value "1" in the "A" flag indicates TRILL frames that may qualify
   as OAM frames.  Implementations are further REQUIRED to validate such
   frames by comparing the value at the OAM Ethertype (Figure 1)
   location with the CFM Ethertype "0x8902" [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].  If the value
   matches, such frames are identified as TRILL OAM frames and SHOULD be
   processed as discussed in <a href="#section-4">Section 4</a>.

   Frames with the "A" flag set that do not contain a CFM Ethertype are
   not considered OAM frames.  Such frames MUST be silently discarded.

   OAM-capable RBridges MUST NOT generate OAM frames to an RBridge that
   is not OAM capable.

   Intermediate RBridges that are not OAM capable (i.e., do not
   understand the "A" flag) follow the process defined in <a href="rfc6325.html#section-3.3">Section 3.3 of
   [RFC6325]</a> and forward OAM frames with the "A" flag unaltered.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20OAM%20Capability%20Announcement"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  OAM Capability Announcement</span>

   Any given RBridge can be (1) OAM incapable, (2) OAM capable with new
   extensions, or (3) OAM capable with the backwards-compatibility
   method.  The OAM request originator, prior to origination of the
   request, is required to identify the OAM capability of the target and
   generate the appropriate OAM message.

   The capability flags defined in the TRILL Version sub-TLV (TRILL-VER)
   [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>] will be utilized for announcing OAM capabilities.  The
   following OAM-related capability flags are defined:

      O - OAM capable

      B - Backwards-compatible OAM

   A capability announcement with the "O" flag set to 1 and the "B" flag
   set to 1 indicates that the originating RBridge is OAM capable but
   utilizes the backwards-compatibility method defined in <a href="#appendix-A">Appendix A</a>.  A
   capability announcement with the "O" flag set to 1 and the "B" flag
   set to 0 indicates that the originating RBridge is OAM capable and
   utilizes the method specified in <a href="#section-3.2">Section 3.2</a>.

   When the "O" flag is set to 0, the announcing implementation is
   considered not capable of OAM, and the "B" flag is ignored.







<span class="grey">Senevirathne, et al.         Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


      +-+-+-+-+-+-+-+-+
      | Type          |              (1 byte)
      +-+-+-+-+-+-+-+-+
      | Length        |              (1 byte)
      +-+-+-+-+-+-+-+-+
      | Max-version   |              (1 byte)
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+
      |A|F|O|B|Other Capabilities and Header Flags|  (4 bytes)
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+-+
       0                   1                 3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7   0 1

    Figure 3: TRILL-VER Sub-TLV [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>] with "O" and "B" Flags

   In Figure 3, "A" is the Affinity sub-TLV support flag as indicated in
   [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>], and "F" is the FGL-safe flag as indicated in [<a href="rfc7172.html" title='"Transparent Interconnection of Lots of Links (TRILL): Fine-Grained Labeling"'>RFC7172</a>] and
   [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>].  The "O" and "B" flags are located after the "F" flag in
   the Capability and Header Flags field of the TRILL-VER sub-TLV, as
   depicted in Figure 3 above.  Usage of the "O" and "B" flags is
   discussed above.

   Absence of the TRILL-VER sub-TLV means the announcing RBridge is not
   OAM capable.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20%20Identification%20of%20the%20OAM%20Message"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>.  Identification of the OAM Message</span>

   The ingress RBridge nickname allows recipients to identify the origin
   of the message in most cases.  However, when an out-of-band reply is
   generated, the responding RBridge nickname is not easy to identify.

   The [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] Sender ID TLV (1) provides methods to identify the device
   by including the Chassis ID.  The Chassis ID allows different
   addressing formats such as IANA Address Family enumerations.  IANA
   has allocated Address Family Number 16396 for TRILL nickname.  In
   TRILL OAM, the Chassis ID sub-type of the Sender ID TLV is set to
   16396, and the Chassis ID field contains the corresponding TRILL
   nickname.

   When the Sender ID TLV is present and the Chassis ID sub-type is set
   to 16396, the sender RBridge TRILL nickname SHOULD be derived from
   the nickname embedded in the Chassis ID.  Otherwise, the sender
   RBridge TRILL nickname SHOULD be derived from the ingress RBridge
   nickname.








<span class="grey">Senevirathne, et al.         Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20TRILL%20OAM%20Layering%20vs.%20IEEE%20Layering"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  TRILL OAM Layering vs. IEEE Layering</span>

   This section presents the placement of the TRILL OAM shim within the
   IEEE 802.1 layers.  The transmit and receive processing are
   explained.

                       +-+-+-+-+-+-+-+-+-+-+
                       |   RBridge Layer   |
                       |   Processing      |
                       +-+-+-+-+-+-+-+-+-+-+
                                |
                                |
                            +-+-+-+-+-+-+
                            | TRILL OAM | UP MEP
                            | Layer     |   MIP
                            +-+-+-+-+-+-+ Down MEP
                                 |
                                 |
                            +-+-+-+-+-+-+
      (3)--------&gt;          | TRILL     |
                            | Encap/Decap
                            +-+-+-+-+-+-+
                                |
                            +-+-+-+-+-+-+
      (2)--------&gt;          |End-station|
                            | VLAN &amp; Priority Processing
                            +-+-+-+-+-+-+
                                |
                            +-+-+-+-+-+-+
      (1)--------&gt;          |ISS        |
                            |Processing |
                            +-+-+-+-+-+-+
                                |
                                |
                                |

           Figure 4: Placement of TRILL MP within IEEE 802.1

   <a href="rfc6325.html#section-4.6">[RFC6325], Section 4.6</a> as updated by [<a href="rfc7180.html" title='"Transparent Interconnection of Lots of Links (TRILL): Clarifications, Corrections, and Updates"'>RFC7180</a>] provides a detailed
   explanation of frame processing.  Please refer to those documents for
   additional details and for processing scenarios not covered herein.

   Sections <a href="#section-4.1">4.1</a> and <a href="#section-4.2">4.2</a> apply to links using a broadcast LAN technology
   such as Ethernet.







<span class="grey">Senevirathne, et al.         Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   On links using an inherently point-to-point technology, such as PPP
   [<a href="rfc6361.html" title='"PPP Transparent Interconnection of Lots of Links (TRILL) Protocol Control Protocol"'>RFC6361</a>], there is no Outer.MacDA, Outer.MacSA, or Outer.VLAN
   because these are part of the Link Header for Ethernet.  Point-to-
   point links typically have Link Headers without these fields.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Processing%20at%20the%20ISS%20Layer"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Processing at the ISS Layer</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.1.1.%20%20Receive%20Processing"></a><a class="selflink" href="#section-4.1.1" name="section-4.1.1">4.1.1</a>.  Receive Processing</span>

   The ISS layer receives an indication from the port.  It extracts DA
   and SA, and it marks the remainder of the payload as M1.  The ISS
   layer passes on (DA, SA, M1) as an indication to the higher layer.

   For TRILL Ethernet frames, this is Outer.MacDA and Outer.MacSA.  M1
   is the remainder of the packet.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.1.2.%20%20Transmit%20Processing"></a><a class="selflink" href="#section-4.1.2" name="section-4.1.2">4.1.2</a>.  Transmit Processing</span>

   The ISS layer receives an indication from the higher layer that
   contains (DA, SA, M1).  It constructs an Ethernet frame and passes
   down to the port.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20End-Station%20VLAN%20and%20Priority%20Processing"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  End-Station VLAN and Priority Processing</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.%20%20Receive%20Processing"></a><a class="selflink" href="#section-4.2.1" name="section-4.2.1">4.2.1</a>.  Receive Processing</span>

   Receive (DA, SA, M1) indication from the ISS layer.  Extract the VLAN
   ID and priority from the M1 part of the received indication (or
   derive them from the port defaults or other default parameters) and
   construct (DA, SA, VLAN, PRI, M2).  VLAN+PRI+M2 maps to M1 in the
   received indication.  Pass (DA, SA, VLAN, PRI, M2) to the TRILL
   Encapsulation/Decapsulation layer.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.2.%20%20Transmit%20Processing"></a><a class="selflink" href="#section-4.2.2" name="section-4.2.2">4.2.2</a>.  Transmit Processing</span>

   Receive (DA, SA, VLAN, PRI, M2) indication from the TRILL
   Encapsulation/Decapsulation layer.  Merge VLAN, PRI, M2 to form M1.
   Pass down (DA, SA, M1) to the ISS layer.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20TRILL%20Encapsulation%20and%20Decapsulation%20Layer"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  TRILL Encapsulation and Decapsulation Layer</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.1.%20%20Receive%20Processing%20for%20Unicast%20Packets"></a><a class="selflink" href="#section-4.3.1" name="section-4.3.1">4.3.1</a>.  Receive Processing for Unicast Packets</span>

   o  Receive indication (DA, SA, VLAN, PRI, M2) from the End-Station
      VLAN and Priority Processing layer.

   o  If the DA matches the port Local DA and the frame is of TRILL
      Ethertype:



<span class="grey">Senevirathne, et al.         Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


      -  Discard DA, SA, VLAN, and PRI.  From M2, derive (TRILL-HDR,
         iDA, iSA, i-VL, M3).

      -  If TRILL nickname is Local and TRILL Header Alert flag is set:

         *  Pass on to OAM processing.

      -  Else, pass on (TRILL-HDR, iDA, iSA, i-VL, M3) to the RBridge
         layer.

   o  If the DA matches the port Local DA and the Ethertype is RBridge-
      Channel [<a href="rfc7178.html" title='"Transparent Interconnection of Lots of Links (TRILL): RBridge Channel Support"'>RFC7178</a>]:

      -  Process as a possible unicast native RBridge Channel packet.

   o  If the DA matches the port Local DA and the Ethertype is neither
      TRILL nor RBridge-Channel:

      -  Discard packet.

   o  If the DA does not match, the port is Appointed Forwarder for
      VLAN, and the Ethertype is not TRILL or RBridge-Channel:

      -  Insert TRILL-HDR and send (TRILL-HDR, iDA, iSA,i-VL, M3)
         indication to the RBridge layer (this is the TRILL Ingress
         Function).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.2.%20%20Transmit%20Processing%20for%20Unicast%20Packets"></a><a class="selflink" href="#section-4.3.2" name="section-4.3.2">4.3.2</a>.  Transmit Processing for Unicast Packets</span>

   o  Receive indication (TRILL-HDR, iDA, iSA, iVL, M3) from the RBridge
      layer.

   o  If the egress TRILL nickname is local:

      -  If the port is Appointed Forwarder for iVL, the port is not
         configured as a trunk or point-to-point (P2P) port, the TRILL
         Alert flag is set, and the OAM Ethertype is present, then:

         *  Strip TRILL-HDR and construct (DA, SA, VLAN, M2) (this is
            the TRILL Egress Function).

      - Else:

         *  Discard packet.







<span class="grey">Senevirathne, et al.         Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  If the egress TRILL nickname is not local:

      -  Insert Outer.MacDA, Outer.MacSA, Outer.VLAN, and TRILL
         Ethertype, and construct (DA, SA, VLAN, M2) where M2 is (TRILL-
         HDR, iDA, iSA, iVL, M).

   o  Forward (DA, SA, V, M2) to the End-Station VLAN and Priority
      Processing layer.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.3.%20%20Receive%20Processing%20for%20Multicast%20Packets"></a><a class="selflink" href="#section-4.3.3" name="section-4.3.3">4.3.3</a>.  Receive Processing for Multicast Packets</span>

   o  Receive (DA, SA, V, M2) from the End-Station VLAN and Priority
      Processing layer.

   o  If the DA is All-RBridges and the Ethertype is TRILL:

      -  Strip DA, SA, and V.  From M2, extract (TRILL-HDR, iDA, iSA,
         iVL, and M3).

      -  If the TRILL Alert flag is set and the OAM Ethertype is present
         at the end of Flow Entropy:

         *  Perform OAM processing.

      -  Else, extract the TRILL Header, inner MAC addresses, and
         Inner.VLAN, and pass indication (TRILL-HDR, iDA, iSA, iVL and
         M3) to the TRILL RBridge layer.

   o  If the DA is All-IS-IS-RBridges and the Ethertype is L2-IS-IS,
      then pass frame up to TRILL IS-IS processing.

   o  If the DA is All-RBridges or All-IS-IS-RBridges but the Ethertype
      is not TRILL or L2-IS-IS respectively:

      -  Discard the packet.

   o  If the Ethertype is TRILL but the multicast DA is not All-RBridges
      or if the Ethertype is L2-IS-IS but the multicast DA is not All-
      IS-IS-RBridges:

      -  Discard the packet.

   o  If the DA is All-Edge-RBridges and the Ethertype is RBridge-
      Channel [<a href="rfc7178.html" title='"Transparent Interconnection of Lots of Links (TRILL): RBridge Channel Support"'>RFC7178</a>]:

      -  Process as a possible multicast native RBridge Channel packet.





<span class="grey">Senevirathne, et al.         Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  If the DA is in the initial bridging/link protocols block
      (01-80-C2-00-00-00 to 01-80-C2-00-00-0F) or is in the TRILL block
      and not assigned for Outer.MacDA use (01-80-C2-00-00-42 to
      01-80-C2-00-00-4F), then:

      -  The frame is not propagated through an RBridge although some
         special processing may be done at the port as specified in
         [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>], and the frame may be dispatched to Layer 2
         processing at the port if certain protocols are supported by
         that port (examples include the Link Aggregation Protocol and
         the Link-Layer Discovery Protocol).

   o  If the DA is some other multicast value:

      -  Insert TRILL-HDR and construct (TRILL-HDR, iDA, iSA, IVL, M3).

      -  Pass the (TRILL-HDR, iDA, iSA, IVL, M3) to the RBridge layer.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.4.%20%20Transmit%20Processing%20of%20Multicast%20Packets"></a><a class="selflink" href="#section-4.3.4" name="section-4.3.4">4.3.4</a>.  Transmit Processing of Multicast Packets</span>

   The following ignores the case of transmitting TRILL IS-IS packets.

   o  Receive indication (TRILL-HDR, iDA, iSA, iVL, M3) from the RBridge
      layer.

   o  If the TRILL Header multicast ("M") flag is set, the TRILL-HDR
      Alert flag is set, and the OAM Ethertype is present, then:

      -  Construct (DA, SA, V, M2) by inserting TRILL Outer.MacDA of
         All-RBridges, Outer.MacSA, Outer.VLAN, and TRILL Ethertype.  M2
         here is (Ethertype TRILL, TRILL-HDR, iDA, iSA, iVL, M).

         Note: A second copy of native format is not made.

   o  Else, if the TRILL Header multicast ("M") flag is set and the
         Alert flag not set:

      -  If the port is Appointed Forwarder for iVL and the port is not
         configured as a trunk port or a P2P port, strip TRILL-HDR, iSA,
         iDA, and iVL and construct (DA, SA, V, M2) for native format.

      -  Make a second copy (DA, SA, V, M2) by inserting TRILL
         Outer.MacDA, Outer.MacSA, Outer.VLAN, and TRILL Ethertype.  M2
         here is (Ethertype TRILL, TRILL-HDR, iDA, iSA, iVL, M).

   o  Pass the indication (DA, SA, V, M2) to the End-Station VLAN and
      Priority Processing layer.




<span class="grey">Senevirathne, et al.         Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20TRILL%20OAM%20Layer%20Processing"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  TRILL OAM Layer Processing</span>

   The TRILL OAM layer is located between the TRILL
   Encapsulation/Decapsulation layer and the RBridge layer.  It performs
   the following: 1) identifies OAM frames that need local processing
   and 2) performs OAM processing or redirects to the CPU for OAM
   processing.

   o  Receive indication (TRILL-HDR, iDA, iSA, iVL, M3) from the RBridge
      layer.  M3 is the payload after Inner.VLAN iVL.

   o  If the TRILL Header multicast ("M") flag is set, the TRILL Alert
      flag is set, and TRILL OAM Ethertype is present, then:

      -  If MEP or MIP is configured on the Inner.VLAN/FGL of the
         packet, then:

         *  Discard packets that have MD-Level less than that of the MEP
            or packets that do not have MD-Level present (e.g., due to
            packet truncation).

         *  If MD-Level matches MD-Level of the MEP, then:

            +  Redirect to OAM processing (Do not forward further).

         *  If MD-Level matches MD-Level of MIP, then:

            +  Make a copy for OAM processing and continue.

         *  If MD-Level matches MD-Level of MEP, then:

            +  Redirect the OAM packet to OAM processing and do not
               forward along or forward as a native packet.

   o  Else, if the TRILL Alert flag is set and the TRILL OAM Ethertype
      is present, then:

      -  If MEP or MIP is configured on the Inner.VLAN/FGL of the
         packet, then:

         *  Discard packets that have MD-Level not present or where MD-
            Level is less than that of the MEP.

         *  If MD-Level matches MD-Level of the MEP, then:

            +  Redirect to OAM processing (do not forward further).





<span class="grey">Senevirathne, et al.         Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


         *  If MD-Level matches MD-Level of MIP, then:

            +  Make a copy for OAM processing and continue.

   o  Else, for a non-OAM packet:

      -  Continue.

   o  Pass the indication (DA, SA, V, M2) to the End-Station VLAN and
      Priority Processing layer.

   Note: In the receive path, the processing above compares with the
   Down MEP and MIP Half functions.  In the transmit processing, it
   compares with Up MEP and MIP Half functions.

   Appointed Forwarder is a function that the TRILL
   Encapsulation/Decapsulation layer performs.  The TRILL
   Encapsulation/Decapsulation layer is responsible for prevention of
   leaking of OAM packets as native frames.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Maintenance%20Associations%20%28MAs%29%20in%20TRILL"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Maintenance Associations (MAs) in TRILL</span>

   [<a id="ref-8021Q" name="ref-8021Q">8021Q</a>] defines a Maintenance Association as a logical relationship
   between a group of nodes.  Each Maintenance Association (MA) is
   identified with a unique MAID of 48 bytes [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].  CCM and other
   related OAM functions operate within the scope of an MA.  The
   definition of MA is technology independent.  Similarly, it is encoded
   within the OAM message, not in the technology-dependent portion of
   the packet.  Hence, the MAID as defined in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] can be utilized
   for TRILL OAM without modifications.  This also allows us to utilize
   CCM and LBM messages defined in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] as is.

   In TRILL, an MA may contain two or more RBridges (MEPs).  For
   unicast, it is likely that the MA contains exactly two MEPs that are
   the two end points of the flow.  For multicast, the MA may contain
   two or more MEPs.

   For TRILL, in addition to all of the standard [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] CFM MIB
   definitions, each MEP's MIB contains one or more Flow Entropy
   definitions corresponding to the set of flows that the MEP monitors.

   [<a id="ref-8021Q" name="ref-8021Q">8021Q</a>] CFM MIB is augmented to add the TRILL-specific information.
   Figure 5 depicts the augmentation of the CFM MIB to add the TRILL-
   specific Flow Entropy.







<span class="grey">Senevirathne, et al.         Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


             MA---
            |
             --- MEP
            |
            . - Remote MEP List
                   .
                   |
                    --- MEP-A
                   |
                    --- MEP-B
                   .

            |
            . - Flow Entropy List { Augments IEEE8021-CFM-MIB}

                   |
                    --- (Flow Entropy-1)
                   |
                    --- (Flow Entropy-2)
                   |
                   . --- (Flow Entropy-n)
           |
            Other MIB entries

          Figure 5: Correlation of TRILL-Augmented MIB

   The detailed TRILL OAM MIB will be specified in a separate document
   [<a href="#ref-TRILLOAMMIB">TRILLOAMMIB</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20MEP%20Addressing"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  MEP Addressing</span>

   In IEEE CFM [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>], OAM messages address the target MEP by utilizing
   a unique MAC address.  In TRILL, a MEP is addressed by a combination
   of the egress RBridge nickname and the Inner.VLAN/FGL.

   Additionally, MEPs are represented by a 2-octet MEP-ID that is
   independent of the underlying technology.  In CFM [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>], the value
   of MEP-ID is restricted to the range of 1 to 8191.  However, on a CFM
   [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] packet, MEP-IDs are encoded as a 2-octet field.  In the TRILL
   Base Mode operation presented in <a href="#appendix-B">Appendix B</a>, MEP-IDs are mapped
   1-to-1 with the RBridge nicknames.  Hence, in TRILL, a MEP-ID MUST be
   a number in the range from 1 to 65535.

   At the MEP, OAM packets go through a hierarchy of OpCode
   demultiplexers.  The OpCode demultiplexers channel the incoming OAM
   packets to the appropriate message processor (e.g., LBM).  Refer to
   Figure 6 for a visual depiction of these different demultiplexers.




<span class="grey">Senevirathne, et al.         Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   The demultiplexing sequence is as follows:

   1.  Identify the packets that need OAM processing at the local
       RBridge as specified in <a href="#section-4">Section 4</a>.

       a.  Identify the MEP that is associated with the Inner.VLAN/FGL.

   2.  The MEP first validates the MD-Level and then:

       a.  Redirects to the MD-Level demultiplexer.

   3.  The MD-Level demultiplexer compares the MD-Level of the packet
       against the MD-Level of the local MEPs of a given MD-Level on the
       port.  (Note: there can be more than one MEP at the same MD-Level
       but they belong to different MAs.)

       a.  If the packet MD-Level is equal to the configured MD-Level of
           the MEP, then pass to the OpCode demultiplexer.

       b.  If the packet MD-Level is less than the configured MD-Level
           of the MEP, discard the packet.

       c.  If the packet MD-Level is greater than the configured
           MD-Level of the MEP, then pass on to the next-higher MD-Level
           demultiplexer, if available.  Otherwise, if no such higher
           MD-Level demultiplexer exists, then forward the packet as
           normal data.

   4.  The OpCode demultiplexer compares the OpCode in the packet with
       supported OpCodes.

       a.  If the OpCode is CCM, LBM, LBR, PTM, PTR, MTVM, or MTVR, then
           pass on to the correct processor.

       b.  If the OpCode is unknown, then discard.
















<span class="grey">Senevirathne, et al.         Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


                            |
                            .CCM   LBM   PTM   MTVM . .
                            |      |    |      |
                          +-+-+-+-+-+-+-+-+-+-+-+-+
                          |        OP Code DE-Mux |--- Unknown
                          +-+-+-+-+-+-+-+-+-+-+-+-+
                            ^       ^          ^
                  MD==Li    |       |          |
                         +-+-+   +-+-+      +-+-+
                         | L |--&gt;|L2 |-.-   |Ln |---- &gt;
                         +-+-+   +-+-+      +-+-+      |
                          |  ^    |          |         |
                  MD&lt;LI Drop |    Drop       Drop      |
                             |                         |
                  MD not --- |TRILL OAM need local     |
                  Present    | Processing              |
                             |                         |
                TRILL Data   ----  TRILL Data         ----
                   -------&gt;| T  |----------------- &gt;|  M |--- &gt;
                + TRILL OAM  ----  + pass through OAM ----

            Figure 6: OAM Demultiplexers at MEP for Active SAP

   o  T: Denotes Tap.  Identifies OAM frames that need local processing.
      These are the packets with the Alert flag set and OAM Ethertype
      present after the Flow Entropy of the packet.

   o  M: The post-processing merge that merges data and OAM messages
      that are passed through.  Additionally, the merge component
      ensures, as explained earlier, that OAM packets are not forwarded
      out as native frames.

   o  L: Denotes MD-Level processing.  Packets whose MD-Level is less
      than the MD-Level of the current processing step will be dropped.
      Packets with equal MD-Levels are passed on to the OpCode
      demultiplexer.  Others are passed on to the next-level MD
      processors or eventually to the merge point (M).

   NOTE: LBM, LBR, MTVM, MTVR, PTM, and PTR are not subject to MA
   demultiplexers.  These packets do not have an MA encoded in the
   packet.  Adequate response can be generated to these packets, without
   loss of functionality, by any of the MEPs present on that interface
   or an entity within the RBridge.








<span class="grey">Senevirathne, et al.         Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Use%20of%20MIP%20in%20TRILL"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Use of MIP in TRILL</span>

   Maintenance Intermediate Points (MIPs) are mainly used for fault
   isolation.  Link Trace Messages in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] utilize a well-known
   multicast MAC address, and MIPs generate responses to Link Trace
   Messages.  Response to Link Trace Messages or lack thereof can be
   used for fault isolation in TRILL.

   As explained in <a href="#section-10">Section 10</a>, a Hop Count expiry approach will be
   utilized for fault isolation and path tracing.  The approach is very
   similar to the well-known IP trace-route approach.  Hence, explicit
   addressing of MIPs is not required for the purpose of fault
   isolation.

   Any given RBridge can have multiple MIPs located within an interface.
   As such, a mechanism is required to identify which MIP should respond
   to an incoming OAM message.  Any MIP residing within the ingress
   interface may reply to the incoming Path Trace Message without loss
   of functionality or information.  As specified in <a href="#section-3.4">Section 3.4</a>, the
   address of the responding RBridge can be identified by means of the
   Sender ID TLV (1).  The Reply Ingress TLV (5) identifies the
   interface id.  The combination of these allows the recipient of the
   response to uniquely identify the responder.

   A similar approach to that presented above for MEPs can be used for
   MIP processing.  It is important to note that "M", the merge block of
   a MIP, does not prevent OAM packets leaking out as native frames.  On
   edge interfaces, MEPs MUST be configured to prevent the leaking of
   TRILL OAM packets out of the TRILL campus.






















<span class="grey">Senevirathne, et al.         Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


                      PTM     PTR     MTVM     MTVR
                       |       |     |      |
                     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                     |             OP Code De-Mux  |-&gt; Unknown
                     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                        ^       ^          ^
              MD==Li    |       |          |
                      +-+-+   +-+-+      +-+-+
                      | L |- &gt;|L2 |-.-   |Ln |------+
                      +-+-+   +-+-+      +-+-+      |
                        ^                         |
                        |                         |
             Drop       |                         |
             MD not --- |TRILL OAM                |
             Present    |                         |
                        |                         v
         TRILL Data   ----  TRILL Data          -----
            ------- &gt;| T  |------------------ &gt;|  M  |----&gt;
         + TRILL OAM  ----                      ----

          Figure 7: OAM Demultiplexers at MIP for Active SAP

   o  T: Tap processing for MIP.  All packets with the TRILL Header
      Alert flag set are captured.

   o  L: MD-Level Processing.  Packets with matching MD-Levels are
      "copied" to the OpCode demultiplexer, and the original packet is
      passed on to the next MD-Level processor.  Other packets are
      simply passed on to the next MD-Level processor without copying to
      the OpCode demultiplexer.

   o  M: The intermediate point processing merge that merges data and
      OAM messages that are passed through.

   Packets that carry Path Trace Message (PTM) or Multi-destination Tree
   Verification Message (MTVM) OpCodes are passed on to the respective
   processors.

   Packets with unknown OpCodes are counted and discarded.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Continuity%20Check%20Message%20%28CCM%29"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Continuity Check Message (CCM)</span>

   CCMs are used to monitor connectivity and configuration errors.
   [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] monitors connectivity by listening to periodic CCM messages
   received from its remote MEP partners in the MA.  An [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] MEP
   identifies cross-connect errors by comparing the MAID in the received
   CCM message with the MEP's local MAID.  The MAID [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] is a 48-byte
   field that is technology independent.  Similarly, the MEP-ID is a



<span class="grey">Senevirathne, et al.         Standards Track                   [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   2-byte field that is independent of the technology.  Given this
   generic definition of CCM fields, CCM as defined in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] can be
   utilized in TRILL with no changes.  TRILL-specific information may be
   carried in CCMs when encoded using TRILL-specific TLVs or sub-TLVs.
   This is possible since CCMs may carry optional TLVs.

   Unlike classical Ethernet environments, TRILL contains multipath
   forwarding.  The path taken by a packet depends on the payload of the
   packet.  The Maintenance Association (MA) identifies the interested
   Maintenance End Points (MEPs) of a given monitored path.  For
   unicast, there are only two MEPs per MA.  For multicast, there can be
   two or more MEPs in the MA.  The entropy values of the monitored
   flows are defined within the MA.  CCM transmit logic will utilize
   these Flow Entropy values when constructing the CCM packets.  Please
   see <a href="#section-12">Section 12</a> for the theory of operation of CCM.

   The MIB in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] is augmented with the definition of Flow Entropy.
   Please see [<a href="#ref-TRILLOAMMIB">TRILLOAMMIB</a>] for this and other TRILL-related OAM MIB
   definitions.  Figure 8 depicts the correlation between MA, CCM, and
   the Flow Entropy.































<span class="grey">Senevirathne, et al.         Standards Track                   [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


             MA---
            |
             --- MEP
            |
            . - Remote MEP List
                   .
                   |
                    --- MEP-A
                   |
                    --- MEP-B
                   .

            |
            . - Flow Entropy List {Augments IEEE8021-CFM-MIB}

                   |
                    --- (Flow Entropy-1)
                   |
                    --- (Flow Entropy-2)
                   |
                   . ---(Flow Entropy-n)
           |
           . - CCM
                  |
                   --- (standard 8021ag entries)
                  |
                   --- (Hop Count) { Augments IEEE8021-CFM-MIB}
                  |
                   --- (Any other TRILL OAM-specific entries)
                                                   {Augmented}
           |
           .
           |
            - Other MIB entries

               Figure 8: Augmentation of CCM MIB in TRILL

   In a multi-pathing environment, a flow, by definition, is
   unidirectional.  A question may arise as to what Flow Entropy should
   be used in the response.  CCMs are unidirectional and have no
   explicit reply; as such, the issue of the response Flow Entropy does
   not arise.  In the transmitted CCM, each MEP reports local status
   using the Remote Defect Indication (RDI) flag.  Additionally, a MEP
   may raise SNMP TRAPs [<a href="#ref-TRILLOAMMIB">TRILLOAMMIB</a>] as alarms when a connectivity
   failure occurs.






<span class="grey">Senevirathne, et al.         Standards Track                   [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20TRILL%20OAM%20Message%20Channel"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  TRILL OAM Message Channel</span>

   The TRILL OAM Message Channel can be divided into two parts: TRILL
   OAM message header and TRILL OAM TLVs.  Every OAM message MUST
   contain a single TRILL OAM message header and a set of one or more
   specified OAM message TLVs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20TRILL%20OAM%20Message%20Header"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  TRILL OAM Message Header</span>

   As discussed earlier, a common messaging framework between [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>],
   TRILL, and other similar standards such as Y.1731 is accomplished by
   reusing the OAM message header defined in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].

    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |MD-L | Version | OpCode        |  Flags        |FirstTLVOffset |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .   OpCode-Specific Information                                 .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .         TLVs                                                  .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                       Figure 9: OAM Message Format

   o  MD-L: Maintenance Domain Level (3 bits).  For TRILL, in general,
      this field is set to a single value across the TRILL campus.  When
      using the TRILL Base Mode as specified in <a href="#appendix-B">Appendix B</a>, MD-L is set
      to 3.  However, extension of TRILL (for example, to support
      multilevel) may create different MD-Levels, and the MD-L field
      must be appropriately set in those scenarios.  (Please refer to
      [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] for the definition of MD-Level).

   o  Version: Indicates the version (5 bits) as specified in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].
      This document does not require changing the Version defined in
      [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].

   o  OpCode: Operation Code (8 bits).  Specifies the operation
      performed by the message.  See <a href="#section-8.2">Section 8.2</a>.

   o  Flags: Includes operational flags (1 byte).  The definition of
      flags is OpCode-specific and is covered in the applicable
      sections.






<span class="grey">Senevirathne, et al.         Standards Track                   [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  FirstTLVOffset: Defines the location of the first TLV, in bytes,
      starting from the end of the FirstTLVOffset field (1 byte).
      (Refer to [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] for the definition of the FirstTLVOffset.)

   o  OpCode-Specific Information: May contain Session Identification
      Number, timestamp, etc.

   The MD-L, Version, OpCode, Flags, and FirstTLVOffset fields
   collectively are referred to as the OAM message header.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20TRILL-Specific%20OAM%20OpCodes"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  TRILL-Specific OAM OpCodes</span>

   The following TRILL-specific CFM OpCodes are defined.  Each of the
   OpCodes indicates a separate type of TRILL OAM message.  Details of
   the messages are presented in Sections <a href="#section-10">10</a> and <a href="#section-11">11</a>.

   TRILL OAM message OpCodes:

      64: Path Trace Reply
      65: Path Trace Message
      66: Multi-destination Tree Verification Reply
      67: Multi-destination Tree Verification Message

   Loopback and CCM Messages reuse the OpCodes defined by [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.3.%20%20Format%20of%20TRILL%20OAM%20TLV"></a><a class="selflink" href="#section-8.3" name="section-8.3">8.3</a>.  Format of TRILL OAM TLV</span>

   The same CFM TLV format as defined in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] is used for TRILL OAM.
   The following figure depicts the general format of a TRILL OAM TLV:

        0                   1                   2
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |    Type       |        Length                 |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                               |
       .            Value (variable)                   .
       |                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                   Figure 10: TRILL OAM TLV

   o  Type (1 octet): Specifies the type of the TLV (see <a href="#section-8.4">Section 8.4</a> for
      TLV types).

   o  Length (2 octets): Specifies the length of the Value field in
      octets.  Length of the Value field can be zero or more octets.




<span class="grey">Senevirathne, et al.         Standards Track                   [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  Value (variable): The length and the content of this field depend
      on the type of TLV.  Please refer to applicable TLV definitions
      for details.

   Semantics and usage of Type values allocated for TRILL OAM purpose
   are defined by this document and other future related documents.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.4.%20%20TRILL%20OAM%20TLVs"></a><a class="selflink" href="#section-8.4" name="section-8.4">8.4</a>.  TRILL OAM TLVs</span>

   TRILL-related TLVs are defined in this section.  TLVS defined in
   [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] are reused, where applicable.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.1.%20%20Common%20TLVs%20between%20CFM%20and%20TRILL"></a><a class="selflink" href="#section-8.4.1" name="section-8.4.1">8.4.1</a>.  Common TLVs between CFM and TRILL</span>

   The following TLVs are defined in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].  We reuse them where
   applicable.  The format and semantics of the TLVs are as defined in
   [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].

      Type   Name of TLV in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]
      ----   ----------------------
        0    End TLV
        1    Sender ID TLV
        2    Port Status TLV
        3    Data TLV
        4    Interface Status TLV
        5    Reply Ingress TLV
        6    Reply Egress TLV
        7    LTM Egress Identifier TLV
        8    LTR Egress Identifier TLV
        9-30 Reserved
        31   Organization Specific TLV

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.2.%20%20TRILL%20OAM-Specific%20TLVs"></a><a class="selflink" href="#section-8.4.2" name="section-8.4.2">8.4.2</a>.  TRILL OAM-Specific TLVs</span>

   Listed below is a summary of TRILL OAM TLVs and their corresponding
   codes.  Format and semantics of TRILL OAM TLVs are defined in
   subsequent sections.














<span class="grey">Senevirathne, et al.         Standards Track                   [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


       Type         TLV Name
       ----         ------------------------------------
       64           TRILL OAM Application Identifier TLV
       65           Out-of-Band Reply Address TLV
       66           Diagnostic Label TLV
       67           Original Data Payload TLV
       68           RBridge Scope TLV
       69           Previous RBridge Nickname TLV
       70           Next-Hop RBridge List TLV
       71           Multicast Receiver Port Count TLV
       72           Flow Identifier TLV
       73           Reflector Entropy TLV
       74           Authentication TLV

   The TRILL OAM Application Identifier TLV (64) MUST be the first TLV.
   An End TLV (0) MUST be included as the last TLV.  All other TLVs can
   be included in any order.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.3.%20%20TRILL%20OAM%20Application%20Identifier%20TLV"></a><a class="selflink" href="#section-8.4.3" name="section-8.4.3">8.4.3</a>.  TRILL OAM Application Identifier TLV</span>

   The TRILL OAM Application Identifier TLV carries information specific
   to TRILL OAM applications.  The TRILL OAM Application Identifier TLV
   MUST always be present and MUST be the first TLV in TRILL OAM
   messages.  Messages that do not include the TRILL OAM Application
   Identifier TLV as the first TLV MUST be discarded by a TRILL MP.

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        | Version       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |               Reserved1                       | Fragment-ID   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Return Code  |Return Sub-code|     Reserved2         |F|C|O|I|
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

            Figure 11: TRILL OAM Application Identifier TLV

   o  Type (1 octet): 64, TRILL OAM Application Identifier TLV

   o  Length (2 octets): 9

   o  Version (1 octet): Currently set to zero.  Indicates the TRILL OAM
      version.  The TRILL OAM version can be different than the [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]
      version.

   o  Reserved1 (3 octets): Set to zero on transmission and ignored on
      reception.



<span class="grey">Senevirathne, et al.         Standards Track                   [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  Fragment-ID (1 octet): Indicates the fragment number of the
      current message.  This applies only to reply messages; in request
      messages, it must be set to zero on transmission and ignored on
      receipt.  The "F" flag defined below MUST be set with the final
      message, whether it is the last fragment of the fragmented message
      or the only message of the reply.  <a href="#section-13">Section 13</a> provides more
      details on OAM message fragmentation.

   o  Return Code (1 octet): Set to zero on requests.  Set to an
      appropriate value in response messages.

   o  Return Sub-code (1 octet): Set to zero on transmission of request
      message.  The Return Sub-code identifies categories within a
      specific Return Code and MUST be interpreted within a Return Code.

   o  Reserved2 (12 bits): Set to zero on transmission and ignored on
      reception.

   o  F (1 bit): Final flag.  When set, indicates this is the last
      response.

   o  C (1 bit): Cross-Connect Error flag (VLAN/FGL mapping error).  If
      set, indicates that the label (VLAN/FGL) in the Flow Entropy is
      different than the label included in the Diagnostic Label TLV.
      This field is ignored in request messages and MUST only be
      interpreted in response messages.

   o  O (1 bit): If set, indicates OAM out-of-band response requested.

   o  I (1 bit): If set, indicates OAM in-band response requested.

   NOTE: When both O and I bits are set to zero, this indicates that no
   response is required (silent mode).  Users MAY specify both O and I,
   one of them, or none.  When both O and I bits are set, the response
   is sent both in-band and out-of-band.
















<span class="grey">Senevirathne, et al.         Standards Track                   [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.4.%20%20Out-of-Band%20Reply%20Address%20TLV"></a><a class="selflink" href="#section-8.4.4" name="section-8.4.4">8.4.4</a>.  Out-of-Band Reply Address TLV</span>

   The Out-of-Band Reply Address TLV specifies the address to which an
   out-of-band OAM reply message MUST be sent.  When the O bit in the
   TRILL Version sub-TLV (<a href="#section-3.3">Section 3.3</a>) is not set, the Out-of-Band Reply
   Address TLV is ignored.

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        | Address Type  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | Addr Length   |                                               |
    +-+-+-+-+-+-+-+-+                                               |
    |                                                               |
    .       Reply Address                                           .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 12: Out-of-Band Reply Address TLV

   o  Type (1 octet): 65, Out-of-Band Reply Address TLV

   o  Length (2 octets): Variable.  Minimum length is 2 + the length (in
      octets) of the shortest address.  Currently, the minimum value of
      this field is 4, but this could change in the future if a new
      address shorter than the TRILL nickname is defined.

   o  Address Type (1 octet):

         0 - IPv4

         1 - IPv6

         2 - TRILL nickname

      All other values reserved.

   o  Addr Length (1 octet): Depends on the Address Type.  Currently,
      defined values are:

         4  - IPv4

         16 - IPv6

         2  - TRILL nickname

      Other lengths may be acceptable for future Address Types.



<span class="grey">Senevirathne, et al.         Standards Track                   [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  Reply Address (variable): Address where the reply needs to be
      sent.  Length depends on the address specification.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.5.%20%20Diagnostic%20Label%20TLV"></a><a class="selflink" href="#section-8.4.5" name="section-8.4.5">8.4.5</a>.  Diagnostic Label TLV</span>

   The Diagnostic Label TLV specifies the data label (VLAN or FGL) in
   which the OAM messages are generated.  Receiving RBridge MUST compare
   the data label of the Flow Entropy to the data label specified in the
   Diagnostic Label TLV.  The "C" flag (Cross Connect Error) in the
   response (TRILL OAM Application Identifier TLV; <a href="#section-8.4.3">Section 8.4.3</a>) MUST
   be set when the two VLANs do not match.

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        | L-Type        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | Reserved      |                       Label                   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                      Figure 13: Diagnostic Label TLV

   o  Type (1 octet): 66, Diagnostic Label TLV

   o  Length (2 octets): 5

   o  L-Type (1 octet): Label type

      0 - Indicates a right-justified 802.1Q 12-bit VLAN padded on the
          left with bits that must be sent as zero and ignored on
          receipt

      1 - Indicates a TRILL 24-bit fine-grained label

   o  Reserved (1 octet): Set to zero on transmission and ignored on
      reception.

   o  Label (24 bits): Either 12-bit VLAN or 24 bit fine-grained label.

   RBridges do not perform label error checking when the Diagnostic
   Label TLV is not included in the OAM message.  In certain
   deployments, intermediate devices may perform label translation.  In
   such scenarios, the originator should not include the Diagnostic
   Label TLV in OAM messages.  Inclusion of Diagnostic Label TLV will
   generate unwanted label error notifications.






<span class="grey">Senevirathne, et al.         Standards Track                   [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.6.%20%20Original%20Data%20Payload%20TLV"></a><a class="selflink" href="#section-8.4.6" name="section-8.4.6">8.4.6</a>.  Original Data Payload TLV</span>

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        |               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +
    |                                                               |
    .                Original Payload                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 14: Original Data Payload TLV

   o  Type (1 octet): 67, Original Data Payload TLV

   o  Length (2 octets): variable

   o  Original Payload: The original TRILL Header and Flow Entropy.
      Used in constructing replies to the Loopback Message (see
      <a href="#section-9">Section 9</a>) and the Path Trace Message (see <a href="#section-10">Section 10</a>).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.7.%20%20RBridge%20Scope%20TLV"></a><a class="selflink" href="#section-8.4.7" name="section-8.4.7">8.4.7</a>.  RBridge Scope TLV</span>

   The RBridge Scope TLV identifies nicknames of RBridges from which a
   response is required.  The RBridge Scope TLV is only applicable to
   Multi-destination Tree Verification Messages.  This TLV SHOULD NOT be
   included in other messages.  Receiving RBridges MUST ignore this TLV
   on messages other than Multi-destination Tree Verification Messages.

   Each TLV can contain up to 255 nicknames of in-scope RBridges.  A
   Multi-destination Tree Verification Message may contain multiple
   RBridge scope TLVs, in the event that more than 255 in-scope RBridges
   need to be specified.

   Absence of the RBridge Scope TLV indicates that a response is needed
   from all the RBridges.  Please see <a href="#section-11">Section 11</a> for details.














<span class="grey">Senevirathne, et al.         Standards Track                   [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        | nOfnicknames  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Nickname-1                   |   Nickname-2                  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                               |  Nickname-n                   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                     Figure 15: RBridge Scope TLV

   o  Type (1 octet): 68, RBridge Scope TLV

   o  Length (2 octets): Variable.  Minimum value is 1.

   o  nOfnicknames (1 octet): Indicates the number of nicknames included
      in this TLV.  Zero (0) indicates no nicknames are included in the
      TLV.  When this field is set to zero (0), the Length field MUST be
      set to 1.

   o  Nickname (2 octets): 16-bit RBridge nickname

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.8.%20%20Previous%20RBridge%20Nickname%20TLV"></a><a class="selflink" href="#section-8.4.8" name="section-8.4.8">8.4.8</a>.  Previous RBridge Nickname TLV</span>

   The Previous RBridge Nickname TLV identifies the nickname or
   nicknames of the previous RBridge.  [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] allows a given RBridge
   to hold multiple nicknames.

   The Previous RBridge Nickname TLV is an optional TLV.  Multiple
   instances of this TLV MAY be included when an upstream RBridge is
   represented by more than 255 nicknames (highly unlikely).

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        | Reserved      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Reserved (continued)         |   Nickname                    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                 Figure 16: Previous RBridge Nickname TLV

   o  Type (1 octet): 69, Previous RBridge Nickname TLV

   o  Length (2 octets): 5



<span class="grey">Senevirathne, et al.         Standards Track                   [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  Reserved (3 octet): Set to zero on transmission and ignored on
      reception.

   o  Nickname (2 octets): RBridge nickname

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.9.%20%20Next-Hop%20RBridge%20List%20TLV"></a><a class="selflink" href="#section-8.4.9" name="section-8.4.9">8.4.9</a>.  Next-Hop RBridge List TLV</span>

   The Next-Hop RBridge List TLV identifies the nickname or nicknames of
   the downstream next-hop RBridges.  [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] allows a given RBridge
   to have multiple equal-cost paths to a specified destination.  Each
   next-hop RBridge is represented by one of its nicknames.

   The Next-Hop RBridge List TLV is an optional TLV.  Multiple instances
   of this TLV MAY be included when there are more than 255 equal-cost
   paths to the destination.

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        | nOfnicknames  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Nickname-1                   |   Nickname-2                  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                               |  Nickname-n                   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 17: Next-Hop RBridge List TLV

   o  Type (1 octet): 70, Next-Hop RBridge List TLV

   o  Length (2 octets): Variable. Minimum value is 1.

   o  nOfnicknames (1 octet): Indicates the number of nicknames included
      in this TLV.  Zero (0) indicates no nicknames are included in the
      TLV.  When this field is set to zero (0), the Length field MUST be
      set to 1.

   o  Nickname (2 octets): 16-bit RBridge nickname

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.10.%20%20Multicast%20Receiver%20Port%20Count%20TLV"></a><a class="selflink" href="#section-8.4.10" name="section-8.4.10">8.4.10</a>.  Multicast Receiver Port Count TLV</span>

   The Multicast Receiver Port Count TLV identifies the number of ports
   interested in receiving the specified multicast stream within the
   responding RBridge on the label (VLAN or FGL) specified by the
   Diagnostic Label TLV.




<span class="grey">Senevirathne, et al.         Standards Track                   [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   The Multicast Receiver Port Count TLV is an optional TLV.

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        | Reserved      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Number of Receivers                              |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

              Figure 18: Multicast Receiver Port Count TLV

   o  Type (1 octet): 71, Multicast Receiver Port Count TLV

   o  Length (2 octets): 5

   o  Reserved (1 octet): Set to zero on transmission and ignored on
      reception.

   o  Number of Receivers (4 octets): Indicates the number of multicast
      receivers available on the responding RBridge on the label
      specified by the diagnostic label.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.11.%20%20%20Flow%20Identifier%20TLV"></a><a class="selflink" href="#section-8.4.11" name="section-8.4.11">8.4.11</a>.   Flow Identifier TLV</span>

   The Flow Identifier TLV uniquely identifies a specific flow.  The
   flow-identifier value is unique per MEP and needs to be interpreted
   as such.

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        | Reserved      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  MEP-ID                       |     flow-identifier           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                     Figure 19: Flow Identifier TLV

   o  Type (1 octet): 72, Flow Identifier TLV

   o  Length (2 octets): 5

   o  Reserved (1 octet): Set to 0 on transmission and ignored on
      reception.

   o  MEP-ID (2 octets): MEP-ID of the originator [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].  In TRILL,
      MEP-ID can take a value from 1 to 65535.



<span class="grey">Senevirathne, et al.         Standards Track                   [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  flow-identifier (2 octets): Uniquely identifies the flow per MEP.
      Different MEPs may allocate the same flow-identifier value.  The
      {MEP-ID, flow-identifier} pair is globally unique.

   Inclusion of the MEP-ID in the Flow Identifier TLV allows the
   inclusion of a MEP-ID for messages that do not contain a MEP-ID in
   their OAM header.  Applications may use MEP-ID information for
   different types of troubleshooting.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.12.%20%20Reflector%20Entropy%20TLV"></a><a class="selflink" href="#section-8.4.12" name="section-8.4.12">8.4.12</a>.  Reflector Entropy TLV</span>

   The Reflector Entropy TLV is an optional TLV.  This TLV, when
   present, tells the responder to utilize the Reflector Entropy
   specified within the TLV as the flow-entropy of the response message.

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        | Reserved      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .               Reflector Entropy                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                     Figure 20: Reflector Entropy TLV

   o  Type (1 octet): 73, Reflector Entropy TLV

   o  Length (2 octets): 97

   o  Reserved (1 octet): Set to zero on transmission and ignored by the
      recipient.

   o  Reflector Entropy (96 octets): Flow Entropy to be used by the
      responder.  May be padded with zeros if the desired flow-entropy
      information is less than 96 octets.














<span class="grey">Senevirathne, et al.         Standards Track                   [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.13.%20%20Authentication%20TLV"></a><a class="selflink" href="#section-8.4.13" name="section-8.4.13">8.4.13</a>.  Authentication TLV</span>

   The Authentication TLV is an optional TLV that can appear in any OAM
   message or reply in TRILL.

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        |  Auth Type    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .                 Authentication Value                          .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Figure 21: Authentication TLV

   o  Type (1 octet): 74, Authentication TLV

   o  Length (2 octets): Variable

   o  The Auth Type and following Authentication Value are the same as
      the Auth Type and following value for the [<a href="#ref-IS-IS" title='"Information technology -- Telecommunications and information exchange between systems -- Intermediate System to Intermediate System intra-domain routeing information exchange protocol for use in conjunction with the protocol for providing the connectionless-mode network service (ISO 8473)"'>IS-IS</a>] Authentication
      TLV.  It is RECOMMENDED that Auth Type 3 be used.  Auth Types 0,
      1, 2, and 54 MUST NOT be used.  With Auth Type 3, the
      Authentication TLV is as follows:

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type       | Length                        | Auth Type = 3 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Key ID                     |                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               .
    .                      Authentication Data (variable)           .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

            Figure 22: Authentication TLV with Auth Type 3

   With Auth Type 3, the process is generally as specified in [<a href="rfc5310.html" title='"IS-IS Generic Cryptographic Authentication"'>RFC5310</a>]
   using the same Key ID space as TRILL [<a href="#ref-IS-IS" title='"Information technology -- Telecommunications and information exchange between systems -- Intermediate System to Intermediate System intra-domain routeing information exchange protocol for use in conjunction with the protocol for providing the connectionless-mode network service (ISO 8473)"'>IS-IS</a>].  The area covered by
   the Authentication TLV is from the beginning of the TRILL Header to
   the end of the TRILL OAM Message Channel; the Link Header and Trailer
   are not included.  The TRILL Header Alert, Reserved bit, and Hop
   Count are treated as zero for the purposes of computing and verifying
   the Authentication Data.




<span class="grey">Senevirathne, et al.         Standards Track                   [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   Key distribution is out of the scope of this document as the keying
   distributed for IS-IS is used.

   An RBridge supporting OAM authentication can be configured to either
   (1) ignore received OAM Authentication TLVs and not send them, (2)
   ignore received OAM Authentication TLVs but include them in all OAM
   packets sent, or (3) to include Authentication TLVs in all OAM
   messages sent and enforce authentication of OAM messages received.
   When an RBridge is enforcing authentication, it discards any OAM
   message subject to OAM processing that does not contain an
   Authentication TLV or an Authentication TLV does not verify.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Loopback%20Message"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Loopback Message</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Loopback%20Message%20Format"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Loopback Message Format</span>

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |MD-L | Version | OpCode        |  Flags        |FirstTLVOffset |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                   Loopback Transaction Identifier             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .         TLVs                                                  .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 23: Loopback Message Format

   The figure above depicts the format of the Loopback Request and
   Response messages as defined in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].  The OpCode for the Loopback
   Message is set to 3, and the OpCode for the reply message is set to 2
   [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].  The Loopback Transaction Identifier (commonly called the
   Session Identification Number or Session ID in this document) is a
   32-bit integer that allows the requesting RBridge to uniquely
   identify the corresponding session.  Responding RBridges, without
   modification, MUST echo the received "Loopback Transaction
   Identifier" number.












<span class="grey">Senevirathne, et al.         Standards Track                   [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Theory%20of%20Operation"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Theory of Operation</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.2.1.%20%20Actions%20by%20Originator%20RBridge"></a><a class="selflink" href="#section-9.2.1" name="section-9.2.1">9.2.1</a>.  Actions by Originator RBridge</span>

   The originator RBridge takes the following actions:

   o  Identifies the destination RBridge nickname based on user
      specification or based on the specified destination MAC or IP
      address.

   o  Constructs the Flow Entropy based on user-specified parameters or
      implementation-specific default parameters.

   o  Constructs the TRILL OAM header: sets the OpCode to Loopback
      Message type (3) [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].  Assigns applicable Loopback Transaction
      Identifier number for the request.

   o  The TRILL OAM Application Identifier TLV MUST be included with the
      flags set to applicable values.

   o  Includes following OAM TLVs, where applicable:

      -  Out-of-Band Reply Address TLV

      -  Diagnostic Label TLV

      -  Sender ID TLV

   o  Specifies the Hop Count of the TRILL Data frame per user
      specification or utilize an applicable Hop Count value.

   o  Dispatches the OAM frame for transmission.

   RBridges may continue to retransmit the request at periodic intervals
   until a response is received or the retransmission count expires.  At
   each transmission, the Session Identification Number MUST be
   incremented.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.2.2.%20%20Intermediate%20RBridge"></a><a class="selflink" href="#section-9.2.2" name="section-9.2.2">9.2.2</a>.  Intermediate RBridge</span>

   Intermediate RBridges forward the frame as a normal data frame; no
   special handling is required.









<span class="grey">Senevirathne, et al.         Standards Track                   [Page 39]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-40" id="page-40" name="page-40"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.2.3.%20%20Destination%20RBridge"></a><a class="selflink" href="#section-9.2.3" name="section-9.2.3">9.2.3</a>.  Destination RBridge</span>

   If the Loopback Message is addressed to the local RBridge and
   satisfies the OAM identification criteria specified in <a href="#section-3.1">Section 3.1</a>,
   then the RBridge data plane forwards the message to the CPU for
   further processing.

   The TRILL OAM application layer further validates the received OAM
   frame by checking for the presence of OAM Ethertype at the end of the
   Flow Entropy.  Frames that do not contain OAM Ethertype at the end of
   the Flow Entropy MUST be discarded.

   Construction of the TRILL OAM response:

   o  The TRILL OAM application encodes the received TRILL Header and
      Flow Entropy in the Original Data Payload TLV and includes it in
      the OAM message.

   o  Set the Return Code to (1) "Reply" and Return Sub-code to zero (0)
      "Valid Response".  Update the TRILL OAM OpCode to 2 (Loopback
      Message Reply).

   o  Optionally, if the VLAN/FGL identifier value of the received Flow
      Entropy differs from the value specified in the Diagnostic Label
      TLV, set the "C" flag (Cross Connect Error) in the TRILL OAM
      Application Identifier TLV.

   o  Include the Sender ID TLV (1).

   o  If in-band response was requested, dispatch the frame to the TRILL
      data plane with request-originator RBridge nickname as the egress
      RBridge nickname.

   o  If out-of-band response was requested, dispatch the frame to the
      IP forwarding process.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Path%20Trace%20Message"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Path Trace Message</span>

   The primary use of the Path Trace Message is for fault isolation.  It
   may also be used for plotting the path taken from a given RBridge to
   another RBridge.

   [<a id="ref-8021Q" name="ref-8021Q">8021Q</a>] accomplishes the objectives of the TRILL Path Trace Message
   using Link Trace Messages.  Link Trace Messages utilize a well-known
   multicast MAC address.  This works for [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] because both the
   unicast and multicast paths are congruent.  However, in TRILL,
   multicast and unicast are not congruent.  Hence, TRILL OAM uses a new
   message format: the Path Trace Message.



<span class="grey">Senevirathne, et al.         Standards Track                   [Page 40]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-41" id="page-41" name="page-41"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   The Path Trace Message has the same format as the Loopback Message.
   The OpCode for Path Trace Reply is 64, and the OpCode for the Path
   Trace Message is 65.

   Operation of the Path Trace Message is identical to the Loopback
   Message except that it is first transmitted with a TRILL Header Hop
   Count field value of 1.  The sending RBridge expects an "Intermediate
   RBridge" Return Sub-code from the next hop or a "Valid response"
   Return Sub-code response from the destination RBridge.  If an
   "Intermediate RBridge" Return Sub-code is received in the response,
   the originator RBridge records the information received from the
   intermediate node that generated the message and resends the message
   by incrementing the previous Hop Count value by 1.  This process is
   continued until, a response is received from the destination RBridge,
   a Path Trace process timeout occurs, or the Hop Count reaches a
   configured maximum value.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Theory%20of%20Operation"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Theory of Operation</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.1.1.%20%20Actions%20by%20Originator%20RBridge"></a><a class="selflink" href="#section-10.1.1" name="section-10.1.1">10.1.1</a>.  Actions by Originator RBridge</span>

   The originator RBridge takes the following actions:

   o  Identifies the destination RBridge based on user specification or
      based on location of the specified MAC address.

   o  Constructs the Flow Entropy based on user-specified parameters or
      implementation-specific default parameters.

   o  Constructs the TRILL OAM header: set the OpCode to Path Trace
      Message type (65).  Assign an applicable Session Identification
      number for the request.  Return Code and Return Sub-code MUST be
      set to zero.

   o  The TRILL OAM Application Identifier TLV MUST be included with the
      flags set to applicable values.

   o  Includes the following OAM TLVs, where applicable:

      -  Out-of-Band Reply Address TLV

      -  Diagnostic Label TLV

      -  Sender ID TLV

   o  Specifies the Hop Count of the TRILL Data frame as 1 for the first
      request.




<span class="grey">Senevirathne, et al.         Standards Track                   [Page 41]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-42" id="page-42" name="page-42"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  Dispatches the OAM frame to the TRILL data plane for transmission.

   An RBridge may continue to retransmit the request at periodic
   intervals until a response is received or the retransmission count
   expires.  At each new retransmission, the Session Identification
   number MUST be incremented.  Additionally, for responses received
   from intermediate RBridges, the RBridge nickname and interface
   information MUST be recorded.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.1.2.%20%20Intermediate%20RBridge"></a><a class="selflink" href="#section-10.1.2" name="section-10.1.2">10.1.2</a>.  Intermediate RBridge</span>

   Path Trace Messages transit through Intermediate RBridges
   transparently, unless the Hop Count has expired.

   The TRILL OAM application layer further validates the received OAM
   frame by examining the presence of the TRILL Alert flag and OAM
   Ethertype at the end of the Flow Entropy and by examining the
   MD-Level.  Frames that do not contain OAM Ethertype at the end of the
   Flow Entropy MUST be discarded.

   Construction of the TRILL OAM response:

   o  The TRILL OAM application encodes the received TRILL Header and
      Flow Entropy in the Original Data Payload TLV and includes it in
      the OAM message.

   o  Set the Return Code to (1) "Reply" and Return Sub-code to two (2)
      "Intermediate RBridge".  Update the TRILL OAM OpCode to 64 (Path
      Trace Reply).

   o  If the VLAN/FGL identifier value of the received Flow Entropy
      differs from the value specified in the diagnostic label, set the
      "C" flag (Cross Connect Error) in the TRILL OAM Application
      Identifier TLV.

   o  Include the following TLVs:

      -  Previous RBridge Nickname TLV (69)

      -  Reply Ingress TLV (5)

      -  Reply Egress TLV (6)

      -  Interface Status TLV (4)

      -  Next-Hop RBridge List TLV (70) (Repeat for each ECMP)

      -  Sender ID TLV (1)



<span class="grey">Senevirathne, et al.         Standards Track                   [Page 42]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-43" id="page-43" name="page-43"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  If a cross-connect error is detected, set the "C" flag (Cross-
      Connect Error) in the reply's TRILL OAM Application Identifier
      TLV.

   o  If in-band response was requested, dispatch the frame to the TRILL
      data plane with request-originator RBridge nickname as the egress
      RBridge nickname.

   o  If out-of-band response was requested, dispatch the frame to the
      standard IP forwarding process.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.1.3.%20%20Destination%20RBridge"></a><a class="selflink" href="#section-10.1.3" name="section-10.1.3">10.1.3</a>.  Destination RBridge</span>

   Processing is identical to that in <a href="#section-10.1.2">Section 10.1.2</a> with the exception
   that the TRILL OAM OpCode is set to Path Trace Reply (64).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Multi-Destination%20Tree%20Verification%20Message%20%28MTVM%29"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Multi-Destination Tree Verification Message (MTVM)</span>

   Multi-destination Tree Verification Messages allow verifying TRILL
   distribution tree integrity and pruning.  TRILL VLAN/FGL and
   multicast pruning are described in [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>], [<a href="rfc7180.html" title='"Transparent Interconnection of Lots of Links (TRILL): Clarifications, Corrections, and Updates"'>RFC7180</a>], and
   [<a href="rfc7172.html" title='"Transparent Interconnection of Lots of Links (TRILL): Fine-Grained Labeling"'>RFC7172</a>].  Multi-destination Tree Verification and Multicast Group
   Verification Messages are designed to detect pruning defects.
   Additionally, these tools can be used for plotting a given multicast
   tree within the TRILL campus.

   Multi-destination Tree Verification OAM frames are copied to the CPU
   of every intermediate RBridge that is part of the distribution tree
   being verified.  The originator of the Multi-destination Tree
   Verification Message specifies the scope of RBridges from which a
   response is required.  Only the RBridges listed in the scope field
   respond to the request.  Other RBridges silently discard the request.
   Inclusion of the scope field is required to prevent receiving an
   excessive number of responses.  The typical scenario of distribution
   tree verification or group verification involves verifying multicast
   connectivity to a selected set of end nodes as opposed to the entire
   network.  Availability of the scope facilitates narrowing down the
   focus to only the RBridges of interest.

   Implementations MAY choose to rate-limit CPU-bound multicast traffic.
   As a result of rate-limiting or due to other congestion conditions,
   MTVM messages may be discarded from time to time by the intermediate
   RBridges, and the requester may be required to retransmit the
   request.  Implementations SHOULD narrow the embedded scope of
   retransmission requests only to RBridges that have failed to respond.






<span class="grey">Senevirathne, et al.         Standards Track                   [Page 43]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-44" id="page-44" name="page-44"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1.%20%20MTVM%20Format"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>.  MTVM Format</span>

   The format of MTVM is identical to the Loopback Message format
   defined in <a href="#section-9">Section 9</a> with the exception that the OpCode used is 67.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.2.%20%20Theory%20of%20Operation"></a><a class="selflink" href="#section-11.2" name="section-11.2">11.2</a>.  Theory of Operation</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/11.2.1.%20%20Actions%20by%20Originator%20RBridge"></a><a class="selflink" href="#section-11.2.1" name="section-11.2.1">11.2.1</a>.  Actions by Originator RBridge</span>

   The user is required, at a minimum, to specify either the
   distribution trees that need to be verified, the Multicast MAC
   address and VLAN/FGL, or the VLAN/FGL and Multicast Destination IP
   address.  Alternatively, for more specific multicast flow
   verification, the user MAY specify more information, e.g., source MAC
   address, VLAN/FGL, and Destination and Source IP addresses.
   Implementations, at a minimum, must allow the user to specify a
   choice of distribution trees, Destination Multicast MAC address, and
   VLAN/FGL that needs to be verified.  Although it is not mandatory, it
   is highly desired to provide an option to specify the scope.  It
   should be noted that the source MAC address and some other parameters
   may not be specified if the backwards-compatibility method in
   <a href="#appendix-A">Appendix A</a> is used to identify the OAM frames.

   Default parameters MUST be used for unspecified parameters.  Flow
   Entropy is constructed based on user-specified parameters and/or
   default parameters.

   Based on user specified parameters, the originating RBridge does the
   following:

   o  Identifies the nickname that represents the multicast tree.

   o  Obtains the applicable Hop Count value for the selected multicast
      tree.

   o  Constructs TRILL OAM message header and includes the Session
      Identification number.  The Session Identification Number
      facilitates the originator mapping the response to the correct
      request.

   o  Includes the TRILL OAM Application Identifier TLV, which MUST be
      included.

   o  Includes the OpCode Multicast Tree Verification Message (67).

   o  Includes RBridge Scope TLV (68).





<span class="grey">Senevirathne, et al.         Standards Track                   [Page 44]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-45" id="page-45" name="page-45"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  Optionally, includes the following TLVs, where applicable:

      -  Out-of-Band IP Address TLV (65)

      -  Diagnostic Label TLV (66)

      -  Sender ID TLV (1)

   o  Specifies the Hop Count of the TRILL Data frame per user
      specification or alternatively utilizes the applicable Hop Count
      value if the TRILL Hop Count is not being specified by the user.

   o  Dispatches the OAM frame to the TRILL data plane to be ingressed
      for transmission.

   The RBridge may continue to retransmit the request at a periodic
   interval until either a response is received or the retransmission
   count expires.  At each new retransmission, the Session
   Identification Number MUST be incremented.  At each retransmission,
   the RBridge may further reduce the scope to the RBridges that it has
   not received a response from.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/11.2.2.%20%20Receiving%20RBridge"></a><a class="selflink" href="#section-11.2.2" name="section-11.2.2">11.2.2</a>.  Receiving RBridge</span>

   Receiving RBridges identify multicast verification frames per the
   procedure explained in <a href="#section-3.2">Section 3.2</a>.

   The RBridge validates the frame and analyzes the scope RBridge list.
   If the RBridge Scope TLV is present and the local RBridge nickname is
   not specified in the scope list, it will silently discard the frame.
   If the local RBridge is specified in the scope list OR the RBridge
   Scope TLV is absent, the receiving RBridge proceeds with further
   processing as defined in <a href="#section-11.2.3">Section 11.2.3</a>.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/11.2.3.%20%20In-Scope%20RBridges"></a><a class="selflink" href="#section-11.2.3" name="section-11.2.3">11.2.3</a>.  In-Scope RBridges</span>

   Construction of the TRILL OAM response:

   o  The TRILL OAM application encodes the received TRILL Header and
      Flow Entropy in the Original Data Payload TLV and includes them in
      the OAM message.

   o  Set the Return Code to zero (0) and Return Sub-code to zero (0).
      Update the TRILL OAM OpCode to 66 (Multi-destination Tree
      Verification Reply).






<span class="grey">Senevirathne, et al.         Standards Track                   [Page 45]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-46" id="page-46" name="page-46"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  Include following TLVs:

      -  Previous RBridge Nickname TLV (69)

      -  Reply Ingress TLV (5)

      -  Interface Status TLV (4)

      -  Next-Hop RBridge List TLV (70)

      -  Sender ID TLV (1)

      -  Multicast Receiver Port Count TLV (71)

   o  If a VLAN/FGL cross-connect error is detected, set the "C" flag
      (Cross-Connect Error) in the TRILL OAM Application Identifier TLV.

   o  If in-band response was requested, dispatch the frame to the TRILL
      data plane with request-originator RBridge nickname as the egress
      RBridge nickname.

   o  If out-of-band response was requested, dispatch the frame to the
      standard IP forwarding process.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20Application%20of%20Continuity%20Check%20Message%20%28CCM%29%20in%20TRILL"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  Application of Continuity Check Message (CCM) in TRILL</span>

   <a href="#section-7">Section 7</a> provides an overview of CCM Messages defined in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] and
   how they can be used within TRILL OAM.  This section presents the
   application and theory of operations of CCM within the TRILL OAM
   framework.  Readers are referred to [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] for CCM message format
   and applicable TLV definitions and usages.  Only the TRILL-specific
   aspects are explained below.

   In TRILL, between any two given MEPs, there can be multiple potential
   paths.  Whereas in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>], there is always a single path between any
   two MEPs at any given time.  [<a href="rfc6905.html" title='"Requirements for Operations, Administration, and Maintenance (OAM) in Transparent Interconnection of Lots of Links (TRILL)"'>RFC6905</a>] requires solutions to have the
   ability to monitor continuity over one or more paths.

   CCM Messages are uni-directional, such that there is no explicit
   response to a received CCM message.  Connectivity status is indicated
   by setting the applicable flags (e.g., RDI) of the CCM messages
   transmitted by a MEP.

   It is important that the solution presented in this document
   accomplishes the requirements specified in [<a href="rfc6905.html" title='"Requirements for Operations, Administration, and Maintenance (OAM) in Transparent Interconnection of Lots of Links (TRILL)"'>RFC6905</a>] within the
   framework of [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] in a straightforward manner and with minimum
   changes.  <a href="#section-8">Section 8</a> defines multiple flows within the CCM object,




<span class="grey">Senevirathne, et al.         Standards Track                   [Page 46]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-47" id="page-47" name="page-47"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   each corresponding to a flow that a given MEP wishes to monitor.
   Hence, CCM, in multipath environments like TRILL, monitors per-flow
   connectivity and cross-connect errors.

   Receiving MEPs do not cross-check whether a received CCM belongs to a
   specific flow from the originating RBridge.  Any attempt to track
   status of individual flows may explode the amount of state
   information that any given RBridge has to maintain.

   The obvious question arises: how does the originating RBridge know
   which flow or flows are at fault?

   This is accomplished with a combination of the RDI flag in the CCM
   header, Flow Identifier TLV, and SNMP Notifications (Traps).
   <a href="#section-12.1">Section 12.1</a> discusses the procedure.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.1.%20%20CCM%20Error%20Notification"></a><a class="selflink" href="#section-12.1" name="section-12.1">12.1</a>.  CCM Error Notification</span>

   Each MEP transmits four CCM messages per each flow.  ([<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] detects
   CCM fault when three consecutive CCM messages are lost).  Each CCM
   message has a unique sequence number (Session ID) and unique flow-
   identifier.  The flow-identifier is included in the OAM message via
   the Flow Identifier TLV.

   When a MEP notices a CCM timeout from a remote MEP (MEP-A), it sets
   the RDI flag on the next CCM message it generates.  Additionally, it
   logs and sends an SNMP notification that contains the remote MEP
   Identification, flow-identifier, and the sequence number of the last
   CCM message it received, and, if available, the flow-identifier and
   the sequence number of the first CCM message it received after the
   failure.  Each MEP maintains a unique flow-identifier per each flow;
   hence, the operator can easily identify flows that correspond to the
   specific flow-identifier.

   The following example illustrates the above.

   Assume there are two MEPs: MEP-A and MEP-B.

   Assume there are three flows between MEP-A and MEP-B.

   Let's assume MEP-A allocates sequence numbers as follows:

      Flow-1 Sequence={1,2,3,4,13,14,15,16,.. } flow-identifier=(1)

      Flow-2 Sequence={5,6,7,8,17,18,19,20,.. } flow-identifier=(2)

      Flow-3 Sequence={9,10,12,11,21,22,23,24,.. } flow-identifier=(3)




<span class="grey">Senevirathne, et al.         Standards Track                   [Page 47]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-48" id="page-48" name="page-48"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   Let's assume Flow-2 is at fault.

   MEP-B receives CCM from MEP-A with sequence numbers 1, 2, 3, and 4
   but did not receive 5, 6, 7, and 8.  CCM timeout is set to three CCM
   intervals in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].  Hence, MEP-B detects the error at the 8th CCM
   message.  At this time, the sequence number of the last good CCM
   message MEP-B has received from MEP-A is 4, and the flow-identifier
   of the last good CCM Message is (1).  Hence, MEP-B will generate a
   CCM error SNMP notification with MEP-A, last good flow-identifier
   (1), and sequence number 4.

   When MEP-A switches to Flow-3 after transmitting Flow-2, MEP-B will
   start receiving CCM messages.  In the foregoing example, it will be a
   CCM message with sequence numbers 9, 10, 11, 12, and 21 and so on.
   When in receipt of a new CCM message from a specific MEP, after a CCM
   timeout, the TRILL OAM will generate an SNMP Notification of CCM
   resume with remote MEP-ID, the first valid flow-identifier, and the
   sequence number after the CCM timeout.  In the foregoing example, it
   is MEP-A, flow-identifier (3), and sequence number 9.

   The remote MEP list under the CCM MIB Object is augmented to contain
   "Last Sequence Number", flow-identifier, and "CCM Timeout" variables.
   "Last Sequence Number" and flow-identifier are updated every time a
   CCM is received from a remote MEP.  The CCM Timeout variable is set
   when the CCM timeout occurs and is cleared when a CCM is received.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.2.%20%20Theory%20of%20Operation"></a><a class="selflink" href="#section-12.2" name="section-12.2">12.2</a>.  Theory of Operation</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/12.2.1.%20%20Actions%20by%20Originator%20RBridge"></a><a class="selflink" href="#section-12.2.1" name="section-12.2.1">12.2.1</a>.  Actions by Originator RBridge</span>

   The originator RBridge takes the following actions:

   o  Derives the Flow Entropy field based on flow-entropy information
      specified in the CCM Management object.

   o  Constructs the TRILL CCM OAM header as specified in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].

   o  The TRILL OAM Application Identifier TLV MUST be included as the
      first TLV with the flags set to applicable values.

   o  Includes other TLVs specified in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].

   o  Includes the following optional TLV, where applicable:

      -  Sender ID TLV (1)

   o  Specifies the Hop Count of the TRILL Data frame per user
      specification or utilize an applicable Hop Count value.



<span class="grey">Senevirathne, et al.         Standards Track                   [Page 48]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-49" id="page-49" name="page-49"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   o  Dispatches the OAM frame to the TRILL data plane for transmission.

   An RBridge transmits a total of four requests, each at CCM
   retransmission interval.  At each transmission, the Session
   Identification number MUST be incremented by one.

   At the 5th retransmission interval, the Flow Entropy of the CCM
   packet is updated to the next flow-entropy information specified in
   the CCM Management object.  If the current Flow Entropy is the last
   Flow Entropy specified, move to the first Flow Entropy specified and
   continue the process.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/12.2.2.%20%20Intermediate%20RBridge"></a><a class="selflink" href="#section-12.2.2" name="section-12.2.2">12.2.2</a>.  Intermediate RBridge</span>

   Intermediate RBridges forward the frame as a normal data frame; no
   special handling is required.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/12.2.3.%20Destination%20RBridge"></a><a class="selflink" href="#section-12.2.3" name="section-12.2.3">12.2.3</a>. Destination RBridge</span>

   If the CCM Message is addressed to the local RBridge or multicast and
   satisfies the OAM identification methods specified in <a href="#section-3.2">Section 3.2</a>,
   then the RBridge data plane forwards the message to the CPU for
   further processing.

   The TRILL OAM application layer further validates the received OAM
   frame by examining the presence of OAM Ethertype at the end of the
   Flow Entropy.  Frames that do not contain OAM Ethertype at the end of
   the Flow Entropy MUST be discarded.

   The TRILL OAM application layer then validates the MD-Level and pass
   the packet to the OpCode demultiplexer.  The OpCode demultiplexer
   delivers CCM packets to the CCM process.

   The CCM process performs the processing specified in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>].

   Additionally, the CCM process updates the CCM Management object with
   the sequence number of the received CCM packet.  Note: The last
   received CCM sequence number and CCM timeout are tracked per each
   remote MEP.

   If the CCM timeout is true for the sending remote MEP, then clear the
   CCM timeout in the CCM Management object and generate the SNMP
   notification as specified above.








<span class="grey">Senevirathne, et al.         Standards Track                   [Page 49]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-50" id="page-50" name="page-50"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20Fragmented%20Reply"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  Fragmented Reply</span>

   TRILL OAM allows fragmented reply messages.  In case of fragmented
   replies, all parts of the reply MUST follow the procedure defined in
   this section.

   The same Session Identification Number MUST be included in all
   related fragments of the same message.

   The TRILL OAM Application Identifier TLV MUST be included, with the
   Fragment-ID field monotonically increasing with each fragment
   transmitted with the appropriate Final flag field.  The Final flag
   MUST only be equal to one on the final fragment of the reply.

   On the receiver, the process MUST order the fragments based on the
   Fragment-ID.  Any fragments received after the final fragment MUST be
   discarded.  Messages with incomplete fragments (i.e., messages with
   one or missing fragments after the receipt of the fragment with the
   final flag set) MUST be discarded as well.

   If the number of fragments exceeds the maximum supported fragments
   (255), then the Return Code of the reply message MUST be set to 1
   (Reply message), and the Return Sub-code MUST be set to 1 (Fragment
   limit exceeded).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14.%20%20Security%20Considerations"></a><a class="selflink" href="#section-14" name="section-14">14</a>.  Security Considerations</span>

   Forged OAM packets could cause false error or failure indications,
   mask actual errors or failures, or be used for denial of service.
   Source addresses for messages can be forged and the out-of-band reply
   facility (see <a href="#section-8.4.4">Section 8.4.4</a>) provides for explicitly supplying the
   address for replies.  For protection against forged OAM packets, the
   Authentication TLV (see <a href="#section-8.4.13">Section 8.4.13</a>) can be used in an OAM message
   in TRILL.  This TLV is virtually identical to the IS-IS
   Authentication TLV specified in [<a href="#ref-IS-IS" title='"Information technology -- Telecommunications and information exchange between systems -- Intermediate System to Intermediate System intra-domain routeing information exchange protocol for use in conjunction with the protocol for providing the connectionless-mode network service (ISO 8473)"'>IS-IS</a>] and depends on IS-IS keying
   material and the current state of IS-IS keying as discussed in
   [<a href="#ref-KARPISIS" title='"KARP IS-IS security analysis"'>KARPISIS</a>] and [<a href="rfc5310.html" title='"IS-IS Generic Cryptographic Authentication"'>RFC5310</a>].  In particular, there is currently no
   standardized IS-IS automated key management.

   Of course, authentication is ineffective unless verified and
   ineffective against senders who have the keying material needed to
   produce OAM messages that will pass authentication checks.
   Implementations MUST implement rate-limiting functionality to protect
   against exploitation of OAM messages as a means of denial-of-service
   attacks.  Aggressive rate-limiting may trigger false positive errors
   against CCM and LBM-based session monitoring.





<span class="grey">Senevirathne, et al.         Standards Track                   [Page 50]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-51" id="page-51" name="page-51"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   Even with authentication, replay of authenticated messages may be
   possible.  There are four types of messages: Continuity Check (CCM),
   Loopback, Path Trace, and Multi-destination Tree Verification (MTVM).
   In the case of CCM messages, sequence numbers are required (see
   <a href="#section-12.1">Section 12.1</a>) that can protect against replay.  In the case of
   Loopback Messages (see <a href="#section-9.1">Section 9.1</a>), a Loopback Transaction
   Identifier is included that, as required by [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>], is incremented
   with each transmission and can detect replays.  PTMs (see <a href="#section-10">Section 10</a>)
   and MTVMs (see <a href="#section-11.1">Section 11.1</a>) are specified to have the same format as
   Loopback Messages (although with different OpCodes), so they also
   have an identifier incremented with each transmission that can detect
   replays.  Thus, all TRILL OAM messages have a field that can be used
   for replay protection.

   For general TRILL-related security considerations, please refer to
   [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].

   [<a id="ref-8021Q" name="ref-8021Q">8021Q</a>] requires that the MEP filters or passes through OAM messages
   based on the MD-Level.  The MD-Level is embedded deep in the OAM
   message.  Hence, conventional methods of frame filtering may not be
   able to filter frames based on the MD-Level.  As a result, OAM
   messages that must be dropped due to MD-Level mismatch may leak into
   a TRILL domain with a different MD-Level.

   This leaking may not cause any functionality loss.  The receiving
   MEP/MIP is required to validate the MD-level prior to acting on the
   message.  Any frames received with an incorrect MD-Level need to be
   dropped.

   Generally, a single operator manages each TRILL campus; hence, there
   is no risk of security exposure.  However, in the event of multi-
   operator deployments, operators should be aware of possible exposure
   of device-specific information, and appropriate measures must be
   taken.

   It is also important to note that the MPLS OAM framework [<a href="rfc4379.html" title='"Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)"'>RFC4379</a>]
   does not include the concept of domains and OAM filtering based on
   operators.  It is our opinion that the lack of OAM frame filtering
   based on domains does not introduce significant functional deficiency
   or security risk.

   It is possible to mandate requiring different credentials to use
   different OAM functions or capabilities within a specific OAM
   function.  Implementations may consider grouping users to different
   security clearance levels and restricting functions and capabilities
   to different clearance levels.  However, exact implementation details
   of such a framework are outside the scope of this document.




<span class="grey">Senevirathne, et al.         Standards Track                   [Page 51]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-52" id="page-52" name="page-52"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/15.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-15" name="section-15">15</a>.  IANA Considerations</span>

   IANA has made the assignments described below.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/15.1.%20%20OAM%20Capability%20Flags"></a><a class="selflink" href="#section-15.1" name="section-15.1">15.1</a>.  OAM Capability Flags</span>

   Two TRILL-VER sub-TLV Capability Flags (see <a href="#section-3.3">Section 3.3</a>) have been
   assigned as follows:

     Bit     Description               Reference
     ---     -----------               ---------
     2       OAM capable               <a href="rfc7455.html">RFC 7455</a>
     3       Backwards-compatible OAM  <a href="rfc7455.html">RFC 7455</a>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/15.2.%20%20CFM%20Code%20Points"></a><a class="selflink" href="#section-15.2" name="section-15.2">15.2</a>.  CFM Code Points</span>

   Four OpCodes have been assigned from the "CFM OAM IETF OpCodes" sub-
   registry as follows:

     Value     Assignment                                   Reference
     -----     ----------                                   ---------
     64        Path Trace Reply                             <a href="rfc7455.html">RFC 7455</a>
     65        Path Trace Message                           <a href="rfc7455.html">RFC 7455</a>
     66        Multi-destination Tree Verification Reply    <a href="rfc7455.html">RFC 7455</a>
     67        Multi-destination Tree Verification Message  <a href="rfc7455.html">RFC 7455</a>

   Eleven TLV Types have been assigned from the "CFM OAM IETF TLV Types"
   sub-registry as follows:

     Value     Assignment                            Reference
     -----     ----------                            ---------
     64        TRILL OAM Application Identifier TLV  <a href="rfc7455.html">RFC 7455</a>
     65        Out-of-Band Reply Address TLV         <a href="rfc7455.html">RFC 7455</a>
     66        Diagnostic Label TLV                  <a href="rfc7455.html">RFC 7455</a>
     67        Original Data Payload TLV             <a href="rfc7455.html">RFC 7455</a>
     68        RBridge Scope TLV                     <a href="rfc7455.html">RFC 7455</a>
     69        Previous RBridge Nickname TLV         <a href="rfc7455.html">RFC 7455</a>
     70        Next-Hop RBridge List TLV             <a href="rfc7455.html">RFC 7455</a>
     71        Multicast Receiver Port Count TLV     <a href="rfc7455.html">RFC 7455</a>
     72        Flow Identifier TLV                   <a href="rfc7455.html">RFC 7455</a>
     73        Reflector Entropy TLV                 <a href="rfc7455.html">RFC 7455</a>
     74        Authentication TLV                    <a href="rfc7455.html">RFC 7455</a>









<span class="grey">Senevirathne, et al.         Standards Track                   [Page 52]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-53" id="page-53" name="page-53"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/15.3.%20%20MAC%20Addresses"></a><a class="selflink" href="#section-15.3" name="section-15.3">15.3</a>.  MAC Addresses</span>

   IANA has assigned a unicast and a multicast MAC address under the
   IANA Organizationally Unique Identifier (OUI) for identification of
   OAM packets as discussed for the backwards-compatibility method
   (Appendix A.2) and based on the request template in <a href="#appendix-C">Appendix C</a>.  The
   assigned addresses are 00-00-5E-90-01-00 (unicast) and
   01-00-5E-90-01-00 (multicast).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/15.4.%20%20Return%20Codes%20and%20Sub-codes"></a><a class="selflink" href="#section-15.4" name="section-15.4">15.4</a>.  Return Codes and Sub-codes</span>

   IANA has created the "TRILL OAM Return Codes" registry within the
   "Transparent Interconnection of Lots of Links (TRILL) Parameters"
   registry and a separate sub-code sub-registry for each Return Code as
   shown below:

   Registry: TRILL OAM Return Codes

   Registration Procedure: Standards Action

      Return Code    Assignment        References
      -----------    ----------        ----------
         0           Request message   <a href="rfc7455.html">RFC 7455</a>
         1           Reply message     <a href="rfc7455.html">RFC 7455</a>
         2-255       Unassigned        <a href="rfc7455.html">RFC 7455</a>

   Sub-Registry: Sub-codes for TRILL OAM Return Code 0

   Registration Procedure: Standards Action

      Sub-code      Assignment        References
      --------      ----------        ----------
         0          Valid request     <a href="rfc7455.html">RFC 7455</a>
         1-255      Unassigned        <a href="rfc7455.html">RFC 7455</a>

   Sub-Registry: Sub-codes for TRILL OAM Return Code 1

   Registration Procedure: Standards Action

      Sub-code      Assignment              References
      --------      ----------              ----------
         0          Valid response          <a href="rfc7455.html">RFC 7455</a>
         1          Fragment limit exceeded <a href="rfc7455.html">RFC 7455</a>
         2          Intermediate RBridge    <a href="rfc7455.html">RFC 7455</a>
         3-255      Unassigned              <a href="rfc7455.html">RFC 7455</a>






<span class="grey">Senevirathne, et al.         Standards Track                   [Page 53]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-54" id="page-54" name="page-54"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/15.5.%20%20TRILL%20Nickname%20Address%20Family"></a><a class="selflink" href="#section-15.5" name="section-15.5">15.5</a>.  TRILL Nickname Address Family</span>

   IANA has allocated 16396 as the Address Family Number for TRILL
   nickname.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/16.%20%20References"></a><a class="selflink" href="#section-16" name="section-16">16</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/16.1.%20%20Normative%20References"></a><a class="selflink" href="#section-16.1" name="section-16.1">16.1</a>.  Normative References</span>

   [<a id="ref-8021Q" name="ref-8021Q">8021Q</a>]    IEEE, "IEEE Standard for Local and metropolitan area
              networks -- Bridges and Bridged Networks", IEEE Std
              802.1Q, December 2014.

   [<a id="ref-IS-IS" name="ref-IS-IS">IS-IS</a>]    ISO/IEC, "Information technology -- Telecommunications and
              information exchange between systems -- Intermediate
              System to Intermediate System intra-domain routeing
              information exchange protocol for use in conjunction with
              the protocol for providing the connectionless-mode network
              service (ISO 8473)", ISO/IEC 10589:2002, Second Edition,
              2002.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC5226" name="ref-RFC5226">RFC5226</a>]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", <a href="https://tools.ietf.org/html/bcp26">BCP 26</a>, <a href="rfc5226.html">RFC 5226</a>,
              May 2008, &lt;<a href="http://www.rfc-editor.org/info/rfc5226">http://www.rfc-editor.org/info/rfc5226</a>&gt;.

   [<a id="ref-RFC5310" name="ref-RFC5310">RFC5310</a>]  Bhatia, M., Manral, V., Li, T., Atkinson, R., White, R.,
              and M. Fanto, "IS-IS Generic Cryptographic
              Authentication", <a href="rfc5310.html">RFC 5310</a>, February 2009,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5310">http://www.rfc-editor.org/info/rfc5310</a>&gt;.

   [<a id="ref-RFC6325" name="ref-RFC6325">RFC6325</a>]  Perlman, R., Eastlake 3rd, D., Dutt, D., Gai, S., and A.
              Ghanwani, "Routing Bridges (RBridges): Base Protocol
              Specification", <a href="rfc6325.html">RFC 6325</a>, July 2011,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6325">http://www.rfc-editor.org/info/rfc6325</a>&gt;.

   [<a id="ref-RFC7172" name="ref-RFC7172">RFC7172</a>]  Eastlake 3rd, D., Zhang, M., Agarwal, P., Perlman, R., and
              D. Dutt, "Transparent Interconnection of Lots of Links
              (TRILL): Fine-Grained Labeling", <a href="rfc7172.html">RFC 7172</a>, May 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7172">http://www.rfc-editor.org/info/rfc7172</a>&gt;.








<span class="grey">Senevirathne, et al.         Standards Track                   [Page 54]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-55" id="page-55" name="page-55"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/16.2.%20%20Informative%20References"></a><a class="selflink" href="#section-16.2" name="section-16.2">16.2</a>.  Informative References</span>

   [<a id="ref-KARPISIS" name="ref-KARPISIS">KARPISIS</a>] Chunduri, U., Tian, A., and W. Lu, "KARP IS-IS security
              analysis", Work in Progress, <a href="https://tools.ietf.org/html/draft-ietf-karp-isis-analysis-04">draft-ietf-karp-isis-</a>
              <a href="https://tools.ietf.org/html/draft-ietf-karp-isis-analysis-04">analysis-04</a>, March 2015.

   [<a id="ref-RFC4379" name="ref-RFC4379">RFC4379</a>]  Eronen, P., Ed., and H. Tschofenig, Ed., "Pre-Shared Key
              Ciphersuites for Transport Layer Security (TLS)", <a href="rfc4279.html">RFC</a>
              <a href="rfc4279.html">4279</a>, December 2005,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4279">http://www.rfc-editor.org/info/rfc4279</a>&gt;.

   [<a id="ref-RFC6291" name="ref-RFC6291">RFC6291</a>]  Andersson, L., van Helvoort, H., Bonica, R., Romascanu,
              D., and S. Mansfield, "Guidelines for the Use of the "OAM"
              Acronym in the IETF", <a href="https://tools.ietf.org/html/bcp161">BCP 161</a>, <a href="rfc6291.html">RFC 6291</a>, June 2011,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6291">http://www.rfc-editor.org/info/rfc6291</a>&gt;.

   [<a id="ref-RFC6361" name="ref-RFC6361">RFC6361</a>]  Carlson, J. and D. Eastlake 3rd, "PPP Transparent
              Interconnection of Lots of Links (TRILL) Protocol Control
              Protocol", <a href="rfc6361.html">RFC 6361</a>, August 2011,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6361">http://www.rfc-editor.org/info/rfc6361</a>&gt;.

   [<a id="ref-RFC6905" name="ref-RFC6905">RFC6905</a>]  Senevirathne, T., Bond, D., Aldrin, S., Li, Y., and R.
              Watve, "Requirements for Operations, Administration, and
              Maintenance (OAM) in Transparent Interconnection of Lots
              of Links (TRILL)", <a href="rfc6905.html">RFC 6905</a>, March 2013,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6905">http://www.rfc-editor.org/info/rfc6905</a>&gt;.

   [<a id="ref-RFC7174" name="ref-RFC7174">RFC7174</a>]  Salam, S., Senevirathne, T., Aldrin, S., and D. Eastlake
              3rd, "Transparent Interconnection of Lots of Links (TRILL)
              Operations, Administration, and Maintenance (OAM)
              Framework", <a href="rfc7174.html">RFC 7174</a>, May 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7174">http://www.rfc-editor.org/info/rfc7174</a>&gt;.

   [<a id="ref-RFC7176" name="ref-RFC7176">RFC7176</a>]  Eastlake 3rd, D., Senevirathne, T., Ghanwani, A., Dutt,
              D., and A. Banerjee, "Transparent Interconnection of Lots
              of Links (TRILL) Use of IS-IS", <a href="rfc7176.html">RFC 7176</a>, May 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7176">http://www.rfc-editor.org/info/rfc7176</a>&gt;.

   [<a id="ref-RFC7178" name="ref-RFC7178">RFC7178</a>]  Eastlake 3rd, D., Manral, V., Li, Y., Aldrin, S., and D.
              Ward, "Transparent Interconnection of Lots of Links
              (TRILL): RBridge Channel Support", <a href="rfc7178.html">RFC 7178</a>, May 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7178">http://www.rfc-editor.org/info/rfc7178</a>&gt;.

   [<a id="ref-RFC7179" name="ref-RFC7179">RFC7179</a>]  Eastlake 3rd, D., Ghanwani, A., Manral, V., Li, Y., and C.
              Bestler, "Transparent Interconnection of Lots of Links
              (TRILL): Header Extension", <a href="rfc7179.html">RFC 7179</a>, May 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7179">http://www.rfc-editor.org/info/rfc7179</a>&gt;.




<span class="grey">Senevirathne, et al.         Standards Track                   [Page 55]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-56" id="page-56" name="page-56"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   [<a id="ref-RFC7180" name="ref-RFC7180">RFC7180</a>]  Eastlake 3rd, D., Zhang, M., Ghanwani, A., Manral, V., and
              A. Banerjee, "Transparent Interconnection of Lots of Links
              (TRILL): Clarifications, Corrections, and Updates", <a href="rfc7180.html">RFC</a>
              <a href="rfc7180.html">7180</a>, May 2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7180">http://www.rfc-editor.org/info/rfc7180</a>&gt;.

   [<a id="ref-RFC7456" name="ref-RFC7456">RFC7456</a>]  Mizrahi, T., Senevirathne, T., Salam, S., Kumar, D., and
              D. Eastlake 3rd, "Loss and Delay Measurement in
              Transparent Interconnection of Lots of Links (TRILL)", <a href="rfc7456.html">RFC</a>
              <a href="rfc7456.html">7456</a>, March 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7456">http://www.rfc-editor.org/info/rfc7456</a>&gt;.

   [<a id="ref-TRILLOAMMIB" name="ref-TRILLOAMMIB">TRILLOAMMIB</a>]
              Kumar, D., Salam, S., and T. Senevirathne, "TRILL OAM
              MIB", Work in Progress, <a href="https://tools.ietf.org/html/draft-deepak-trill-oam-mib-01">draft-deepak-trill-oam-mib-01</a>,
              October 2013.

   [<a id="ref-Y1731" name="ref-Y1731">Y1731</a>]    ITU-T, "OAM functions and mechanisms for Ethernet based
              networks", ITU-T Recommendation G.8013/Y.1731, November
              2013.
































<span class="grey">Senevirathne, et al.         Standards Track                   [Page 56]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-57" id="page-57" name="page-57"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Backwards%20Compatibility"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Backwards Compatibility</span>

   The methodology presented in this document is in-line with the
   framework defined in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] for providing fault management coverage.
   However, in practice, some TRILL platforms may not have the
   capabilities to support some of the required techniques.  In this
   appendix, we present a method that allows RBridges, which do not have
   the required hardware capabilities, to participate in the TRILL OAM
   solution.

   There are two broad areas to be considered: 1) the Maintenance Point
   (MEP/MIP) Model and 2) data-plane encoding and frame identification.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20Maintenance%20Point%20%28MEP%2FMIP%29%20Model"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  Maintenance Point (MEP/MIP) Model</span>

   For backwards compatibility, MEPs and MIPs are located in the CPU.
   This will be referred to as the "central brain" model as opposed to
   "port brain" model.

   In the "central brain" model, an RBridge using either Access Control
   Lists (ACLs) or some other method forwards qualifying OAM messages to
   the CPU.  The CPU then performs the required processing and
   multiplexing to the correct MP (Maintenance Point).

   Additionally, RBridges MUST have the capability to prevent the
   leaking of OAM packets, as specified in [<a href="rfc6905.html" title='"Requirements for Operations, Administration, and Maintenance (OAM) in Transparent Interconnection of Lots of Links (TRILL)"'>RFC6905</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20Data-Plane%20Encoding%20and%20Frame%20Identification"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  Data-Plane Encoding and Frame Identification</span>

   The backwards-compatibility method presented in this section defines
   methods to identify OAM frames when implementations do not have
   capabilities to utilize the TRILL OAM Alert flag presented earlier in
   this document to identify OAM frames in the hardware.

   It is assumed that ECMP path selection of non-IP flows utilizes MAC
   DA, MAC SA, and VLAN; IP flows utilize IP DA, IP SA, TCP/UDP port
   numbers, and other Layer 3 and Layer 4 information.  The well-known
   fields to identify OAM flows are chosen such that they mimic the ECMP
   selection of the actual data along the path.  However, it is
   important to note that there may be implementations that would
   utilize these well-known fields for ECMP selections.  Hence,
   implementations that support OAM SHOULD move to utilizing the TRILL
   Alert flag, as soon as possible, and methods presented here SHOULD be
   used only as an interim solution.







<span class="grey">Senevirathne, et al.         Standards Track                   [Page 57]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-58" id="page-58" name="page-58"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   Identification methods are divided in to four broader groups:

   1.  Identification of Unicast non-IP OAM Flows,

   2.  Identification of Multicast non-IP OAM Flows,

   3.  Identification of Unicast IP OAM Flows, and

   4.  Identification of Multicast IP OAM Flows.

   As presented in Figure 24, based on the flow type (as defined above),
   implementations are required to use a well-known value in either the
   Inner.MacSA field or OAM Ethertype field to identify OAM flows.

   A receiving RBridge identifies OAM flows based on the presence of the
   well-known values in the specified fields.  Additionally, for unicast
   flows, the egress RBridge nickname of the packet MUST match that of
   the local RBridge, or for multicast flows, the TRILL Header multicast
   ("M") flag MUST be set.

   Unicast OAM flows that qualify for local processing MUST be
   redirected to the OAM process and MUST NOT be forwarded (to prevent
   leaking of the packet out of the TRILL campus).

   A copy of multicast OAM flows that qualify for local processing MUST
   be sent to the OAM process, and the packets MUST be forwarded along
   the normal path.  Additionally, methods MUST be in place to prevent
   multicast packets from leaking out of the TRILL campus.

   Figure 24 summarizes the identification of different OAM frames from
   data frames.

      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Flow Entropy   |Inner.MacSA  |OAM Ethertype  |Egress   |
      |               |             |               |nickname |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Unicast no IP  | N/A         |Match          |Match    |
      |               |             |               |         |
      |Multicast no IP| N/A         |Match          |N/A      |
      |               |             |               |         |
      |Unicast IP     | Match       |N/A            |Match    |
      |               |             |               |         |
      |Multicast IP   | Match       |N/A            |N/A      |
      |               |             |               |         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

       Figure 24: Identification of TRILL OAM Frames




<span class="grey">Senevirathne, et al.         Standards Track                   [Page 58]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-59" id="page-59" name="page-59"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   The unicast and multicast Inner.MacSAs used for the unicast and
   multicast IP cases, respectively, are 00-00-5E-90-01-00 and
   01-00-5E-90-01-00.  These have been assigned per the request in
   <a href="#appendix-C">Appendix C</a>.

   It is important to note that all RBridges MUST generate OAM flows
   with the "A" flag set and CFM Ethertype "0x8902" at the Flow Entropy
   off-set.  However, well-known values MUST be utilized as part of the
   flow-entropy when generating OAM messages destined for older RBridges
   that are compliant to the backwards-compatibility method defined in
   this appendix.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20B.%20%20Base%20Mode%20for%20TRILL%20OAM"></a><a class="selflink" href="#appendix-B" name="appendix-B">Appendix B</a>.  Base Mode for TRILL OAM</span>

   CFM, as defined in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>], requires configuration of several
   parameters before the protocol can be used.  These parameters include
   MAID, Maintenance Domain Level (MD-Level), and MEP-IDs.  The Base
   Mode for TRILL OAM defined here facilitates ease of use and provides
   out-of-the-box plug-and-play capabilities, supporting the operational
   and manageability considerations described in <a href="rfc7174.html#section-6">Section 6 of [RFC7174]</a>.

   All RBridges that support TRILL OAM MUST support the Base Mode
   operation.

   All RBridges MUST create a default MA with MAID as specified herein.

   MAID [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] has a flexible format and includes two parts:
   Maintenance Domain Name and Short MA Name.  In the Base Mode
   operation, the value of the Maintenance Domain Name must be the
   character string "TrillBaseMode" (excluding the quotes).  In the Base
   Mode operation, the Short MA Name format is set to a 2-octet integer
   format (value 3 in Short MA Format field) and Short MA Name set to
   65532 (0xFFFC).

   The default MA belongs to MD-Level 3.

   In the Base Mode of operation, each RBridge creates a single UP MEP
   associated with a virtual OAM port with no physical layer (NULL PHY).
   The MEP-ID associated with this MEP is the 2-octet RBridge nickname.

   By default, all RBridges operating in Base Mode for TRILL OAM are
   able to initiate LBM, PTM, and other OAM tools with no configuration.

   Implementations MAY provide default flow-entropy to be included in
   OAM messages.  Content of the default flow-entropy is outside the
   scope of this document.





<span class="grey">Senevirathne, et al.         Standards Track                   [Page 59]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-60" id="page-60" name="page-60"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   Figure 25 depicts encoding of MAID within CCM messages.

      +-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Field Name     |Size     |
      |               |         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Maintenance    | 1       |
      |Domain Format  |         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Maintenance    | 2       |
      |Domain Length  |         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Maintenance    | variable|
      |Domain Name    |         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Short MA       | 1       |
      |Name   Format  |         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Short MA       | 2       |
      |Name  Length   |         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Short MA       | variable|
      |Name           |         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Padding        | Variable|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+

      Figure 25: MAID Structure as Defined in [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>]

   Maintenance Domain Name Format: set to value 4

   Maintenance Domain Name Length: set to value 13

   Maintenance Domain Name: set to TrillBaseMode

   Short MA Name Format: set to value 3

   Short MA Name Length: set to value 2

   Short MA Name: set to FFFC

   Padding: set of zero up to 48 octets of total length of the MAID

   Please refer to [<a href="#ref-8021Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>8021Q</a>] for details.







<span class="grey">Senevirathne, et al.         Standards Track                   [Page 60]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-61" id="page-61" name="page-61"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20C.%20%20MAC%20Addresses%20Request"></a><a class="selflink" href="#appendix-C" name="appendix-C">Appendix C</a>.  MAC Addresses Request</span>

   Applicant Name: IETF TRILL Working Group

   Applicant Email:  tsenevir@cisco.com

   Applicant Telephone: +1-408-853-2291

   Use Name: TRILL OAM

   Document: <a href="rfc7455.html">RFC 7455</a>

   Specify whether this is an application for EUI-48 or EUI-64
   identifiers: EUI-48

   Size of Block requested: 1

   Specify multicast, unicast, or both: Both

































<span class="grey">Senevirathne, et al.         Standards Track                   [Page 61]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-62" id="page-62" name="page-62"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


Acknowledgments

   Work on this document was largely inspired by the directions provided
   by Stewart Bryant in finding a common OAM solution between SDOs.

   Acknowledgments are due for many who volunteered to review this
   document, notably, Jari Arkko, Adrian Farrel, Pete Resnick, Stephen
   Farrell, Dan Romascanu, Gayle Nobel, and Tal Mizrahi.

   Special appreciation is due to Dinesh Dutt for his support and
   encouragement, especially during the initial discussion phase of
   TRILL OAM.

Authors' Addresses

   Tissa Senevirathne
   Cisco Systems
   375 East Tasman Drive
   San Jose, CA 95134
   United States

   Phone: +1 408-853-2291
   EMail: tsenevir@cisco.com


   Norman Finn
   Cisco Systems
   510 McCarthy Blvd
   Milpitas, CA 95035
   United States

   EMail: nfinn@cisco.com


   Samer Salam
   Cisco Systems
   595 Burrard St., Suite 2123
   Vancouver, BC V7X 1J1
   Canada

   EMail: ssalam@cisco.com










<span class="grey">Senevirathne, et al.         Standards Track                   [Page 62]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-63" id="page-63" name="page-63"> </a>
<span class="grey"><a href="rfc7455.html">RFC 7455</a>                 TRILL Fault Management               March 2015</span>


   Deepak Kumar
   Cisco Systems
   510 McCarthy Blvd
   Milpitas, CA 95035
   United States

   Phone: +1 408-853-9760
   EMail: dekumar@cisco.com


   Donald Eastlake 3rd
   Huawei Technologies
   155 Beaver Street
   Milford, MA 01757
   United States

   Phone: +1-508-333-2270
   EMail: d3e3e3@gmail.com


   Sam Aldrin
   Huawei Technologies
   2330 Central Express Way
   Santa Clara, CA 95951
   United States

   EMail: aldrin.ietf@gmail.com


   Yizhou Li
   Huawei Technologies
   101 Software Avenue
   Nanjing 210012
   China

   Phone: +86-25-56625375
   EMail: liyizhou@huawei.com














Senevirathne, et al.         Standards Track                   [Page 63]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7455 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:21 GMT --></html>