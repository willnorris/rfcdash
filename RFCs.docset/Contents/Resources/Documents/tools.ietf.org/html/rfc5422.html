<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc5422 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:35 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:5422" name="DC.Identifier"/>
<meta content="The Flexible Authentication via Secure Tunneling Extensible
Authentication Protocol (EAP-FAST) method enables secure communication
between a peer and a server by using Transport Layer Security (TLS) to
establish a mutually authenticated tunnel. EAP- FAST also enables the
provisioning credentials or other information through this protected
tunnel. This document describes the use of EAP-FAST for dynamic
provisioning. This memo provides information for the Internet
community." name="DC.Description.Abstract"/>
<meta content="Cam-Winget, Nancy" name="DC.Creator"/>
<meta content="McGrew, David" name="DC.Creator"/>
<meta content="Zhou, Hao" name="DC.Creator"/>
<meta content="Salowey, Joseph" name="DC.Creator"/>
<meta content="March, 2009" name="DC.Date.Issued"/>
<meta content="Dynamic Provisioning Using Flexible Authentication via Secure Tunneling Extensible Authentication Protocol (EAP-FAST)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 5422 - Dynamic Provisioning Using Flexible Authentication via Secure Tunneling Extensible Authentication Protocol (EAP-FAST)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc5422.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc5422" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-cam-winget-eap-fast-provisioning" title="draft-cam-winget-eap-fast-provisioning">draft-cam-winge...</a>] [<a href="https://datatracker.ietf.org/doc/rfc5422" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc5422" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc5422" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=5422&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]   </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Network Working Group                                      N. Cam-Winget
Request for Comments: 5422                                     D. McGrew
Category: Informational                                       J. Salowey
                                                                 H. Zhou
                                                           Cisco Systems
                                                              March 2009


        <span class="h1">Dynamic Provisioning Using Flexible Authentication via</span>
     <span class="h1">Secure Tunneling Extensible Authentication Protocol (EAP-FAST)</span>

Status of This Memo

   This memo provides information for the Internet community.  It does
   not specify an Internet standard of any kind.  Distribution of this
   memo is unlimited.

Copyright Notice

   Copyright (c) 2009 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents in effect on the date of
   publication of this document (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>).
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

IESG Note

   EAP-FAST has been implemented by many vendors and it is used in the
   Internet.  Publication of this specification is intended to promote
   interoperability by documenting current use of existing EAP methods
   within EAP-FAST.





<span class="grey">Cam-Winget, et al.           Informational                      [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   The EAP method EAP-FAST-MSCHAPv2 reuses the EAP type code assigned to
   EAP-MSCHAPv2 (26) for authentication within an anonymous TLS tunnel.
   In order to minimize the risk associated with an anonymous tunnel,
   changes to the method were made that are not interoperable with EAP-
   MSCHAPv2.  Since EAP-MSCHAPv2 does not support method-specific
   version negotiation, the use of EAP-FAST-MSCHAPv2 is implied by the
   use of an anonymous EAP-FAST tunnel.  This behavior may cause
   problems in implementations where the use of unaltered EAP-MSCHAPv2
   is needed inside an anonymous EAP-FAST tunnel.  Since such support
   requires special case execution of a method within a tunnel, it also
   complicates implementations that use the same method code both within
   and outside of the tunnel method.  If EAP-FAST were to be designed
   today, these difficulties could be avoided by utilization of unique
   EAP Type codes.  Given these issues, assigned method types must not
   be re-used with different meaning inside tunneled methods in the
   future.

Abstract

   The Flexible Authentication via Secure Tunneling Extensible
   Authentication Protocol (EAP-FAST) method enables secure
   communication between a peer and a server by using Transport Layer
   Security (TLS) to establish a mutually authenticated tunnel.  EAP-
   FAST also enables the provisioning credentials or other information
   through this protected tunnel.  This document describes the use of
   EAP-FAST for dynamic provisioning.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-4">4</a>
      <a href="#section-1.1">1.1</a>. Specification Requirements .................................<a href="#page-4">4</a>
      <a href="#section-1.2">1.2</a>. Terminology ................................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. EAP-FAST Provisioning Modes .....................................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. Dynamic Provisioning Using EAP-FAST Conversation ................<a href="#page-6">6</a>
      <a href="#section-3.1">3.1</a>. Phase 1 TLS Tunnel .........................................<a href="#page-7">7</a>
           <a href="#section-3.1.1">3.1.1</a>. Server-Authenticated Tunnel .........................<a href="#page-7">7</a>
           <a href="#section-3.1.2">3.1.2</a>. Server-Unauthenticated Tunnel .......................<a href="#page-7">7</a>
      <a href="#section-3.2">3.2</a>. Phase 2 - Tunneled Authentication and Provisioning .........<a href="#page-7">7</a>
           <a href="#section-3.2.1">3.2.1</a>. Server-Authenticated Tunneled Authentication ........<a href="#page-8">8</a>
           <a href="#section-3.2.2">3.2.2</a>. Server-Unauthenticated Tunneled Authentication ......<a href="#page-8">8</a>
           <a href="#section-3.2.3">3.2.3</a>. Authenticating Using EAP-FAST-MSCHAPv2 ..............<a href="#page-8">8</a>
           3.2.4. Use of Other Inner EAP Methods for EAP-FAST
                  Provisioning ........................................<a href="#page-9">9</a>
      3.3. Key Derivations Used in the EAP-FAST Provisioning
           Exchange ..................................................<a href="#page-10">10</a>
      <a href="#section-3.4">3.4</a>. Peer-Id, Server-Id, and Session-Id ........................<a href="#page-11">11</a>
      <a href="#section-3.5">3.5</a>. Network Access after EAP-FAST Provisioning ................<a href="#page-11">11</a>
   <a href="#section-4">4</a>. Information Provisioned in EAP-FAST ............................<a href="#page-12">12</a>



<span class="grey">Cam-Winget, et al.           Informational                      [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


      <a href="#section-4.1">4.1</a>. Protected Access Credential ...............................<a href="#page-12">12</a>
           <a href="#section-4.1.1">4.1.1</a>. Tunnel PAC .........................................<a href="#page-13">13</a>
           <a href="#section-4.1.2">4.1.2</a>. Machine Authentication PAC .........................<a href="#page-13">13</a>
           <a href="#section-4.1.3">4.1.3</a>. User Authorization PAC .............................<a href="#page-13">13</a>
           <a href="#section-4.1.4">4.1.4</a>. PAC Provisioning ...................................<a href="#page-14">14</a>
      <a href="#section-4.2">4.2</a>. PAC TLV Format ............................................<a href="#page-15">15</a>
           <a href="#section-4.2.1">4.2.1</a>. Formats for PAC Attributes .........................<a href="#page-16">16</a>
           <a href="#section-4.2.2">4.2.2</a>. PAC-Key ............................................<a href="#page-16">16</a>
           <a href="#section-4.2.3">4.2.3</a>. PAC-Opaque .........................................<a href="#page-17">17</a>
           <a href="#section-4.2.4">4.2.4</a>. PAC-Info ...........................................<a href="#page-18">18</a>
           <a href="#section-4.2.5">4.2.5</a>. PAC-Acknowledgement TLV ............................<a href="#page-20">20</a>
           <a href="#section-4.2.6">4.2.6</a>. PAC-Type TLV .......................................<a href="#page-21">21</a>
      <a href="#section-4.3">4.3</a>. Trusted Server Root Certificate ...........................<a href="#page-21">21</a>
           <a href="#section-4.3.1">4.3.1</a>. Server-Trusted-Root TLV ............................<a href="#page-22">22</a>
           <a href="#section-4.3.2">4.3.2</a>. PKCS#7 TLV .........................................<a href="#page-23">23</a>
   <a href="#section-5">5</a>. IANA Considerations ............................................<a href="#page-24">24</a>
   <a href="#section-6">6</a>. Security Considerations ........................................<a href="#page-25">25</a>
      <a href="#section-6.1">6.1</a>. Provisioning Modes and Man-in-the-Middle Attacks ..........<a href="#page-25">25</a>
           6.1.1. Server-Authenticated Provisioning Mode and
                  Man-in-the-Middle Attacks ..........................<a href="#page-26">26</a>
           6.1.2. Server-Unauthenticated Provisioning Mode
                  and Man-in-the-Middle Attacks ......................<a href="#page-26">26</a>
      <a href="#section-6.2">6.2</a>. Dictionary Attacks ........................................<a href="#page-27">27</a>
      <a href="#section-6.3">6.3</a>. Considerations in Selecting a Provisioning Mode ...........<a href="#page-28">28</a>
      <a href="#section-6.4">6.4</a>. Diffie-Hellman Groups .....................................<a href="#page-28">28</a>
      <a href="#section-6.5">6.5</a>. Tunnel PAC Usage ..........................................<a href="#page-28">28</a>
      <a href="#section-6.6">6.6</a>. Machine Authentication PAC Usage ..........................<a href="#page-29">29</a>
      <a href="#section-6.7">6.7</a>. User Authorization PAC Usage ..............................<a href="#page-29">29</a>
      <a href="#section-6.8">6.8</a>. PAC Storage Considerations ................................<a href="#page-29">29</a>
      <a href="#section-6.9">6.9</a>. Security Claims ...........................................<a href="#page-31">31</a>
   <a href="#section-7">7</a>. Acknowledgements ...............................................<a href="#page-31">31</a>
   <a href="#section-8">8</a>. References .....................................................<a href="#page-31">31</a>
      <a href="#section-8.1">8.1</a>. Normative References ......................................<a href="#page-31">31</a>
      <a href="#section-8.2">8.2</a>. Informative References ....................................<a href="#page-32">32</a>
   <a href="#appendix-A">Appendix A</a>.  Examples .............................................<a href="#page-33">33</a>
     <a href="#appendix-A.1">A.1</a>.  Example 1: Successful Tunnel PAC Provisioning .............<a href="#page-33">33</a>
     <a href="#appendix-A.2">A.2</a>.  Example 2: Failed Provisioning ............................<a href="#page-35">35</a>
     A.3.  Example 3: Provisioning an Authentication Server's
           Trusted Root Certificate ..................................<a href="#page-37">37</a>












<span class="grey">Cam-Winget, et al.           Informational                      [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   EAP-FAST [<a href="rfc4851.html" title='"The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP- FAST)"'>RFC4851</a>] is an EAP method that can be used to mutually
   authenticate the peer and server.  Credentials such as a pre-shared
   key, certificate trust anchor, or a Protected Access Credential (PAC)
   must be provisioned to the peer before it can establish mutual
   authentication with the server.  In many cases, the provisioning of
   such information presents deployment hurdles.  Through the use of the
   protected TLS [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>] tunnel, EAP-FAST can enable dynamic in-band
   provisioning to address such deployment obstacles.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Specification%20Requirements"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Specification Requirements</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Terminology"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Terminology</span>

   Much of the terminology used in this document comes from [<a href="rfc3748.html" title='"Extensible Authentication Protocol (EAP)"'>RFC3748</a>].
   The terms "peer" and "server" are used interchangeably with the terms
   "EAP peer" and "EAP server", respectively.  Additional terms are
   defined below:

   Man in the Middle (MITM)

      An adversary that can successfully inject itself between a peer
      and EAP server.  The MITM succeeds by impersonating a valid peer
      or server.

   Provisioning

      Providing a peer with a trust anchor, shared secret, or other
      appropriate information needed to establish a security
      association.

   Protected Access Credential (PAC)

      Credentials distributed to a peer for future optimized network
      authentication.  The PAC consists of at most three components: a
      shared secret, an opaque element, and optional information.  The
      shared secret part contains the secret key shared between the peer
      and server.  The opaque part contains the shared secret encrypted
      by a private key only known to the server.  It is provided to the
      peer and is presented back to the server when the peer wishes to
      obtain access to network resources.  Finally, a PAC may optionally
      include other information that may be useful to the peer.




<span class="grey">Cam-Winget, et al.           Informational                      [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   Tunnel PAC

      A set of credentials stored by the peer and consumed by both the
      peer and the server to establish a TLS tunnel.

   User Authorization PAC

      A User Authorization PAC is server-encrypted data containing
      authorization information associated with a previously
      authenticated user.  The User Authorization PAC does not contain a
      key, but rather it is generally bound to a Tunnel PAC, which is
      used with the User Authorization PAC.

   Machine Authentication PAC

      A Machine Authentication PAC contains server-encrypted data
      containing authorization information associated with a device.  A
      Machine Authentication PAC may be used instead of a Tunnel PAC to
      establish the TLS tunnel to provide machine authentication and
      authorization information.  The Machine Authentication PAC is
      useful in cases where the machine needs to be authenticated and
      authorized to access a network before a user has logged in.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20EAP-FAST%20Provisioning%20Modes"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  EAP-FAST Provisioning Modes</span>

   EAP-FAST supports two modes for provisioning:

   1.  Server-Authenticated Provisioning Mode - Provisioning inside a
       TLS tunnel that provides server-side authentication.

   2.  Server-Unauthenticated Provisioning Mode - Provisioning inside an
       anonymous TLS tunnel.

   The EAP-FAST provisioning modes use EAP-FAST phase 2 inside a secure
   TLS tunnel established during phase 1.  [<a href="rfc4851.html" title='"The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP- FAST)"'>RFC4851</a>] describes the EAP-
   FAST phases in greater detail.

   In the Server-Authenticated Provisioning Mode, the peer has
   successfully authenticated the EAP server as part of EAP-FAST phase 1
   (i.e., TLS tunnel establishment).  Additional exchanges MAY occur
   inside the tunnel to allow the EAP server to authenticate the EAP
   peer before provisioning any information.

   In the Server-Unauthenticated Provisioning Mode, an unauthenticated
   TLS tunnel is established in the EAP-FAST phase 1.  The peer MUST
   negotiate a TLS anonymous Diffie-Hellman-based ciphersuite to signal





<span class="grey">Cam-Winget, et al.           Informational                      [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   that it wishes to use Server-Unauthenticateded Provisioning Mode.
   This provisioning mode enables the bootstrapping of peers where the
   peer lacks strong credentials usable for mutual authentication with
   the server.

   Since the server is not authenticated in the Server-Unauthenticated
   Provisioning Mode, it is possible that an attacker may intercept the
   TLS tunnel.  If an anonymous tunnel is used, then the peer and server
   MUST negotiate and successfully complete an EAP method supporting
   mutual authentication and key derivation as described in <a href="#section-6">Section 6</a>.
   The peer then uses the Crypto-Binding TLV to validate the integrity
   of the TLS tunnel, thereby verifying that the exchange was not
   subject to a man-in-the-middle attack.

   Server-Authenticated Provisioning Mode protects against the man-in-
   the-middle attack; however, it requires provisioning the peer with
   the credentials necessary to authenticate the server.  Environments
   willing to trade off the security risk of a man-in-the-middle attack
   for ease of deployment can choose to use the Server-Unauthenticated
   Provisioning Mode.

   Assuming that an inner EAP method and Crypto-Binding TLV exchange is
   successful, the server will subsequently provide credential
   information, such as a shared key using a PAC TLV or the trusted
   certificate root(s) of the server using a Server-Trusted-Root TLV.
   Once the EAP-FAST Provisioning conversation completes, the peer is
   expected to use the provisioned credentials in subsequent EAP-FAST
   authentications.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Dynamic%20Provisioning%20Using%20EAP-FAST%20Conversation"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Dynamic Provisioning Using EAP-FAST Conversation</span>

   The provisioning occurs in the following steps, which are detailed in
   the subsequent sections and in <a href="rfc4851.html">RFC 4851</a>.  First, the EAP-FAST phase 1
   TLS tunnel is established.  During this process, extra material is
   extracted from the TLS key derivation for use as challenges in the
   subsequent authentication exchange.  Next, an inner EAP method, such
   as EAP-FAST-MSCHAPv2 (Microsoft Challenge Handshake Authentication
   Protocol version 2), is executed within the EAP-FAST phase 2 TLS
   tunnel to authenticate the client using the challenges derived from
   the phase 1 TLS exchange.  Following successful authentication and
   Crypto-Binding TLV exchange, the server provisions the peer with PAC
   information including the secret PAC-Key and the PAC-Opaque.
   Finally, the EAP-FAST conversation completes with Result TLV
   exchanges defined in <a href="rfc4851.html">RFC 4851</a>.  The exported EAP Master Session Key
   (MSK) and Extended MSK (EMSK) are derived from a combination of the
   tunnel key material and key material from the inner EAP method
   exchange.




<span class="grey">Cam-Winget, et al.           Informational                      [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Phase%201%20TLS%20Tunnel"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Phase 1 TLS Tunnel</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.1.%20%20Server-Authenticated%20Tunnel"></a><a class="selflink" href="#section-3.1.1" name="section-3.1.1">3.1.1</a>.  Server-Authenticated Tunnel</span>

   The provisioning EAP-FAST exchange uses the same sequence as the EAP-
   FAST authentication phase 1 to establish a protected TLS tunnel.
   Implementations supporting this version of the Sever-Authenticated
   Provisioning Mode MUST support the following TLS ciphersuites defined
   in [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>]:

         TLS_RSA_WITH_RC4_128_SHA
         TLS_RSA_WITH_AES_128_CBC_SHA
         TLS_DHE_RSA_WITH_AES_128_CBC_SHA

   Other TLS ciphersuites that provide server authentication and
   encryption MAY be supported.  The server MAY authenticate the peer
   during the TLS handshake in Server-Authenticated Provisioning Mode.
   To adhere to best security practices, the peer MUST validate the
   server's certificate chain when performing server-side authentication
   to obtain the full security benefits of Server-Authenticated
   provisioning.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.2.%20%20Server-Unauthenticated%20Tunnel"></a><a class="selflink" href="#section-3.1.2" name="section-3.1.2">3.1.2</a>.  Server-Unauthenticated Tunnel</span>

   Implementations supporting this version of the Sever-Unauthenticated
   Provisioning Mode MUST support the following TLS ciphersuite defined
   in [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>]:

      TLS_DH_anon_WITH_AES_128_CBC_SHA

   Anonymous ciphersuites SHOULD NOT be allowed outside of EAP-FAST
   Server-Unauthenticated Provisioning Mode.  Any ciphersuites that are
   used for Server-Unauthenticated Provisioning Mode MUST provide a key
   agreement contributed by both parties.  Therefore, ciphersuites based
   on RSA key transport MUST NOT be used for this mode.  Ciphersuites
   that are used for provisioning MUST provide encryption.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Phase%202%20-%20Tunneled%20Authentication%20and%20Provisioning"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Phase 2 - Tunneled Authentication and Provisioning</span>

   Once a protected tunnel is established and the server is
   unauthenticated, the peer and server MUST execute additional
   authentication and perform integrity checks of the TLS tunnel.  Even
   if both parties are authenticated during TLS tunnel establishment,
   the peer and server MAY wish to perform additional authentication
   within the tunnel.  As defined in [<a href="rfc4851.html" title='"The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP- FAST)"'>RFC4851</a>], the authentication
   exchange will be followed by an Intermediate-Result TLV and a Crypto-
   Binding TLV, if the EAP method succeeded.  The Crypto-Binding TLV




<span class="grey">Cam-Winget, et al.           Informational                      [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   provides a check on the integrity of the tunnel with respect to the
   endpoints of the EAP method.  If the preceding is successful, then a
   provisioning exchange MAY take place.  The provisioning exchange will
   use a PAC TLV exchange if a PAC is being provisioned and a Server-
   Trusted-Root TLV if a trusted root certificate is being provisioned.
   The provisioning MAY be solicited by the peer or it MAY be
   unsolicited.  The PAC TLV exchange consists of the server
   distributing the PAC in a corresponding PAC TLV to the peer and the
   peer confirming its receipt in a final PAC TLV Acknowledgement
   message.  The peer may also use the PAC TLV to request that the
   server send a PAC.  The provisioning TLVs MAY be piggybacked onto the
   Result TLV.  Many implementations process TLVs in the order they are
   received; thus, for proper provisioning to occur, the Result TLV MUST
   precede the TLVs to be provisioned (e.g., Tunnel PAC, Machine
   Authentication PAC, and User Authorization PAC).  A PAC TLV MUST NOT
   be accepted if it is not encapsulated in an encrypted TLS tunnel.

   A fresh PAC MAY be distributed if the server detects that the PAC is
   expiring soon.  In-band PAC refreshing is through the PAC TLV
   mechanism.  The decision of whether or not to refresh the PAC is
   determined by the server.  Based on the PAC-Opaque information, the
   server MAY determine not to refresh a peer's PAC, even if the PAC-Key
   has expired.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.%20%20Server-Authenticated%20Tunneled%20Authentication"></a><a class="selflink" href="#section-3.2.1" name="section-3.2.1">3.2.1</a>.  Server-Authenticated Tunneled Authentication</span>

   If Server-Authenticated Provisioning Mode is in use, then any EAP
   method may be used within the TLS tunnel to authenticate the peer
   that is allowed by the peer's policy.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.%20%20Server-Unauthenticated%20Tunneled%20Authentication"></a><a class="selflink" href="#section-3.2.2" name="section-3.2.2">3.2.2</a>.  Server-Unauthenticated Tunneled Authentication</span>

   If Server-Unauthenticated Provisioning Mode is in use, then peer
   authenticates the server and the server authenticates the peer within
   the tunnel.  The only method for performing authentication defined in
   this version of EAP-FAST is EAP-FAST-MSCHAPv2 (in a special way as
   described in the following section).  It is possible for other
   methods to be defined to perform this authentication in the future.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.3.%20%20Authenticating%20Using%20EAP-FAST-MSCHAPv2"></a><a class="selflink" href="#section-3.2.3" name="section-3.2.3">3.2.3</a>.  Authenticating Using EAP-FAST-MSCHAPv2</span>

   EAP-FAST-MSCHAPv2 is a specific instantiation of EAP-MSCHAPv2
   [<a href="#ref-EAP-MSCHAPv2" title='"MS-CHAP: Extensible Authentication Protocol Method for Microsoft Challenge Handshake Authentication Protocol (CHAP) Specification"'>EAP-MSCHAPv2</a>] defined for use within EAP-FAST.  The 256-bit inner
   session key (ISK) is generated from EAP-FAST-MSCHAPv2 by combining
   the 128-bit master keys derived according to <a href="rfc3079.html">RFC 3079</a> [<a href="rfc3079.html" title='"Deriving Keys for use with Microsoft Point-to-Point Encryption (MPPE)"'>RFC3079</a>], with
   the MasterSendKey taking the first 16 octets and MasterReceiveKey
   taking the last 16 octets.




<span class="grey">Cam-Winget, et al.           Informational                      [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   Implementations of this version of the EAP-FAST Server-
   Unauthenticated Provisioning Mode MUST support EAP-FAST-MSCHAPv2 as
   the inner authentication method.  While other authentication methods
   exist, EAP-FAST-MSCHAPv2 was chosen for several reasons:

   o  It provides the ability to slow an active attack by using a hash-
      based challenge-response protocol.

   o  Its use of a challenge-response protocol, such as MSCHAPv2,
      provides some ability to detect a man-in-the-middle attack during
      Server-Unauthenticated Provisioning Mode.

   o  It is already supported by a large deployed base.

   o  It allows support for password change during the EAP-FAST
      provisioning modes.

   When using an anonymous Diffie-Hellman (DH) key agreement, the
   challenges MUST be generated as defined in <a href="#section-3.3">Section 3.3</a>.  This forms a
   binding between the tunnel and the EAP-FAST-MSCHAPv2 exchanges by
   using keying material generated during the EAP-FAST tunnel
   establishment as the EAP-FAST-MSCHAPv2 challenges instead of using
   the challenges exchanged within the protocol itself.  The exchanged
   challenges are zeroed upon transmission, ignored upon reception, and
   the challenges derived from the TLS key exchange are used in the
   calculations.  When EAP-FAST-MSCHAPv2 is used within a tunnel
   established using a ciphersuite other than one that provides
   anonymous key agreement, the randomly generated EAP-FAST-MSCHAPv2
   challenges MUST be exchanged and used.

   The EAP-FAST-MSCHAPv2 exchange forces the server to provide a valid
   ServerChallengeResponse, which must be a function of the server
   challenge, peer challenge, and password as part of its response.
   This reduces the window of vulnerability of a man-in-the-middle
   attack spoofing the server by requiring the attacker to successfully
   break the password within the peer's challenge-response time limit.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.4.%20%20Use%20of%20Other%20Inner%20EAP%20Methods%20for%20EAP-FAST%20Provisioning"></a><a class="selflink" href="#section-3.2.4" name="section-3.2.4">3.2.4</a>.  Use of Other Inner EAP Methods for EAP-FAST Provisioning</span>

   Once a protected tunnel is established, typically the peer
   authenticates itself to the server before the server can provision
   the peer.  If the authentication mechanism does not support mutual
   authentication and protection from man-in-the-middle attacks, then
   Server-Authenticated Provisioning Mode MUST be used.  Within a server
   side, authenticated tunnel authentication mechanisms such as EAP-
   FAST-GTC (Generic Token Card) [<a href="rfc5421.html" title='"Basic Password Exchange within the Flexible Authentication via Secure Tunneling Extensible Authentication Protocol (EAP- FAST)"'>RFC5421</a>] MAY be used.  This will
   enable peers using other authentication mechanisms such as password
   database and one-time passwords to be provisioned in-band as well.



<span class="grey">Cam-Winget, et al.           Informational                      [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   This version of the EAP-FAST provisioning mode implementation MUST
   support both EAP-FAST-GTC and EAP-FAST-MSCHAPv2 within the tunnel in
   Server-Authenticated Provisioning Mode.

   It should be noted that Server-Authenticated Provisioning Mode
   provides significant security advantages over Server-Unauthenticated
   Provisioning Mode even when EAP-FAST-MSCHAPv2 is being used as the
   inner method.  It protects the EAP-FAST-MSCHAPv2 exchanges from
   potential active MITM attacks by verifying the server's authenticity
   before executing EAP-FAST-MSCHAPv2.  Server-Authenticated
   Provisioning Mode is the recommended provisioning mode.  The EAP-FAST
   peer MUST use the Server- Authenticated Provisioning Mode whenever it
   is configured with a valid trust root for a particular server.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Key%20Derivations%20Used%20in%20the%20EAP-FAST%20Provisioning%20Exchange"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Key Derivations Used in the EAP-FAST Provisioning Exchange</span>

   The TLS tunnel key is calculated according to the TLS version with an
   extra 72 octets of key material derived from the end of the
   key_block.  Portions of the extra 72 octets are used for the EAP-FAST
   provisioning exchange session key seed and as the random challenges
   in the EAP-FAST-MSCHAPv2 exchange.

   To generate the key material, compute:

                key_block = PRF(master_secret,
                               "key expansion",
                               server_random +
                               client_random);

   until enough output has been generated.

   For example, the key_block for TLS 1.0 [<a href="rfc2246.html" title='"The TLS Protocol Version 1.0"'>RFC2246</a>] is partitioned as
   follows:

                client_write_MAC_secret[hash_size]
                server_write_MAC_secret[hash_size]
                client_write_key[Key_material_length]
                server_write_key[key_material_length]
                client_write_IV[IV_size]
                server_write_IV[IV_size]
                session_key_seed[40]
                ServerChallenge[16]
                ClientChallenge[16]








<span class="grey">Cam-Winget, et al.           Informational                     [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   and the key_block for subsequent versions is partitioned as follows:

                client_write_MAC_secret[hash_size]
                server_write_MAC_secret[hash_size]
                client_write_key[Key_material_length]
                server_write_key[key_material_length]
                session_key_seed[40]
                ServerChallenge[16]
                ClientChallenge[16]

   In the extra key material, session_key_seed is used for the EAP-FAST
   Crypto-Binding TLV exchange while the ServerChallenge and
   ClientChallenge correspond to the authentication server's EAP-FAST-
   MSCHAPv2 challenge and the peer's EAP-FAST-MSCHAPv2 challenge,
   respectively.  The ServerChallenge and ClientChallenge are only used
   for the EAP-FAST-MSCHAPv2 exchange when Diffie-Hellman anonymous key
   agreement is used in the EAP-FAST tunnel establishment.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20%20Peer-Id%2C%20Server-Id%2C%20and%20Session-Id"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>.  Peer-Id, Server-Id, and Session-Id</span>

   The provisioning modes of EAP-FAST do not change the general EAP-
   FAST protocol and thus how the Peer-Id, Server-Id, and Session-Id are
   determined is based on the [<a href="rfc4851.html" title='"The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP- FAST)"'>RFC4851</a>] techniques.

   <a href="rfc4851.html#section-3.4">Section 3.4 of [RFC4851]</a> describes how the Peer-Id and Server-Id are
   determined; <a href="#section-3.5">Section 3.5</a> describes how the Session-Id is generated.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.5.%20%20Network%20Access%20after%20EAP-FAST%20Provisioning"></a><a class="selflink" href="#section-3.5" name="section-3.5">3.5</a>.  Network Access after EAP-FAST Provisioning</span>

   After successful provisioning, network access MAY be granted or
   denied depending upon the server policy.  For example, in the Server-
   Authenticated Provisioning Mode, access can be granted after the EAP
   server has authenticated the peer and provisioned it with a Tunnel
   PAC (i.e., a PAC used to mutually authenticate and establish the EAP-
   FAST tunnel).  Additionally, peer policy MAY instruct the peer to
   disconnect the current provisioning connection and initiate a new
   EAP-FAST exchange for authentication utilizing the newly provisioned
   information.  At the end of the Server-Unauthenticated Provisioning
   Mode, network access SHOULD NOT be granted as this conversation is
   intended for provisioning only and thus no network access is
   authorized.  The server MAY grant access at the end of a successful
   Server-Authenticated provisioning exchange.

   If after successful provisioning access to the network is denied, the
   EAP Server SHOULD conclude with an EAP Failure.  The EAP server SHALL
   NOT grant network access or distribute any session keys to the
   Network Access Server (NAS) if this exchange is not intended to
   provide network access.  Even though the provisioning mode completes



<span class="grey">Cam-Winget, et al.           Informational                     [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   with a successful inner termination (e.g., a successful Result TLV),
   the server policy defines whether or not the peer gains network
   access.  Thus, it is feasible that the server, while providing a
   successful Result TLV, may conclude that its authentication policy
   was not satisfied and terminate the conversation with an EAP Failure.

   Denying network access after EAP-FAST Provisioning may cause
   disruption in scenarios such as wireless devices (e.g., in IEEE
   802.11 devices, an EAP Failure may trigger a full 802.11
   disassociation).  While a full EAP restart can be performed, a smooth
   transition to the subsequent EAP-FAST authentications to enable
   network access can be achieved by the peer or server initiating TLS
   renegotiation, where the newly provisioned credentials can be used to
   establish a server-authenticated or mutually authenticated TLS tunnel
   for authentication.  Either the peer or server may reject the request
   for TLS renegotiation.  Upon completion of the TLS negotiation and
   subsequent authentication, normal network access policy on EAP-FAST
   authentication can be applied.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Information%20Provisioned%20in%20EAP-FAST"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Information Provisioned in EAP-FAST</span>

   Multiple types of credentials MAY be provisioned within EAP-FAST.
   The most common credential is the Tunnel PAC that is used to
   establish the EAP-FAST phase 1 tunnel.  In addition to the Tunnel
   PAC, other types of credentials and information can also be
   provisioned through EAP-FAST.  They may include trusted root
   certificates, PACs for specific purposes, and user identities, to
   name a few.  Typically, provisioning is invoked after both the peer
   and server authenticate each other and after a successful Crypto-
   Binding TLV exchange.  However, depending on the information being
   provisioned, mutual authentication MAY not be needed.

   At a minimum, either the peer or server must prove authenticity
   before credentials are provisioned to ensure that information is not
   freely provisioned to or by adversaries.  For example, the EAP server
   may not need to authenticate the peer to provision it with trusted
   root certificates.  However, the peer SHOULD authenticate the server
   before it can accept a trusted server root certificate.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Protected%20Access%20Credential"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Protected Access Credential</span>

   A Protected Access Credential (PAC) is a security credential
   generated by the server that holds information specific to a peer.
   The server distributes all PAC information through the use of a PAC
   TLV.  Different types of PAC information are identified through the
   PAC Type and other PAC attributes defined in this section.  This
   document defines three types of PACs: a Tunnel PAC, a Machine
   Authentication PAC, and a User Authorization PAC.



<span class="grey">Cam-Winget, et al.           Informational                     [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.1.1.%20%20Tunnel%20PAC"></a><a class="selflink" href="#section-4.1.1" name="section-4.1.1">4.1.1</a>.  Tunnel PAC</span>

   The server distributes the Tunnel PAC to the peer, which uses it in
   subsequent attempts to establish a secure EAP-FAST TLS tunnel with
   the server.  The Tunnel PAC includes a secret key (PAC-Key), data
   that is opaque to the peer (PAC-Opaque), and other information (PAC-
   Info) that the peer can interpret.  The opaque data is generated by
   the server and cryptographically protected so it cannot be modified
   or interpreted by the peer.  The Tunnel PAC conveys the server policy
   of what must and can occur in the protected phase 2 tunnel.  It is up
   to the server policy to include what is necessary in a PAC-Opaque to
   enforce the policy in subsequent TLS handshakes.  For example, user
   identity, I-ID, can be included as the part of the server policy.
   This I-ID information limits the inner EAP methods to be carried only
   on the specified user identity.  Other types of information can also
   be included, such as which EAP method(s) and which TLS ciphersuites
   are allowed.  If the server policy is not included in a PAC-Opaque,
   then there is no limitation imposed by the PAC on the usage of the
   inner EAP methods or user identities inside the tunnel established by
   the use of that PAC.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.1.2.%20%20Machine%20Authentication%20PAC"></a><a class="selflink" href="#section-4.1.2" name="section-4.1.2">4.1.2</a>.  Machine Authentication PAC</span>

   The Machine Authentication PAC contains information in the PAC-Opaque
   that identifies the machine.  It is meant to be used by a machine
   when network access is required and no user is logged in.  Typically,
   a server will only grant the minimal amount of access required for a
   machine without a user present based on the Machine Authentication
   PAC.  The Machine Authentication PAC MAY be provisioned during the
   authentication of a user.  It SHOULD be stored by the peer in a
   location that is only accessible to the machine.  This type of PAC
   typically persists across sessions.

   The peer can use the Machine Authentication PAC as the Tunnel PAC to
   establish the TLS tunnel.  The EAP server MAY have a policy to bypass
   additional inner EAP method and grant limited network access based on
   information in the Machine Authentication PAC.  The server MAY
   request additional exchanges to validate machine's other
   authorization criteria, such as posture information etc., before
   granting network access.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.1.3.%20%20User%20Authorization%20PAC"></a><a class="selflink" href="#section-4.1.3" name="section-4.1.3">4.1.3</a>.  User Authorization PAC</span>

   The User Authorization PAC contains information in the PAC-Opaque
   that identifies a user and provides authorization information.  This
   type of PAC does not contain a PAC-Key.  The PAC-Opaque portion of
   the User Authorization PAC is presented within the protected EAP-FAST
   TLS tunnel to provide user information during stateless session



<span class="grey">Cam-Winget, et al.           Informational                     [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   resume so user authentication MAY be skipped.  The User Authorization
   PAC MAY be provisioned after user authentication.  It is meant to be
   short lived and not persisted across logon sessions.  The User
   Authorization PAC SHOULD only be available to the user for which it
   is provisioned.  The User Authorization PAC SHOULD be deleted from
   the peer when the local authorization state of a user's session
   changes, such as upon the user logs out.

   Once the EAP-FAST phase 1 TLS tunnel is established, the peer MAY
   present a User Authorization PAC to the server in a PAC TLV.  This is
   sent as TLS application data, but it MAY be included in the same
   message as the Finished Handshake message sent by the peer.  The User
   Authorization PAC MUST only be sent within the protection of an
   encrypted tunnel to an authenticated entity.  The server will decrypt
   the PAC and evaluate the contents.  If the contents are valid and the
   server policy allows the session to be resumed based on this
   information, then the server will complete the session resumption and
   grant access to the peer without requiring an inner authentication
   method.  This is called stateless session resume in EAP-FAST.  In
   this case, the server sends the Result TLV indicating success without
   the Crypto-Binding TLV and the peer sends back a Result TLV
   indicating success.  If the User Authorization PAC fails the server
   validation or the server policy, the server MAY either reject the
   request or continue with performing full user authentication within
   the tunnel.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.1.4.%20%20PAC%20Provisioning"></a><a class="selflink" href="#section-4.1.4" name="section-4.1.4">4.1.4</a>.  PAC Provisioning</span>

   To request provisioning of a PAC, a peer sends a PAC TLV containing a
   PAC attribute of PAC Type set to the appropriate value.  For a Tunnel
   PAC, the value is '1'; for a Machine Authentication PAC, the value is
   '2'; and for a User Authorization PAC, the value is '3'.  The request
   MAY be issued after the peer has determined that it has successfully
   authenticated the EAP server and validated the Crypto-Binding TLV to
   ensure that the TLS tunnel's integrity is intact.  Since anonymous DH
   ciphersuites are only allowed for provisioning a Tunnel PAC, if an
   anonymous ciphersuite is negotiated, the Tunnel PAC MAY be
   provisioned automatically by the server.  The peer MUST send separate
   PAC TLVs for each type of PAC it wants to provision.  Multiple PAC
   TLVs can be sent in the same packet or different packets.  When
   requesting the Machine Authentication PAC, the peer SHOULD include an
   I-ID TLV containing the machine name prefixed by "host/".  The EAP
   server will send the PACs after its internal policy has been
   satisfied, or it MAY ignore the request or request additional
   authentications if its policy dictates.  If a peer receives a PAC
   with an unknown type, it MUST ignore it.





<span class="grey">Cam-Winget, et al.           Informational                     [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   A PAC-TLV containing PAC-Acknowledge attribute MUST be sent by the
   peer to acknowledge the receipt of the Tunnel PAC.  A PAC-Acknowledge
   TLV MUST NOT be used by the peer to acknowledge the receipt of other
   types of PACs.

   Please see <a href="#appendix-A.1">Appendix A.1</a> for an example of packet exchanges to
   provision a Tunnel PAC.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20PAC%20TLV%20Format"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  PAC TLV Format</span>

   The PAC TLV provides support for provisioning the Protected Access
   Credential (PAC) defined within [<a href="rfc4851.html" title='"The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP- FAST)"'>RFC4851</a>].  The PAC TLV carries the
   PAC and related information within PAC attribute fields.
   Additionally, the PAC TLV MAY be used by the peer to request
   provisioning of a PAC of the type specified in the PAC Type PAC
   attribute.  The PAC TLV MUST only be used in a protected tunnel
   providing encryption and integrity protection.  A general PAC TLV
   format is defined as follows:

   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|R|         TLV Type          |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        PAC Attributes...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

        M

             0 - Non-mandatory TLV
             1 - Mandatory TLV

        R

             Reserved, set to zero (0)

        TLV Type

                  11 - PAC TLV

        Length

                Two octets containing the length of the PAC attributes
                field in octets.

        PAC Attributes

                        A list of PAC attributes in the TLV format.



<span class="grey">Cam-Winget, et al.           Informational                     [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.%20%20Formats%20for%20PAC%20Attributes"></a><a class="selflink" href="#section-4.2.1" name="section-4.2.1">4.2.1</a>.  Formats for PAC Attributes</span>

   Each PAC attribute in a PAC TLV is formatted as a TLV defined as
   follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Type               |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              Value...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

        Type

             The Type field is two octets, denoting the attribute type.
             Allocated Types include:

                     1 - PAC-Key
                     2 - PAC-Opaque
                     3 - PAC-Lifetime
                     4 - A-ID
                     5 - I-ID
                     6 - Reserved
                     7 - A-ID-Info
                     8 - PAC-Acknowledgement
                     9 - PAC-Info
                     10 - PAC-Type

        Length

                Two octets containing the length of the Value field in
                octets.

        Value

               The value of the PAC attribute.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.2.%20%20PAC-Key"></a><a class="selflink" href="#section-4.2.2" name="section-4.2.2">4.2.2</a>.  PAC-Key</span>

   The PAC-Key is a secret key distributed in a PAC attribute of type
   PAC-Key.  The PAC-Key attribute is included within the PAC TLV
   whenever the server wishes to issue or renew a PAC that is bound to a
   key such as a Tunnel PAC.  The key is a randomly generated octet
   string, which is 32 octets in length.  The generator of this key is
   the issuer of the credential, which is identified by the Authority
   Identifier (A-ID).




<span class="grey">Cam-Winget, et al.           Informational                     [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Type               |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                              Key                              ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Type

         1 - PAC-Key

      Length

         2-octet length indicating a 32-octet key

      Key

         The value of the PAC-Key.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.3.%20%20PAC-Opaque"></a><a class="selflink" href="#section-4.2.3" name="section-4.2.3">4.2.3</a>.  PAC-Opaque</span>

   The PAC-Opaque attribute is included within the PAC TLV whenever the
   server wishes to issue or renew a PAC or the client wishes to present
   a User Authorization PAC to the server.

   The PAC-Opaque is opaque to the peer and thus the peer MUST NOT
   attempt to interpret it.  A peer that has been issued a PAC-Opaque by
   a server stores that data and presents it back to the server
   according to its PAC Type.  The Tunnel PAC is used in the ClientHello
   SessionTicket extension field defined in [<a href="rfc5077.html" title='"Transport Layer Security (TLS) Session Resumption without Server-Side State"'>RFC5077</a>].  If a peer has
   opaque data issued to it by multiple servers, then it stores the data
   issued by each server separately according to the A-ID.  This
   requirement allows the peer to maintain and use each opaque datum as
   an independent PAC pairing, with a PAC-Key mapping to a PAC-Opaque
   identified by the A-ID.  As there is a one-to-one correspondence
   between the PAC-Key and PAC-Opaque, the peer determines the PAC-Key
   and corresponding PAC-Opaque based on the A-ID provided in the EAP-
   FAST/Start message and the A-ID provided in the PAC-Info when it was
   provisioned with a PAC-Opaque.

   The PAC-Opaque attribute format is summarized as follows:







<span class="grey">Cam-Winget, et al.           Informational                     [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Type               |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              Value ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Type

         2 - PAC-Opaque

      Length

         The Length filed is two octets, which contains the length of
         the Value field in octets.

      Value

         The Value field contains the actual data for the PAC-Opaque.
         It is specific to the server implementation.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.4.%20%20PAC-Info"></a><a class="selflink" href="#section-4.2.4" name="section-4.2.4">4.2.4</a>.  PAC-Info</span>

   The PAC-Info is comprised of a set of PAC attributes as defined in
   <a href="#section-4.2.1">Section 4.2.1</a>.  The PAC-Info attribute MUST contain the A-ID, A-ID-
   Info, and PAC-Type attributes.  Other attributes MAY be included in
   the PAC-Info to provide more information to the peer.  The PAC-Info
   attribute MUST NOT contain the PAC-Key, PAC-Acknowledgement, PAC-
   Info, or PAC-Opaque attributes.  The PAC-Info attribute is included
   within the PAC TLV whenever the server wishes to issue or renew a
   PAC.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Type               |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           Attributes...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Type

         9 - PAC-Info







<span class="grey">Cam-Winget, et al.           Informational                     [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


      Length

         2-octet Length field containing the length of the attributes
         field in octets.

      Attributes

         The attributes field contains a list of PAC attributes.  Each
         mandatory and optional field type is defined as follows:

         3 - PAC-LIFETIME

            This is a 4-octet quantity representing the expiration time
            of the credential expressed as the number of seconds,
            excluding leap seconds, after midnight UTC, January 1, 1970.
            This attribute MAY be provided to the peer as part of the
            PAC-Info.

         4 - A-ID

            The A-ID is the identity of the authority that issued the
            PAC.  The A-ID is intended to be unique across all issuing
            servers to avoid namespace collisions.  The A-ID is used by
            the peer to determine which PAC to employ.  The A-ID is
            treated as an opaque octet string.  This attribute MUST be
            included in the PAC-Info attribute.  The A-ID MUST match the
            A-ID the server used to establish the tunnel.  Since many
            existing implementations expect the A-ID to be 16 octets in
            length, it is RECOMMENDED that the length of an A-ID be 16
            octets for maximum interoperability.  One method for
            generating the A-ID is to use a high-quality random number
            generator to generate a 16-octet random number.  An
            alternate method would be to take the hash of the public key
            or public key certificate belonging a server represented by
            the A-ID.

         5 - I-ID

            Initiator identifier (I-ID) is the peer identity associated
            with the credential.  This identity is derived from the
            inner EAP exchange or from the client-side authentication
            during tunnel establishment if inner EAP method
            authentication is not used.  The server employs the I-ID in
            the EAP-FAST phase 2 conversation to validate that the same
            peer identity used to execute EAP-FAST phase 1 is also used
            in at minimum one inner EAP method in EAP-FAST phase 2.  If
            the server is enforcing the I-ID validation on the inner EAP
            method, then the I-ID MUST be included in the PAC-Info, to



<span class="grey">Cam-Winget, et al.           Informational                     [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


            enable the peer to also enforce a unique PAC for each unique
            user.  If the I-ID is missing from the PAC-Info, it is
            assumed that the Tunnel PAC can be used for multiple users
            and the peer will not enforce the unique-Tunnel-PAC-per-user
            policy.

         7 - A-ID-Info

            Authority Identifier Information is intended to provide a
            user-friendly name for the A-ID.  It may contain the
            enterprise name and server name in a human-readable format.
            This TLV serves as an aid to the peer to better inform the
            end-user about the A-ID.  The name is encoded in UTF-8
            [<a href="rfc3629.html" title='"UTF-8, a transformation format of ISO 10646"'>RFC3629</a>] format.  This attribute MUST be included in the
            PAC-Info.

         10 - PAC-type

            The PAC-Type is intended to provide the type of PAC.  This
            attribute SHOULD be included in the PAC-Info.  If the PAC-
            Type is not present, then it defaults to a Tunnel PAC (Type
            1).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.5.%20%20PAC-Acknowledgement%20TLV"></a><a class="selflink" href="#section-4.2.5" name="section-4.2.5">4.2.5</a>.  PAC-Acknowledgement TLV</span>

   The PAC-Acknowledgement is used to acknowledge the receipt of the
   Tunnel PAC by the peer.  The peer includes the PAC-Acknowledgement
   TLV in a PAC-TLV sent to the server to indicate the result of the
   processing and storing of a newly provisioned Tunnel PAC.  This TLV
   is only used when Tunnel PAC is provisioned.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Type               |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Result             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Type

         8 - PAC-Acknowledgement

      Length

         The length of this field is two octets containing a value of 2.





<span class="grey">Cam-Winget, et al.           Informational                     [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


      Result

         The resulting value MUST be one of the following:

               1 - Success
               2 - Failure

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.6.%20%20PAC-Type%20TLV"></a><a class="selflink" href="#section-4.2.6" name="section-4.2.6">4.2.6</a>.  PAC-Type TLV</span>

   The PAC-Type TLV is a TLV intended to specify the PAC type.  It is
   included in a PAC-TLV sent by the peer to request PAC provisioning
   from the server.  Its format is described below:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Type               |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         PAC Type              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Type

         10 - PAC-Type

      Length

         2-octet Length field with a value of 2

      PAC Type

         This 2-octet field defines the type of PAC being requested or
         provisioned.  The following values are defined:

               1 - Tunnel PAC
               2 - Machine Authentication PAC
               3 - User Authorization PAC

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20Trusted%20Server%20Root%20Certificate"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  Trusted Server Root Certificate</span>

   Server-Trusted-Root TLV facilitates the request and delivery of a
   trusted server root certificate.  The Server-Trusted-Root TLV can be
   exchanged in regular EAP-FAST authentication mode or provisioning
   mode.  The Server-Trusted-Root TLV is always marked as optional, and







<span class="grey">Cam-Winget, et al.           Informational                     [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   cannot be responded to with a Negative Acknowledgement (NAK) TLV.
   The Server-Trusted-Root TLV MUST only be sent as an inner TLV (inside
   the protection of the tunnel).

   After the peer has determined that it has successfully authenticated
   the EAP server and validated the Crypto-Binding TLV, it MAY send one
   or more Server-Trusted-Root TLVs (marked as optional) to request the
   trusted server root certificates from the EAP server.  The EAP server
   MAY send one or more root certificates with a Public Key
   Cryptographic System #7 (PKCS#7) TLV inside Server-Trusted-Root TLV.
   The EAP server MAY also choose not to honor the request.  Please see
   <a href="#appendix-A.3">Appendix A.3</a> for an example of a server provisioning a server trusted
   root certificate.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.1.%20%20Server-Trusted-Root%20TLV"></a><a class="selflink" href="#section-4.3.1" name="section-4.3.1">4.3.1</a>.  Server-Trusted-Root TLV</span>

   The Server-Trusted-Root TLV allows the peer to send a request to the
   EAP server for a list of trusted roots.  The server may respond with
   one or more root certificates in PKCS#7 [<a href="rfc2315.html" title='"PKCS #7: Cryptographic Message Syntax Version 1.5"'>RFC2315</a>] format.

   If the EAP server sets the credential format to PKCS#7-Server-
   Certificate-Root, then the Server-Trusted-Root TLV should contain the
   root of the certificate chain of the certificate issued to the EAP
   server packaged in a PKCS#7 TLV.  If the Server certificate is a
   self-signed certificate, then the root is the self-signed
   certificate.

   If the Server-Trusted-Root TLV credential format contains a value
   unknown to the peer, then the EAP peer should ignore the TLV.

   The Server-Trusted-Root TLV is defined as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|R|         TLV Type          |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Credential-Format   |     Cred TLVs...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-

        M

             0 - Non-mandatory TLV

        R

             Reserved, set to zero (0)




<span class="grey">Cam-Winget, et al.           Informational                     [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


        TLV Type

                  18 - Server-Trusted-Root TLV [<a href="rfc4851.html" title='"The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP- FAST)"'>RFC4851</a>]

        Length

                &gt;=2 octets

        Credential-Format

                           The Credential-Format field is two octets.
                           Values include:

             1 - PKCS#7-Server-Certificate-Root

        Cred TLVs

                   This field is of indefinite length.  It contains TLVs
                   associated with the credential format.  The peer may
                   leave this field empty when using this TLV to request
                   server trust roots.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.2.%20%20PKCS%237%20TLV"></a><a class="selflink" href="#section-4.3.2" name="section-4.3.2">4.3.2</a>.  PKCS#7 TLV</span>

   The PKCS#7 TLV is sent by the EAP server to the peer inside the
   Server-Trusted-Root TLV.  It contains PKCS#7-wrapped [<a href="rfc2315.html" title='"PKCS #7: Cryptographic Message Syntax Version 1.5"'>RFC2315</a>] X.509
   certificates.  The format consists of a certificate or certificate
   chain in a Certificates-Only PKCS#7 SignedData message as defined in
   [<a href="rfc2311.html" title='"S/MIME Version 2 Message Specification"'>RFC2311</a>].

   The PKCS#7 TLV is always marked as optional, which cannot be
   responded to with a NAK TLV.  EAP-FAST server implementations that
   claim to support the dynamic provisioning defined in this document
   SHOULD support this TLV.  EAP-FAST peer implementations MAY support
   this TLV.

   If the PKCS#7 TLV contains a certificate or certificate chain that is
   not acceptable to the peer, then the peer MUST ignore the TLV.

   The PKCS#7 TLV is defined as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|R|         TLV Type          |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           PKCS #7 Data...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-



<span class="grey">Cam-Winget, et al.           Informational                     [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


      M

         0 - Optional TLV

      R

         Reserved, set to zero (0)

      TLV Type

         20 - PKCS#7 TLV [<a href="rfc4851.html" title='"The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP- FAST)"'>RFC4851</a>]

      Length

         The length of the PKCS #7 Data field.

      PKCS #7 Data

         This field contains the X.509 certificate or certificate chain
         in a Certificates-Only PKCS#7 SignedData message.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  IANA Considerations</span>

   This section explains the criteria to be used by the IANA for
   assignment of Type value in the PAC attribute, the PAC Type value in
   the PAC- Type TLV, and the Credential-Format value in the Server-
   Trusted-Root TLV.  The "Specification Required" policy is used here
   with the meaning defined in <a href="https://tools.ietf.org/html/bcp26">BCP 26</a> [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].

   A registry of values, named "EAP-FAST PAC Attribute Types", has been
   created for the PAC attribute types.  The initial values that
   populate the registry are:

         1 - PAC-Key
         2 - PAC-Opaque
         3 - PAC-Lifetime
         4 - A-ID
         5 - I-ID
         6 - Reserved
         7 - A-ID-Info
         8 - PAC-Acknowledgement
         9 - PAC-Info
        10 - PAC-Type

   Values from 11 to 63 are allocated for management by Cisco.  Values
   64 to 255 are assigned with a "Specification Required" policy.





<span class="grey">Cam-Winget, et al.           Informational                     [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   A registry of values, named "EAP-FAST PAC Types", has been created
   for PAC-Type values used in the PAC-Type TLV.  The initial values
   that populate the registry are:

         1 - Tunnel PAC
         2 - Machine Authentication PAC
         3 - User Authorization PAC

   Values from 4 to 63 are allocated for management by Cisco.  Values 64
   to 255 are assigned with a "Specification Required" policy.

   A registry of values, named "EAP-FAST Server-Trusted-Root Credential
   Format Types", has been created for Credential-Format values used in
   the Server-Trusted-Root TLV.  The initial values that populate the
   registry are:

         1 - PKCS#7-Server-Certificate-Root

   Values from 2 to 63 are allocated for management by Cisco.  Values 64
   to 255 are assigned with a "Specification Required" policy.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Security Considerations</span>

   The Dynamic Provisioning EAP-FAST protocol shares the same security
   considerations outlined in [<a href="rfc4851.html" title='"The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP- FAST)"'>RFC4851</a>].  Additionally, it also has its
   unique security considerations described below:

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Provisioning%20Modes%20and%20Man-in-the-Middle%20Attacks"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Provisioning Modes and Man-in-the-Middle Attacks</span>

   EAP-FAST can be invoked in two different provisioning modes: Server-
   Authenticated Provisioning Mode and Server-Unauthenticated
   Provisioning Mode.  Each mode provides different levels of resistance
   to man-in-the-middle attacks.  The following list identifies some of
   the problems associated with a man-in-the-middle attack:

   o  Disclosure of secret information such as keys, identities, and
      credentials to an attacker

   o  Spoofing of a valid server to a peer and the distribution of false
      credentials

   o  Spoofing of a valid peer and receiving credentials generated for
      that peer

   o  Denial of service






<span class="grey">Cam-Winget, et al.           Informational                     [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.1.%20%20Server-Authenticated%20Provisioning%20Mode%20and%20Man-in-the-Middle"></a><a class="selflink" href="#section-6.1.1" name="section-6.1.1">6.1.1</a>.  Server-Authenticated Provisioning Mode and Man-in-the-Middle</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Attacks"></a>        Attacks</span>

   In Server-Authenticated Provisioning Mode, the TLS handshake assures
   protected communications with the server because the peer must have
   been securely pre-provisioned with the trust roots and/or other
   authentication information necessary to authenticate the server
   during the handshake.  This pre-provisioning step prevents an
   attacker from inserting themselves as a man-in-the-middle of the
   communications.  Unfortunately, secure pre-provisioning can be
   difficult to achieve in many environments.

   Cryptographic binding of inner authentication mechanisms to the TLS
   tunnel provides additional protection from man-in-the-middle attacks
   resulting from the tunneling of authentication mechanisms.

   Server-Authenticated Provisioning Mode provides a high degree of
   protection from man-in-the-middle attacks.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.2.%20%20Server-Unauthenticated%20Provisioning%20Mode%20and%20Man-in-the-Middle"></a><a class="selflink" href="#section-6.1.2" name="section-6.1.2">6.1.2</a>.  Server-Unauthenticated Provisioning Mode and Man-in-the-Middle</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Attacks"></a>        Attacks</span>

   In Server-Unauthenticated Provisioning Mode, the TLS handshake does
   not assure protected communications with the server because either an
   anonymous handshake is negotiated or the peer lacks the necessary
   information to complete the authentication of the server.  This
   allows an attacker to insert itself in the middle of the TLS
   communications.

   EAP-FAST Server-Unauthenticated Provisioning Mode mitigates the man-
   in-the-middle attack through the following techniques:

   o  Binding the phase 2 authentication method to secret values derived
      from the phase 1 TLS exchange:

      In the case of EAP-FAST-MSCHAPv2 used with an anonymous Diffie-
      Hellman ciphersuite, the challenges for the EAP-FAST-MSCHAPv2
      exchange are derived from the TLS handshake and are not
      transmitted within the EAP-FAST-MSCHAPv2 exchange.  Since the man-
      in-the-middle attack does not know these challenges, it cannot
      successfully impersonate the server without cracking the EAP-FAST-
      MSCHAPv2 message from the peer before the peer times out.

   o  Cryptographic binding of secret values derived from the phase 2
      authentication exchange with secret values derived from the phase
      1 TLS exchange:





<span class="grey">Cam-Winget, et al.           Informational                     [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


      This makes use of the cryptographic binding exchange defined
      within EAP-FAST to discover the presence of a man-in-the-middle
      attack by binding secret information obtained from the phase 2
      EAP-FAST-MSCHAPv2 exchange with secret information from the phase
      1 TLS exchange.

   While it would be sufficient to only support the cryptographic
   binding to mitigate the MITM, the binding of the EAP-FAST-MSCHAPv2
   random challenge derivations to the TLS key agreement protocol
   enables early detection of a man-in-the-middle attack.  This guards
   against adversaries who may otherwise relay the inner EAP
   authentication messages between the true peer and server, and it
   enforces that the adversary successfully respond with a valid
   challenge response.

   The ciphersuite used to establish phase 1 of the Server-
   Unauthenticated Provisioning Mode MUST be one in which both the peer
   and server provide contribution to the derived TLS master key.
   Ciphersuites that use RSA key transport do not meet this requirement.
   The authenticated and anonymous ephemeral Diffie-Hellman ciphersuites
   provide this type of key agreement.

   This document specifies EAP-FAST-MSCHAPv2 as the inner authentication
   exchange; however, it is possible that other inner authentication
   mechanisms to authenticate the tunnel may be developed in the future.
   Since the strength of the man-in-the-middle protection is directly
   dependent on the strength of the inner method, it is RECOMMENDED that
   any inner method used provide at least as much resistance to attack
   as EAP-FAST-MSCHAPv2.  Cleartext passwords MUST NOT be used in
   Server-Unauthenticated Provisioning Mode.  Note that an active man-
   in-the-middle attack may observe phase 2 authentication method
   exchange until the point that the peer determines that authentication
   mechanism fails or is aborted.  This allows for the disclosure of
   sensitive information such as identity or authentication protocol
   exchanges to the man-in-the-middle attack.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Dictionary%20Attacks"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Dictionary Attacks</span>

   It is often the case that phase 2 authentication mechanisms are based
   on password credentials.  These exchanges may be vulnerable to both
   online and off-line dictionary attacks.  The two provisioning modes
   provide various degrees of protection from these attacks.

   In online dictionary attacks, the attacker attempts to discover the
   password by repeated attempts at authentication using a guessed
   password.  Neither mode prevents this type of attack by itself.
   Implementations should provide controls that limit how often an
   attacker can execute authentication attempts.



<span class="grey">Cam-Winget, et al.           Informational                     [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   In off-line dictionary attacks, the attacker captures information
   that can be processed off-line to recover the password.  Server-
   Authenticated Provisioning Mode provides effecting mitigation because
   the peer will not engage in phase 2 authentication without first
   authenticating the server during phase 1.  Server-Unauthenticated
   Provisioning Mode is vulnerable to this type of attack.  If, during
   phase 2 authentication, a peer receives no response or an invalid
   response from the server, then there is a possibility there is a man-
   in-the-middle attack in progress.  Implementations SHOULD log these
   events and, if possible, provide warnings to the user.
   Implementations are also encouraged to provide controls, which are
   appropriate to their environment, that limit how and where Server-
   Unauthenticated Provisioning Mode can be performed.  For example, an
   implementation may limit this mode to be used only on certain
   interfaces or require user intervention before allowing this mode if
   provisioning has succeeded in the past.

   Another mitigation technique that should not be overlooked is the
   choice of good passwords that have sufficient complexity and length
   and a password-changing policy that requires regular password
   changes.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20Considerations%20in%20Selecting%20a%20Provisioning%20Mode"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  Considerations in Selecting a Provisioning Mode</span>

   Since Server-Authenticated Provisioning Mode provides much better
   protection from attacks than Server-Unauthenticated Provisioning
   Mode, Server-Authenticated Provisioning Mode SHOULD be used whenever
   possible.  The Server-Unauthenticated Provisioning Mode provides a
   viable option as there may be deployments that can physically confine
   devices during the provisioning or are willing to accept the risk of
   an active dictionary attack.  Further, it is the only option that
   enables zero-touch provisioning and facilitates simpler deployments
   requiring little to no peer configuration.  The peer MAY choose to
   use alternative secure out-of-band mechanisms for PAC provisioning
   that afford better security than the Server Unauthenticated
   Provisioning Mode.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.4.%20%20Diffie-Hellman%20Groups"></a><a class="selflink" href="#section-6.4" name="section-6.4">6.4</a>.  Diffie-Hellman Groups</span>

   To encourage interoperability implementations of EAP-FAST, anonymous
   provisioning modes MUST support the 2048-bit group "14" in [<a href="rfc3526.html" title='"More Modular Exponential (MODP) Diffie-Hellman groups for Internet Key Exchange (IKE)"'>RFC3526</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.5.%20%20Tunnel%20PAC%20Usage"></a><a class="selflink" href="#section-6.5" name="section-6.5">6.5</a>.  Tunnel PAC Usage</span>

   The basic usage of the Tunnel PAC is to establish the TLS tunnel.  In
   this operation, it does not have to provide user authentication as
   user authentication is expected to be carried out in phase 2 of EAP-
   FAST.  The EAP-FAST Tunnel PAC MAY contain information about the



<span class="grey">Cam-Winget, et al.           Informational                     [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   identity of a peer to prevent a particular Tunnel PAC from being used
   to establish a tunnel that can perform phase 2 authentication other
   peers.  While it is possible for the server to accept the Tunnel PAC
   as authentication for the peer, many current implementations do not
   do this.  The ability to use PAC to authenticate peers and provide
   authorizations will be the subject of a future document.  [<a href="rfc5077.html" title='"Transport Layer Security (TLS) Session Resumption without Server-Side State"'>RFC5077</a>]
   gives an example PAC-Opaque format in the Recommended Ticket
   Construction section.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.6.%20%20Machine%20Authentication%20PAC%20Usage"></a><a class="selflink" href="#section-6.6" name="section-6.6">6.6</a>.  Machine Authentication PAC Usage</span>

   In general, the Machine Authorization PAC is expected to provide the
   minimum access required by a machine without a user.  This will
   typically be a subset of the privilege a registered user has.  The
   server provisioning the PAC should include information necessary to
   validate it at a later point in time.  This would include expiration
   information.  The Machine Authentication PAC includes a key so it can
   be used as a Tunnel PAC.  The PAC-Key MUST be kept secret by the
   peer.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.7.%20%20User%20Authorization%20PAC%20Usage"></a><a class="selflink" href="#section-6.7" name="section-6.7">6.7</a>.  User Authorization PAC Usage</span>

   The User Authorization PAC provides the privilege associated with a
   user.  The server provisioning the PAC should include the information
   necessary to validate it at a later point in time.  This includes
   expiration and other information associated with the PAC.  The User
   Authorization PAC is a bearer credential such that it does not have a
   key that used to authenticate its ownership.  For this reason, this
   type of PAC MUST NOT be sent in the clear.  For additional
   protection, the PAC MAY be bound to a Tunnel PAC used to establish
   the TLS tunnel.  On the peer, the User Authorization PAC SHOULD only
   be accessible by the user for which it is provisioned.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.8.%20%20PAC%20Storage%20Considerations"></a><a class="selflink" href="#section-6.8" name="section-6.8">6.8</a>.  PAC Storage Considerations</span>

   The main goal of EAP-FAST is to protect the authentication stream
   over the media link.  However, host security is still an issue.  Some
   care should be taken to protect the PAC on both the peer and server.
   The peer must securely store both the PAC-Key and PAC-Opaque, while
   the server must secure storage of its security association context
   used to consume the PAC-Opaque.  Additionally, if alternate
   provisioning is employed, the transportation mechanism used to
   distribute the PAC must also be secured.








<span class="grey">Cam-Winget, et al.           Informational                     [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   Most of the attacks described here would require some level of effort
   to execute: conceivably greater than their value.  The main focus
   therefore, should be to ensure that proper protections are used on
   both the peer and server.  There are a number of potential attacks
   that can be considered against secure key storage such as:

   o  Weak Passphrases

      On the peer side, keys are usually protected by a passphrase.  In
      some environments, this passphrase may be associated with the
      user's password.  In either case, if an attacker can obtain the
      encrypted key for a range of users, he may be able to successfully
      attack a weak passphrase.  The tools are already in place today to
      enable an attacker to easily attack all users in an enterprise
      environment through the use of email viruses and other techniques.

   o  Key Finding Attacks

      Key finding attacks are usually mentioned in reference to web
      servers where the private Secure Socket Layer (SSL) key may be
      stored securely, but at some point, it must be decrypted and
      stored in system memory.  An attacker with access to system memory
      can actually find the key by identifying their mathematical
      properties.  To date, this attack appears to be purely theoretical
      and primarily acts to argue strongly for secure access controls on
      the server itself to prevent such unauthorized code from
      executing.

   o  Key duplication, Key substitution, Key modification

      Once keys are accessible to an attacker on either the peer or
      server, they fall under three forms of attack: key duplication,
      key substitution, and key modification.  The first option would be
      the most common, allowing the attacker to masquerade as the user
      in question.  The second option could have some use if an attacker
      could implement it on the server.  Alternatively, an attacker
      could use one of the latter two attacks on either the peer or
      server to force a PAC re-key, and take advantage of the potential
      MITM/dictionary attack vulnerability of the EAP-FAST Server-
      Unauthenticated Provisioning Mode.

   Another consideration is the use of secure mechanisms afforded by the
   particular device.  For instance, some laptops enable secure key
   storage through a special chip.  It would be worthwhile for
   implementations to explore the use of such a mechanism.






<span class="grey">Cam-Winget, et al.           Informational                     [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.9.%20%20Security%20Claims"></a><a class="selflink" href="#section-6.9" name="section-6.9">6.9</a>.  Security Claims</span>

   The [<a href="rfc3748.html" title='"Extensible Authentication Protocol (EAP)"'>RFC3748</a>] security claims for EAP-FAST are given in <a href="rfc4851.html#section-7.8">Section 7.8
   of [RFC4851]</a>.  When using anonymous provisioning mode, there is a
   greater risk of off-line dictionary attack since it is possible for a
   man-in-the-middle attack to capture the beginning of the inner EAP-
   FAST-MSCHAPv2 conversation.  However, as noted previously, it is
   possible to detect the man-in-the-middle attack.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Acknowledgements"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Acknowledgements</span>

   The EAP-FAST design and protocol specification is based on the ideas
   and contributions from Pad Jakkahalli, Mark Krischer, Doug Smith,
   Ilan Frenkel, Max Pritikin, Jan Vilhuber, and Jeremy Steiglitz.  The
   authors would also like to thank Jouni Malinen, Pasi Eronen, Jari
   Arkko, Chris Newman, Ran Canetti, and Vijay Gurbani for reviewing
   this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20References"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20Normative%20References"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  Normative References</span>

   [<a id="ref-EAP-MSCHAPv2" name="ref-EAP-MSCHAPv2">EAP-MSCHAPv2</a>]  Microsoft Corporation, "MS-CHAP: Extensible
                   Authentication Protocol Method for Microsoft
                   Challenge Handshake Authentication Protocol (CHAP)
                   Specification", January 2009.
                   <a href="http://msdn2.microsoft.com/en-us/library/cc224612.aspx">http://msdn2.microsoft.com/</a>
                   <a href="http://msdn2.microsoft.com/en-us/library/cc224612.aspx">en-us/library/cc224612.aspx</a>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]       Bradner, S., "Key words for use in RFCs to Indicate
                   Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2246" name="ref-RFC2246">RFC2246</a>]       Dierks, T. and C. Allen, "The TLS Protocol Version
                   1.0", <a href="rfc2246.html">RFC 2246</a>, January 1999.

   [<a id="ref-RFC2311" name="ref-RFC2311">RFC2311</a>]       Dusse, S., Hoffman, P., Ramsdell, B., Lundblade, L.,
                   and L. Repka, "S/MIME Version 2 Message
                   Specification", <a href="rfc2311.html">RFC 2311</a>, March 1998.

   [<a id="ref-RFC2315" name="ref-RFC2315">RFC2315</a>]       Kaliski, B., "PKCS #7: Cryptographic Message Syntax
                   Version 1.5", <a href="rfc2315.html">RFC 2315</a>, March 1998.

   [<a id="ref-RFC3079" name="ref-RFC3079">RFC3079</a>]       Zorn, G., "Deriving Keys for use with Microsoft
                   Point-to-Point Encryption (MPPE)", <a href="rfc3079.html">RFC 3079</a>,
                   March 2001.






<span class="grey">Cam-Winget, et al.           Informational                     [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


   [<a id="ref-RFC3526" name="ref-RFC3526">RFC3526</a>]       Kivinen, T. and M. Kojo, "More Modular Exponential
                   (MODP) Diffie-Hellman groups for Internet Key
                   Exchange (IKE)", <a href="rfc3526.html">RFC 3526</a>, May 2003.

   [<a id="ref-RFC3629" name="ref-RFC3629">RFC3629</a>]       Yergeau, F., "UTF-8, a transformation format of ISO
                   10646", STD 63, <a href="rfc3629.html">RFC 3629</a>, November 2003.

   [<a id="ref-RFC3748" name="ref-RFC3748">RFC3748</a>]       Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J.,
                   and H. Levkowetz, "Extensible Authentication Protocol
                   (EAP)", <a href="rfc3748.html">RFC 3748</a>, June 2004.

   [<a id="ref-RFC4851" name="ref-RFC4851">RFC4851</a>]       Cam-Winget, N., McGrew, D., Salowey, J., and H. Zhou,
                   "The Flexible Authentication via Secure Tunneling
                   Extensible Authentication Protocol Method (EAP-
                   FAST)", <a href="rfc4851.html">RFC 4851</a>, May 2007.

   [<a id="ref-RFC5077" name="ref-RFC5077">RFC5077</a>]       Salowey, J., Zhou, H., Eronen, P., and H. Tschofenig,
                   "Transport Layer Security (TLS) Session Resumption
                   without Server-Side State", <a href="rfc5077.html">RFC 5077</a>, January 2008.

   [<a id="ref-RFC5246" name="ref-RFC5246">RFC5246</a>]       Dierks, T. and E. Rescorla, "The Transport Layer
                   Security (TLS) Protocol Version 1.2", <a href="rfc5246.html">RFC 5246</a>,
                   August 2008.

   [<a id="ref-RFC5421" name="ref-RFC5421">RFC5421</a>]       Cam-Winget, N. and H. Zhou, "Basic Password Exchange
                   within the Flexible Authentication via Secure
                   Tunneling Extensible Authentication Protocol (EAP-
                   FAST)", <a href="rfc5421.html">RFC 5421</a>, March 2009.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Informative%20References"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Informative References</span>

   [<a id="ref-RFC5226" name="ref-RFC5226">RFC5226</a>]       Narten, T. and H. Alvestrand, "Guidelines for Writing
                   an IANA Considerations Section in RFCs", <a href="https://tools.ietf.org/html/bcp26">BCP 26</a>,
                   <a href="rfc5226.html">RFC 5226</a>, May 2008.

















<span class="grey">Cam-Winget, et al.           Informational                     [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Examples"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Examples</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20Example%201%3A%20Successful%20Tunnel%20PAC%20Provisioning"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  Example 1: Successful Tunnel PAC Provisioning</span>

   The following exchanges show anonymous DH with a successful EAP-FAST-
   MSCHAPv2 exchange within phase 2 to provision a Tunnel PAC.  The
   conversation will appear as follows:

          Authenticating Peer     Authenticator
          -------------------     -------------
                                  &lt;- EAP-Request/Identity
          EAP-Response/
          Identity (MyID1) -&gt;
                                  &lt;- EAP-Request/EAP-FAST,
                                 (S=1, A-ID)

          EAP-Response/EAP-FAST
          (TLS Client Hello without
          PAC-Opaque in SessionTicket extension)-&gt;

                                  &lt;- EAP-Request/EAP-FAST
                                    (TLS Server Hello,
                                     TLS Server Key Exchange
                                   TLS Server Hello Done)

          EAP-Response/EAP-FAST
          (TLS Client Key Exchange
           TLS Change Cipher Spec
           TLS Finished)   -&gt;

                                  &lt;- EAP-Request/EAP-FAST
                                 ( TLS change_cipher_spec,
                                  TLS finished,
                                 EAP-Payload-TLV
                                 (EAP-Request/Identity))

         // TLS channel established
            (Subsequent messages sent within the TLS channel,
                                     encapsulated within EAP-FAST)

         // First EAP Payload TLV is piggybacked on the TLS Finished as
            Application Data and protected by the TLS tunnel









<span class="grey">Cam-Winget, et al.           Informational                     [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


          EAP Payload TLV
          (EAP-Response/Identity) -&gt;

                                 &lt;-  EAP Payload TLV
                                     (EAP-Request/EAP-FAST-MSCHAPv2
                                      (Challenge))

          EAP Payload TLV
          (EAP-Response/EAP-FAST-MSCHAPv2
           (Response)) -&gt;

                                 &lt;-  EAP Payload TLV
                                     (EAP-Request/EAP-FAST-MSCHAPv2)
                                     (Success))
          EAP Payload TLV
          (EAP-Response/EAP-FAST-MSCHAPv2
           (Success)) -&gt;
                                  &lt;- Intermediate Result TLV(Success)
                                     Crypto-Binding-TLV (Version=1,
                                     EAP-FAST Version=1, Nonce,
                                     CompoundMAC)

          Intermediate Result TLV (Success)
          Crypto-Binding-TLV (Version=1,
          EAP-FAST Version=1, Nonce,
          CompoundMAC)
          PAC-TLV (Type=1)
                                  &lt;- Result TLV (Success)
                                     PAC TLV

          Result TLV (Success)
          PAC Acknowledgment -&gt;

          TLS channel torn down
          (messages sent in cleartext)

                                  &lt;- EAP-Failure














<span class="grey">Cam-Winget, et al.           Informational                     [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20Example%202%3A%20Failed%20Provisioning"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  Example 2: Failed Provisioning</span>

   The following exchanges show a failed EAP-FAST-MSCHAPv2 exchange
   within phase 2, where the peer failed to authenticate the server.
   The conversation will appear as follows:

        Authenticating Peer     Authenticator
        -------------------     -------------
                                &lt;- EAP-Request/Identity
        EAP-Response/
        Identity (MyID1) -&gt;
                                &lt;- EAP-Request/EAP-FAST
                                   (s=1, A-ID)

        EAP-Response/EAP-FAST
        (TLS Client Hello without
        SessionTicket extension)-&gt;

                                &lt;- EAP-Request/EAP-FAST
                                (TLS Server Hello
                                TLS Server Key Exchange
                                TLS Server Hello Done)
        EAP-Response/EAP-FAST
        (TLS Client Key Exchange
         TLS Change Cipher Spec,
         TLS Finished)   -&gt;

                                                 &lt;- EAP-Request/EAP-FAST
                               ( TLS change_cipher_spec,
                                TLS finished,
                               EAP-Payload-TLV
                               (EAP-Request/Identity))

       // TLS channel established
          (Subsequent messages sent within the TLS channel,
                                   encapsulated within EAP-FAST)

       // First EAP Payload TLV is piggybacked on the TLS Finished as
          Application Data and protected by the TLS tunnel


        EAP Payload TLV
        (EAP-Response/Identity)-&gt;

                               &lt;-  EAP Payload TLV
                                  (EAP-Request/EAP-FAST-MSCHAPv2
                                    (Challenge))




<span class="grey">Cam-Winget, et al.           Informational                     [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


        EAP Payload TLV
        (EAP-Response/EAP-FAST-MSCHAPv2
         (Response)) -&gt;

                               &lt;-  EAP Payload TLV
                                   (EAP-Request EAP-FAST-MSCHAPv2
                                    (Success))

        // peer failed to verify server MSCHAPv2 response
        EAP Payload TLV
        (EAP-Response/EAP-FAST-MSCHAPv2
         (Failure)) -&gt;

                               &lt;-  Result TLV (Failure)

        Result TLV (Failure) -&gt;
        TLS channel torn down
        (messages sent in cleartext)

                                &lt;- EAP-Failure































<span class="grey">Cam-Winget, et al.           Informational                     [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.3.%20%20Example%203%3A%20Provisioning%20an%20Authentication%20Server%27s%20Trusted%20Root"></a><a class="selflink" href="#appendix-A.3" name="appendix-A.3">A.3</a>.  Example 3: Provisioning an Authentication Server's Trusted Root</span>
      Certificate

   The following exchanges show a successful provisioning of a server
   trusted root certificate using anonymous DH and EAP-FAST-MSCHAPv2
   exchange within phase 2.  The conversation will appear as follows:

      Authenticating Peer     Authenticator
      -------------------     -------------
                              &lt;- EAP-Request/
                              Identity
      EAP-Response/
      Identity (MyID1) -&gt;
                              &lt;- EAP-Requese/EAP-FAST
                              (s=1, A-ID)

      EAP-Response/EAP-FAST
      (TLS Client Hello without
      SessionTicket extension)-&gt;
                              &lt;- EAP-Request/EAP-FAST
                              (TLS Server Hello,
                              (TLS Server Key Exchange
                               TLS Server Hello Done)

      EAP-Response/EAP-FAST
      (TLS Client Key Exchange
       TLS Change Cipher Spec,
       TLS Finished)  -&gt;

                              &lt;- EAP-Request/EAP-FAST
                              (TLS Change Cipher Spec
                               TLS Finished)
                               (EAP-Payload-TLV(
                               EAP-Request/Identity))

      // TLS channel established
         (messages sent within the TLS channel)

      // First EAP Payload TLV is piggybacked on the TLS Finished as
         Application Data and protected by the TLS tunnel

      EAP-Payload TLV
      (EAP-Response/Identity) -&gt;

                              &lt;- EAP Payload TLV
                                 (EAP-Request/EAP-FAST-MSCHAPv2
                                 (Challenge))




<span class="grey">Cam-Winget, et al.           Informational                     [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


      EAP Payload TLV
      (EAP-Response/EAP-FAST-MSCHAPv2
       (Response)) -&gt;

                             &lt;-  EAP Payload TLV
                                 (EAP-Request/EAP-FAST-MSCHAPv2
                                  (success))

      EAP Payload TLV
      (EAP-Response/EAP-FAST-MSCHAPv2
       (Success) -&gt;

                              &lt;- Intermediate Result TLV(Success)
                                 Crypto-Binding TLV (Version=1,
                                 EAP-FAST Version=1, Nonce,
                                 CompoundMAC),

      Intermediate Result TLV(Success)
      Crypto-Binding TLV (Version=1
      EAP-FAST Version=1, Nonce,
      CompoundMAC)
      Server-Trusted-Root TLV
      (Type = PKCS#7) -&gt;
                              &lt;- Result TLV (Success)
                                 Server-Trusted-Root TLV
                                 (PKCS#7 TLV)

      Result TLV (Success) -&gt;

      // TLS channel torn down
         (messages sent in cleartext)

                              &lt;- EAP-Failure


















<span class="grey">Cam-Winget, et al.           Informational                     [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc5422.html">RFC 5422</a>          Dynamic Provisioning Using EAP-FAST         March 2009</span>


Authors' Addresses

   Nancy Cam-Winget
   Cisco Systems
   3625 Cisco Way
   San Jose, CA  95134
   US

   EMail: ncamwing@cisco.com


   David McGrew
   Cisco Systems
   3625 Cisco Way
   San Jose, CA  95134
   US

   EMail: mcgrew@cisco.com


   Joseph Salowey
   Cisco Systems
   2901 3rd Ave
   Seattle, WA  98121
   US

   EMail: jsalowey@cisco.com


   Hao Zhou
   Cisco Systems
   4125 Highlander Parkway
   Richfield, OH  44286
   US

   EMail: hzhou@cisco.com















Cam-Winget, et al.           Informational                     [Page 39]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc5422 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:35 GMT --></html>