<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6198 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:31 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:6198" name="DC.Identifier"/>
<meta content="The Border Gateway Protocol (BGP) is heavily used in Service Provider
networks for both Internet and BGP/MPLS VPN services. For resiliency
purposes, redundant routers and BGP sessions can be deployed to reduce
the consequences of an Autonomous System Border Router (ASBR) or BGP
session breakdown on customers' or peers' traffic. However,
simply taking down or even bringing up a BGP session for maintenance
purposes may still induce connectivity losses during the BGP
convergence. This is no longer satisfactory for new applications
(e.g., voice over IP, online gaming, VPN). Therefore, a solution is
required for the graceful shutdown of a (set of) BGP session(s) in
order to limit the amount of traffic loss during a planned shutdown.
This document expresses requirements for such a solution. This
document is not an Internet Standards Track specification; it is
published for informational purposes." name="DC.Description.Abstract"/>
<meta content="&lt;&gt;, Zubair Ahmad" name="DC.Creator"/>
<meta content="&lt;&gt;, Tomonori Takeda" name="DC.Creator"/>
<meta content="&lt;&gt;, Bruno Decraene" name="DC.Creator"/>
<meta content="&lt;&gt;, Pierre Francois" name="DC.Creator"/>
<meta content="April, 2011" name="DC.Date.Issued"/>
<meta content="Requirements for the Graceful Shutdown of BGP Sessions" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6198 - Requirements for the Graceful Shutdown of BGP Sessions</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6198.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6198" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-grow-bgp-graceful-shutdown-requirements" title="draft-ietf-grow-bgp-graceful-shutdown-requirements">draft-ietf-grow...</a>] [<a href="https://datatracker.ietf.org/doc/rfc6198" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6198" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6198" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=6198&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]   </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                       B. Decraene
Request for Comments: 6198                                France Telecom
Category: Informational                                      P. Francois
ISSN: 2070-1721                                                      UCL
                                                              C. Pelsser
                                                                     IIJ
                                                                Z. Ahmad
                                                Orange Business Services
                                                  A.J. Elizondo Armengol
                                                          Telefonica I+D
                                                               T. Takeda
                                                                     NTT
                                                              April 2011


         <span class="h1">Requirements for the Graceful Shutdown of BGP Sessions</span>

Abstract

   The Border Gateway Protocol (BGP) is heavily used in Service Provider
   networks for both Internet and BGP/MPLS VPN services.  For resiliency
   purposes, redundant routers and BGP sessions can be deployed to
   reduce the consequences of an Autonomous System Border Router (ASBR)
   or BGP session breakdown on customers' or peers' traffic.  However,
   simply taking down or even bringing up a BGP session for maintenance
   purposes may still induce connectivity losses during the BGP
   convergence.  This is no longer satisfactory for new applications
   (e.g., voice over IP, online gaming, VPN).  Therefore, a solution is
   required for the graceful shutdown of a (set of) BGP session(s) in
   order to limit the amount of traffic loss during a planned shutdown.
   This document expresses requirements for such a solution.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6198">http://www.rfc-editor.org/info/rfc6198</a>.




<span class="grey">Decraene, et al.              Informational                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-2">2</a>
   <a href="#section-2">2</a>. Conventions Used in This Document ...............................<a href="#page-3">3</a>
   <a href="#section-3">3</a>. Problem Statement ...............................................<a href="#page-4">4</a>
      <a href="#section-3.1">3.1</a>. Example of Undesirable BGP Routing Behavior ................<a href="#page-4">4</a>
      <a href="#section-3.2">3.2</a>. Causes of Packet Loss ......................................<a href="#page-5">5</a>
   <a href="#section-4">4</a>. Terminology .....................................................<a href="#page-6">6</a>
   <a href="#section-5">5</a>. Goals and Requirements ..........................................<a href="#page-7">7</a>
   <a href="#section-6">6</a>. Security Considerations ........................................<a href="#page-10">10</a>
   <a href="#section-7">7</a>. References .....................................................<a href="#page-10">10</a>
      <a href="#section-7.1">7.1</a>. Normative References ......................................<a href="#page-10">10</a>
      <a href="#section-7.2">7.2</a>. Informative References ....................................<a href="#page-10">10</a>
   Acknowledgments ...................................................<a href="#page-11">11</a>
   <a href="#appendix-A">Appendix A</a>. Reference BGP Topologies ..............................<a href="#page-12">12</a>
      <a href="#appendix-A.1">A.1</a>. EBGP Topologies ...........................................<a href="#page-12">12</a>
      <a href="#appendix-A.2">A.2</a>. IBGP Topologies ...........................................<a href="#page-15">15</a>
      <a href="#appendix-A.3">A.3</a>. Routing Decisions .........................................<a href="#page-19">19</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The Border Gateway Protocol (BGP) [<a href="rfc4271.html" title='"A Border Gateway Protocol 4 (BGP-4)"'>RFC4271</a>] is heavily used in
   Service Provider networks for both Internet and BGP/MPLS VPN services
   [<a href="rfc4364.html" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>].  For resiliency purposes, redundant routers and BGP
   sessions can be deployed to reduce the consequences of an Autonomous
   System Border Router (ASBR) or BGP session breakdown on customers' or
   peers' traffic.

   We place ourselves in the context where a Service Provider performs a
   maintenance operation and needs to shut down one or multiple BGP
   peering link(s) or a whole ASBR.  If an alternate path is available
   within the Autonomous System (AS), the requirement is to avoid or
   reduce customer or peer traffic loss during the BGP convergence.



<span class="grey">Decraene, et al.              Informational                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


   Indeed, as an alternate path is available in the AS, it should be
   made possible to reroute the customer or peer traffic on this backup
   path before the BGP session(s) is/are torn down, the nominal path
   withdrawn, and the forwarding stopped.

   The requirements also cover the subsequent re-establishment of the
   BGP session as even this "UP" case can currently trigger route loss,
   and thus traffic loss, at some routers.

   BGP [<a href="rfc4271.html" title='"A Border Gateway Protocol 4 (BGP-4)"'>RFC4271</a>] and MP-BGP [<a href="rfc4760.html" title='"Multiprotocol Extensions for BGP-4"'>RFC4760</a>] do not currently have a mechanism
   to gracefully migrate traffic from one BGP next-hop to another
   without interrupting the flow of traffic.  When a BGP session is
   taken down, BGP behaves as if there were a sudden link or router
   failure and withdraws the prefixes learned over that session, which
   may trigger traffic loss.  While still being advertised as reachable,
   there is no mechanism to advertise to its BGP peers that the prefix
   will soon be unreachable.  When applicable, such mechanism would
   reduce or prevent traffic loss.  It would typically be applicable in
   case of a maintenance operation requiring the shutdown of a
   forwarding resource.  Typical examples would be a link or line card
   maintenance, replacement, or upgrade.  It may also be applicable for
   a software upgrade, as it may involve a firmware reset on the line
   cards and hence forwarding interruption.

   The introduction of route reflectors (RRs) as per [<a href="rfc4456.html" title='"BGP Route Reflection: An Alternative to Full Mesh Internal BGP (IBGP)"'>RFC4456</a>] to solve
   scalability issues bound to Internal BGP (IBGP) full-meshes has
   worsened the duration of routing convergence as some route reflectors
   may hide the backup path.  Thus, depending on RR topology, more IBGP
   hops may be involved in the IBGP convergence.

   Note that these planned maintenance operations cannot be addressed by
   Graceful Restart (GR) extensions [<a href="rfc4724.html" title='"Graceful Restart Mechanism for BGP"'>RFC4724</a>] as GR only applies when
   the forwarding is preserved during the control plane restart.  On the
   contrary, graceful shutdown applies when the forwarding is
   interrupted.

   Also, note that some protocols are already considering such a
   graceful shutdown procedure (e.g., GMPLS in [<a href="rfc5817.html" title='"Graceful Shutdown in MPLS and Generalized MPLS Traffic Engineering Networks"'>RFC5817</a>]).

   A metric of success is the degree to which such a mechanism
   eliminates traffic loss during maintenance operations.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Conventions%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Conventions Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].




<span class="grey">Decraene, et al.              Informational                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Problem%20Statement"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Problem Statement</span>

   As per [<a href="rfc4271.html" title='"A Border Gateway Protocol 4 (BGP-4)"'>RFC4271</a>], when one (or many) BGP session(s) are shut down, a
   BGP NOTIFICATION message is sent to the peer and the session is then
   closed.  A protocol convergence is then triggered both by the local
   router and by the peer.  Alternate paths to the destination are
   selected, if known.  If those alternate paths are not known prior to
   the BGP session shutdown, additional BGP convergence steps are
   required in each AS to search for an alternate path.

   This behavior is not satisfactory in a maintenance situation because
   the traffic that was directed towards the removed next-hops may be
   lost until the end of the BGP convergence.  As it is a planned
   operation, a make-before-break solution should be made possible.

   As maintenance operations are frequent in large networks [<a href="#ref-Reliable" title='"Reliable IP Nodes: A prerequisite to profitable IP services"'>Reliable</a>],
   the global availability of the network is significantly impaired by
   this BGP maintenance issue.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Example%20of%20Undesirable%20BGP%20Routing%20Behavior"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Example of Undesirable BGP Routing Behavior</span>

   To illustrate these problems, let us consider the following simple
   example where one customer router "CUST" is dual-attached to two
   Service Providers' routers, "ASBR1" and "ASBR2".

   ASBR1 and ASBR2 are in the same AS and are owned by the same Service
   Provider.  Both are IBGP clients of the route reflector R1.

                        '
                  AS1   '      AS2
                        '

                  /-----------ASBR1---
                 /                     \
                /                       \
            CUST                         R1
                \                       /
         Z/z     \                     /
                  \-----------ASBR2---

                        '
                  AS1   '      AS2
                        '

         Figure 1. Dual-Attached Customer






<span class="grey">Decraene, et al.              Informational                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


   Before the maintenance, packets for destination Z/z use the ASBR1-
   CUST link because R1 selects ASBR1's route based on the IGP cost.

   Let's assume the Service Provider wants to shut down the ASBR1-CUST
   link for maintenance purposes.  Currently, when the shutdown is
   performed on ASBR1, the following steps are performed:

      1. ASBR1 withdraws its prefix Z/z to its route reflector, R1.

      2. R1 runs its decision process, selects the route from ASBR2, and
         advertises the new path to ASBR1.

      3. ASBR1 runs its decision process and recovers the reachability
         of Z/z.

   Traffic is lost at step 1 when ASBR1 looses its route until step 3
   when it discovers a new path.

   Note that this is a simplified description for illustrative purposes.
   In a bigger AS, multiple steps of BGP convergence may be required to
   find and select the best alternate path (e.g., ASBR1 may be chosen
   based on a higher LOCAL_PREF, hierarchical route reflectors may be
   used, etc.).  When multiple BGP routers are involved and plenty of
   prefixes are affected, the recovery process can take longer than
   application requirements.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Causes%20of%20Packet%20Loss"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Causes of Packet Loss</span>

   The loss of packets during maintenance has two main causes:

      - lack of an alternate path on some routers, and

      - transient routing inconsistency.

   Some routers may lack an alternate path because another router is
   hiding the backup path.  This router can be:

      - a route reflector only propagating its best path.

      - the backup ASBR not advertising the backup path because it
        prefers the nominal path.

   This lack of knowledge regarding the alternate path is the first
   target of this requirements document.

   Transient routing inconsistencies happen during IBGP convergence
   because routers do not simultaneously update their Routing
   Information Bases (RIBs) and hence do not simultaneously update their



<span class="grey">Decraene, et al.              Informational                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


   Forwarding Information Bases (FIBs) entries.  This can lead to
   forwarding loops, which result in both link congestion and packet
   drops.  The duration of these transient micro-loops is dependent on
   the IBGP topology (e.g., number of route reflectors between ingress
   and egress ASBR), implementation differences among router platforms
   (which result in differences in the time taken to update specific
   prefix in the FIB), and forwarding mode (hop-by-hop IP forwarding
   versus tunneling).

   Note that when an IP lookup is only performed on entry to the AS, for
   example, prior to entry into a tunnel across the AS, micro-loops will
   not occur.  An example of this is when BGP is being used as the
   routing protocol for MPLS VPN as defined in [<a href="rfc4364.html" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>].

   Note that [<a href="rfc5715.html" title='"A Framework for Loop-Free Convergence"'>RFC5715</a>] defines a framework for loop-free convergence.
   It has been written in the context of IP fast reroute for link state
   IGP [<a href="rfc5714.html" title='"IP Fast Reroute Framework"'>RFC5714</a>], but some concepts are also of interest for BGP
   convergence.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Terminology"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Terminology</span>

   g-shut: Graceful shutdown.  A method for explicitly notifying the BGP
   routers that a BGP session (and hence the prefixes learned over that
   session) is going to be disabled.

   g-noshut: Graceful no shutdown.  A method for explicitly notifying
   the BGP routers that a BGP session (and hence the prefixes learned
   over that session) is going to be enabled.

   g-shut initiator: the router on which the session(s) shutdown(s) is
   (are) performed for maintenance.

   g-shut neighbor: a router that peers with the g-shut initiator via
   (one of) the session(s) undergoing maintenance.

   affected prefixes: a prefix initially reached via the peering link(s)
   undergoing maintenance.

   affected router: a router reaching an affected prefix via a peering
   link undergoing maintenance.

   initiator AS: the autonomous system of the g-shut initiator router.

   neighbor AS(es): the autonomous system(s) of the g-shut neighbor
   router(s).






<span class="grey">Decraene, et al.              Informational                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Goals%20and%20Requirements"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Goals and Requirements</span>

   Currently, when a BGP session of the router under maintenance is shut
   down, the router removes the routes and then triggers the BGP
   convergence on its BGP peers by withdrawing its route.

   The goal of BGP graceful shutdown of a (set of) BGP session(s) is to
   minimize traffic loss during a planned shutdown.  Ideally, a solution
   should reduce this traffic loss to zero.

   Another goal is to minimize and, preferably, to eliminate packet loss
   when the BGP session is re-established following the maintenance.

   As the event is known in advance, a make-before-break solution can be
   used in order to initiate the BGP convergence, find and install the
   alternate paths before the nominal paths are removed.  As a result,
   before the nominal BGP session is shut down, all affected routers
   learn and use the alternate paths.  Those alternate paths are
   computed by BGP, taking into account the known status of the network,
   which includes known failures that the network is processing
   concurrently with the BGP session graceful shutdown and possibly
   other known graceful shutdowns under way.  Therefore, multiple BGP
   graceful shutdowns overlapping within a short time frame are
   gracefully handled.  Indeed, a given graceful shutdown takes into
   account all previous ones.

   As a result, provided an alternate path with enough remaining
   capacity is available, the packets are rerouted before the BGP
   session termination and fewer packets (possibly none) are lost during
   the BGP convergence process since, at any time, all routers have a
   valid path.

   From the above goals, we can derive the following requirements:

   a)   A mechanism to advertise the maintenance action to all affected
        routers is REQUIRED.  Such a mechanism may be either implicit or
        explicit.  Note that affected routers can be located both in the
        local AS and in neighboring ASes.  Note also that the
        maintenance action can either be the shutdown of a BGP session
        or the establishment of a BGP session.

        The mechanism SHOULD allow BGP routers to minimize and,
        preferably, eliminate packet loss when a path is removed or
        advertised.  In particular, it SHOULD be ensured that the old
        path is not removed from the routing tables of the affected
        routers before the new path is known.





<span class="grey">Decraene, et al.              Informational                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


        The solution mechanism MUST significantly reduce and, ideally,
        eliminate packet loss.  A trade-off may be made between the
        degree of packet loss and the simplicity of the solution.

   b)   An Internet-wide convergence is OPTIONAL.  However, if the
        initiator AS and the neighbor AS(es) have a backup path, they
        SHOULD be able to gracefully converge before the nominal path is
        shut down.

   c)   The proposed solution SHOULD be applicable to any kind of BGP
        sessions (External BGP (EBGP), IBGP, IBGP route reflector
        client, EBGP confederations, EBGP multi hop, MultiProtocol BGP
        extension, etc.) and any address family.  If a BGP
        implementation allows the closing or enabling of a subset of
        Address Family Identifiers (AFIs) carried in an MP-BGP session,
        this mechanism MAY be applicable to this subset of AFIs.

        Depending on the kind of session, there may be some variations
        in the proposed solution in order to fulfill the requirements.

        The following cases should be handled in priority:

        - The shutdown of an inter-AS link and therefore the shutdown of
          an EBGP session;

        - The shutdown of an ASBR and therefore the shutdown of all its
          BGP sessions.

        Service Providers and platforms implementing a graceful shutdown
        solution should note that in BGP/MPLS VPN as per [<a href="rfc4364.html" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>], the
        Provider Edge - Customer Edge (PE-CE) routing can be performed
        by protocols other than BGP (e.g., static routes, RIPv2, OSPF,
        IS-IS).  This is out of scope of this document.

   d)   The proposed solution SHOULD NOT change the BGP convergence
        behavior for the ASes exterior to the maintenance process,
        namely, ASes other than the initiator AS and its neighbor
        AS(es).

   e)   An incremental deployment on a per-AS or per-BGP session basis
        MUST be made possible.  In case of partial deployment, the
        proposed solution SHOULD incrementally improve the maintenance
        process.  It should be noted that in an inter-domain relation,
        one AS may have more incentive to use graceful shutdown than the
        other.  Similarly, in a BGP/MPLS VPN environment, it's much
        easier to upgrade the PE routers than the CE ones, mainly
        because there is at least an order of magnitude more CE and CE
        locations than PE and PE locations.  As a consequence, when



<span class="grey">Decraene, et al.              Informational                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


        splitting the cost of the solution between the g-shut initiator
        and the g-shut neighbor, the solution SHOULD favor a low-cost
        solution on the neighbor AS side in order to reduce the impact
        on the g-shut neighbor.  Impact should be understood as a
        generic term that includes first hardware, then software, then
        configuration upgrade.

   f)   Redistribution or advertisement of (static) IP routes into BGP
        SHOULD also be covered.

   g)   The proposed solution MAY be designed in order to avoid
        transient forwarding loops.  Indeed, forwarding loops increase
        packet transit-delay and may lead to link saturation.

   h)   The specific procedure SHOULD end when the BGP session is closed
        following the g-shut and once the BGP session is gracefully
        opened following the g-noshut.  In the end, once the planned
        maintenance is finished, the nominal BGP routing MUST be re-
        established.  The duration of the g-shut procedure, and hence
        the time before the BGP session is safely closed, SHOULD be
        discussed by the solution document.  Examples of possible
        solutions are the use of a pre-configured timer, the use of a
        message to signal the end of the BGP convergence, or the
        monitoring of the traffic on the g-shut interface.

   i)   The solution SHOULD be simple and simple to operate.  Hence, it
        MAY only cover a subset of the cases.  As a consequence, most of
        the above requirements are expressed as "SHOULD" rather than
        "MUST".

        The metrics to evaluate and compare the proposed solutions are:

        - The duration of the remaining loss of connectivity when the
          BGP session is brought down or up;

        - The applicability to a wide range of BGP and network
          topologies;

        - The simplicity;

        - The duration of transient forwarding loops;

        - The additional load introduced in BGP (e.g., BGP messages sent
          to peer routers, peer ASes, the Internet).







<span class="grey">Decraene, et al.              Informational                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Security Considerations</span>

   At the requirements stage, this graceful shutdown mechanism is not
   expected to affect the security of the BGP protocol, especially if it
   can be kept simple.  No new sessions are required and the additional
   ability to signal the graceful shutdown is not expected to bring
   additional attack vectors, as BGP neighbors already have the ability
   to send incorrect or misleading information or even shut down the
   session.

   Security considerations MUST be addressed by the proposed solutions.
   In particular, they SHOULD address the issues of bogus g-shut
   messages and how they would affect the network(s), as well as the
   impact of hiding a g-shut message so that g-shut is not performed.

   The solution SHOULD NOT increase the ability of one AS to selectively
   influence routing decision in the peer AS (inbound Traffic
   Engineering) outside of the case of the BGP session shutdown.
   Otherwise, the peer AS SHOULD have means to detect such behavior.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20References"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Normative%20References"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC4271" name="ref-RFC4271">RFC4271</a>]  Rekhter, Y., Ed., Li, T., Ed., and S. Hares, Ed., "A
              Border Gateway Protocol 4 (BGP-4)", <a href="rfc4271.html">RFC 4271</a>, January
              2006.

   [<a id="ref-RFC4760" name="ref-RFC4760">RFC4760</a>]  Bates, T., Chandra, R., Katz, D., and Y. Rekhter,
              "Multiprotocol Extensions for BGP-4", <a href="rfc4760.html">RFC 4760</a>, January
              2007.

   [<a id="ref-RFC4456" name="ref-RFC4456">RFC4456</a>]  Bates, T., Chen, E., and R. Chandra, "BGP Route
              Reflection: An Alternative to Full Mesh Internal BGP
              (IBGP)", <a href="rfc4456.html">RFC 4456</a>, April 2006.

   [<a id="ref-RFC4364" name="ref-RFC4364">RFC4364</a>]  Rosen, E. and Y. Rekhter, "BGP/MPLS IP Virtual Private
              Networks (VPNs)", <a href="rfc4364.html">RFC 4364</a>, February 2006.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20Informative%20References"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-RFC5817" name="ref-RFC5817">RFC5817</a>]  Ali, Z., Vasseur, JP., Zamfir, A., and J. Newton,
              "Graceful Shutdown in MPLS and Generalized MPLS Traffic
              Engineering Networks", <a href="rfc5817.html">RFC 5817</a>, April 2010.




<span class="grey">Decraene, et al.              Informational                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


   [<a id="ref-RFC5715" name="ref-RFC5715">RFC5715</a>]  Shand, M. and S. Bryant, "A Framework for Loop-Free
              Convergence", <a href="rfc5715.html">RFC 5715</a>, January 2010.

   [<a id="ref-RFC5714" name="ref-RFC5714">RFC5714</a>]  Shand, M. and S. Bryant, "IP Fast Reroute Framework", <a href="rfc5714.html">RFC</a>
              <a href="rfc5714.html">5714</a>, January 2010.

   [<a id="ref-RFC4724" name="ref-RFC4724">RFC4724</a>]  Sangli, S., Chen, E., Fernando, R., Scudder, J., and Y.
              Rekhter, "Graceful Restart Mechanism for BGP", <a href="rfc4724.html">RFC 4724</a>,
              January 2007.

   [<a id="ref-Reliable" name="ref-Reliable">Reliable</a>] Network Strategy Partners, LLC. "Reliable IP Nodes: A
              prerequisite to profitable IP services", November 2002.
              <a href="http://www.nspllc.com/NewPages/Reliable_IP_Nodes.pdf">http://www.nspllc.com/NewPages/Reliable_IP_Nodes.pdf</a>

Acknowledgments

   The authors would like to thank Nicolas Dubois, Benoit Fondeviole,
   Christian Jacquenet, Olivier Bonaventure, Steve Uhlig, Xavier Vinet,
   Vincent Gillet, Jean-Louis le Roux, Pierre Alain Coste, and Ronald
   Bonica for their useful discussions on this subject, review, and
   comments.

   This document has been partly sponsored by the European project IST
   AGAVE.



























<span class="grey">Decraene, et al.              Informational                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Reference%20BGP%20Topologies"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Reference BGP Topologies</span>

   This section describes some frequent BGP topologies used both within
   the AS (IBGP) and between ASes (EBGP).  Solutions should be
   applicable to the following topologies and their combinations.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20EBGP%20Topologies"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  EBGP Topologies</span>

   This section describes some frequent BGP topologies used between
   ASes.  In each figure, a line represents a BGP session.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.1.1.%20%20One%20ASBR%20in%20AS1%20Connected%20to%20Two%20ASBRs%20in%20the%20Neighboring%20AS2"></a><a class="selflink" href="#appendix-A.1.1" name="appendix-A.1.1">A.1.1</a>.  One ASBR in AS1 Connected to Two ASBRs in the Neighboring AS2</span>

   In this topology, we have an asymmetric protection scheme between AS1
   and AS2:

      - On the AS2 side, two different routers are used to connect to
        AS1.

      - On the AS1 side, one single router with two BGP sessions is
        used.

                    '
              AS1   '      AS2
                    '
              /----------- ASBR2.1
             /      '
            /       '
         ASBR1.1    '
            \       '
             \      '
              \----------- ASBR2.2
                    '
                    '
          AS1       '      AS2
                    '

         Figure 2. EBGP Topology with Redundant ASBR in One of the ASes

   BGP graceful shutdown is expected to be applicable for the
   maintenance of:

      - one of the routers of AS2;

      - one link between AS1 and AS2, performed either on an AS1 or AS2
        router.





<span class="grey">Decraene, et al.              Informational                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


   Note that in the case of maintenance of the whole router, all its BGP
   sessions need to be gracefully shutdown at the beginning of the
   maintenance and gracefully brought up at the end of the maintenance.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.1.2.%20%20Two%20ASBRs%20in%20AS1%20Connected%20to%20Two%20ASBRs%20in%20AS2"></a><a class="selflink" href="#appendix-A.1.2" name="appendix-A.1.2">A.1.2</a>.  Two ASBRs in AS1 Connected to Two ASBRs in AS2</span>

   In this topology, we have a symmetric protection scheme between AS1
   and AS2: on both sides, two different routers are used to connect AS1
   to AS2.

                      '
                AS1   '      AS2
                      '
         ASBR1.1----------- ASBR2.1
                      '
                      '
                      '
                      '
                      '
         ASBR1.2----------- ASBR2.2
                      '
            AS1       '      AS2
                      '

         Figure 3. EBGP Topology with Redundant ASBRs in Both ASes

   BGP graceful shutdown is expected to be applicable for the
   maintenance of:

      - any of the ASBR routers (in AS1 or AS2);

      - one link between AS1 and AS2, performed either on an AS1 or AS2
        router.


















<span class="grey">Decraene, et al.              Informational                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.1.3.%20%20Two%20ASBRs%20in%20AS2%20Each%20Connected%20to%20Two%20Different%20ASes"></a><a class="selflink" href="#appendix-A.1.3" name="appendix-A.1.3">A.1.3</a>.  Two ASBRs in AS2 Each Connected to Two Different ASes</span>

   In this topology, at least three ASes are involved.

                        '
                  AS1   '      AS2
                        '
           ASBR1.1----------- ASBR2.1
              |         '
              |         '
         '''''|''''''''''
              |         '
              |         '
           ASBR3.1----------- ASBR2.2
                        '
              AS3       '      AS2

         Figure 4. EBGP Topology of a Dual-Homed Customer

   As the requirement expressed in <a href="#section-5">Section 5</a> is to advertise the
   maintenance only within the initiator and neighbor ASes, not
   Internet-wide, BGP graceful shutdown solutions may not be applicable
   to this topology.  Depending on which routes are exchanged between
   these ASes, some protection for some of the traffic may be possible.

   For instance, if ASBR2.2 performs a maintenance affecting ASBR3.1,
   then ASBR3.1 will be notified.  However, ASBR1.1 may not be notified
   of the maintenance of the EBGP session between ASBR3.1 and ASBR2.2.























<span class="grey">Decraene, et al.              Informational                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20IBGP%20Topologies"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  IBGP Topologies</span>

   This section describes some frequent BGP topologies used within an
   AS.  In each figure, a line represents a BGP session.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.2.1.%20%20IBGP%20Full-Mesh"></a><a class="selflink" href="#appendix-A.2.1" name="appendix-A.2.1">A.2.1</a>.  IBGP Full-Mesh</span>

   In this topology, we have a full-mesh of IBGP sessions:

            P1 ----- P2
            | \    / |
            |  \  /  |
            |   \/   |     AS1
            |   /\   |
            |  /  \  |
            | /    \ |
          ASBR1.1--ASBR1.2
             \       /
              \     /
         ''''''\'''/''''''''''''
                \ /      AS2
               ASBR2.1

         Figure 5. IBGP Full-Mesh

   When the session between ASBR1.1 and ASBR2.1 is gracefully shut down,
   it is required that all affected routers of AS1 reroute traffic to
   ASBR1.2 before the session between ASBR1.1 and ASBR2.1 is shut down.

   Similarly, when the session between ASBR1.1 and ASBR2.1 is gracefully
   brought up, all affected routers of AS1 preferring ASBR1.1 over
   ASBR1.2 need to reroute traffic to ASBR1.1 before the less preferred
   path through ASBR1.2 is possibly withdrawn.


















<span class="grey">Decraene, et al.              Informational                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.2.2.%20%20Route%20Reflector"></a><a class="selflink" href="#appendix-A.2.2" name="appendix-A.2.2">A.2.2</a>.  Route Reflector</span>

   In this topology, route reflectors are used to limit the number of
   IBGP sessions.  There is a single level of route reflectors and the
   route reflectors are fully meshed.

            P1 (RR)-- P2 (RR)
            | \      / |
            |  \    /  |
            |   \  /   |     AS1
            |    \/    |
            |    /\    |
            |   /  \   |
            |  /    \  |
            | /      \ |
          ASBR1.1    ASBR1.2
             \          /
              \        /
         ''''''\''''''/''''''''''''
                \    /
                 \  /         AS2
                ASBR2.1

         Figure 6. Route Reflector

   When the session between ASBR1.1 and ASBR2.1 is gracefully shut down,
   all BGP routers of AS1 need to reroute traffic to ASBR1.2 before the
   session between ASBR1.1 and ASBR2.1 is shut down.

   Similarly, when the session between ASBR1.1 and ASBR2.1 is gracefully
   brought up, all affected routers of AS1 preferring ASBR1.1 over
   ASBR1.2 need to reroute traffic to ASBR1.1 before the less preferred
   path through ASBR1.2 is possibly withdrawn.


















<span class="grey">Decraene, et al.              Informational                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.2.3.%20%20Hierarchical%20Route%20Reflector"></a><a class="selflink" href="#appendix-A.2.3" name="appendix-A.2.3">A.2.3</a>.  Hierarchical Route Reflector</span>

   In this topology, hierarchical route reflectors are used to limit the
   number of IBGP sessions.  There could be more than two levels of
   route reflectors and the top-level route reflectors are fully meshed.


         P1 (RR) --------  P2 (RR)
            |               |
            |               |
            |               |   AS1
            |               |
            |               |

          P3 (RR)          P4 (RR)
            |               |
            |               |
            |               |   AS1
            |               |
            |               |
          ASBR1.1         ASBR1.2
             \             /
              \           /
         ''''''\'''''''''/''''''''''''
                \       /
                 \     /        AS2
                 ASBR2.1

         Figure 7. Hierarchical Route Reflector

   When the session between ASBR1.1 and ASBR2.1 is gracefully shut down,
   all BGP routers of AS1 need to reroute traffic to ASBR1.2 before the
   session between ASBR1.1 and ASBR2.1 is shut down.

   Similarly, when the session between ASBR1.1 and ASBR2.1 is gracefully
   brought up, all affected routers of AS1 preferring ASBR1.1 over
   ASBR1.2 need to reroute traffic to ASBR1.1 before the less preferred
   path through ASBR1.2 is possibly withdrawn.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.2.4.%20%20Confederations"></a><a class="selflink" href="#appendix-A.2.4" name="appendix-A.2.4">A.2.4</a>.  Confederations</span>

   In this topology, a confederation of ASes is used to limit the number
   of IBGP sessions.  Moreover, RRs may be present in the member ASes of
   the confederation.







<span class="grey">Decraene, et al.              Informational                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


   Confederations may be run with different sub-options.  Regarding the
   IGP, each member AS can run its own IGP or they can all share the
   same IGP.  Regarding BGP, LOCAL_PREF may or may not cross the member
   AS boundaries.

   A solution should support the graceful shutdown and graceful bringing
   up of EBGP sessions between member ASes in the confederation in
   addition to the graceful shutdown and graceful bringing up of EBGP
   sessions between a member-AS and an AS outside of the confederation.

         ASBR1C.1 ---------- ASBR1C.2
            |                   |
            |                   |
            |       AS1C        |
            |                   |
            |                   |
         """|"""""""""""""""""""|"""
            |        "          |
          ASBR1A.2   "        ASBR1B.2
            |        "          |
            |        "          |
            |  AS1A  "   AS1B   |             AS1
            |        "          |
            |        "          |
          ASBR1A.1   "         ASBR1B.1
             \       "         /
              \      "        /
         ''''''\'''''''''''''/''''''''''''
                \           /
                 \         /                   AS2
                   ASBR2.1

         Figure 8. Confederation

   In the above figure, member ASes AS1A, AS1B, and AS1C belong to a
   confederation of ASes in AS1.  AS1A and AS1B are connected to AS2.

   In normal operation, for the traffic toward AS2:

      - AS1A sends the traffic directly to AS2 through ASBR1A.1.

      - AS1B sends the traffic directly to AS2 through ASBR1B.1.

      - AS1C load balances the traffic between AS1A and AS1B.

   When the session between ASBR1A.1 and ASBR2.1 is gracefully shut
   down, all BGP routers of AS1 need to reroute traffic to ASBR1B.1
   before the session between ASBR1A.1 and ASBR2.1 is shut down.



<span class="grey">Decraene, et al.              Informational                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


   Similarly, when the session between ASBR1A.1 and ASBR2.1 is
   gracefully brought up, all affected routers of AS1 preferring
   ASBR1A.1 over ASBR1B.1 need to reroute traffic to ASBR1A.1 before the
   less preferred path through ASBR1B.1 is possibly withdrawn.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.3.%20%20Routing%20Decisions"></a><a class="selflink" href="#appendix-A.3" name="appendix-A.3">A.3</a>.  Routing Decisions</span>

   Here we describe some routing engineering choices that are frequently
   used in ASes and that should be supported by the solution.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.3.1.%20%20Hot%20Potato%20%28IGP%20Cost%29"></a><a class="selflink" href="#appendix-A.3.1" name="appendix-A.3.1">A.3.1</a>.  Hot Potato (IGP Cost)</span>

   The ingress router selects the nominal egress ASBR (AS exit point)
   based on the IGP cost to reach the BGP next-hop.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.3.2.%20%20Cold%20Potato%20%28BGP%20LOCAL_PREF%29"></a><a class="selflink" href="#appendix-A.3.2" name="appendix-A.3.2">A.3.2</a>.  Cold Potato (BGP LOCAL_PREF)</span>

   The ingress router selects the nominal egress ASBR based on the BGP
   LOCAL_PREF value set and advertised by the exit point.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.3.3.%20%20Cold%20Potato%20%28BGP%20Preference%20Set%20on%20Ingress%29"></a><a class="selflink" href="#appendix-A.3.3" name="appendix-A.3.3">A.3.3</a>.  Cold Potato (BGP Preference Set on Ingress)</span>

   The ingress router selects the nominal egress ASBR based on
   preconfigured policy information.  (Typically, this is done by
   locally setting the BGP LOCAL_PREF based on the BGP communities
   attached on the routes).

   As per [<a href="rfc4271.html" title='"A Border Gateway Protocol 4 (BGP-4)"'>RFC4271</a>], note that if tunnels are not used to forward
   packets between the ingress and egress ASBR; this can lead to
   persistent forwarding loops.





















<span class="grey">Decraene, et al.              Informational                    [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6198.html">RFC 6198</a>             Reqs for Graceful BGP Shutdown           April 2011</span>


Authors' Addresses

   Bruno Decraene
   France Telecom
   38-40 rue du General Leclerc
   92794 Issy Moulineaux cedex 9
   France
   EMail: bruno.decraene@orange-ftgroup.com

   Pierre Francois
   Universite catholique de Louvain
   Place Ste Barbe, 2
   Louvain-la-Neuve  1348
   BE
   EMail: francois@info.ucl.ac.be

   Cristel Pelsser
   Internet Initiative Japan
   Jinbocho Mitsui Building
   1-105 Kanda jinbo-cho
   Chiyoda-ku, Tokyo 101-0051
   Japan
   EMail: cristel@iij.ad.jp

   Zubair Ahmad
   Orange Business Services
   13775 McLearen Road, Oak Hill VA 20171
   USA
   EMail: zubair.ahmad@orange-ftgroup.com

   Antonio Jose Elizondo Armengol
   Division de Analisis Tecnologicos
   Technology Analysis Division
   Telefonica I+D
   C/ Emilio Vargas 6
   28043, Madrid
   EMail: ajea@tid.es

   Tomonori Takeda
   NTT Corporation
   9-11, Midori-Cho 3 Chrome
   Musashino-Shi, Tokyo 180-8585
   Japan
   EMail: takeda.tomonori@lab.ntt.co.jp







Decraene, et al.              Informational                    [Page 20]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc6198 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:31 GMT --></html>