<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc2633 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 28 Apr 2015 16:02:32 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.111" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-ramsdell-smime-msg" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:2633" name="DC.Identifier"/>
<meta content="June, 1999" name="DC.Date.Issued"/>
<meta content="B. Ramsdell" name="DC.Creator"/>
<meta content="This document describes a protocol for adding cryptographic signature
and encryption services to MIME data. [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="S/MIME Version 3 Message Specification" name="DC.Title"/>

    <link href="http://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="http://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 2633 - S/MIME Version 3 Message Specification</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgbrown" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="http://tools.ietf.org/rfc/rfc2633.txt" title="Plaintext version of this document">txt</a>|<a href="http://tools.ietf.org/pdf/rfc2633" title="PDF version of this document">pdf</a>] [<a href="http://tools.ietf.org/html/draft-ietf-smime-msg" title="draft-ietf-smime-msg">draft-ietf-smime-msg</a>] [<a href="http://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc2633" title="Inline diff (wdiff)">Diff1</a>] [<a href="http://tools.ietf.org/rfcdiff?url2=rfc2633" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?option=rfc_search&amp;rfc_search=2633" title="IPR disclosures related to this document">IPR</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=2633">Errata</a>]  </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">Obsoleted by: <a href="rfc3851.html">3851</a>                                     PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                               B. Ramsdell, Editor
Request for Comments: 2633                                    Worldtalk
Category: Standards Track                                     June 1999


                 <span class="h1">S/MIME Version 3 Message Specification</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (1999).  All Rights Reserved.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>. Introduction</span>

   S/MIME (Secure/Multipurpose Internet Mail Extensions) provides a
   consistent way to send and receive secure MIME data. Based on the
   popular Internet MIME standard, S/MIME provides the following
   cryptographic security services for electronic messaging
   applications:  authentication, message integrity and non-repudiation
   of origin (using digital signatures) and privacy and data security
   (using encryption).

   S/MIME can be used by traditional mail user agents (MUAs) to add
   cryptographic security services to mail that is sent, and to
   interpret cryptographic security services in mail that is received.
   However, S/MIME is not restricted to mail; it can be used with any
   transport mechanism that transports MIME data, such as HTTP. As such,
   S/MIME takes advantage of the object-based features of MIME and
   allows secure messages to be exchanged in mixed-transport systems.

   Further, S/MIME can be used in automated message transfer agents that
   use cryptographic security services that do not require any human
   intervention, such as the signing of software-generated documents and
   the encryption of FAX messages sent over the Internet.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1%20Specification%20Overview"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a> Specification Overview</span>

   This document describes a protocol for adding cryptographic signature
   and encryption services to MIME data. The MIME standard [<a href="#ref-MIME-SPEC" title='"MIME Part 1: Format of Internet Message Bodies"'>MIME-SPEC</a>]
   provides a general structure for the content type of Internet
   messages and allows extensions for new content type applications.



<span class="grey">Ramsdell                    Standards Track                     [Page 1]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   This memo defines how to create a MIME body part that has been
   cryptographically enhanced according to CMS [<a href="#ref-CMS" title='"Cryptographic Message Syntax"'>CMS</a>], which is derived
   from PKCS #7 [<a href="#ref-PKCS-7" title='"PKCS #7: Cryptographic Message Syntax Version 1.5"'>PKCS-7</a>]. This memo also defines the application/pkcs7-
   mime MIME type that can be used to transport those body parts.

   This memo also discusses how to use the multipart/signed MIME type
   defined in [<a href="#ref-MIME-SECURE" title='"Security Multiparts for MIME: Multipart/Signed and Multipart/Encrypted"'>MIME-SECURE</a>] to transport S/MIME signed messages. This
   memo also defines the application/pkcs7-signature MIME type, which is
   also used to transport S/MIME signed messages.

   In order to create S/MIME messages, an S/MIME agent has to follow
   specifications in this memo, as well as the specifications listed in
   the Cryptographic Message Syntax [<a href="#ref-CMS" title='"Cryptographic Message Syntax"'>CMS</a>].

   Throughout this memo, there are requirements and recommendations made
   for how receiving agents handle incoming messages. There are separate
   requirements and recommendations for how sending agents create
   outgoing messages. In general, the best strategy is to "be liberal in
   what you receive and conservative in what you send". Most of the
   requirements are placed on the handling of incoming messages while
   the recommendations are mostly on the creation of outgoing messages.

   The separation for requirements on receiving agents and sending
   agents also derives from the likelihood that there will be S/MIME
   systems that involve software other than traditional Internet mail
   clients.  S/MIME can be used with any system that transports MIME
   data. An automated process that sends an encrypted message might not
   be able to receive an encrypted message at all, for example. Thus,
   the requirements and recommendations for the two types of agents are
   listed separately when appropriate.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2%20Terminology"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a> Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="#ref-MUSTSHOULD" title='"Key words for use in RFCs to Indicate Requirement Levels"'>MUSTSHOULD</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.3%20Definitions"></a><a class="selflink" href="#section-1.3" name="section-1.3">1.3</a> Definitions</span>

   For the purposes of this memo, the following definitions apply.

   ASN.1: Abstract Syntax Notation One, as defined in CCITT X.208.

   BER: Basic Encoding Rules for ASN.1, as defined in CCITT X.209.

   Certificate: A type that binds an entity's distinguished name to a
   public key with a digital signature.




<span class="grey">Ramsdell                    Standards Track                     [Page 2]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   DER: Distinguished Encoding Rules for ASN.1, as defined in CCITT
   X.509.

   7-bit data: Text data with lines less than 998 characters long, where
   none of the characters have the 8th bit set, and there are no NULL
   characters. &lt;CR&gt; and &lt;LF&gt; occur only as part of a &lt;CR&gt;&lt;LF&gt; end of
   line delimiter.

   8-bit data: Text data with lines less than 998 characters, and where
   none of the characters are NULL characters. &lt;CR&gt; and &lt;LF&gt; occur only
   as part of a &lt;CR&gt;&lt;LF&gt; end of line delimiter.

   Binary data: Arbitrary data.

   Transfer Encoding: A reversible transformation made on data so 8-bit
   or binary data may be sent via a channel that only transmits 7-bit
   data.

   Receiving agent: software that interprets and processes S/MIME CMS
   objects, MIME body parts that contain CMS objects, or both.

   Sending agent: software that creates S/MIME CMS objects, MIME body
   parts that contain CMS objects, or both.

   S/MIME agent: user software that is a receiving agent, a sending
   agent, or both.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.4%20Compatibility%20with%20Prior%20Practice%20of%20S%2FMIME"></a><a class="selflink" href="#section-1.4" name="section-1.4">1.4</a> Compatibility with Prior Practice of S/MIME</span>

   S/MIME version 3 agents should attempt to have the greatest
   interoperability possible with S/MIME version 2 agents. S/MIME
   version 2 is described in <a href="rfc2311.html">RFC 2311</a> through <a href="rfc2315.html">RFC 2315</a>, inclusive. <a href="rfc2311.html">RFC</a>
   <a href="rfc2311.html">2311</a> also has historical information about the development of S/MIME.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20CMS%20Options"></a><a class="selflink" href="#section-2" name="section-2">2</a>. CMS Options</span>

   CMS allows for a wide variety of options in content and algorithm
   support. This section puts forth a number of support requirements and
   recommendations in order to achieve a base level of interoperability
   among all S/MIME implementations. [<a href="#ref-CMS" title='"Cryptographic Message Syntax"'>CMS</a>] provides additional details
   regarding the use of the cryptographic algorithms.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1%20DigestAlgorithmIdentifier"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a> DigestAlgorithmIdentifier</span>

   Sending and receiving agents MUST support SHA-1 [<a href="#ref-SHA1" title='"Secure Hash Standard,"'>SHA1</a>].  Receiving
   agents SHOULD support MD5 [<a href="#ref-MD5" title='"The MD5 Message Digest Algorithm"'>MD5</a>] for the purpose of providing backward
   compatibility with MD5-digested S/MIME v2 SignedData objects.




<span class="grey">Ramsdell                    Standards Track                     [Page 3]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2%20SignatureAlgorithmIdentifier"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a> SignatureAlgorithmIdentifier</span>

   Sending and receiving agents MUST support id-dsa defined in [<a href="#ref-DSS" title='"Digital Signature Standard"'>DSS</a>].
   The algorithm parameters MUST be absent (not encoded as NULL).

   Receiving agents SHOULD support rsaEncryption, defined in [<a href="#ref-PKCS-1" title='"PKCS #1: RSA Encryption Version 2.0"'>PKCS-1</a>].

   Sending agents SHOULD support rsaEncryption. Outgoing messages are
   signed with a user's private key. The size of the private key is
   determined during key generation.

   Note that S/MIME v2 clients are only capable of verifying digital
   signatures using the rsaEncryption algorithm.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3%20KeyEncryptionAlgorithmIdentifier"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a> KeyEncryptionAlgorithmIdentifier</span>

   Sending and receiving agents MUST support Diffie-Hellman defined in
   [<a href="#ref-DH" title='"Diffie-Hellman Key Agreement Method"'>DH</a>].

   Receiving agents SHOULD support rsaEncryption. Incoming encrypted
   messages contain symmetric keys which are to be decrypted with a
   user's private key. The size of the private key is determined during
   key generation.

   Sending agents SHOULD support rsaEncryption.

   Note that S/MIME v2 clients are only capable of decrypting content
   encryption keys using the rsaEncryption algorithm.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.4%20General%20Syntax"></a><a class="selflink" href="#section-2.4" name="section-2.4">2.4</a> General Syntax</span>

   CMS defines multiple content types.  Of these, only the Data,
   SignedData, and EnvelopedData content types are currently used for
   S/MIME.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.4.1%20Data%20Content%20Type"></a><a class="selflink" href="#section-2.4.1" name="section-2.4.1">2.4.1</a> Data Content Type</span>

   Sending agents MUST use the id-data content type identifier to
   indicate the message content which has had security services applied
   to it. For example, when applying a digital signature to MIME data,
   the CMS signedData encapContentInfo eContentType MUST include the
   id-data object identifier and the MIME content MUST be stored in the
   SignedData encapContentInfo eContent OCTET STRING (unless the sending
   agent is using multipart/signed, in which case the eContent is
   absent, per <a href="#section-3.4.3">section 3.4.3</a> of this document).  As another example,
   when applying encryption to MIME data, the CMS EnvelopedData





<span class="grey">Ramsdell                    Standards Track                     [Page 4]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   encryptedContentInfo ContentType MUST include the id-data object
   identifier and the encrypted MIME content MUST be stored in the
   envelopedData encryptedContentInfo encryptedContent OCTET STRING.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.4.2%20SignedData%20Content%20Type"></a><a class="selflink" href="#section-2.4.2" name="section-2.4.2">2.4.2</a> SignedData Content Type</span>

   Sending agents MUST use the signedData content type to apply a
   digital signature to a message or, in a degenerate case where there
   is no signature information, to convey certificates.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.4.3%20EnvelopedData%20Content%20Type"></a><a class="selflink" href="#section-2.4.3" name="section-2.4.3">2.4.3</a> EnvelopedData Content Type</span>

   This content type is used to apply privacy protection to a message. A
   sender needs to have access to a public key for each intended message
   recipient to use this service. This content type does not provide
   authentication.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.5%20Attribute%20SignerInfo%20Type"></a><a class="selflink" href="#section-2.5" name="section-2.5">2.5</a> Attribute SignerInfo Type</span>

   The SignerInfo type allows the inclusion of unsigned and signed
   attributes to be included along with a signature.

   Receiving agents MUST be able to handle zero or one instance of each
   of the signed attributes listed here. Sending agents SHOULD generate
   one instance of each of the following signed attributes in each
   S/MIME message:

   - signingTime (<a href="#section-2.5.1">section 2.5.1</a> in this document)
   - sMIMECapabilities (<a href="#section-2.5.2">section 2.5.2</a> in this document)
   - sMIMEEncryptionKeyPreference (<a href="#section-2.5.3">section 2.5.3</a> in this document)

   Further, receiving agents SHOULD be able to handle zero or one
   instance in the signed attributes of the signingCertificate attribute
   (section 5 in [<a href="#ref-ESS" title='"Enhanced Security Services for S/MIME"'>ESS</a>]).

   Sending agents SHOULD generate one instance of the signingCertificate
   signed attribute in each S/MIME message.

   Additional attributes and values for these attributes may be defined
   in the future. Receiving agents SHOULD handle attributes or values
   that it does not recognize in a graceful manner.

   Sending agents that include signed attributes that are not listed
   here SHOULD display those attributes to the user, so that the user is
   aware of all of the data being signed.






<span class="grey">Ramsdell                    Standards Track                     [Page 5]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.5.1%20Signing-Time%20Attribute"></a><a class="selflink" href="#section-2.5.1" name="section-2.5.1">2.5.1</a> Signing-Time Attribute</span>

   The signing-time attribute is used to convey the time that a message
   was signed. Until there are trusted timestamping services, the time
   of signing will most likely be created by a message originator and
   therefore is only as trustworthy as the originator.

   Sending agents MUST encode signing time through the year 2049 as
   UTCTime; signing times in 2050 or later MUST be encoded as
   GeneralizedTime. When the UTCTime CHOICE is used, S/MIME agents MUST
   interpret the year field (YY) as follows:

   if YY is greater than or equal to 50, the year is interpreted as
   19YY; if YY is less than 50, the year is interpreted as 20YY.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.5.2%20SMIMECapabilities%20Attribute"></a><a class="selflink" href="#section-2.5.2" name="section-2.5.2">2.5.2</a> SMIMECapabilities Attribute</span>

   The SMIMECapabilities attribute includes signature algorithms (such
   as "sha1WithRSAEncryption"), symmetric algorithms (such as "DES-
   EDE3-CBC"), and key encipherment algorithms (such as
   "rsaEncryption"). It also includes a non-algorithm capability which
   is the preference for signedData. The SMIMECapabilities were designed
   to be flexible and extensible so that, in the future, a means of
   identifying other capabilities and preferences such as certificates
   can be added in a way that will not cause current clients to break.

   If present, the SMIMECapabilities attribute MUST be a
   SignedAttribute; it MUST NOT be an UnsignedAttribute. CMS defines
   SignedAttributes as a SET OF Attribute. The SignedAttributes in a
   signerInfo MUST NOT include multiple instances of the
   SMIMECapabilities attribute. CMS defines the ASN.1 syntax for
   Attribute to include attrValues SET OF AttributeValue. A
   SMIMECapabilities attribute MUST only include a single instance of
   AttributeValue.  There MUST NOT be zero or multiple instances of
   AttributeValue present in the attrValues SET OF AttributeValue.

   The semantics of the SMIMECapabilites attribute specify a partial
   list as to what the client announcing the SMIMECapabilites can
   support. A client does not have to list every capability it supports,
   and probably should not list all its capabilities so that the
   capabilities list doesn't get too long. In an SMIMECapabilities
   attribute, the OIDs are listed in order of their preference, but
   SHOULD be logically separated along the lines of their categories
   (signature algorithms, symmetric algorithms, key encipherment
   algorithms, etc.)






<span class="grey">Ramsdell                    Standards Track                     [Page 6]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   The structure of the SMIMECapabilities attribute is to facilitate
   simple table lookups and binary comparisons in order to determine
   matches. For instance, the DER-encoding for the SMIMECapability for
   DES EDE3 CBC MUST be identically encoded regardless of the
   implementation.

   In the case of symmetric algorithms, the associated parameters for
   the OID MUST specify all of the parameters necessary to differentiate
   between two instances of the same algorithm. For instance, the number
   of rounds and block size for RC5 must be specified in addition to the
   key length.

   There is a list of OIDs (OIDs Used with S/MIME) that is centrally
   maintained and is separate from this memo. The list of OIDs is
   maintained by the Internet Mail Consortium at
   &lt;<a href="http://www.imc.org/ietf-smime/oids.html">http://www.imc.org/ietf-smime/oids.html</a>&gt;. Note that all OIDs
   associated with the MUST and SHOULD implement algorithms are included
   in section A of this document.

   The OIDs that correspond to algorithms SHOULD use the same OID as the
   actual algorithm, except in the case where the algorithm usage is
   ambiguous from the OID. For instance, in an earlier draft,
   rsaEncryption was ambiguous because it could refer to either a
   signature algorithm or a key encipherment algorithm. In the event
   that an OID is ambiguous, it needs to be arbitrated by the maintainer
   of the registered SMIMECapabilities list as to which type of
   algorithm will use the OID, and a new OID MUST be allocated under the
   smimeCapabilities OID to satisfy the other use of the OID.

   The registered SMIMECapabilities list specifies the parameters for
   OIDs that need them, most notably key lengths in the case of
   variable-length symmetric ciphers. In the event that there are no
   differentiating parameters for a particular OID, the parameters MUST
   be omitted, and MUST NOT be encoded as NULL.

   Additional values for the SMIMECapabilities attribute may be defined
   in the future. Receiving agents MUST handle a SMIMECapabilities
   object that has values that it does not recognize in a graceful
   manner.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.5.3%20Encryption%20Key%20Preference%20Attribute"></a><a class="selflink" href="#section-2.5.3" name="section-2.5.3">2.5.3</a> Encryption Key Preference Attribute</span>

   The encryption key preference attribute allows the signer to
   unambiguously describe which of the signer's certificates has the
   signer's preferred encryption key. This attribute is designed to
   enhance behavior for interoperating with those clients which use
   separate keys for encryption and signing. This attribute is used to




<span class="grey">Ramsdell                    Standards Track                     [Page 7]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   convey to anyone viewing the attribute which of the listed
   certificates should be used for encrypting a session key for future
   encrypted messages.

   If present, the SMIMEEncryptionKeyPreference attribute MUST be a
   SignedAttribute; it MUST NOT be an UnsignedAttribute. CMS defines
   SignedAttributes as a SET OF Attribute. The SignedAttributes in a
   signerInfo MUST NOT include multiple instances of the
   SMIMEEncryptionKeyPreference attribute.  CMS defines the ASN.1 syntax
   for Attribute to include attrValues SET OF AttributeValue. A
   SMIMEEncryptionKeyPreference attribute MUST only include a single
   instance of AttributeValue.  There MUST NOT be zero or multiple
   instances of AttributeValue present in the attrValues SET OF
   AttributeValue.

   The sending agent SHOULD include the referenced certificate in the
   set of certificates included in the signed message if this attribute
   is used.  The certificate may be omitted if it has been previously
   made available to the receiving agent.  Sending agents SHOULD use
   this attribute if the commonly used or preferred encryption
   certificate is not the same as the certificate used to sign the
   message.

   Receiving agents SHOULD store the preference data if the signature on
   the message is valid and the signing time is greater than the
   currently stored value.  (As with the SMIMECapabilities, the clock
   skew should be checked and the data not used if the skew is too
   great.)  Receiving agents SHOULD respect the sender's encryption key
   preference attribute if possible.  This however represents only a
   preference and the receiving agent may use any certificate in
   replying to the sender that is valid.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.5.3.1%20Selection%20of%20Recipient%20Key%20Management%20Certificate"></a><a class="selflink" href="#section-2.5.3.1" name="section-2.5.3.1">2.5.3.1</a> Selection of Recipient Key Management Certificate</span>

   In order to determine the key management certificate to be used when
   sending a future CMS envelopedData message for a particular
   recipient, the following steps SHOULD be followed:

    - If an SMIMEEncryptionKeyPreference attribute is found in a
   signedData object received from the desired recipient, this
   identifies the X.509 certificate that should be used as the X.509
   key management certificate for the recipient.

   - If an SMIMEEncryptionKeyPreference attribute is not found in a
   signedData object received from the desired recipient, the set of
   X.509 certificates should be searched for a X.509 certificate with
   the same subject name as the signing X.509 certificate which can
   be used for key management.



<span class="grey">Ramsdell                    Standards Track                     [Page 8]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   - Or use some other method of determining the user's key management
   key. If a X.509 key management certificate is not found, then
   encryption cannot be done with the signer of the message. If multiple
   X.509 key management certificates are found, the S/MIME agent can
   make an arbitrary choice between them.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.6%20SignerIdentifier%20SignerInfo%20Type"></a><a class="selflink" href="#section-2.6" name="section-2.6">2.6</a> SignerIdentifier SignerInfo Type</span>

   S/MIME v3 requires the use of SignerInfo version 1, that is the
   issuerAndSerialNumber CHOICE MUST be used for SignerIdentifier.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.7%20ContentEncryptionAlgorithmIdentifier"></a><a class="selflink" href="#section-2.7" name="section-2.7">2.7</a> ContentEncryptionAlgorithmIdentifier</span>

   Sending and receiving agents MUST support encryption and decryption
   with DES EDE3 CBC, hereinafter called "tripleDES" [<a href="#ref-3DES" title='"Triple Data Encryption Algorithm Modes of Operation"'>3DES</a>] [<a href="#ref-DES" title='"American National Standard for Information Systems- Data Link Encryption,"'>DES</a>].
   Receiving agents SHOULD support encryption and decryption using the
   RC2 [<a href="#ref-RC2" title='"A Description of the RC2 (r) Encryption Algorithm"'>RC2</a>] or a compatible algorithm at a key size of 40 bits,
   hereinafter called "RC2/40".

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.7.1%20Deciding%20Which%20Encryption%20Method%20To%20Use"></a><a class="selflink" href="#section-2.7.1" name="section-2.7.1">2.7.1</a> Deciding Which Encryption Method To Use</span>

   When a sending agent creates an encrypted message, it has to decide
   which type of encryption to use. The decision process involves using
   information garnered from the capabilities lists included in messages
   received from the recipient, as well as out-of-band information such
   as private agreements, user preferences, legal restrictions, and so
   on.

   <a href="#section-2.5">Section 2.5</a> defines a method by which a sending agent can optionally
   announce, among other things, its decrypting capabilities in its
   order of preference. The following method for processing and
   remembering the encryption capabilities attribute in incoming signed
   messages SHOULD be used.

   -  If the receiving agent has not yet created a list of capabilities
      for the sender's public key, then, after verifying the signature
      on the incoming message and checking the timestamp, the receiving
      agent SHOULD create a new list containing at least the signing
      time and the symmetric capabilities.

    - If such a list already exists, the receiving agent SHOULD verify
      that the signing time in the incoming message is greater than
      the signing time stored in the list and that the signature is
      valid. If so, the receiving agent SHOULD update both the signing
      time and capabilities in the list. Values of the signing time that
      lie far in the future (that is, a greater discrepancy than any
      reasonable clock skew), or a capabilities list in messages whose
      signature could not be verified, MUST NOT be accepted.



<span class="grey">Ramsdell                    Standards Track                     [Page 9]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   The list of capabilities SHOULD be stored for future use in creating
   messages.

   Before sending a message, the sending agent MUST decide whether it is
   willing to use weak encryption for the particular data in the
   message.  If the sending agent decides that weak encryption is
   unacceptable for this data, then the sending agent MUST NOT use a
   weak algorithm such as RC2/40.  The decision to use or not use weak
   encryption overrides any other decision in this section about which
   encryption algorithm to use.

   Sections <a href="#section-2.7.2.1">2.7.2.1</a> through <a href="#section-2.7.2.4">2.7.2.4</a> describe the decisions a sending
   agent SHOULD use in deciding which type of encryption should be
   applied to a message.  These rules are ordered, so the sending agent
   SHOULD make its decision in the order given.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.7.1.1%20Rule%201%3A%20Known%20Capabilities"></a><a class="selflink" href="#section-2.7.1.1" name="section-2.7.1.1">2.7.1.1</a> Rule 1: Known Capabilities</span>

   If the sending agent has received a set of capabilities from the
   recipient for the message the agent is about to encrypt, then the
   sending agent SHOULD use that information by selecting the first
   capability in the list (that is, the capability most preferred by the
   intended recipient) for which the sending agent knows how to encrypt.
   The sending agent SHOULD use one of the capabilities in the list if
   the agent reasonably expects the recipient to be able to decrypt the
   message.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.7.1.2%20Rule%202%3A%20Unknown%20Capabilities%2C%20Known%20Use%20of%20Encryption"></a><a class="selflink" href="#section-2.7.1.2" name="section-2.7.1.2">2.7.1.2</a> Rule 2: Unknown Capabilities, Known Use of Encryption</span>

   If:
    - the sending agent has no knowledge of the encryption capabilities
      of the recipient,
    - and the sending agent has received at least one message from the
      recipient,
    - and the last encrypted message received from the recipient had a
      trusted signature on it,

   then the outgoing message SHOULD use the same encryption algorithm as
   was used on the last signed and encrypted message received from the
   recipient.











<span class="grey">Ramsdell                    Standards Track                    [Page 10]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.7.1.3%20Rule%203%3A%20Unknown%20Capabilities%2C%20Unknown%20Version%20of%20S%2FMIME"></a><a class="selflink" href="#section-2.7.1.3" name="section-2.7.1.3">2.7.1.3</a> Rule 3: Unknown Capabilities, Unknown Version of S/MIME</span>

   If:

    - the sending agent has no knowledge of the encryption capabilities
      of the recipient,
    - and the sending agent has no knowledge of the version of S/MIME
      of the recipient,

   then the sending agent SHOULD use tripleDES because it is a stronger
   algorithm and is required by S/MIME v3. If the sending agent chooses
   not to use tripleDES in this step, it SHOULD use RC2/40.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.7.2%20Choosing%20Weak%20Encryption"></a><a class="selflink" href="#section-2.7.2" name="section-2.7.2">2.7.2</a> Choosing Weak Encryption</span>

   Like all algorithms that use 40 bit keys, RC2/40 is considered by
   many to be weak encryption. A sending agent that is controlled by a
   human SHOULD allow a human sender to determine the risks of sending
   data using RC2/40 or a similarly weak encryption algorithm before
   sending the data, and possibly allow the human to use a stronger
   encryption method such as tripleDES.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.7.3%20Multiple%20Recipients"></a><a class="selflink" href="#section-2.7.3" name="section-2.7.3">2.7.3</a> Multiple Recipients</span>

   If a sending agent is composing an encrypted message to a group of
   recipients where the encryption capabilities of some of the
   recipients do not overlap, the sending agent is forced to send more
   than one message. It should be noted that if the sending agent
   chooses to send a message encrypted with a strong algorithm, and then
   send the same message encrypted with a weak algorithm, someone
   watching the communications channel may be able to learn the contents
   of the strongly-encrypted message simply by decrypting the weakly-
   encrypted message.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20Creating%20S%2FMIME%20Messages"></a><a class="selflink" href="#section-3" name="section-3">3</a>. Creating S/MIME Messages</span>

   This section describes the S/MIME message formats and how they are
   created. S/MIME messages are a combination of MIME bodies and CMS
   objects. Several MIME types as well as several CMS objects are used.
   The data to be secured is always a canonical MIME entity. The MIME
   entity and other data, such as certificates and algorithm
   identifiers, are given to CMS processing facilities which produces a
   CMS object.  The CMS object is then finally wrapped in MIME. The
   Enhanced Security Services for S/MIME [<a href="#ref-ESS" title='"Enhanced Security Services for S/MIME"'>ESS</a>] document provides
   examples of how nested, secured S/MIME messages are formatted.  ESS
   provides an example of how a triple-wrapped S/MIME message is
   formatted using multipart/signed and application/pkcs7-mime for the
   signatures.



<span class="grey">Ramsdell                    Standards Track                    [Page 11]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   S/MIME provides one format for enveloped-only data, several formats
   for signed-only data, and several formats for signed and enveloped
   data. Several formats are required to accommodate several
   environments, in particular for signed messages. The criteria for
   choosing among these formats are also described.

   The reader of this section is expected to understand MIME as
   described in [<a href="#ref-MIME-SPEC" title='"MIME Part 1: Format of Internet Message Bodies"'>MIME-SPEC</a>] and [<a href="#ref-MIME-SECURE" title='"Security Multiparts for MIME: Multipart/Signed and Multipart/Encrypted"'>MIME-SECURE</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1%20Preparing%20the%20MIME%20Entity%20for%20Signing%20or%20Enveloping"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a> Preparing the MIME Entity for Signing or Enveloping</span>

   S/MIME is used to secure MIME entities. A MIME entity may be a sub-
   part, sub-parts of a message, or the whole message with all its sub-
   parts. A MIME entity that is the whole message includes only the MIME
   headers and MIME body, and does not include the <a href="rfc822.html">RFC-822</a> headers.
   Note that S/MIME can also be used to secure MIME entities used in
   applications other than Internet mail.

   The MIME entity that is secured and described in this section can be
   thought of as the "inside" MIME entity. That is, it is the
   "innermost" object in what is possibly a larger MIME message.
   Processing "outside" MIME entities into CMS objects is described in
   <a href="#section-3.2">Section 3.2</a>, 3.4 and elsewhere.

   The procedure for preparing a MIME entity is given in [<a href="#ref-MIME-SPEC" title='"MIME Part 1: Format of Internet Message Bodies"'>MIME-SPEC</a>].
   The same procedure is used here with some additional restrictions
   when signing. Description of the procedures from [<a href="#ref-MIME-SPEC" title='"MIME Part 1: Format of Internet Message Bodies"'>MIME-SPEC</a>] are
   repeated here, but the reader should refer to that document for the
   exact procedure. This section also describes additional requirements.

   A single procedure is used for creating MIME entities that are to be
   signed, enveloped, or both signed and enveloped. Some additional
   steps are recommended to defend against known corruptions that can
   occur during mail transport that are of particular importance for
   clear- signing using the multipart/signed format. It is recommended
   that these additional steps be performed on enveloped messages, or
   signed and enveloped messages in order that the message can be
   forwarded to any environment without modification.

   These steps are descriptive rather than prescriptive. The implementor
   is free to use any procedure as long as the result is the same.

   Step 1. The MIME entity is prepared according to the local
   conventions

   Step 2. The leaf parts of the MIME entity are converted to canonical
   form




<span class="grey">Ramsdell                    Standards Track                    [Page 12]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   Step 3. Appropriate transfer encoding is applied to the leaves of the
   MIME entity

   When an S/MIME message is received, the security services on the
   message are processed, and the result is the MIME entity. That MIME
   entity is typically passed to a MIME-capable user agent where, it is
   further decoded and presented to the user or receiving application.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.1%20Canonicalization"></a><a class="selflink" href="#section-3.1.1" name="section-3.1.1">3.1.1</a> Canonicalization</span>

   Each MIME entity MUST be converted to a canonical form that is
   uniquely and unambiguously representable in the environment where the
   signature is created and the environment where the signature will be
   verified.  MIME entities MUST be canonicalized for enveloping as well
   as signing.

   The exact details of canonicalization depend on the actual MIME type
   and subtype of an entity, and are not described here. Instead, the
   standard for the particular MIME type should be consulted. For
   example, canonicalization of type text/plain is different from
   canonicalization of audio/basic. Other than text types, most types
   have only one representation regardless of computing platform or
   environment which can be considered their canonical representation.
   In general, canonicalization will be performed by the non-security
   part of the sending agent rather than the S/MIME implementation.

   The most common and important canonicalization is for text, which is
   often represented differently in different environments. MIME
   entities of major type "text" must have both their line endings and
   character set canonicalized. The line ending must be the pair of
   characters &lt;CR&gt;&lt;LF&gt;, and the charset should be a registered charset
   [<a href="#ref-CHARSETS">CHARSETS</a>].  The details of the canonicalization are specified in
   [<a href="#ref-MIME-SPEC" title='"MIME Part 1: Format of Internet Message Bodies"'>MIME-SPEC</a>]. The chosen charset SHOULD be named in the charset
   parameter so that the receiving agent can unambiguously determine the
   charset used.

   Note that some charsets such as ISO-2022 have multiple
   representations for the same characters. When preparing such text for
   signing, the canonical representation specified for the charset MUST
   be used.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.2%20Transfer%20Encoding"></a><a class="selflink" href="#section-3.1.2" name="section-3.1.2">3.1.2</a> Transfer Encoding</span>

   When generating any of the secured MIME entities below, except the
   signing using the multipart/signed format, no transfer encoding at
   all is required.  S/MIME implementations MUST be able to deal with
   binary MIME objects. If no Content-Transfer-Encoding header is
   present, the transfer encoding should be considered 7BIT.



<span class="grey">Ramsdell                    Standards Track                    [Page 13]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   S/MIME implementations SHOULD however use transfer encoding described
   in <a href="#section-3.1.3">section 3.1.3</a> for all MIME entities they secure. The reason for
   securing only 7-bit MIME entities, even for enveloped data that are
   not exposed to the transport, is that it allows the MIME entity to be
   handled in any environment without changing it. For example, a
   trusted gateway might remove the envelope, but not the signature, of
   a message, and then forward the signed message on to the end
   recipient so that they can verify the signatures directly. If the
   transport internal to the site is not 8-bit clean, such as on a
   wide-area network with a single mail gateway, verifying the signature
   will not be possible unless the original MIME entity was only 7-bit
   data.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.3%20Transfer%20Encoding%20for%20Signing%20Using%20multipart%2Fsigned"></a><a class="selflink" href="#section-3.1.3" name="section-3.1.3">3.1.3</a> Transfer Encoding for Signing Using multipart/signed</span>

   If a multipart/signed entity is EVER to be transmitted over the
   standard Internet SMTP infrastructure or other transport that is
   constrained to 7-bit text, it MUST have transfer encoding applied so
   that it is represented as 7-bit text. MIME entities that are 7-bit
   data already need no transfer encoding. Entities such as 8-bit text
   and binary data can be encoded with quoted-printable or base-64
   transfer encoding.

   The primary reason for the 7-bit requirement is that the Internet
   mail transport infrastructure cannot guarantee transport of 8-bit or
   binary data. Even though many segments of the transport
   infrastructure now handle 8-bit and even binary data, it is sometimes
   not possible to know whether the transport path is 8-bit clear. If a
   mail message with 8-bit data were to encounter a message transfer
   agent that can not transmit 8-bit or binary data, the agent has three
   options, none of which are acceptable for a clear-signed message:

   - The agent could change the transfer encoding; this would invalidate
     the signature.
   - The agent could transmit the data anyway, which would most likely
     result in the 8th bit being corrupted; this too would invalidate the
     signature.
   - The agent could return the message to the sender.

   [<a id="ref-MIME-SECURE" name="ref-MIME-SECURE">MIME-SECURE</a>] prohibits an agent from changing the transfer encoding
   of the first part of a multipart/signed message. If a compliant agent
   that can not transmit 8-bit or binary data encounters a
   multipart/signed message with 8-bit or binary data in the first part,
   it would have to return the message to the sender as undeliverable.







<span class="grey">Ramsdell                    Standards Track                    [Page 14]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.4%20Sample%20Canonical%20MIME%20Entity"></a><a class="selflink" href="#section-3.1.4" name="section-3.1.4">3.1.4</a> Sample Canonical MIME Entity</span>

   This example shows a multipart/mixed message with full transfer
   encoding. This message contains a text part and an attachment. The
   sample message text includes characters that are not US-ASCII and
   thus must be transfer encoded. Though not shown here, the end of each
   line is &lt;CR&gt;&lt;LF&gt;. The line ending of the MIME headers, the text, and
   transfer encoded parts, all must be &lt;CR&gt;&lt;LF&gt;.

   Note that this example is not of an S/MIME message.

     Content-Type: multipart/mixed; boundary=bar

     --bar
     Content-Type: text/plain; charset=iso-8859-1
     Content-Transfer-Encoding: quoted-printable

     =A1Hola Michael!

     How do you like the new S/MIME specification?

     I agree. It's generally a good idea to encode lines that begin with
     From=20 because some mail transport agents will insert a
     greater-than (&gt;) sign, thus invalidating the signature.

     Also, in some cases it might be desirable to encode any  =20
     trailing whitespace that occurs on lines in order to ensure  =20
     that the message signature is not invalidated when passing  =20
     a gateway that modifies such whitespace (like BITNET).  =20

     --bar
     Content-Type: image/jpeg
     Content-Transfer-Encoding: base64

     iQCVAwUBMJrRF2N9oWBghPDJAQE9UQQAtl7LuRVndBjrk4EqYBIb3h5QXIX/LC//
     jJV5bNvkZIGPIcEmI5iFd9boEgvpirHtIREEqLQRkYNoBActFBZmh9GC3C041WGq
     uMbrbxc+nIs1TIKlA08rVi9ig/2Yh7LFrK5Ein57U/W72vgSxLhe/zhdfolT9Brn
     HOxEa44b+EI=

     --bar--

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2%20The%20application%2Fpkcs7-mime%20Type"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a> The application/pkcs7-mime Type</span>

   The application/pkcs7-mime type is used to carry CMS objects of
   several types including envelopedData and signedData. The details of
   constructing these entities is described in subsequent sections. This
   section describes the general characteristics of the
   application/pkcs7-mime type.



<span class="grey">Ramsdell                    Standards Track                    [Page 15]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   The carried CMS object always contains a MIME entity that is prepared
   as described in <a href="#section-3.1">section 3.1</a> if the eContentType is id-data. Other
   contents may be carried when the eContentType contains different
   values. See [<a href="#ref-ESS" title='"Enhanced Security Services for S/MIME"'>ESS</a>] for an example of this with signed receipts.

   Since CMS objects are binary data, in most cases base-64 transfer
   encoding is appropriate, in particular when used with SMTP transport.
   The transfer encoding used depends on the transport through which the
   object is to be sent, and is not a characteristic of the MIME type.

   Note that this discussion refers to the transfer encoding of the CMS
   object or "outside" MIME entity. It is completely distinct from, and
   unrelated to, the transfer encoding of the MIME entity secured by the
   CMS object, the "inside" object, which is described in <a href="#section-3.1">section 3.1</a>.

   Because there are several types of application/pkcs7-mime objects, a
   sending agent SHOULD do as much as possible to help a receiving agent
   know about the contents of the object without forcing the receiving
   agent to decode the ASN.1 for the object. The MIME headers of all
   application/pkcs7-mime objects SHOULD include the optional "smime-
   type" parameter, as described in the following sections.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.1%20The%20name%20and%20filename%20Parameters"></a><a class="selflink" href="#section-3.2.1" name="section-3.2.1">3.2.1</a> The name and filename Parameters</span>

   For the application/pkcs7-mime, sending agents SHOULD emit the
   optional "name" parameter to the Content-Type field for compatibility
   with older systems. Sending agents SHOULD also emit the optional
   Content-Disposition field [<a href="#ref-CONTDISP" title='"Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field"'>CONTDISP</a>] with the "filename" parameter.
   If a sending agent emits the above parameters, the value of the
   parameters SHOULD be a file name with the appropriate extension:

   MIME Type                                File Extension

   Application/pkcs7-mime (signedData,      .p7m
   envelopedData)

   Application/pkcs7-mime (degenerate       .p7c
   signedData "certs-only" message)

   Application/pkcs7-signature              .p7s

   In addition, the file name SHOULD be limited to eight characters
   followed by a three letter extension. The eight character filename
   base can be any distinct name; the use of the filename base "smime"
   SHOULD be used to indicate that the MIME entity is associated with
   S/MIME.





<span class="grey">Ramsdell                    Standards Track                    [Page 16]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   Including a file name serves two purposes. It facilitates easier use
   of S/MIME objects as files on disk. It also can convey type
   information across gateways. When a MIME entity of type
   application/pkcs7-mime (for example) arrives at a gateway that has no
   special knowledge of S/MIME, it will default the entity's MIME type
   to application/octet-stream and treat it as a generic attachment,
   thus losing the type information. However, the suggested filename for
   an attachment is often carried across a gateway. This often allows
   the receiving systems to determine the appropriate application to
   hand the attachment off to, in this case a stand-alone S/MIME
   processing application. Note that this mechanism is provided as a
   convenience for implementations in certain environments. A proper
   S/MIME implementation MUST use the MIME types and MUST NOT rely on
   the file extensions.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.2%20The%20smime-type%20parameter"></a><a class="selflink" href="#section-3.2.2" name="section-3.2.2">3.2.2</a> The smime-type parameter</span>

   The application/pkcs7-mime content type defines the optional "smime-
   type" parameter. The intent of this parameter is to convey details
   about the security applied (signed or enveloped) along with
   infomation about the contained content. This memo defines the
   following smime-types.

   Name                   Security                Inner Content

   enveloped-data         EnvelopedData           id-data

   signed-data            SignedData              id-data

   certs-only             SignedData              none

   In order that consistency can be obtained with future, the following
   guidelines should be followed when assigning a new smime-type
   parameter.

   1. If both signing and encryption can be applied to the content, then
   two values for smime-type SHOULD be assigned "signed-*" and
   "encrypted-*".  If one operation can be assigned then this may be
   omitted. Thus since "certs-only" can only be signed, "signed-" is
   omitted.

   2. A common string for a content oid should be assigned. We use
   "data" for the id-data content OID when MIME is the inner content.

   3. If no common string is assigned.  Then the common string of
   "OID.&lt;oid&gt;" is recommended (for example, "OID.1.3.6.1.5.5.7.6.1"
   would be DES40).




<span class="grey">Ramsdell                    Standards Track                    [Page 17]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3%20Creating%20an%20Enveloped-only%20Message"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a> Creating an Enveloped-only Message</span>

   This section describes the format for enveloping a MIME entity
   without signing it. It is important to note that sending enveloped
   but not signed messages does not provide for data integrity. It is
   possible to replace ciphertext in such a way that the processed
   message will still be valid, but the meaning may be altered.

   Step 1. The MIME entity to be enveloped is prepared according to
   <a href="#section-3.1">section 3.1</a>.

   Step 2. The MIME entity and other required data is processed into a
   CMS object of type envelopedData. In addition to encrypting a copy of
   the content-encryption key for each recipient, a copy of the content
   encryption key SHOULD be encrypted for the originator and included in
   the envelopedData (see CMS <a href="#section-6">Section 6</a>).

   Step 3. The CMS object is inserted into an application/pkcs7-mime
   MIME entity.

   The smime-type parameter for enveloped-only messages is "enveloped-
   data". The file extension for this type of message is ".p7m".

   A sample message would be:

       Content-Type: application/pkcs7-mime; smime-type=enveloped-data;
            name=smime.p7m
       Content-Transfer-Encoding: base64
       Content-Disposition: attachment; filename=smime.p7m

       rfvbnj756tbBghyHhHUujhJhjH77n8HHGT9HG4VQpfyF467GhIGfHfYT6
       7n8HHGghyHhHUujhJh4VQpfyF467GhIGfHfYGTrfvbnjT6jH7756tbB9H
       f8HHGTrfvhJhjH776tbB9HG4VQbnj7567GhIGfHfYT6ghyHhHUujpfyF4
       0GhIGfHfQbnj756YT64V

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4%20Creating%20a%20Signed-only%20Message"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a> Creating a Signed-only Message</span>

   There are two formats for signed messages defined for S/MIME:
   application/pkcs7-mime with SignedData, and multipart/signed. In
   general, the multipart/signed form is preferred for sending, and
   receiving agents SHOULD be able to handle both.










<span class="grey">Ramsdell                    Standards Track                    [Page 18]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.4.1%20Choosing%20a%20Format%20for%20Signed-only%20Messages"></a><a class="selflink" href="#section-3.4.1" name="section-3.4.1">3.4.1</a> Choosing a Format for Signed-only Messages</span>

   There are no hard-and-fast rules when a particular signed-only format
   should be chosen because it depends on the capabilities of all the
   receivers and the relative importance of receivers with S/MIME
   facilities being able to verify the signature versus the importance
   of receivers without S/MIME software being able to view the message.

   Messages signed using the multipart/signed format can always be
   viewed by the receiver whether they have S/MIME software or not. They
   can also be viewed whether they are using a MIME-native user agent or
   they have messages translated by a gateway. In this context, "be
   viewed" means the ability to process the message essentially as if it
   were not a signed message, including any other MIME structure the
   message might have.

   Messages signed using the signedData format cannot be viewed by a
   recipient unless they have S/MIME facilities. However, if they have
   S/MIME facilities, these messages can always be verified if they were
   not changed in transit.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.4.2%20Signing%20Using%20application%2Fpkcs7-mime%20with%20SignedData"></a><a class="selflink" href="#section-3.4.2" name="section-3.4.2">3.4.2</a> Signing Using application/pkcs7-mime with SignedData</span>

   This signing format uses the application/pkcs7-mime MIME type. The
   steps to create this format are:

   Step 1. The MIME entity is prepared according to <a href="#section-3.1">section 3.1</a>

   Step 2. The MIME entity and other required data is processed into a
   CMS object of type signedData

   Step 3. The CMS object is inserted into an application/pkcs7-mime
   MIME entity

   The smime-type parameter for messages using application/pkcs7-mime
   with SignedData is "signed-data". The file extension for this type of
   message is ".p7m".

   A sample message would be:

       Content-Type: application/pkcs7-mime; smime-type=signed-data;
            name=smime.p7m
       Content-Transfer-Encoding: base64
       Content-Disposition: attachment; filename=smime.p7m







<span class="grey">Ramsdell                    Standards Track                    [Page 19]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


       567GhIGfHfYT6ghyHhHUujpfyF4f8HHGTrfvhJhjH776tbB9HG4VQbnj7
       77n8HHGT9HG4VQpfyF467GhIGfHfYT6rfvbnj756tbBghyHhHUujhJhjH
       HUujhJh4VQpfyF467GhIGfHfYGTrfvbnjT6jH7756tbB9H7n8HHGghyHh
       6YT64V0GhIGfHfQbnj75

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.4.3%20Signing%20Using%20the%20multipart%2Fsigned%20Format"></a><a class="selflink" href="#section-3.4.3" name="section-3.4.3">3.4.3</a> Signing Using the multipart/signed Format</span>

   This format is a clear-signing format. Recipients without any S/MIME
   or CMS processing facilities are able to view the message. It makes
   use of the multipart/signed MIME type described in [<a href="#ref-MIME-SECURE" title='"Security Multiparts for MIME: Multipart/Signed and Multipart/Encrypted"'>MIME-SECURE</a>]. The
   multipart/signed MIME type has two parts. The first part contains the
   MIME entity that is signed; the second part contains the "detached
   signature" CMS SignedData object in which the encapContentInfo
   eContent field is absent.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.4.3.1%20The%20application%2Fpkcs7-signature%20MIME%20Type"></a><a class="selflink" href="#section-3.4.3.1" name="section-3.4.3.1">3.4.3.1</a> The application/pkcs7-signature MIME Type</span>

   This MIME type always contains a single CMS object of type
   signedData.  The signedData encapContentInfo eContent field MUST be
   absent. The signerInfos field contains the signatures for the MIME
   entity.

   The file extension for signed-only messages using application/pkcs7-
   signature is ".p7s".

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.4.3.2%20Creating%20a%20multipart%2Fsigned%20Message"></a><a class="selflink" href="#section-3.4.3.2" name="section-3.4.3.2">3.4.3.2</a> Creating a multipart/signed Message</span>

   Step 1. The MIME entity to be signed is prepared according to <a href="#section-3.1">section</a>
   <a href="#section-3.1">3.1</a>, taking special care for clear-signing.

   Step 2. The MIME entity is presented to CMS processing in order to
   obtain an object of type signedData in which the encapContentInfo
   eContent field is absent.

   Step 3. The MIME entity is inserted into the first part of a
   multipart/signed message with no processing other than that described
   in <a href="#section-3.1">section 3.1</a>.

   Step 4. Transfer encoding is applied to the "detached signature" CMS
   SignedData object and it is inserted into a MIME entity of type
   application/pkcs7-signature.

   Step 5. The MIME entity of the application/pkcs7-signature is
   inserted into the second part of the multipart/signed entity.

   The multipart/signed Content type has two required parameters: the
   protocol parameter and the micalg parameter.




<span class="grey">Ramsdell                    Standards Track                    [Page 20]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   The protocol parameter MUST be "application/pkcs7-signature". Note
   that quotation marks are required around the protocol parameter
   because MIME requires that the "/" character in the parameter value
   MUST be quoted.

   The micalg parameter allows for one-pass processing when the
   signature is being verified. The value of the micalg parameter is
   dependent on the message digest algorithm(s) used in the calculation
   of the Message Integrity Check. If multiple message digest algorithms
   are used they MUST be separated by commas per [<a href="#ref-MIME-SECURE" title='"Security Multiparts for MIME: Multipart/Signed and Multipart/Encrypted"'>MIME-SECURE</a>]. The
   values to be placed in the micalg parameter SHOULD be from the
   following:

   Algorithm   Value
   used

   MD5         md5
   SHA-1       sha1
   Any other   unknown

   (Historical note: some early implementations of S/MIME emitted and
   expected "rsa-md5" and "rsa-sha1" for the micalg parameter.)
   Receiving agents SHOULD be able to recover gracefully from a micalg
   parameter value that they do not recognize.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.4.3.3%20Sample%20multipart%2Fsigned%20Message"></a><a class="selflink" href="#section-3.4.3.3" name="section-3.4.3.3">3.4.3.3</a> Sample multipart/signed Message</span>

       Content-Type: multipart/signed;
          protocol="application/pkcs7-signature";
          micalg=sha1; boundary=boundary42

       --boundary42
       Content-Type: text/plain

       This is a clear-signed message.

       --boundary42
       Content-Type: application/pkcs7-signature; name=smime.p7s
       Content-Transfer-Encoding: base64
       Content-Disposition: attachment; filename=smime.p7s

       ghyHhHUujhJhjH77n8HHGTrfvbnj756tbB9HG4VQpfyF467GhIGfHfYT6
       4VQpfyF467GhIGfHfYT6jH77n8HHGghyHhHUujhJh756tbB9HGTrfvbnj
       n8HHGTrfvhJhjH776tbB9HG4VQbnj7567GhIGfHfYT6ghyHhHUujpfyF4
       7GhIGfHfYT64VQbnj756

       --boundary42--




<span class="grey">Ramsdell                    Standards Track                    [Page 21]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.5%20Signing%20and%20Encrypting"></a><a class="selflink" href="#section-3.5" name="section-3.5">3.5</a> Signing and Encrypting</span>

   To achieve signing and enveloping, any of the signed-only and
   encrypted-only formats may be nested. This is allowed because the
   above formats are all MIME entities, and because they all secure MIME
   entities.

   An S/MIME implementation MUST be able to receive and process
   arbitrarily nested S/MIME within reasonable resource limits of the
   recipient computer.

   It is possible to either sign a message first, or to envelope the
   message first. It is up to the implementor and the user to choose.
   When signing first, the signatories are then securely obscured by the
   enveloping. When enveloping first the signatories are exposed, but it
   is possible to verify signatures without removing the enveloping.
   This may be useful in an environment were automatic signature
   verification is desired, as no private key material is required to
   verify a signature.

   There are security ramifications to choosing whether to sign first or
   encrypt first. A recipient of a message that is encrypted and then
   signed can validate that the encrypted block was unaltered, but
   cannot determine any relationship between the signer and the
   unencrypted contents of the message. A recipient of a message that is
   signed-then-encrypted can assume that the signed message itself has
   not been altered, but that a careful attacker may have changed the
   unauthenticated portions of the encrypted message.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.6%20Creating%20a%20Certificates-only%20Message"></a><a class="selflink" href="#section-3.6" name="section-3.6">3.6</a> Creating a Certificates-only Message</span>

   The certificates only message or MIME entity is used to transport
   certificates, such as in response to a registration request. This
   format can also be used to convey CRLs.

   Step 1. The certificates are made available to the CMS generating
   process which creates a CMS object of type signedData. The signedData
   encapContentInfo eContent field MUST be absent and signerInfos field
   MUST be empty.

   Step 2. The CMS signedData object is enclosed in an
   application/pkcs7-mime MIME entity

   The smime-type parameter for a certs-only message is "certs-only".
   The file extension for this type of message is ".p7c".






<span class="grey">Ramsdell                    Standards Track                    [Page 22]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.7%20Registration%20Requests"></a><a class="selflink" href="#section-3.7" name="section-3.7">3.7</a> Registration Requests</span>

   A sending agent that signs messages MUST have a certificate for the
   signature so that a receiving agent can verify the signature. There
   are many ways of getting certificates, such as through an exchange
   with a certificate authority, through a hardware token or diskette,
   and so on.

   S/MIME v2 [<a href="#ref-SMIMEV2" title='"S/MIME Version 2 Message Specification"'>SMIMEV2</a>] specified a method for "registering" public keys
   with certificate authorities using an application/pkcs10 body part.
   The IETF's PKIX Working Group is preparing another method for
   requesting certificates; however, that work was not finished at the
   time of this memo. S/MIME v3 does not specify how to request a

   certificate, but instead mandates that every sending agent already
   has a certificate. Standardization of certificate management is being
   pursued separately in the IETF.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.8%20Identifying%20an%20S%2FMIME%20Message"></a><a class="selflink" href="#section-3.8" name="section-3.8">3.8</a> Identifying an S/MIME Message</span>

   Because S/MIME takes into account interoperation in non-MIME
   environments, several different mechanisms are employed to carry the
   type information, and it becomes a bit difficult to identify S/MIME
   messages. The following table lists criteria for determining whether
   or not a message is an S/MIME message. A message is considered an
   S/MIME message if it matches any below.

   The file suffix in the table below comes from the "name" parameter in
   the content-type header, or the "filename" parameter on the content-
   disposition header. These parameters that give the file suffix are
   not listed below as part of the parameter section.

   MIME type:   application/pkcs7-mime
   parameters:  any
   file suffix: any

   MIME type:   multipart/signed
   parameters:  protocol="application/pkcs7-signature"
   file suffix: any

   MIME type:   application/octet-stream
   parameters:  any
   file suffix: p7m, p7s, p7c








<span class="grey">Ramsdell                    Standards Track                    [Page 23]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20Certificate%20Processing"></a><a class="selflink" href="#section-4" name="section-4">4</a>. Certificate Processing</span>

   A receiving agent MUST provide some certificate retrieval mechanism
   in order to gain access to certificates for recipients of digital
   envelopes. This memo does not cover how S/MIME agents handle
   certificates, only what they do after a certificate has been
   validated or rejected. S/MIME certification issues are covered in
   [<a href="#ref-CERT3" title='"S/MIME Version 3 Certificate Handling"'>CERT3</a>].

   At a minimum, for initial S/MIME deployment, a user agent could
   automatically generate a message to an intended recipient requesting
   that recipient's certificate in a signed return message. Receiving
   and sending agents SHOULD also provide a mechanism to allow a user to
   "store and protect" certificates for correspondents in such a way so
   as to guarantee their later retrieval.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1%20Key%20Pair%20Generation"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a> Key Pair Generation</span>

   If an S/MIME agent needs to generate a key pair, then the S/MIME
   agent or some related administrative utility or function MUST be
   capable of generating separate DH and DSS public/private key pairs on
   behalf of the user. Each key pair MUST be generated from a good
   source of non-deterministic random input [<a href="#ref-RANDOM" title='"Randomness Recommendations for Security"'>RANDOM</a>] and the private key
   MUST be protected in a secure fashion.

   If an S/MIME agent needs to generate a key pair, then the S/MIME
   agent or some related administrative utility or function SHOULD
   generate RSA key pairs.

   A user agent SHOULD generate RSA key pairs at a minimum key size of
   768 bits. A user agent MUST NOT generate RSA key pairs less than 512
   bits long. Creating keys longer than 1024 bits may cause some older
   S/MIME receiving agents to not be able to verify signatures, but
   gives better security and is therefore valuable. A receiving agent
   SHOULD be able to verify signatures with keys of any size over 512
   bits. Some agents created in the United States have chosen to create
   512 bit keys in order to get more advantageous export licenses.
   However, 512 bit keys are considered by many to be cryptographically
   insecure.  Implementors should be aware that multiple (active) key
   pairs may be associated with a single individual. For example, one
   key pair may be used to support confidentiality, while a different
   key pair may be used for authentication.









<span class="grey">Ramsdell                    Standards Track                    [Page 24]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20Security"></a><a class="selflink" href="#section-5" name="section-5">5</a>. Security</span>

   This entire memo discusses security. Security issues not covered in
   other parts of the memo include:

   40-bit encryption is considered weak by most cryptographers. Using
   weak cryptography in S/MIME offers little actual security over
   sending plaintext. However, other features of S/MIME, such as the
   specification of tripleDES and the ability to announce stronger
   cryptographic capabilities to parties with whom you communicate,
   allow senders to create messages that use strong encryption. Using
   weak cryptography is never recommended unless the only alternative is
   no cryptography. When feasible, sending and receiving agents should
   inform senders and recipients the relative cryptographic strength of
   messages.

   It is impossible for most software or people to estimate the value of
   a message. Further, it is impossible for most software or people to
   estimate the actual cost of decrypting a message that is encrypted
   with a key of a particular size. Further, it is quite difficult to
   determine the cost of a failed decryption if a recipient cannot
   decode a message. Thus, choosing between different key sizes (or
   choosing whether to just use plaintext) is also impossible. However,
   decisions based on these criteria are made all the time, and
   therefore this memo gives a framework for using those estimates in
   choosing algorithms.

   If a sending agent is sending the same message using different
   strengths of cryptography, an attacker watching the communications
   channel may be able to determine the contents of the strongly-
   encrypted message by decrypting the weakly-encrypted version.  In
   other words, a sender should not send a copy of a message using
   weaker cryptography than they would use for the original of the
   message.

   Modification of the ciphertext can go undetected if authentication is
   not also used, which is the case when sending EnvelopedData without
   wrapping it in SignedData or enclosing SignedData within it.













<span class="grey">Ramsdell                    Standards Track                    [Page 25]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/A.%20ASN.1%20Module"></a><a class="selflink" href="#appendix-A" name="appendix-A">A</a>. ASN.1 Module</span>

SecureMimeMessageV3
  { iso(1) member-body(2) us(840) rsadsi(113549)
         pkcs(1) pkcs-9(9) smime(16) modules(0) smime(4) }

DEFINITIONS IMPLICIT TAGS ::=
BEGIN

IMPORTS
-- Cryptographic Message Syntax
    SubjectKeyIdentifier, IssuerAndSerialNumber,
RecipientKeyIdentifier
        FROM    CryptographicMessageSyntax
               { iso(1) member-body(2) us(840) rsadsi(113549)
                 pkcs(1) pkcs-9(9) smime(16) modules(0) cms(1) };

--  id-aa is the arc with all new authenticated and unauthenticated
--  attributes produced the by S/MIME Working Group

id-aa OBJECT IDENTIFIER ::= {iso(1) member-body(2) usa(840)
rsadsi(113549)
        pkcs(1) pkcs-9(9) smime(16) attributes(2)}

-- S/MIME Capabilities provides a method of broadcasting the symetric
-- capabilities understood.  Algorithms should be ordered by preference
-- and grouped by type

smimeCapabilities OBJECT IDENTIFIER ::=
   {iso(1) member-body(2) us(840) rsadsi(113549) pkcs(1) pkcs-9(9) 15}

SMIMECapability ::= SEQUENCE {
   capabilityID OBJECT IDENTIFIER,
   parameters ANY DEFINED BY capabilityID OPTIONAL }

SMIMECapabilities ::= SEQUENCE OF SMIMECapability

-- Encryption Key Preference provides a method of broadcasting the
-- preferred encryption certificate.

id-aa-encrypKeyPref OBJECT IDENTIFIER ::= {id-aa 11}

SMIMEEncryptionKeyPreference ::= CHOICE {
   issuerAndSerialNumber   [0] IssuerAndSerialNumber,
   receipentKeyId          [1] RecipientKeyIdentifier,
   subjectAltKeyIdentifier [2] SubjectKeyIdentifier
}




<span class="grey">Ramsdell                    Standards Track                    [Page 26]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


-- The Content Encryption Algorithms defined for SMIME are:

-- Triple-DES is the manditory algorithm with CBCParameter being the
-- parameters

dES-EDE3-CBC OBJECT IDENTIFIER ::=
   {iso(1) member-body(2) us(840) rsadsi(113549)
encryptionAlgorithm(3) 7}

CBCParameter ::= IV

IV ::= OCTET STRING (SIZE (8..8))

--  RC2 (or compatable) is an optional algorithm w/ RC2-CBC-paramter
--  as the parameter

rC2-CBC OBJECT IDENTIFIER ::=
   {iso(1) member-body(2) us(840) rsadsi(113549)
encryptionAlgorithm(3) 2}

-- For the effective-key-bits (key size) greater than 32 and less than
-- 256, the RC2-CBC algorithm parameters are encoded as:

RC2-CBC-parameter ::=  SEQUENCE {
   rc2ParameterVersion  INTEGER,
   iv                   IV}

-- For the effective-key-bits of 40, 64, and 128, the
-- rc2ParameterVersion values are 160, 120, 58 respectively.

-- The following list the OIDs to be used with S/MIME V3

-- Digest Algorithms:

-- md5 OBJECT IDENTIFIER ::=
--    {iso(1) member-body(2) us(840) rsadsi(113549)
-- digestAlgorithm(2) 5}

-- sha-1 OBJECT IDENTIFIER ::=
--    {iso(1) identified-organization(3) oiw(14) secsig(3)
-- algorithm(2) 26}

-- Asymmetric Encryption Algorithms
--
-- rsaEncryption OBJECT IDENTIFIER ::=
--    {iso(1) member-body(2) us(840) rsadsi(113549) pkcs(1) pkcs-1(1)
-- 1}
--



<span class="grey">Ramsdell                    Standards Track                    [Page 27]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


-- rsa OBJECT IDENTIFIER ::=
--    {joint-iso-ccitt(2) ds(5) algorithm(8) encryptionAlgorithm(1) 1}
--
-- id-dsa OBJECT IDENTIFIER ::=
--    {iso(1) member-body(2) us(840) x9-57(10040) x9cm(4) 1 }

-- Signature Algorithms
--
-- md2WithRSAEncryption OBJECT IDENTIFIER ::=
--    {iso(1) member-body(2) us(840) rsadsi(113549) pkcs(1) pkcs-1(1)
-- 2}
--
-- md5WithRSAEncryption OBJECT IDENTIFIER ::=
--    {iso(1) member-body(2) us(840) rsadsi(113549) pkcs(1) pkcs-1(1)
-- 4}
--
-- sha-1WithRSAEncryption OBJECT IDENTIFIER ::=
--    {iso(1) member-body(2) us(840) rsadsi(113549) pkcs(1) pkcs-1(1)
-- 5}
--
-- id-dsa-with-sha1 OBJECT IDENTIFIER ::=
--    {iso(1) member-body(2) us(840) x9-57(10040) x9cm(4) 3}

-- Other Signed Attributes
--
-- signingTime OBJECT IDENTIFIER ::=
--    {iso(1) member-body(2) us(840) rsadsi(113549) pkcs(1) pkcs-9(9)
-- 5}
--    See [<a href="#ref-CMS" title='"Cryptographic Message Syntax"'>CMS</a>] for a description of how to encode the attribute
--    value.

END



















<span class="grey">Ramsdell                    Standards Track                    [Page 28]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/B.%20References"></a><a class="selflink" href="#appendix-B" name="appendix-B">B</a>. References</span>

   [<a id="ref-3DES" name="ref-3DES">3DES</a>]         ANSI X9.52-1998, "Triple Data Encryption Algorithm
                  Modes of Operation", American National Standards
                  Institute, 1998.

   [<a id="ref-CERT3" name="ref-CERT3">CERT3</a>]        Ramsdell, B., Editor, "S/MIME Version 3 Certificate
                  Handling", <a href="rfc2632.html">RFC 2632</a>, June 1999.

   [<a id="ref-CHARSETS" name="ref-CHARSETS">CHARSETS</a>]     Character sets assigned by IANA. See
                  &lt;<a href="ftp://ftp.isi.edu/in-notes/iana/assignments/character-sets">ftp://ftp.isi.edu/in-</a>
                  <a href="ftp://ftp.isi.edu/in-notes/iana/assignments/character-sets">notes/iana/assignments/character-sets</a>&gt;.

   [<a id="ref-CMS" name="ref-CMS">CMS</a>]          Housley, R., "Cryptographic Message Syntax", <a href="rfc2630.html">RFC 2630</a>,
                  June 1999.

   [<a id="ref-CONTDISP" name="ref-CONTDISP">CONTDISP</a>]     Troost, R., Dorner, S. and K. Moore, "Communicating
                  Presentation Information in Internet Messages: The
                  Content-Disposition Header Field", <a href="rfc2183.html">RFC 2183</a>, August
                  1997.

   [<a id="ref-DES" name="ref-DES">DES</a>]          ANSI X3.106, "American National Standard for
                  Information Systems- Data Link Encryption," American
                  National Standards Institute, 1983.

   [<a id="ref-DH" name="ref-DH">DH</a>]           Rescorla, E., "Diffie-Hellman Key Agreement Method",
                  <a href="rfc2631.html">RFC 2631</a>, June 1999.

   [<a id="ref-DSS" name="ref-DSS">DSS</a>]          NIST FIPS PUB 186, "Digital Signature Standard", 18
                  May 1994.

   [<a id="ref-ESS" name="ref-ESS">ESS</a>]          Hoffman, P., Editor "Enhanced Security Services for
                  S/MIME", <a href="rfc2634.html">RFC 2634</a>, June 1999.

   [<a id="ref-MD5" name="ref-MD5">MD5</a>]          Rivest, R., "The MD5 Message Digest Algorithm", <a href="rfc1321.html">RFC</a>
                  <a href="rfc1321.html">1321</a>, April 1992.

   [<a id="ref-MIME-SPEC" name="ref-MIME-SPEC">MIME-SPEC</a>]    The primary definition of MIME. "MIME Part 1: Format
                  of Internet Message Bodies", <a href="rfc2045.html">RFC 2045</a>; "MIME Part 2:
                  Media Types", <a href="rfc2046.html">RFC 2046</a>; "MIME Part 3: Message Header
                  Extensions for Non-ASCII Text", <a href="rfc2047.html">RFC 2047</a>; "MIME Part
                  4: Registration Procedures", <a href="rfc2048.html">RFC 2048</a>; "MIME Part 5:
                  Conformance Criteria and Examples", <a href="rfc2049.html">RFC 2049</a>,
                  September 1993.

   [<a id="ref-MIME-SECURE" name="ref-MIME-SECURE">MIME-SECURE</a>]  Galvin, J., Murphy, S., Crocker, S. and N. Freed,
                  "Security Multiparts for MIME: Multipart/Signed and
                  Multipart/Encrypted", <a href="rfc1847.html">RFC 1847</a>, October 1995.



<span class="grey">Ramsdell                    Standards Track                    [Page 29]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


   [<a id="ref-MUSTSHOULD" name="ref-MUSTSHOULD">MUSTSHOULD</a>]   Bradner, S., "Key words for use in RFCs to Indicate
                  Requirement Levels", <a href="http://tools.ietf.org/html/bcp14">BCP14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-PKCS-1" name="ref-PKCS-1">PKCS-1</a>]       Kaliski, B., "PKCS #1: RSA Encryption Version 2.0",
                  <a href="rfc2437.html">RFC 2437</a>, October 1998.

   [<a id="ref-PKCS-7" name="ref-PKCS-7">PKCS-7</a>]       Kaliski, B., "PKCS #7: Cryptographic Message Syntax
                  Version 1.5", <a href="rfc2315.html">RFC 2315</a>, March 1998.

   [<a id="ref-RANDOM" name="ref-RANDOM">RANDOM</a>]       Eastlake, 3rd, D., Crocker, S. and J. Schiller,
                  "Randomness Recommendations for Security", <a href="rfc1750.html">RFC 1750</a>,
                  December 1994.

   [<a id="ref-RC2" name="ref-RC2">RC2</a>]          Rivest, R., "A Description of the RC2 (r) Encryption
                  Algorithm", <a href="rfc2268.html">RFC 2268</a>, January 1998.

   [<a id="ref-SHA1" name="ref-SHA1">SHA1</a>]         NIST FIPS PUB 180-1, "Secure Hash Standard," National
                  Institute of Standards and Technology, U.S. Department
                  of Commerce, DRAFT, 31May 1994.

   [<a id="ref-SMIMEV2" name="ref-SMIMEV2">SMIMEV2</a>]      Dusse, S., Hoffman, P., Ramsdell, B., Lundblade, L.
                  and L.  Repka, "S/MIME Version 2 Message
                  Specification", <a href="rfc2311.html">RFC 2311</a>, March 1998.




























<span class="grey">Ramsdell                    Standards Track                    [Page 30]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/C.%20Acknowledgements"></a><a class="selflink" href="#appendix-C" name="appendix-C">C</a>. Acknowledgements</span>

   Many thanks go out to the other authors of the S/MIME Version 2
   Message Specification RFC:  Steve Dusse, Paul Hoffman, Laurence
   Lundblade and Lisa Repka. Without v2, there wouldn't be a v3.

   A number of the members of the S/MIME Working Group have also worked
   very hard and contributed to this document. Any list of people is
   doomed to omission, and for that I apologize. In alphabetical order,
   the following people stand out in my mind due to the fact that they
   made direct contributions to this document.

   Dave Crocker
   Bill Flanigan
   Paul Hoffman
   Russ Housley
   John Pawling
   Jim Schaad

Editor's Address

   Blake Ramsdell
   Worldtalk
   17720 NE 65th St Ste 201
   Redmond, WA 98052

   Phone: +1 425 376 0225
   EMail: blaker@deming.com























<span class="grey">Ramsdell                    Standards Track                    [Page 31]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc2633.html">RFC 2633</a>         S/MIME Version 3 Message Specification        June 1999</span>


Full Copyright Statement

   Copyright (C) The Internet Society (1999).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.



















Ramsdell                    Standards Track                    [Page 32]

</pre><br/>
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.111, available from
<a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>



</body><!-- Mirrored from tools.ietf.org/html/rfc2633 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 28 Apr 2015 16:02:32 GMT --></html>