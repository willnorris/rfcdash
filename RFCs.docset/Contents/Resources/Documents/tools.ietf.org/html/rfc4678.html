<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc4678 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:40 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:4678" name="DC.Identifier"/>
<meta content="Entities responsible for distributing work across a group of systems
traditionally do not know a great deal about the ability of the
applications on those systems to complete the work in a satisfactory
fashion. Workload management systems traditionally know a great deal
about the health of applications, but have little control over the
rate in which these applications receive work. The Server/Application
State Protocol (SASP) provides a mechanism for load balancers and
workload management systems to communicate better ways of distributing
the existing workload to the group members. This memo provides
information for the Internet community." name="DC.Description.Abstract"/>
<meta content="Alan Bivens &lt;jbivens@us.ibm.com&gt;" name="DC.Creator"/>
<meta content="September, 2006" name="DC.Date.Issued"/>
<meta content="Server/Application State Protocol v1" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 4678 - Server/Application State Protocol v1</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc4678.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc4678" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-bivens-sasp" title="draft-bivens-sasp">draft-bivens-sasp</a>] [<a href="https://datatracker.ietf.org/doc/rfc4678" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc4678" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc4678" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=4678">Errata</a>] </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                                          A. Bivens
Request for Comments: 4678                                  IBM Research
Category: Informational                                   September 2006


                  <span class="h1">Server/Application State Protocol v1</span>

Status of This Memo

   This memo provides information for the Internet community.  It does
   not specify an Internet standard of any kind.  Distribution of this
   memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2006).

IESG Note

   This RFC is not a candidate for any level of Internet Standard.  The
   IETF disclaims any knowledge of the fitness of this RFC for any
   purpose and in particular notes that the decision to publish is not
   based on IETF review for such things as security, congestion control,
   or inappropriate interaction with deployed protocols.  The RFC Editor
   has chosen to publish this document at its discretion.  Readers of
   this document should exercise caution in evaluating its value for
   implementation and deployment.  See <a href="rfc3932.html">RFC 3932</a> for more information.

Abstract

   Entities responsible for distributing work across a group of systems
   traditionally do not know a great deal about the ability of the
   applications on those systems to complete the work in a satisfactory
   fashion.  Workload management systems traditionally know a great deal
   about the health of applications, but have little control over the
   rate in which these applications receive work.  The
   Server/Application State Protocol (SASP) provides a mechanism for
   load balancers and workload management systems to communicate better
   ways of distributing the existing workload to the group members.












<span class="grey">Bivens                       Informational                      [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Overview ...................................................<a href="#page-3">3</a>
      <a href="#section-1.2">1.2</a>. Identities .................................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Requirements Notation ...........................................<a href="#page-4">4</a>
   <a href="#section-3">3</a>. Conventions Used in This Document ...............................<a href="#page-4">4</a>
   <a href="#section-4">4</a>. General Message Structure .......................................<a href="#page-4">4</a>
      <a href="#section-4.1">4.1</a>. TLV Structure ..............................................<a href="#page-6">6</a>
      <a href="#section-4.2">4.2</a>. Component Types ............................................<a href="#page-6">6</a>
      <a href="#section-4.3">4.3</a>. SASP Protocol Header .......................................<a href="#page-7">7</a>
      <a href="#section-4.4">4.4</a>. Version Negotiation ........................................<a href="#page-8">8</a>
   <a href="#section-5">5</a>. Singular Protocol Components ....................................<a href="#page-9">9</a>
      <a href="#section-5.1">5.1</a>. Member Data Component ......................................<a href="#page-9">9</a>
      <a href="#section-5.2">5.2</a>. Group Data Component ......................................<a href="#page-11">11</a>
      <a href="#section-5.3">5.3</a>. Weight Entry Data Component ...............................<a href="#page-12">12</a>
      <a href="#section-5.4">5.4</a>. Member State Instance Component ...........................<a href="#page-14">14</a>
   <a href="#section-6">6</a>. Group Protocol Components ......................................<a href="#page-15">15</a>
      <a href="#section-6.1">6.1</a>. Group of Member Data Component ............................<a href="#page-15">15</a>
      <a href="#section-6.2">6.2</a>. Group of Weight Data Component ............................<a href="#page-16">16</a>
      <a href="#section-6.3">6.3</a>. Group of Member State Data Components .....................<a href="#page-17">17</a>
   <a href="#section-7">7</a>. Protocol Messages ..............................................<a href="#page-17">17</a>
      <a href="#section-7.1">7.1</a>. Registration Request and Reply ............................<a href="#page-18">18</a>
           <a href="#section-7.1.1">7.1.1</a>. Registration Request ...............................<a href="#page-18">18</a>
           <a href="#section-7.1.2">7.1.2</a>. Registration Reply .................................<a href="#page-19">19</a>
      <a href="#section-7.2">7.2</a>. DeRegistration Request and Reply ..........................<a href="#page-20">20</a>
           <a href="#section-7.2.1">7.2.1</a>. DeRegistration Request .............................<a href="#page-21">21</a>
           <a href="#section-7.2.2">7.2.2</a>. DeRegistration Reply ...............................<a href="#page-22">22</a>
      <a href="#section-7.3">7.3</a>. Get Weights Request and Reply .............................<a href="#page-23">23</a>
           <a href="#section-7.3.1">7.3.1</a>. Get Weights Request ................................<a href="#page-24">24</a>
           <a href="#section-7.3.2">7.3.2</a>. Get Weights Reply ..................................<a href="#page-25">25</a>
      <a href="#section-7.4">7.4</a>. Send Weights ..............................................<a href="#page-26">26</a>
      <a href="#section-7.5">7.5</a>. Set Member State Request and Reply ........................<a href="#page-27">27</a>
           <a href="#section-7.5.1">7.5.1</a>. Set Member State Request ...........................<a href="#page-28">28</a>
           <a href="#section-7.5.2">7.5.2</a>. Set Member State Reply .............................<a href="#page-29">29</a>
      <a href="#section-7.6">7.6</a>. Set Load Balancer State Request and Reply .................<a href="#page-30">30</a>
           <a href="#section-7.6.1">7.6.1</a>. Set LB State Request ...............................<a href="#page-30">30</a>
           <a href="#section-7.6.2">7.6.2</a>. Set LB State Reply .................................<a href="#page-32">32</a>
   <a href="#section-8">8</a>. Example of SASP Message Encoding ...............................<a href="#page-32">32</a>
   <a href="#section-9">9</a>. Protocol Flow ..................................................<a href="#page-37">37</a>
      <a href="#section-9.1">9.1</a>. Normal Protocol Flow ......................................<a href="#page-37">37</a>
      <a href="#section-9.2">9.2</a>. Behavior in Error Cases ...................................<a href="#page-39">39</a>
      9.3. Example Flow 1: Load Balancer Registration,
           Getting Weights, and Application-Side Quiescing ...........<a href="#page-41">41</a>
      9.4. Example Flow 2:  Set Load Balancer State, Application
           Registration, and Load Balancer Group DeRegistration ......<a href="#page-43">43</a>
      <a href="#section-9.5">9.5</a>. Avoiding Single Points of Failure .........................<a href="#page-44">44</a>




<span class="grey">Bivens                       Informational                      [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   <a href="#section-10">10</a>. Security Considerations .......................................<a href="#page-45">45</a>
   <a href="#section-11">11</a>. Normative References ..........................................<a href="#page-46">46</a>
   <a href="#appendix-A">Appendix A</a>. Acknowledgements ......................................<a href="#page-47">47</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Overview"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Overview</span>

   The Server/Application State Protocol is designed to enable load
   balancers or schedulers (1) to receive traffic weight recommendations
   from Workload Managers, (2) to register with Workload Managers
   members of load balancing/scheduling groups, and (3) to enable
   Workload Managers to suggest new load balancing group members to load
   balancers and schedulers

   The figure below shows where the SASP entities are in typical load
   balancing topology.

                                            ----------
                                            | Group  |
                                   --------&gt;|Member 1|&lt;--|
                                   |        ----------   |
                                   |                     |
     ---------        ----------   |        ----------   |
     |Request|&lt;------&gt;|  Load  |---|        | Group  |   |
     |Origins|&lt;------&gt;|Balancer|-----------&gt;|Member 2|&lt;--|
     ---------        |        |---|        ----------   |
                      ----------   |                     |
                          ^        |        ----------   |
                          |        --------&gt;| Group  |   |
                     SASP |                 |Member 3|&lt;--|
                    -------                 ----------   |
                    |                                    |
                    |      --------------------          |
                    |      |     Group        |     SASP |
                    ------&gt;| Workload Manager |&lt;----------
                           --------------------

                                 Figure 1

   SASP is a binary protocol that facilitates communication from load
   balancers/schedulers to Workload Managers.  The connection between
   the Group Workload Manager (GWM) and the load balancer/scheduler is
   expected to be a long-running TCP connection.  In SASP interactions,
   the GWM acts as a SASP server waiting to receive connections from the
   other SASP components.  Server port 3860 has been registered with the
   IANA for SASP communications.  It is expected that all SASP
   components are configured with the DNS name of the GWM to develop



<span class="grey">Bivens                       Informational                      [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   this connection.  Security in SASP is handled by transporting binary
   messages over Secure Socket Layer/Transport Layer Security (SSL/TLS).
   This document only describes the message format and protocol behavior
   above the connection and security layers.  Connection and security
   aspects including SSL's authentication and encryption will be
   implementation specific.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Identities"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Identities</span>

   SASP identifies a load balancer by a UTF-8 string called a "LB UID".
   A group of "equivalent" servers providing a service is identified by
   a UTF-8 string called a "Group Name", which is interpreted in the
   context of the LB UID.  A server is identified by its IP address and
   (optional) port and protocol numbers.  A GWM is only identified
   implicitly as the entity on the other end of the TCP connection from
   a load balancer or group member.  All of these identifiers are local;
   there are no globally unique identifiers.  The LB UID and GroupName
   fields are unstructured so that components could assign values to
   these fields that are meaningful to an administrator.  For example,
   in many cases, a load balancer would use the name an administrator
   provided for the serverfarm group as the groupname in a SASP-
   specified group.  Since the naming options in industry load balancers
   do not carry explicit naming restrictions, SASP naming options also
   carry no naming restrictions.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Requirements%20Notation"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Requirements Notation</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Conventions%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Conventions Used in This Document</span>

   o  Load Balancer - Entity responsible for distributing requests
      amongst the available members.

   o  Member - Machine, process, or application used to service
      requests.

   o  Group Workload Manager (GWM) - Entity responsible for reporting or
      managing a group of members on multiple machines.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20General%20Message%20Structure"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  General Message Structure</span>

   Any string interpreted by the group workload manager is assumed to
   use UTF8.  Components implementing SASP MUST support the printable
   ASCII subrepertoire of UTF8 (0x20-0x7E).  Components MAY also choose
   to provide support for additional UTF8 character encodings.  It is



<span class="grey">Bivens                       Informational                      [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   recommended that customers using SASP-enabled products configure the
   string-generating components (load balancers and group members) to
   use the same character repertoire.

   Many of the SASP structures involve the transfer of multi-byte
   integer values.  In all cases where multi-byte integer values are
   used, they are considered to be in network-byte order (big-endian).

   SASP is organized into several message components.  For extendibility
   and ease of processing, each message component is described in a TLV
   (Type, Length, Value) format.  An illustration of the SASP structure
   can be found in the example below.  The first section is the header
   followed by the message component type.  As mentioned, the header,
   message component, and all other components have a TLV format.  Each
   component value contains a variable number of fields, some of which
   refer to upcoming components (explained component descriptions are in
   upcoming sections).  After the first message component, any number of
   additional components may be included (as stipulated in the fields of
   the message type).

   -------------------------------------------------
   |            |T| Type (SASP Header Type)        |
   |    SASP    |----------------------------------|
   |   Header   |L| Length of SASP header TLV      |
   |            |----------------------------------|
   |            |V| Header fields                  |
   |-----------------------------------------------|
   |            |T| Type (Message Type)            |
   |  Message   |----------------------------------|
   |    Type    |L| Length of this Message Type TLV|
   | Component  |----------------------------------|
   |            |V| Component fields               |
   |-----------------------------------------------|
   |            |T| Type (Component Type)          |
   |            |----------------------------------|
   |Component-1 |L| Length of this TLV             |
   |            |----------------------------------|
   |            |V| Component fields               |
   |-----------------------------------------------|
   | ...                                           |
   |-----------------------------------------------|
   |            |T| Type (Component Type)          |
   |            |----------------------------------|
   |Component-n |L| Length of this TLV             |
   |            |----------------------------------|
   |            |V| Component fields               |
   -------------------------------------------------




<span class="grey">Bivens                       Informational                      [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


                                 Figure 2

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20TLV%20Structure"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  TLV Structure</span>

   An illustration of the TLV format is shown below.  The Type is a
   two-byte field containing a binary value for the component type.  The
   Length is a two-byte field containing the size of the TLV in bytes
   (including the Type and Length fields).  The Value field is a
   variable-length field that actually contains the data of the
   component.

   &lt; xxxx xxxx xxxx xxxx, xxxx xxxx xxxx xxxx, xxxx...........xxxx &gt;
     |-----------------|  |-----------------|  |-----------------|
        Type(2 bytes)       Length(2 bytes)      Value(variable)

                                 Figure 3

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Component%20Types"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Component Types</span>

   The TLV structure requires a type value for each protocol component.
   All SASP types are listed in this section.

      Reserved 0x0000-0x1000

      Message Types

         Registration Request 0x1010

         Registration Reply 0x1015

         DeRegistration Request 0x1020

         DeRegistration Reply 0x1025

         Get Weights Request 0x1030

         Get Weights Reply 0x1035

         Send Weights 0x1040

         Set Load Balancer State Request 0x1050

         Set Load Balancer State Reply 0x1055

         Set Member State Request 0x1060

         Set Member State Reply 0x1065




<span class="grey">Bivens                       Informational                      [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


      Utility Component Types

         SASP Header 0x2010

      Singular Component Types

         Member Data 0x3010

         Group Data 0x3011

         Weight Entry Data 0x3012

         Member State Instance 0x3013

      Group Component Types

         Group of Member Data 0x4010

         Group of Weight Entry Data 0x4011

         Group of Member State Data 0x4012

      Reserved 0xF000-0xFFFF

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20SASP%20Protocol%20Header"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  SASP Protocol Header</span>

   An illustration of the SASP Header is found in the table below.  It
   is expected that every message will start with the SASP Protocol
   Header component.

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   SASP header type (0x2010)   |       Size of this TLV        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    Version    |                     Message Length
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                      |                       Message ID
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                      |
      +-+-+-+-+-+-+-+-+

                                 Figure 4

   o  Version: The version of the protocol used in this message.






<span class="grey">Bivens                       Informational                      [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   o  Message Length: A 4-byte signed integer value representing the
      total length of the SASP message.  It is said to be a signed
      4-byte value to make any Java implementations easier (or any other
      implementations without unsigned values); however, no negative
      lengths are valid.

   o  Message ID: Each request message is given a 4-byte Message ID by
      the message originator, which is simply returned in the Message ID
      field of the reply.  This field is meant to assist the requester
      in correlating replies to the appropriate request when many
      requests have been sent.  In the Send Weights message (the only
      message transaction that has no reply), this field serves no
      purpose.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20Version%20Negotiation"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  Version Negotiation</span>

   To negotiate the version of the protocol used by the entities
   involved in the connection, the GWM views the version included in the
   load balancer request as the load balancer's proposed version.

   If the GWM supports the version proposed by the load balancer, it
   will respond to the connection with the appropriate response code and
   the load balancer's proposed version in the response header.  This
   proposed version should be the version used for all messages in this
   connection.

   If the GWM does not support the version proposed by the load
   balancer, the GWM will respond with a "message not understood"
   response code and the GWM's highest supported SASP version in the
   version field of the response header.  This is an indication for the
   load balancer to come down to GWM's SASP version level.




















<span class="grey">Bivens                       Informational                      [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Singular%20Protocol%20Components"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Singular Protocol Components</span>

   The most basic of SASP components are singular components because
   they describe a single instance of a member, member resource, member
   weight, or group.  Some of the SASP components reuse other SASP
   components.  When this is the case, any component being reused by a
   base component will simply be given immediately following the base
   component.  Some examples of this technique are seen and explained in
   the Weight Entry and Member State Instance components.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Member%20Data%20Component"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Member Data Component</span>

   The member data component describes a particular member and is
   referred to by other components.

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Member Data Type (0x3010)   |       Size of this TLV        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Protocol    |             Port              |               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +
      |                                                               |
      +                                                               +
      |                                                               |
      +                   IP Address of Member                        +
      |                                                               |
      +                                               +-+-+-+-+-+-+-+-+
      |                                               |  Label Length |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      .                                                               .
      .                          Label                                .
      .                                                               .
      |                                                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                 Figure 5

   o  Protocol: The assigned number of the IP transport layer used in
      the Protocol Field of the IP header.  These are defined in
      [<a href="rfc1700.html" title='"Assigned Numbers"'>RFC1700</a>]; however, a current list is maintained at
      <a href="http://www.iana.org/">http://www.iana.org</a>.
      for example: TCP = 0x06, UDP = 0x11, etc.







<span class="grey">Bivens                       Informational                      [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   o  Port: The port number used for communication to the member.
      *** A value of 0 can be given for the Protocol and Port to signify
      a system level member.  However, 0 shouldn't be perceived as a
      wildcard for either Port or Protocol fields (i.e., a
      deregistration request that includes a MemberData component with a
      0 for the port doesn't mean deregister all applications listening
      on any port of that IP and protocol).

   o  IP Address: The current format is described by the following 16
      bytes, where IPv4 addresses are represented as "IPv4-compatible
      IPv6 addresses" [<a href="rfc4291.html" title='"IP Version 6 Addressing Architecture"'>RFC4291</a>].  In the following example, the x's and
      zeros represent 4-bit hex values.  The x's describe arbitrary hex
      values.

         IPv4 Address: 00 00 00 00 00 00 00 00 00 00 00 00 xx xx xx xx

         IPv6 Address: xx xx xx xx xx xx xx xx xx xx xx xx xx xx xx xx

   o  Label length: The length, in bytes, of the label string to follow.

   o  Label: A UTF8 string that may be set while registering a member.
      This string is opaque to the GWM and is simply included with any
      correspondence containing the member data component.  Note that
      the size of this label is &lt;= 255 bytes.  Because UTF8 character
      encodings may be up to 6 bytes, care must be exercised by the load
      balancer or member to make sure the UTF8 string it sends the GWM
      is in fact &lt;= 255 bytes.
























<span class="grey">Bivens                       Informational                     [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Group%20Data%20Component"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Group Data Component</span>

   The group data component simply describes a group with which to
   associate other singular components.

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    Group Data Type (0x3011)   |       Size of this TLV        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | LB UID Length |                                               |
      +-+-+-+-+-+-+-+-+                                               +
      .                                                               .
      .                             LB UID                            .
      .                                                               .
      +                                               +-+-+-+-+-+-+-+-+
      |                                               |Group Name Len |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                          Group Name                           .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                 Figure 6

   o  LB UID Length: Length of the LB UID to follow (in bytes).

   o  LB UID: A UTF8 string used as a unique identifier and a context
      for the Group Name (e.g., a UTF8 representation of the MAC address
      of the load balancer or some type of Universally Unique Identifier
      (UUID)).  This string is used by the Group Workload Manager to
      associate application registration and deregistration, and to set
      state messages with the correct load balancer.  This unique
      identifier should not be any longer than 64 bytes.

   o  Group Name Len: Length of the Group Name field to follow (in
      bytes).

   o  Group Name: A UTF8 string the load balancer has chosen to tell the
      Group Workload Manager that members being registered with this
      Group Name are equivalent in function.  In Get Weight and
      DeRegistration messages, the Group Name may be omitted (Group Name
      Length = 0) to indicate all groups from the associated load
      balancer.







<span class="grey">Bivens                       Informational                     [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Weight%20Entry%20Data%20Component"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Weight Entry Data Component</span>

   The Weight Entry Component is used by the get and send weight
   messages to associate a weight with a particular member (or Member
   Data).  It also uses an opaque member state field and a general
   member flags field to denote extra information about a member
   (described below).  When the Weight Entry component is used, the
   Member Data TLV it refers to is listed first, immediately followed by
   the Weight Entry TLV.

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Member Data Type (0x3010)   | Size of this Member Data TLV  |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      Member Data Fields                       .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Weight Entry Type (0x3012)  | Size of this Weight Entry TLV |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  State Field  |  Flags Field  |             Weight            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                 Figure 7

   o  State Field: This field is used by the member to communicate state
      information to the scheduler.  The information placed in this
      field is opaque to the GWM and will simply be forwarded to the
      scheduler with the member weights.  There are no defined values
      for this field.

   o  Flags Field: This field has several flag values that describe
      several attributes of the member.

      A.  Contact Success Flag (set by the GWM): describes whether the
          member is currently running.  If the contact success flag is
          off, this member should be avoided by the load balancer.

          +  xxxx xxx1 The GWM has located this running system or
             application.

          +  xxxx xxx0 The GWM has not located this running system or
             application.

      B.  Quiesce Flag (set by the load balancer or Member): used when
          an administrator would like to temporarily remove a member
          from the weight calculation, but not deregister it from the



<span class="grey">Bivens                       Informational                     [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


          group.  When quiesced, the member will still show up in the
          weights, but the quiesce flag will be set, and its weight will
          be zero.  When the administrator returns this member to
          active, the quiesce flag will be 0, and a weight will be
          provided.  If the quiesce flag is on, this member should be
          avoided by the load balancer.

          +  xxxx xx1x The member is quiesced.

          +  xxxx xx0x The member is active (not quiesced).

      C.  Registration Flag (set by the GWM): stores how the member was
          registered.

          +  xxxx x1xx This member has been registered by the load
             balancer/scheduler.

          +  xxxx x0xx This member has registered itself.

      D.  Confident Flag (set by the GWM): describes whether the GWM has
          knowledge of this member's state.  If this flag is off for
          only some of the members in the group while the remaining
          members have valid weights, the load balancer should avoid
          sending work to those members with the confident flag off.  If
          the confident flag is off for all valid group members, the
          load balancer should disregard any recommendation from the GWM
          until the confident flag comes back on for at least one
          member.  In this case where all confident flags are off, the
          load balancer should determine the correct distribution of
          work by other means (perhaps a different advisor, previously
          configured static weights, etc.).

          The goal of the confident flag is to convey to the load
          balancer that it should look to other methods of distribution
          recommendations if the GWM cannot give recommendations for any
          of the valid group members.  If some members of the group have
          the confident flag on but the contact flag off or the quiesced
          flag on (meaning these members should always be avoided) while
          the remaining members of the group have their confident flag
          off, the load balancer should determine the appropriate
          distribution of work for those members with the confident flag
          off by other means.

          +  xxxx 1xxx GWM has determined it has knowledge of the state
             of this member.

          +  xxxx 0xxx GWM has no knowledge of the state of this member.




<span class="grey">Bivens                       Informational                     [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


      E.  Leftmost four bits are reserved (0000 xxxx - 1111 xxxx).

   o  Weight: This field represents the GWM's recommendation for the
      relative amount of work that should be sent to this member.  This
      is a 16-bit field with a possible range of 0 to 65536.  Load
      balancers should be prepared to receive a wide range of weight
      values.  Load balancers with limited maximum weight values may
      restrict the granularity of management by the GWM and in turn
      cause less than optimal performance.  Many existing
      implementations have supported a minimum raw weight range from 0
      to 100.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.4.%20%20Member%20State%20Instance%20Component"></a><a class="selflink" href="#section-5.4" name="section-5.4">5.4</a>.  Member State Instance Component</span>

   The Member State Instance Component is used by the set member state
   message to indicate the sender's perceived state of the member
   mentioned.  This component is used to set values that will ultimately
   end up in the WeightEntry component.  When the Member State Instance
   component is used, the Member Data TLV it refers to is listed first,
   immediately followed by the Member State Instance TLV.

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Member Data Type (0x3010)   | Size of this Member Data TLV  |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      Member Data Fields                       .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Member State Instance(0x3013) | Size of Member State Inst TLV |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  State Field  |  Flags Field  |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                 Figure 8

   o  State Field: This field is used by the member to communicate state
      information to the load balancer or scheduler.  There are no
      defined values for this field.

   o  Flags Field: This field describes attributes of the member.
      Currently the only flag value defined is that of the quiesce flag.
      The quiesce flag is used when an administrator would like to
      temporarily remove a member from the weight calculation, but not
      deregister it from the group.  When quiesced, the member will
      still show up in the weights, but the quiesce flag will be set,




<span class="grey">Bivens                       Informational                     [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


      and its weight will be zero.  When the administrator returns this
      member to active, the quiesce flag will be 0, and a weight will be
      provided.

      A.  Quiesce Flag

          +  xxxx xxx1 The member or load balancer setting this state is
             quiescing this member.

          +  xxxx xxx0 The member or load balancer setting this state is
             placing the member in a non-quiesced state.

      B.  Leftmost seven bits are reserved (0000 000x - 1111 111x).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Group%20Protocol%20Components"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Group Protocol Components</span>

   Group protocol components each contain a collection of related
   singular components.  In particular, they associate Member Data,
   Weight Entry, or Member State Instance components to a particular
   Group Data component.  In these cases, the particular "Group of x"
   component will be immediately followed by the Group Data component.
   The Group Data component will be immediately followed by any number
   of singular components the group contains.  In figures listed in this
   document, a component type with an asterisk denotes a component that
   is repeated a number of times.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Group%20of%20Member%20Data%20Component"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Group of Member Data Component</span>

   The "group of member data" component describes a particular group of
   members and is used in the registration message components.

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Group of Member Data (0x4010) | Size of GroupOfMemberData TLV |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |        Member Count           |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
      .                                                               .
      .                        Group Data TLV                         .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .               *Array of Member Data Components              .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                 Figure 9



<span class="grey">Bivens                       Informational                     [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   o  Member Count: The number of Member Data Components immediately
      following the Group Data structure.

   o  Array of Member Data Components: There will be as many Member Data
      TLVs as Member Count has specified.  A load balancer/scheduler
      would use these components to pass information that would enable
      the Group Workload Manager to identify the members to associate
      with this Group Name.  The Member Data Component was described in
      <a href="#section-5.1">Section 5.1</a>.  In DeRegistration messages, the Member Count may be
      set to 0 to indicate all members of a particular group.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Group%20of%20Weight%20Data%20Component"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Group of Weight Data Component</span>

   The "Group of Weight Data" Component is used by the get and send
   weight messages to create a list of Weight Entry Components for a
   particular group.

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Group Weight Entry Type(0x4011)| Size of GroupOfWeightEntry TLV|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     Weight Entry Count        |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
      .                                                               .
      .                        Group Data TLV                         .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .              *Array of Weight Entry Data Components           .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                 Figure 10

   o  Weight Entry Count: The number of Member Data / Weight Entry
      combinations to follow the Group Data TLV.

   o  Array of Weight Entry Data TLVs: There will be as many [Member
      Data / Weight Entry] TLVs as Weight Entry Count has specified.
      Each Weight Entry component is preceded by its corresponding
      Member Data component as explained in <a href="#section-5.3">Section 5.3</a>.  This Member
      Data / Weight Entry data combination will repeat to form as many
      Weight Entry items as the Weight Entry Count specifies.







<span class="grey">Bivens                       Informational                     [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20Group%20of%20Member%20State%20Data%20Components"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  Group of Member State Data Components</span>

   The "group of member state data" component describes a particular set
   of members and their corresponding state fields used in the Set
   Member State messages.

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Group Weight Entry Type(0x4011)| Size of GroupOfWeightEntry TLV|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Member State Instance Count  |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
      .                                                               .
      .                        Group Data TLV                         .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .            *Array of Member State Data Components             .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                 Figure 11

   o  Member State Instance Count: The number of Member Data / Member
      State Instance combinations following the Group Data component.

   o  Array of Member State Data Components: Each Member State Instance
      component is immediately preceded by its corresponding Member Data
      component as explained in <a href="#section-5.4">Section 5.4</a>.  This Member Data / Member
      State Instance combination will repeat to form as many Member
      State items as the Member State Instance Count specifies.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Protocol%20Messages"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Protocol Messages</span>

   SASP messages are a collection of TLVs (Type, Length, and Value
   components).  The header has no information as to what type of
   message it is part of; the purpose-specific information is in the
   message component.  This format could facilitate placing more than
   one message component in a single message; however, this use of
   multiple message components is not supported in every GWM and could
   produce indeterminate behavior.  Similar to the other protocol
   components, when a message component needs to involve other
   components, the additional components immediately follow the message
   component.






<span class="grey">Bivens                       Informational                     [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   All SASP requests sent to the GWM will be acknowledged with a reply.
   The reply contains information requested as well as a single-byte
   response code describing the success of the request.  SASP defines
   some general response codes in the range of 0x00 - 0x3F that may be
   used regardless of the response message type.  However, some request
   types may cause specific error conditions not covered by the general
   response codes.  The response code range of 0x40 - 0xFF is used for
   these message-specific response codes.  Any given SASP response will
   only contain one response code (depending on the error type).  This
   section explains the format and purpose of specific SASP messages.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Registration%20Request%20and%20Reply"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Registration Request and Reply</span>

   This exchange happens between the load balancer/scheduler and the
   Group Workload Manager as well as between the Group Workload Manager
   and the member to register the members in a group specified by Group
   Name.  Applications are identified with an IP address, Protocol, and
   Port.  Systems are identified only with an IP Address (Port = 0x0000
   and Protocol = 0x00).  All members in a group have equivalent
   functionality, so the Group Workload Manager can direct routers, load
   balancers, and schedulers to any member in the group.  Even though
   registrations can come from either the load balancer/scheduler or the
   actual member, member-initiated registrations will only be considered
   if the Trust flag is set while the state of the load
   balancer/scheduler is set.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.1.1.%20%20Registration%20Request"></a><a class="selflink" href="#section-7.1.1" name="section-7.1.1">7.1.1</a>.  Registration Request</span>

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      SASP Header TLV                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Registration Req. Type(0x1010)| Size of Registration Req. TLV |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Flag Field  |   Group of Member Data Count  |               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +
      .                                                               .
      .           *Array of Group of Member Data Components           .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   *There will be as many Group of Member Data Components as "Group of
   Member Data Count" has specified.

                                 Figure 12



<span class="grey">Bivens                       Informational                     [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   o  Flag Field

      A.  Load Balancer Flag

          +  xxxx xxx1 The entity sending this message is the load
             balancer.

          +  xxxx xxx0 The entity sending this message is an
             Application.

      B.  Leftmost seven bits are reserved (0000 000x - 1111 111x).

   o  Group of Member Data Count: The number of "Group of Member Data"
      components immediately following the Registration Request
      component.

   o  Array of Group of Member Data Components: Each "Group of Member
      Data" component is immediately followed by Group Data Components
      and its Member Data components (as described in <a href="#section-6.1">Section 6.1</a>).  In
      the case where several of these "Group of Member Data" components
      may be present, the second "Group of Member Data" component only
      appears after all of the internal components that are referred to
      by the first "Group of Member Data" component are listed.  The
      format is the same for all subsequent "Group of Member Data"
      components in the message.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.1.2.%20%20Registration%20Reply"></a><a class="selflink" href="#section-7.1.2" name="section-7.1.2">7.1.2</a>.  Registration Reply</span>

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      SASP Header TLV                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Registration Reply Type(0x1015)| Size of Registration Reply TLV|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Return Code  |
      +-+-+-+-+-+-+-+-+

                                 Figure 13

   o  General SASP return codes (0x00 - 0x3F)

      *  0x00 Successful

      *  0x10 Message not understood




<span class="grey">Bivens                       Informational                     [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


      *  0x11 GWM will not accept this message from the sender.  Reasons
         for this include the following:
         a. The message was not sent by a LB and trust flag is off
         b. LB attempted to address members of a different LB in the
            message
         c. Vendor specific criteria for this message type were not met.

   o  Message-Specific return codes (0x40 - 0xFF)

      *  0x40 Member already registered

      *  0x44 Duplicate Member in Request

      *  0x45 Invalid Group (determined by the GWM)

      *  0x50 Invalid Group Name Size (size == 0)

      *  0x51 Invalid LB UID Size (size == 0 or &gt; max)

      *  0x61 Member is registering itself, but LB hasn't yet contacted
         the GWM.  This registration will not be processed.

   **The Invalid Group error return code refers to the LB or member
   attempting to form a group that the GWM considers invalid.  For
   example, some GWM vendors may not support the registration of both
   System and Application members in the same group.  To determine what
   can cause a GWM to return this error code, the vendor's documentation
   must be consulted.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20DeRegistration%20Request%20and%20Reply"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  DeRegistration Request and Reply</span>

   This exchange happens between the load balancer/scheduler and the
   Group Workload Manager as well as between the Group Workload Manager
   and the Member to deregister members from a group specified by Group
   Name with the Group Workload Manager.  Even though deregistrations
   can come from either the load balancer/scheduler or the actual
   member, member-initiated deregistrations will only be considered if
   the Trust flag is set with a Set LB State message.













<span class="grey">Bivens                       Informational                     [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.2.1.%20%20DeRegistration%20Request"></a><a class="selflink" href="#section-7.2.1" name="section-7.2.1">7.2.1</a>.  DeRegistration Request</span>

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      SASP Header TLV                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |DeRegistration Req.Type(0x1020)|Size of DeRegistration Req. TLV|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Flag Field  |     Reason    |   Group of Member Data Count  |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .           *Array of Group of Member Data Components           .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   *There will be as many Group of Member Data Components as "Group of
   Member Data Count" has specified.

                                 Figure 14

   o  Flag Field

      A.  Load Balancer Flag

          +  xxxx xxx1 The entity sending this message is the load
             balancer.

          +  xxxx xxx0 The entity sending this message is an
             Application.

      B.  Leftmost seven bits are reserved (0000 000x - 1111 111x).

   o  Reason: Byte describing the reason for deregistering the group or
      instance.

      A.  SASP-defined Reason Codes (0x00-0x7F)

          +  0x00 No reason given.

          +  0x01 Learned and Purposeful, i.e., a human has deconfigured
             this member from the load balancer configuration.

          +  0x80-0xFF Open for vendor specific deregistration reason
             codes.




<span class="grey">Bivens                       Informational                     [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   o  Group of Member Data Count: The number of "Group of Member Data"
      components immediately following the DeRegistration Request
      component.

   o  Array of Group of Member Data Components: Each "Group of Member
      Data" component is immediately followed by Group Data Components
      and its Member Data components (as described in <a href="#section-6.1">Section 6.1</a>).  In
      this case, where several of these "Group of Member Data"
      components may be present, the second "Group of Member Data"
      component only appears after all of the internal components that
      are referred to by the first "Group of Member Data" component are
      listed.  The format is the same for all subsequent "Group of
      Member Data" components in the message.

   ** If Member Count equals zero in the Group of Member Data component,
   the Group Workload Manager will deregister the entire group.

   ** Recall that the Group Data Component contains both a Unique LB
   Identifier field and a Group Name field.  If the Group Data component
   has no Group Name (GroupData's Group Name Length==0), the Group
   Workload Manager will deregister all groups associated with this load
   balancer.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.2.2.%20%20DeRegistration%20Reply"></a><a class="selflink" href="#section-7.2.2" name="section-7.2.2">7.2.2</a>.  DeRegistration Reply</span>

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      SASP Header TLV                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   DeReg. Reply Type(0x1025)   |    Size of DeReg. Reply TLV   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Return Code  |
      +-+-+-+-+-+-+-+-+

                                 Figure 15

   o  Return Code: A byte return code indicating the status of action
      taken.

      A.  General SASP return codes (0x00 - 0x3F)

          +  0x00 Successful

          +  0x10 Message not understood




<span class="grey">Bivens                       Informational                     [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


          +  0x11 GWM will not accept this message from the sender.
             Reasons for this include the following:
             a. The message was not sent by a LB and trust flag is off
             b. LB attempted to address members of a different LB in the
                message
             c. Vendor specific criteria for this message type were not
                met.

      B.  Message-Specific return codes (0x40 - 0xFF)

          +  0x41 Application or System not registered

          +  0x42 Unknown Group Name

          +  0x43 Unknown LB UID

          +  0x44 Duplicate Member in Request

          +  0x46 Duplicate Group in Request (for remove all
             members/groups requests)

          +  0x51 Invalid LB UID Size (size == 0 or &gt; max)

          +  0x61 Member is deregistering itself, but LB hasn't yet
             contacted the GWM.  This deregistration will not be
             processed.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.3.%20%20Get%20Weights%20Request%20and%20Reply"></a><a class="selflink" href="#section-7.3" name="section-7.3">7.3</a>.  Get Weights Request and Reply</span>

   This exchange happens between the load balancer/scheduler and the
   Group Workload Manager to get weights for the groups specified in the
   list of GroupData objects.  In the case of application load balancing
   (balancing workloads between applications with the same
   functionality), the load balancer would call the Group Workload
   Manager every Interval (parameter returned by the Group Workload
   Manager below) to get an array of weights and associated members
   (e.g., Application1 20, SecondCopyOfApplication 30,
   ThirdCopyOfApplication 5).  The load balancer then uses these weights
   to determine the fashion in which work will be sent to each of the
   members.  For example, in the case of weighted round robin, the load
   balancer/scheduler would then send a request to Application1, the
   next to SecondCopyOfApplication, and the next to
   ThirdCopyOfApplication.  After 15 requests, the load
   balancer/scheduler would only send work to Application1 and
   SecondCopyOfApplication.  After an additional 30 requests, the load
   balancer/scheduler would only send requests to
   SecondCopyofApplication.  After another 10 requests, the load
   balancer/scheduler product would start over using the weights of 20,



<span class="grey">Bivens                       Informational                     [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   30, and 5 again; or if the Interval number of seconds have passed,
   the load balancer/scheduler would get a new set of weights.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.3.1.%20%20Get%20Weights%20Request"></a><a class="selflink" href="#section-7.3.1" name="section-7.3.1">7.3.1</a>.  Get Weights Request</span>

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      SASP Header TLV                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Get Weights Req. Type(0x1030) |  Size of Get Weights Req. TLV |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |        Group Data Count       |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
      .                                                               .
      .                   *Array of Group Data Components             .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   *There will be as many Group Data Components as "Group Data Count"
   has specified.

                                 Figure 16

   o  Group Data Count: The number of "Group Data" components
      immediately following the Get Weights Request TLV.

   o  Array of Group Data Components: This array of Group Data
      Components lists the groups for which the load balancer wants to
      get weights.

   ** If there is no group name in the Group Data structure of the Get
   Weights Request, the load balancer is requesting weights for all
   groups registered for the load balancer.















<span class="grey">Bivens                       Informational                     [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.3.2.%20%20Get%20Weights%20Reply"></a><a class="selflink" href="#section-7.3.2" name="section-7.3.2">7.3.2</a>.  Get Weights Reply</span>

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      SASP Header TLV                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Get Weights Reply Type(0x1035)| Size of Get Weights Reply TLV |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Return Code  |            Interval           | Group of Weight
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      Entry Data Count|                                               |
      +-+-+-+-+-+-+-+-+                                               +
      .                                                               .
      .             *Group of Weight Entry Data Components            .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   * There will be as many Group of Weight Entry Data Components as
   "Group of Weight Entry Data Count" has specified.

                                 Figure 17

   o  Return Code: A byte return code indicating the status of action
      taken.

      A.  General SASP return codes (0x00 - 0x3F)

          +  0x00 Successful

          +  0x10 Message not understood

          +  0x11 GWM will not accept this message from the sender.
             Reasons for this include the following:
             a. LB attempted to address members of a different LB in the
                message
             b. Vendor specific criteria for this message type were not
                met.

      B.  Message-Specific return codes (0x40 - 0xFF)

          +  0x42 Unknown Group Name

          +  0x43 Unknown LB UID

          +  0x46 Duplicate Group in Request



<span class="grey">Bivens                       Informational                     [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


          +  0x51 Invalid LB uid Size (size == 0 or &gt; max)

   o  Interval: These two bytes indicate a recommended polling interval
      for the load balancer to use.  The Group Workload Manager is
      stating that any polling interval smaller than the suggested
      interval would probably retrieve values before they have had a
      chance to change.

   o  Group of Weight Entry Data Components: Each "Group of Weight Data"
      component is immediately followed by Group Data Components and its
      Weight Entry Data components (as described in <a href="#section-6.2">Section 6.2</a>).  In
      this case, where several "Group of Weight Data" components may be
      present, the second "Group of Weight Data" component only appears
      after all of the internal components that are referred to by the
      first "Group of Weight Data" component are listed.  The format is
      the same for all subsequent "Group of Weight Data" components in
      the message.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.4.%20%20Send%20Weights"></a><a class="selflink" href="#section-7.4" name="section-7.4">7.4</a>.  Send Weights</span>

   This exchange happens between the Group Workload Manager and the load
   balancer/scheduler to send the new weights for the group specified in
   Group Name.  This message is unique in that it is the only message
   exchange initiated by the Group Workload Manager and the only message
   that has no reply.  In the case of application load balancing
   (balancing workloads between applications with the same
   functionality), the Group Workload Manager would message the load
   balancer at a possibly dynamic interval (chosen by the Group Workload
   Manager) to send an array of weights and associated members (e.g.,
   Application1 20, SecondCopyOfApplication 30, ThirdCopyOfApplication
   5).  The load balancer then uses these weights to determine the
   fashion in which work will be sent to each of the members.  For
   example, in the case of weighted round robin, the load
   balancer/scheduler would then send a request to Application1, the
   next to SecondCopyOfApplication, and the next to
   ThirdCopyOfApplication.  After 15 requests, the load
   balancer/scheduler would only send work to Application1 and
   SecondCopyOfApplication.  After another 30 requests, the load
   balancer/scheduler would only send requests to
   SecondCopyofApplication.  After an additional 10 requests, the load
   balancer/scheduler product would start over using the weights of 20,
   30, and 5 again, if it has not yet received a new set of weights.
   The Group Workload Manager only sends this message if the Push flag
   has been enabled using a Set Load Balancer State message.







<span class="grey">Bivens                       Informational                     [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      SASP Header TLV                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    Send Weights Type(0x1040)  |    Size of Send Weights TLV   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Group of Weight Data Count   |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
      .                                                               .
      .             *Group of Weight Entry Data Components            .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   * There will be as many Group of Weight Entry Data Components as
   "Group of Weight Data Count" has specified.

                                 Figure 18

   o  Group of Weight Entry Data Components: Each "Group of Weight Data"
      component is immediately followed by Group Data Components and its
      Weight Entry Data components (as described in <a href="#section-6.2">Section 6.2</a>).  In
      this case, where several "Group of Weight Data" components may be
      present, the second "Group of Weight Data" component only appears
      after all of the internal components that are referred to by the
      first "Group of Weight Data" component are listed.  The format is
      the same for all subsequent "Group of Weight Data" components in
      the message.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.5.%20%20Set%20Member%20State%20Request%20and%20Reply"></a><a class="selflink" href="#section-7.5" name="section-7.5">7.5</a>.  Set Member State Request and Reply</span>

   This is a special exchange that can take place between the load
   balancer and the Group Workload Manager or between the Member and the
   Group Workload Manager to pass information about the state of the
   member including placing the member in quiesced or non-quiesced
   states.  In particular, the load balancer/scheduler can use this
   message to quiesce a set of members.  Members can also use this
   message to quiesce themselves as well as to pass certain state
   information to the load balancer/scheduler that is opaque to the
   Group Workload Manager.  This opaque state information is passed to
   the load balancer/scheduler with the weights during get and send
   weight messages.







<span class="grey">Bivens                       Informational                     [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.5.1.%20%20Set%20Member%20State%20Request"></a><a class="selflink" href="#section-7.5.1" name="section-7.5.1">7.5.1</a>.  Set Member State Request</span>

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      SASP Header TLV                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |SetMemberState Req.Type(0x1060)|Size of SetMemberState Req. TLV|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Flag Field  | Group of MemberStateData Count|               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +
      .                                                               .
      .        *Array of Group of Member State Data Components        .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   *There will be as many Group of Member State Data Components as
   "Group of Member State Data Count" has specified.

                                 Figure 19

   o  Flag Field

      A.  Load Balancer Flag

          +  xxxx xxx1 The entity sending this message is the load
             balancer.

          +  xxxx xxx0 The entity sending this message is an
             Application.

      B.  Leftmost seven bits are reserved (0000 000x - 1111 111x).

   o  Group of Member State Data Count: The number of "Group of Member
      State Data" components immediately following the Set Member State
      Request TLV.

   o  Array of Group of Member Data Components: Each "Group of Member
      State Data" component is immediately followed by Group Data
      Components and its Member State Instance components (as described
      in <a href="#section-6.3">Section 6.3</a>).  In the case where several "Group of Member State
      Data" components may be present, the second "Group of Member State
      Data" component only appears after all of the internal components
      that are referred to by the first "Group of Member State Data"
      component are listed.  The format is the same for all subsequent
      "Group of Member State Data" components in the message.



<span class="grey">Bivens                       Informational                     [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.5.2.%20%20Set%20Member%20State%20Reply"></a><a class="selflink" href="#section-7.5.2" name="section-7.5.2">7.5.2</a>.  Set Member State Reply</span>

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      SASP Header TLV                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Set Member State Reply(0x1025)|Size of SetMemberStateReply TLV|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Return Code  |
      +-+-+-+-+-+-+-+-+

                                 Figure 20

   o  Return Code: A byte return code indicating the status of action
      taken.

      A.  General SASP return codes (0x00 - 0x3F)

          +  0x00 Successful

          +  0x10 Message not understood

          +  0x11 GWM will not accept this message from the sender.
             Reasons for this include the following:
             a. The message was not sent by a LB and trust flag is off
             b. LB attempted to address members of a different LB in the
                message
             c. Vendor specific criteria for this message type were not
                met.

      B.  Message-Specific return codes (0x40 - 0xFF)

          +  0x41 Application or System not registered

          +  0x42 Unknown Group Name

          +  0x43 Unknown LB UID

          +  0x44 Duplicate Member in Request

          +  0x46 Duplicate Group in Request

          +  0x50 Invalid Group Name Size (size == 0)

          +  0x51 Invalid LB UID Size (size == 0 or &gt; than max)



<span class="grey">Bivens                       Informational                     [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


          +  0x61 Member is setting state for itself, but LB hasn't yet
             contacted the GWM.  This request will not be processed.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.6.%20%20Set%20Load%20Balancer%20State%20Request%20and%20Reply"></a><a class="selflink" href="#section-7.6" name="section-7.6">7.6</a>.  Set Load Balancer State Request and Reply</span>

   This is an exchange that can take place between the load balancer and
   the Group Workload Manager to pass information about the state (and
   partial configuration) of the load balancer.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.6.1.%20%20Set%20LB%20State%20Request"></a><a class="selflink" href="#section-7.6.1" name="section-7.6.1">7.6.1</a>.  Set LB State Request</span>

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      SASP Header TLV                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Set LB State Req. Type (0x1050)| Size of Set LB State Req. TLV |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | LB UID Length |                                               |
      +-+-+-+-+-+-+-+-+                                               +
      .                                                               .
      .                             LB UID                            .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    LB Health  |    LB Flags   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                 Figure 21

   o  LB UID Length: one-byte length field describing the size of the
      following LB UID.

   o  LB UID: This should be the same unique identifier given when
      registering group members for this particular load balancer.

   o  LB Health: This field gives the load balancer a chance to pass in
      a metric describing its own health or state.

         0x00 - 0x7F Least Healthy - Most Healthy

         0x80 - 0xFF Reserved

   o  LB Flags:

      A.  Push Flag




<span class="grey">Bivens                       Informational                     [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


          +  xxxx xxx1 The load balancer should receive weights through
             the Send Weights message (GWM pushes weights to load
             balancer).  Even if this flag is set, the GWM must still
             respond accordingly to any Get Weights messages from the
             load balancer.

          +  xxxx xxx0 The load balancer will send a Get Weights message
             to get the new weights.  This is the default behavior.
             (load balancer pulls weights from GWM).

      B.  Trust Flag

          +  xxxx xx1x Trust any member-initiated registration,
             deregistration, or set state message.  Immediately reflect
             the registration, deregistration, or new state in the
             weights sent.

          +  xxxx xx0x Do not trust any member-initiated registration,
             deregistration, or set state message.  Registration,
             Deregistration, and State Setting of members can only occur
             from the load balancer.  Discard any member-initiated
             registration, deregistration, or set state message.  This
             is the default behavior.

      C.  No Change / No Send Flag

          +  xxxx x1xx The GWM must not include members whose weights
             and state (i.e., contact and quiesce flags) have not
             changed since they were last sent.

          +  xxxx x0xx The GWM must include the weights of all group
             members when sending the weights to this load balancer
             (including members whose weights and state have not
             changed).  This is the default behavior.

      D.  Leftmost five bits are reserved (0000 0xxx - 1111 1xxx).















<span class="grey">Bivens                       Informational                     [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.6.2.%20%20Set%20LB%20State%20Reply"></a><a class="selflink" href="#section-7.6.2" name="section-7.6.2">7.6.2</a>.  Set LB State Reply</span>

      0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                      SASP Header TLV                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Set LB State Reply (0x1025) | Size of Set LB State Reply TLV|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Return Code  |
      +-+-+-+-+-+-+-+-+

                                 Figure 22

   o  Return Code: A byte return code indicating the status of action
      taken.

      A.  General SASP return codes (0x00 - 0x3F)

          +  0x00 Successful

          +  0x10 Message not understood

          +  0x11 GWM will not accept this message from the sender.
             Reasons for this include the following:
             a. LB attempted to address the state of a different LB
             b. Vendor specific criteria for this message type were not
                met.

      B.  Message-Specific return codes (0x40 - 0xFF)

          +  0x51 Invalid LB UID Size (size == 0 or &gt; max)

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Example%20of%20SASP%20Message%20Encoding"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Example of SASP Message Encoding</span>

   This section provides an example of the actual SASP message encoding.
   For this example, we will look at a sample GetWeights Reply in which
   two webservers are registered to a serverfarm called FARM1.  The IP
   addresses of the two webservers are 10.10.10.1 and 10.10.10.2.
   Currently the GWM has a weight of 40 for 10.10.10.1 and 20 for
   10.10.10.2.  The load balancer has a unique Identifier of "LB1" and
   the message example was sent by the GWM in response to a request
   (MessageID: 0x32000000) for FARM1's weights.






<span class="grey">Bivens                       Informational                     [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   The TLVs necessary for this message are shown in the following list.

   1.  SASP Header TLV

   ------------------------------------
   | | Field   |  Size   |   Value    |
   |-----------|---------|------------|
   |T| Type    | 2 bytes | 0x2010     |
   |-----------|---------|------------|
   |L| Length  | 2 bytes | 0x000D     |
   |-----------|---------|------------|
   | | Version | 1 byte  | 0x01       |
   | |---------|---------|------------|
   |V| Mesg Len| 4 bytes | 0x0000 006A|
   | |---------|---------|------------|
   | | Mesg ID | 4 bytes | 0x3200 0000|
   ------------------------------------

                                   Figure 23

   2.  Get Weights Reply TLV

   ------------------------------------
   | | Field   |  Size   |   Value    |
   |-----------|---------|------------|
   |T| Type    | 2 bytes | 0x1035     |
   |-----------|---------|------------|
   |L| Length  | 2 bytes | 0x0009     |
   |-----------|---------|------------|
   | | RetCode | 1 byte  | 0x00       |
   | |---------|---------|------------|
   |V| Interval| 2 bytes | 0x0040     |
   | |---------|---------|------------|
   | |GWD Count| 2 bytes | 0x0001     |
   ------------------------------------
   *GWD Count = Group of Weight Data Count

                                   Figure 24













<span class="grey">Bivens                       Informational                     [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   3.  Group of Weight Data TLV

   ------------------------------------
   | | Field   |  Size   |   Value    |
   |-----------|---------|------------|
   |T| Type    | 2 bytes | 0x4011     |
   |-----------|---------|------------|
   |L| Length  | 2 bytes | 0x0006     |
   |-----------|---------|------------|
   |V| WE Count| 2 bytes | 0x0002     |
   ------------------------------------
   *WE Count = Weight Entry Count

                                   Figure 25

   4.  Group Data TLV

   ------------------------------------
   | | Field   |  Size   |   Value    |
   |-----------|---------|------------|
   |T| Type    | 2 bytes | 0x3011     |
   |-----------|---------|------------|
   |L| Length  | 2 bytes | 0x000E     |
   |-----------|---------|------------|
   | |LBUID len| 1 byte  | 0x03       |
   | |---------|---------|------------|
   | |  LBUID  | 3 bytes | "LB1" or   |
   | |         |         | 0x4C 42 31 |
   |V|---------|---------|------------|
   | |GroupName| 1 byte  | 0x05       |
   | | Length  |         |            |
   | |---------|---------|------------|
   | |  Group  |         | "FARM1" or |
   | |  Name   | 5 bytes | 0x46 41 52 |
   | |         |         |   4D 31    |
   ------------------------------------

                                   Figure 26













<span class="grey">Bivens                       Informational                     [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   5.  Member Data TLV

   ------------------------------------
   | | Field   |  Size   |   Value    |
   |-----------|---------|------------|
   |T| Type    | 2 bytes | 0x3010     |
   |-----------|---------|------------|
   |L| Length  | 2 bytes | 0x0018     |
   |-----------|---------|------------|
   | | Protocol| 1 byte  | 0x06       |
   | |---------|---------|------------|
   | |  Port   | 2 bytes | 0x0050     |
   | |---------|---------|------------|
   |V|   IP    |16 bytes | 0x0000 0000|
   | | Address |         |   0000 0000|
   | |         |         |   0000 0000|
   | |         |         |   0A0A 0A01|
   | |---------|---------|------------|
   | |Label Len| 1 byte  | 0x00       |
   | |---------|---------|------------|
   | |  Label  | 0 bytes |            |
   ------------------------------------

                                   Figure 27

   6.  Weight Entry Data TLV

   ------------------------------------
   | | Field   |  Size   |   Value    |
   |-----------|---------|------------|
   |T| Type    | 2 bytes | 0x3012     |
   |-----------|---------|------------|
   |L| Length  | 2 bytes | 0x0008     |
   |-----------|---------|------------|
   | | State   | 1 byte  | 0x00       |
   | |---------|---------|------------|
   |V| Flags   | 1 byte  | 0x0D       |
   | |---------|---------|------------|
   | | Weight  | 2 bytes | 0x0028     |
   ------------------------------------

                                   Figure 28









<span class="grey">Bivens                       Informational                     [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   7.  Member Data TLV

   ------------------------------------
   | | Field   |  Size   |   Value    |
   |-----------|---------|------------|
   |T| Type    | 2 bytes | 0x3010     |
   |-----------|---------|------------|
   |L| Length  | 2 bytes | 0x0018     |
   |-----------|---------|------------|
   | | Protocol| 1 byte  | 0x06       |
   | |---------|---------|------------|
   | |  Port   | 2 bytes | 0x0050     |
   | |---------|---------|------------|
   |V|   IP    |16 bytes | 0x0000 0000|
   | | Address |         |   0000 0000|
   | |         |         |   0000 0000|
   | |         |         |   0A0A 0A02|
   | |---------|---------|------------|
   | |Label Len| 1 byte  | 0x00       |
   | |---------|---------|------------|
   | |  Label  | 0 bytes |            |
   ------------------------------------

                                   Figure 29

   8.  Weight Entry Data TLV

   ------------------------------------
   | | Field   |  Size   |   Value    |
   |-----------|---------|------------|
   |T| Type    | 2 bytes | 0x3012     |
   |-----------|---------|------------|
   |L| Length  | 2 bytes | 0x0008     |
   |-----------|---------|------------|
   | | State   | 1 byte  | 0x00       |
   | |---------|---------|------------|
   |V| Flags   | 1 byte  | 0x0D       |
   | |---------|---------|------------|
   | | Weight  | 2 bytes | 0x0014     |
   ------------------------------------

                                   Figure 30

   A hex stream representing this same message is below:

      20 10 00 0D 01 00 00 00 6A 32 00 00 00 10 35 00 09 00 00 40

      00 01 40 11 00 06 00 02 30 11 00 0E 03 4C 42 31 05 46 41 52



<span class="grey">Bivens                       Informational                     [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


      4D 31 30 10 00 18 06 00 50 00 00 00 00 00 00 00 00 00 00 00

      00 0A 0A 0A 01 00 30 12 00 08 00 0D 00 28 30 10 00 18 06 00

      50 00 00 00 00 00 00 00 00 00 00 00 00 0A 0A 0A 02 00 30 12

      00 08 00 0D 00 14

   (106 bytes)

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Protocol%20Flow"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Protocol Flow</span>

   This section describes the expected general flow of the SASP
   messages.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Normal%20Protocol%20Flow"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Normal Protocol Flow</span>

   SASP first starts with a connection from an LB to the GWM.  This is
   expected to be a long-running connection and will be used for many
   messages.  After establishing the connection, the LB either registers
   a group of members or sets a Trust flag to allow the members to
   register themselves.  The Trust flag is set using a Set LB State
   Request (both message flows are shown below).

   Registration from load balancer

   ------------  Registration Request  ------------------
   |          |-----------------------&gt;|                |
   |   Load   |                        | Group Workload |
   | Balancer |  Registration Reply    |     Manager    |
   |          |&lt;-----------------------|                |
   ------------                        ------------------

   Set LB State from load balancer

   ------------  Set LB State Request  ------------------
   |          |-----------------------&gt;|                |
   |   Load   |                        | Group Workload |
   | Balancer |  Set LB State Reply    |     Manager    |
   |          |&lt;-----------------------|                |
   ------------                        ------------------

                                 Figure 31








<span class="grey">Bivens                       Informational                     [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   The connection can start with other requests, but any other request
   would likely result in an error (unless this connection is a
   reconnection that has happened a short period of time after the
   original connection).  For example, if the load balancer issues a
   deregistration request as its first message, it will receive an error
   because it has not registered any groups.

   The load balancer always drops all state information after a loss of
   connection and can recover it using a GetWeights message.  The
   establishment of a new connection causes the GWM to assume that the
   old one is broken.  In this case, the GWM will keep all state for the
   load balancer for a limited time after a detected break.  After the
   limited time has expired, all state for the broken connection will be
   discarded by the GWM.

   Registration of group members may be done at any time.  A load
   balancer can register anywhere from one group with one member to many
   groups of many members.  The member may also register itself if the
   Trust flag has been set and it knows the appropriate load balancer
   information.  Registrations will add to groups that already exist,
   but return errors if any of the registered members already exist.

   In the case of system load balancing, the representation of a member
   is only the member's IP address with a 0 used as the value for the
   port and protocol.  In the case of application load balancing, the
   representation of a member is the member's IP address and the
   Application's port and protocol.

   Deregistration of group members may be done at any time.  A load
   balancer can deregister anywhere from one group with one member to
   many groups of many members.  The LB may also deregister entire
   groups or deregister all of its groups at once.  The member may also
   deregister itself if the Trust flag has been set and it knows the
   appropriate load balancer information.

   Once members are registered, the GWM will start the monitoring and
   weight computation processes to determine weights to be sent back to
   the load balancer.  At any time the load balancer may issue a
   GetWeights message and ask for the weights for members in a
   particular group.  The LB may also set a flag telling the GWM to send
   the weights without waiting for the GetWeights message.  If this flag
   is set, the GWM will send the weights at an interval it feels is
   appropriate (the interval could change depending on the algorithm
   used and variance of the weights generated).

   At any time the LB or a particular member may quiesce the member
   through the use of a SetMemberState message.  In this case, the
   member's weight will always be zero, and the quiesce flag will be



<span class="grey">Bivens                       Informational                     [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   turned on when sending its weight.  Members may also use this message
   to send an opaque state value that will also be presented when
   sending weights.

   At any time, the load balancer may choose to send the GWM a
   SetLBState request to configure its interaction.  The message allows
   the load balancer to set the Push, Trust, and NoChange_NoSend flags.
   It also allows the load balancer to pass a health value to the GWM to
   be displayed.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Behavior%20in%20Error%20Cases"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Behavior in Error Cases</span>

   While behaviors in many error conditions will be product specific,
   the following error cases should have the following expected
   behavior.


   Case:  The protocol is violated in an unrecoverable manner by either
      end of the connection.

   Behavior:  Either end of the connection may choose to disconnect to
      avoid future message synchronization problems.  The state kept
      when disconnected is vendor specific.


   Case:  LB or application attempts to connect to the GWM before the
      GWM is fully up and running.

   Behavior:  The LB or application should wait at least 20 seconds to
      retry the connection.


   Case:  Members attempt to register or deregister themselves before
      the LB develops the connection with the GWM.

   Behavior:  In this case, the members would receive a reply with an
      error code signifying that there is no LB registered with that LB
      UID.


   Case:  Member registers or deregisters for an LB who has not set the
      Trust flag.

   Behavior:  GWM will send Member a reply containing an error code.







<span class="grey">Bivens                       Informational                     [Page 39]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-40" id="page-40" name="page-40"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   Case:  LB asks for weights for a group that doesn't exist.

   Behavior:  GWM will send LB a reply containing an error code.


   Case:  LB or Member attempts to register a member that is already
      registered in that group.

   Behavior:  GWM will send sender a reply containing an error code.


   Case:  LB or Member attempts to deregister a member or group that
      doesn't exist.

   Behavior:  GWM will send sender a reply containing an error code.


   Case:  LB or Member tries to set state for a non-registered server.

   Behavior:  GWM will send sender a reply containing an error code.


   Case:  LB tries to Get Weights for an unregistered group.

   Behavior:  GWM will send LB a reply containing an error code.


























<span class="grey">Bivens                       Informational                     [Page 40]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-41" id="page-41" name="page-41"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.3.%20%20Example%20Flow%201%3A%20Load%20Balancer%20Registration%2C%20Getting%20Weights%2C%20and"></a><a class="selflink" href="#section-9.3" name="section-9.3">9.3</a>.  Example Flow 1: Load Balancer Registration, Getting Weights, and</span>
<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/Application-Side%20Quiescing"></a>      Application-Side Quiescing</span>

      Load                 Group Workload
    Balancer                   Manager
       |                         |
       | 1) Registration Request |
       |------------------------&gt;|
       |&lt;------------------------|
       |    Registration Reply   |
       |                         |
       | 2) Set LB State Request |
       |------------------------&gt;|
       |&lt;------------------------|
       |    Set LB State Reply   |
       |                         |
       | 3) Get Weights Request  |
       |------------------------&gt;|
       |&lt;------------------------|
       |    Get Weights Reply    |
       |                         | 4) Set Member State Req. --------
       |                         |&lt;-------------------------|Member|
       |                         |-------------------------&gt;|  A   |
       |                         |  Set Member State Reply  --------
       |                         |
       |                         | 5) Set Member State Req. --------
       |                         |&lt;-------------------------|Member|
       |                         |-------------------------&gt;|  C   |
       |                         |  Set Member State Reply  --------
       |                         |
       | 6) Get Weights Request  |
       |------------------------&gt;|
       |&lt;------------------------|
       |    Get Weights Reply    |
       |                         |
       |                         | 7) Set Member State Req. --------
       |                         |&lt;-------------------------|Member|
       |                         |-------------------------&gt;|  C   |
       |                         |  Set Member State Reply  --------
       |                         |
       | 8) Get Weights Request  |
       |------------------------&gt;|
       |&lt;------------------------|
       |    Get Weights Reply    |
       |                         |

                                 Figure 32




<span class="grey">Bivens                       Informational                     [Page 41]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-42" id="page-42" name="page-42"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   1.  The LB registers Members A, B, and C in a group named GRP1.  The
       GWM replies with no error.

   2.  The LB turns its trust flag on by issuing a Set LB State message:

          LB Health: 0x00 Flags: 0000 0010

   3.  The LB sends a Get Weights message for GRP1 and gets the reply:

          Members      Opaque State     Flags          Weight
          --------     ------------     ---------      ------
          Member A     0x00             0000 1101      20
          Member B     0x00             0000 1101      40
          Member C     0x00             0000 1101       5

   4.  Member A sends a Set Member State message with flags:

          Members       Opaque State     Flags
          --------      ------------     ---------
          Member A      0x32             0000 0000

   5.  Member C sends a Set Member State message to quiesce itself with
       the following flags:

          Members       Opaque State     Flags
          --------      ------------     ---------
          Member C      0x0A             0000 0001

   6.  The LB sends the Get Weights message for GRP1 and receives the
       following:

          Members       Opaque State     Flags          Weight
          --------      ------------     ---------      ------
          Member A      0x32             0000 1101      20
          Member B      0x00             0000 1101      40
          Member C      0x0A             0000 1111       5

   7.  Member C sends a Set Member State message to resume (un-quiesce
       itself) with the following flags:

          Members       Opaque State     Flags
          --------      ------------     ---------
          Member C      0x0A             0000 0000








<span class="grey">Bivens                       Informational                     [Page 42]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-43" id="page-43" name="page-43"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   8.  The LB sends a Get Weights message for GRP1 and gets the reply:

          Members       Opaque State     Flags          Weight
          --------      ------------     ---------      ------
          Member A      0x32             0000 1101      20
          Member B      0x00             0000 1101      40
          Member C      0x0A             0000 1101       5

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.4.%20%20Example%20Flow%202%3A"></a><a class="selflink" href="#section-9.4" name="section-9.4">9.4</a>.  Example Flow 2:  </span>Set Load Balancer State, Application
      Registration, and Load Balancer Group DeRegistration

      Load                 Group Workload
    Balancer                   Manager
       |                         |
       | 1) Set LB State Request |
       |------------------------&gt;|
       |&lt;------------------------|
       |    Set LB State Reply   |
       |                         |
       |                         | 2) Registration Request  --------
       |                         |&lt;-------------------------|Member|
       |                         |-------------------------&gt;|  A   |
       |                         |    Registration Reply    --------
       |                         |
       |                         | 3) Registration Request  --------
       |                         |&lt;-------------------------|Member|
       |                         |-------------------------&gt;|  B   |
       |                         |    Registration Reply    --------
       |                         |
       | 4) Send Weights Mesg    |
       |&lt;------------------------|
       |                         |
       |                         | 5) Registration Request  --------
       |                         |&lt;-------------------------|Member|
       |                         |-------------------------&gt;|  C   |
       |                         |    Registration Reply    --------
       |                         |
       | 6) Send Weights Mesg    |
       |&lt;------------------------|
       |                         |
       |7) Deregistration Request|
       |------------------------&gt;|
       |&lt;------------------------|
       |   Deregistration Reply  |
       |                         |

                                 Figure 39




<span class="grey">Bivens                       Informational                     [Page 43]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-44" id="page-44" name="page-44"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


   1.  The LB sets its state with the Set LB State message and the
       following parameters.

          Health: 0x7F Flags: 0000 0011


   2.  Member A registers itself for work in GRP1 using the Register
       message.


   3.  Member B registers itself for work in GRP1 using the Register
       message.


   4.  The GWM issues a Send Weights message to the LB.

          Members       Opaque State     Flags          Weight
          --------      ------------     ---------      ------
          Member A      0x00             0000 1001      20
          Member B      0x00             0000 1001      40

   5.  Member C registers itself for work in GRP1 using the Register
       message.


   6.  The GWM issues a Send Weights message to the LB.

          Members       Opaque State     Flags          Weight
          --------      ------------     ---------      ------
          Member A      0x00             0000 1001      20
          Member B      0x00             0000 1001      40
          Member C      0x00             0000 1001       5

   7.  LB deregisters GRP1 by using the DeRegister message with the
       Member Data Count = 0

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.5.%20%20Avoiding%20Single%20Points%20of%20Failure"></a><a class="selflink" href="#section-9.5" name="section-9.5">9.5</a>.  Avoiding Single Points of Failure</span>

   o  To avoid having a single point of failure at the load balancer, an
      administrator may choose to have multiple load balancers in his or
      her environment.  SASP provides for the GWM to keep track of
      multiple load balancers through the use of load balancer unique
      identifiers (LB UIDs).

   o  To avoid having a single point of failure at the GWM or enhance
      the load balancing strategy by utilizing the strengths of several
      different GWMs, an administrator may choose to have multiple GWMs
      in his or her environment.  In this case, the load balancer would



<span class="grey">Bivens                       Informational                     [Page 44]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-45" id="page-45" name="page-45"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


      connect to multiple GWMs and register the same groups with
      corresponding members.  The load balancer may choose to coordinate
      the recommendations of each GWM by any method it chooses (e.g.,
      statistical combination such as averaging).  The coordination of
      weights from multiple GWMs is product specific and not addressed
      in this protocol.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Security%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Security Considerations</span>

   SASP is a binary stream expected to be transported over a TCP
   connection.  To secure this protocol, it is expected that
   implementers of the protocol use a secure mode of transport such as
   SSL/TLS.  Discussions around security concerns have been listed
   below:


   Security Issue:  In insecure environments, if the LB UID becomes
      known by another system, the other system could initiate a
      connection and send messages to the GWM causing the GWM to replace
      the previous (possibly valid) connection for the new (potentially
      bad) connection.

   Solution:  This may not be a concern if the load balancer and GWM are
      in protected parts of the network.  If the administrator is
      concerned about this vulnerability, she should use SSL or TLS to
      provide authentication for the connection.  When using SSL or TLS
      to secure the connection, the administrator SHOULD use both server
      and client authentication through client and server certificates.
      The GWM will trust any certificate that is signed by an authority
      it's been configured to trust.


   Security Issue:  In insecure environments, if the load balancer turns
      the Trust Flag on, any member or other system can send a
      Registration Message and be included in the serverfarm to receive
      work.  A person with bad intentions and the correct information
      could exploit this feature and register his own application to
      receive work.  His counterfeit application could capture valuable
      data from unsuspecting clients as their transactions are sent to
      his system.

   Solution:  This may not be a concern if the GWM and its members are
      in protected parts of the network.  If the administrator is
      concerned about this vulnerability, she should use SSL or TLS to
      provide authentication for the member connections.  When using SSL
      or TLS to authenticate the connection, the administrator would
      need to explicitly install valid certificates on each component




<span class="grey">Bivens                       Informational                     [Page 45]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-46" id="page-46" name="page-46"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


      while at the same time establishing the trusted certificates of
      each component.  This would make certain that only those trusted
      components would be permitted to connect to the GWM.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Normative%20References"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Normative References</span>

   [<a id="ref-RFC1700" name="ref-RFC1700">RFC1700</a>]  Reynolds, J. and J. Postel, "Assigned Numbers", STD 2,
              <a href="rfc1700.html">RFC 1700</a>, October 1994.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC4291" name="ref-RFC4291">RFC4291</a>]  Hinden, R. and S. Deering, "IP Version 6 Addressing
              Architecture", <a href="rfc4291.html">RFC 4291</a>, February 2006.





































<span class="grey">Bivens                       Informational                     [Page 46]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-47" id="page-47" name="page-47"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Acknowledgements"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Acknowledgements</span>

   The author gratefully acknowledges contributions by Mark Albert,
   David McCowan, John Fenton, Derek Huckaby, Dyan Collins, and Stefano
   Testa.  Mark Albert, David McCowan, John Fenton, Derek Huckaby, Dyan
   Collins, and Stefano Testa were supported for this work by Cisco
   Systems Inc.

   The author would also like to thank John Arwe, Dave Bostjancic, Brian
   Carpenter, Donna Dillenberger, Gus Kassimis, and Thomas Narten for
   their efforts in the creation and refining of this work.

Author's Address

   Alan Bivens
   IBM T.J. Watson Research Center
   19 Skyline Drive
   Hawthorne, NY  10532
   US

   EMail: jbivens@us.ibm.com






























<span class="grey">Bivens                       Informational                     [Page 47]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-48" id="page-48" name="page-48"> </a>
<span class="grey"><a href="rfc4678.html">RFC 4678</a>                         SASPv1                   September 2006</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2006).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and at www.rfc-editor.org/copyright.html, and
   except as set forth therein, the authors retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="https://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.

Acknowledgement

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).







Bivens                       Informational                     [Page 48]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc4678 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:40 GMT --></html>