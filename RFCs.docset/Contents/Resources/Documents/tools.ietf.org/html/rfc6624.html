<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6624 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:27 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:6624" name="DC.Identifier"/>
<meta content="Layer 2 Virtual Private Networks (L2VPNs) based on Frame Relay or ATM
circuits have been around a long time; more recently, Ethernet VPNs,
including Virtual Private LAN Service, have become popular.
Traditional L2VPNs often required a separate Service Provider
infrastructure for each type and yet another for the Internet and IP
VPNs. In addition, L2VPN provisioning was cumbersome. This document
presents a new approach to the problem of offering L2VPN services
where the L2VPN customer's experience is virtually identical to
that offered by traditional L2VPNs, but such that a Service Provider
can maintain a single network for L2VPNs, IP VPNs, and the Internet,
as well as a common provisioning methodology for all services. This
document is not an Internet Standards Track specification; it is
published for informational purposes." name="DC.Description.Abstract"/>
<meta content="Kompella, Kireeti" name="DC.Creator"/>
<meta content="Cherukuri, Rao" name="DC.Creator"/>
<meta content="Kothari, Bhupesh" name="DC.Creator"/>
<meta content="May, 2012" name="DC.Date.Issued"/>
<meta content="Layer 2 Virtual Private Networks Using BGP for Auto-Discovery and Signaling" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6624 - Layer 2 Virtual Private Networks Using BGP for Auto-Discovery and Signaling</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6624.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6624" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-kompella-l2vpn-l2vpn" title="draft-kompella-l2vpn-l2vpn">draft-kompella-...</a>] [<a href="https://datatracker.ietf.org/doc/rfc6624" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6624" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6624" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=6624&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]   </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                       K. Kompella
Request for Comments: 6624                              Juniper Networks
Category: Informational                                       B. Kothari
ISSN: 2070-1721                                            Cisco Systems
                                                            R. Cherukuri
                                                        Juniper Networks
                                                                May 2012


             <span class="h1">Layer 2 Virtual Private Networks Using BGP for</span>
                      <span class="h1">Auto-Discovery and Signaling</span>

Abstract

   Layer 2 Virtual Private Networks (L2VPNs) based on Frame Relay or ATM
   circuits have been around a long time; more recently, Ethernet VPNs,
   including Virtual Private LAN Service, have become popular.
   Traditional L2VPNs often required a separate Service Provider
   infrastructure for each type and yet another for the Internet and IP
   VPNs.  In addition, L2VPN provisioning was cumbersome.  This document
   presents a new approach to the problem of offering L2VPN services
   where the L2VPN customer's experience is virtually identical to that
   offered by traditional L2VPNs, but such that a Service Provider can
   maintain a single network for L2VPNs, IP VPNs, and the Internet, as
   well as a common provisioning methodology for all services.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6624">http://www.rfc-editor.org/info/rfc6624</a>.










<span class="grey">Kompella, et al.              Informational                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


Copyright Notice

   Copyright (c) 2012 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





































<span class="grey">Kompella, et al.              Informational                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Terminology ................................................<a href="#page-6">6</a>
           <a href="#section-1.1.1">1.1.1</a>. Conventions Used in This Document ...................<a href="#page-6">6</a>
      <a href="#section-1.2">1.2</a>. Advantages of Layer 2 VPNs .................................<a href="#page-6">6</a>
           <a href="#section-1.2.1">1.2.1</a>. Separation of Administrative Responsibilities .......<a href="#page-7">7</a>
           <a href="#section-1.2.2">1.2.2</a>. Migrating from Traditional Layer 2 VPNs .............<a href="#page-7">7</a>
           <a href="#section-1.2.3">1.2.3</a>. Privacy of Routing ..................................<a href="#page-7">7</a>
           <a href="#section-1.2.4">1.2.4</a>. Layer 3 Independence ................................<a href="#page-7">7</a>
           <a href="#section-1.2.5">1.2.5</a>. PE Scaling ..........................................<a href="#page-8">8</a>
           <a href="#section-1.2.6">1.2.6</a>. Ease of Configuration ...............................<a href="#page-8">8</a>
      <a href="#section-1.3">1.3</a>. Advantages of Layer 3 VPNs .................................<a href="#page-9">9</a>
           <a href="#section-1.3.1">1.3.1</a>. Layer 2 Independence ................................<a href="#page-9">9</a>
           <a href="#section-1.3.2">1.3.2</a>. SP Routing as Added Value ..........................<a href="#page-10">10</a>
           <a href="#section-1.3.3">1.3.3</a>. Class of Service ...................................<a href="#page-10">10</a>
      <a href="#section-1.4">1.4</a>. Multicast Routing .........................................<a href="#page-10">10</a>
   <a href="#section-2">2</a>. Operation of a Layer 2 VPN .....................................<a href="#page-11">11</a>
      <a href="#section-2.1">2.1</a>. Network Topology ..........................................<a href="#page-11">11</a>
      <a href="#section-2.2">2.2</a>. Configuration .............................................<a href="#page-13">13</a>
           <a href="#section-2.2.1">2.2.1</a>. CE Configuration ...................................<a href="#page-14">14</a>
           <a href="#section-2.2.2">2.2.2</a>. PE Configuration ...................................<a href="#page-15">15</a>
           <a href="#section-2.2.3">2.2.3</a>. Adding a New Site ..................................<a href="#page-15">15</a>
           <a href="#section-2.2.4">2.2.4</a>. Deleting a Site ....................................<a href="#page-16">16</a>
           <a href="#section-2.2.5">2.2.5</a>. Managing CE ID Mappings ............................<a href="#page-16">16</a>
           <a href="#section-2.2.6">2.2.6</a>. Managing Label Blocks ..............................<a href="#page-16">16</a>
      <a href="#section-2.3">2.3</a>. Operations, Administration, and Maintenance (OAM) .........<a href="#page-17">17</a>
   <a href="#section-3">3</a>. PE Information Exchange ........................................<a href="#page-17">17</a>
      <a href="#section-3.1">3.1</a>. Circuit Status Vector .....................................<a href="#page-19">19</a>
      <a href="#section-3.2">3.2</a>. Generalizing the VPN Topology .............................<a href="#page-20">20</a>
   <a href="#section-4">4</a>. Layer 2 Interworking ...........................................<a href="#page-21">21</a>
   <a href="#section-5">5</a>. Packet Transport ...............................................<a href="#page-22">22</a>
      <a href="#section-5.1">5.1</a>. Layer 2 MTU ...............................................<a href="#page-22">22</a>
      <a href="#section-5.2">5.2</a>. Layer 2 Frame Format ......................................<a href="#page-22">22</a>
      <a href="#section-5.3">5.3</a>. IP-Only Layer 2 Interworking ..............................<a href="#page-23">23</a>
   <a href="#section-6">6</a>. Security Considerations ........................................<a href="#page-23">23</a>
   <a href="#section-7">7</a>. IANA Considerations ............................................<a href="#page-23">23</a>
   <a href="#section-8">8</a>. Acknowledgments ................................................<a href="#page-24">24</a>
   <a href="#section-9">9</a>. Contributors ...................................................<a href="#page-24">24</a>
   <a href="#section-10">10</a>. References ....................................................<a href="#page-24">24</a>
      <a href="#section-10.1">10.1</a>. Normative References .....................................<a href="#page-24">24</a>
      <a href="#section-10.2">10.2</a>. Informative References ...................................<a href="#page-25">25</a>









<span class="grey">Kompella, et al.              Informational                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The earliest Virtual Private Networks (VPNs) were based on Layer 2
   circuits: X.25, Frame Relay, and ATM (see [<a href="#ref-Kosiur" title='"Building and Managing Virtual Private Networks"'>Kosiur</a>]).  More recently,
   multipoint VPNs based on Ethernet Virtual Local Area Networks (VLANs)
   and Virtual Private LAN Service (VPLS) [<a href="rfc4761.html" title='"Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling"'>RFC4761</a>][RFC4762] have become
   quite popular.  In contrast, the VPNs described in this document are
   point-to-point, and usually called Virtual Private Wire Service
   (VPWS).  All of these come under the classification of Layer 2 VPNs
   (L2VPNs), as the customer-to-Service-Provider hand-off is at Layer 2.

   There are at least two factors that adversely affected the cost of
   offering L2VPNs.  The first is that the easiest way to offer an L2VPN
   of a given type of Layer 2 was over an infrastructure of the same
   type.  This approach required that the Service Provider build a
   separate infrastructure for each Layer 2 encapsulation, e.g., an ATM
   infrastructure for ATM VPNs, an Ethernet infrastructure for Ethernet
   VPNs, etc.  In addition, a separate infrastructure was needed for the
   Internet and IP VPNs [<a href="rfc4364.html" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>], and possibly yet another for voice
   services.  Going down this path meant a proliferation of networks.

   The other is that each of these networks had different provisioning
   methodologies.  Furthermore, the provisioning of an L2VPN was fairly
   complex.  It is important to distinguish between a single Layer 2
   circuit, which connects two customer sites, and a Layer 2 VPN, which
   is a set of circuits that connect sites belonging to the same
   customer.  The fact that two different circuits belonged to the same
   VPN was typically known only to the provisioning system, not to the
   switches offering the service; this complicated the setting up, and
   subsequently, the troubleshooting, of an L2VPN.  Also, each switch
   offering the service had to be provisioned with the address of every
   other switch in the same VPN, requiring, in the case of full-mesh VPN
   connectivity, provisioning proportional to the square of the number
   of sites.  This made full-mesh L2VPN connectivity prohibitively
   expensive for the Service Provider (SP) and thus also for customers.
   Finally, even setting up an individual circuit often required the
   provisioning of every switch along the path.

   Of late, there has been much progress in network "convergence",
   whereby Layer 2 traffic, Internet traffic, and IP VPN traffic can be
   carried over a single, consolidated network infrastructure based on
   IP/MPLS tunnels; this is made possible by techniques such as those
   described in [<a href="rfc4448.html" title='"Encapsulation Methods for Transport of Ethernet over MPLS Networks"'>RFC4448</a>], [<a href="rfc4618.html" title='"Encapsulation Methods for Transport of PPP/High-Level Data Link Control (HDLC) over MPLS Networks"'>RFC4618</a>], [<a href="rfc4619.html" title='"Encapsulation Methods for Transport of Frame Relay over Multiprotocol Label Switching (MPLS) Networks"'>RFC4619</a>], and [<a href="rfc4717.html" title='"Encapsulation Methods for Transport of Asynchronous Transfer Mode (ATM) over MPLS Networks"'>RFC4717</a>] for Layer
   2 traffic and in [<a href="rfc4364.html" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>] for IP VPN traffic.  This development goes
   a long way toward addressing the problem of network proliferation.
   This document goes one step further and shows how a Service Provider
   can offer Layer 2 VPNs using protocol and provisioning methodologies
   similar to that used for VPLS [<a href="rfc4761.html" title='"Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling"'>RFC4761</a>] and IP VPNs [<a href="rfc4364.html" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>],



<span class="grey">Kompella, et al.              Informational                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   thereby achieving a significant degree of operational convergence as
   well.  In particular, all of these methodologies include the notion
   of a VPN identifier that serves to unify components of a given VPN
   and the concept of auto-discovery, which simplifies the provisioning
   of dense VPN topologies (for example, a full mesh).  In addition,
   similar techniques are used in all of the above-mentioned VPN
   technologies to offer inter-AS and inter-provider VPNs (i.e., VPNs
   whose sites are connected to multiple Autonomous Systems (ASes) or
   Service Providers).

   Technically, the approach proposed here uses the concepts and
   solution described in [<a href="rfc4761.html" title='"Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling"'>RFC4761</a>], which describes a method for VPLS, a
   particular form of a Layer 2 VPN.  That document, in turn, borrowed
   much from [<a href="rfc4364.html" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>], including the use of BGP for auto-discovery and
   "demultiplexor" (see below) exchange and the concepts of Route
   Distinguishers to make VPN advertisements unique and Route Targets to
   control VPN topology.  In addition, all three documents share the
   idea that routers not directly connected to VPN customers should
   carry no VPN state, restricting the provisioning of individual
   connections to just the edge devices.  This is achieved using tunnels
   to carry the data, with a demultiplexor that identifies individual
   VPN circuits.  These tunnels could be based on MPLS, GRE, or any
   other tunnel technology that offers a demultiplexing field; the
   signaling of these tunnels is outside the scope of this document.
   The specific approach taken here is to use an MPLS label as the
   demultiplexor.

   Layer 2 VPNs typically require that all sites in the VPN connect to
   the SP with the same Layer 2 encapsulation.  To ease this
   restriction, this document proposes a limited form of Layer 2
   interworking, by restricting the Layer 3 protocol to IP only (see
   <a href="#section-4">Section 4</a>).

   It may be instructive to compare the approach described in [<a href="rfc4447.html" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>RFC4447</a>]
   and [<a href="rfc6074.html" title='"Provisioning, Auto-Discovery, and Signaling in Layer 2 Virtual Private Networks (L2VPNs)"'>RFC6074</a>] (these are the IETF-approved technologies for the
   functions described in this document, albeit using two separate
   protocols) with the one described here.  To comply with IETF
   standards, it is recommended that devices implementing the solution
   described in this document also implement the approach in [<a href="rfc4447.html" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>RFC4447</a>]
   and [<a href="rfc6074.html" title='"Provisioning, Auto-Discovery, and Signaling in Layer 2 Virtual Private Networks (L2VPNs)"'>RFC6074</a>].

   The rest of this section discusses the relative merits of Layer 2 and
   Layer 3 VPNs.  <a href="#section-2">Section 2</a> describes the operation of a Layer 2 VPN.
   <a href="#section-3">Section 3</a> describes PE information exchange.  <a href="#section-4">Section 4</a> describes IP-
   only Layer 2 interworking.  <a href="#section-5">Section 5</a> describes how the L2 packets
   are transported across the SP network.





<span class="grey">Kompella, et al.              Informational                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Terminology"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Terminology</span>

   The terminology used is from [<a href="rfc4761.html" title='"Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling"'>RFC4761</a>] and [<a href="rfc4364.html" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>]; it is briefly
   repeated here.  A "customer" is a customer of a Service Provider
   seeking to interconnect their various "sites" (each an independent
   network) at Layer 2 through the Service Provider's network, while
   maintaining privacy of communication and address space.  The device
   in a customer site that connects to a Service Provider router is
   termed the CE (customer edge) device; this device may be a router or
   a switch.  The Service Provider router to which a CE connects is
   termed a PE (provider edge).  A router in the Service Provider's
   network that doesn't connect directly to any CE is termed P
   ("provider" device).  Every pair of PEs is connected by a "tunnel";
   within a tunnel, VPN data is distinguished by a "demultiplexor",
   which in this document is an MPLS label.

   Each CE within a VPN is assigned a CE ID, a number that uniquely
   identifies a CE within an L2VPN.  More accurately, the CE ID
   identifies a physical connection from the CE device to the PE, since
   a CE may be connected to multiple PEs (or multiply connected to a
   PE); in such a case, the CE would have a CE ID for each connection.
   A CE may also be part of many L2VPNs; it would need one (or more) CE
   ID(s) for each L2VPN of which it is a member.  The number space for
   CE IDs is scoped to a given VPN.

   In the case of inter-provider L2VPNs, there needs to be some
   coordination of allocation of CE IDs.  One solution is to allocate
   ranges for each SP.  Other solutions may be forthcoming.

   Within each physical connection from a CE to a PE, there may be
   multiple virtual circuits.  These will be referred to as Attachment
   Circuits (ACs), following [<a href="rfc3985.html" title='"Pseudo Wire Emulation Edge-to- Edge (PWE3) Architecture"'>RFC3985</a>].  Similarly, the entity that
   connects two attachment circuits across the Service Provider network
   is called a pseudowire (PW).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.1.1.%20%20Conventions%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-1.1.1" name="section-1.1.1">1.1.1</a>.  Conventions Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Advantages%20of%20Layer%202%20VPNs"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Advantages of Layer 2 VPNs</span>

   A Layer 2 VPN is one where a Service Provider provides Layer 2
   connectivity to the customer.  The Service Provider does not
   participate in the customer's Layer 3 network, especially in the
   routing, resulting in several advantages to the SP as a whole and to
   PE routers in particular.



<span class="grey">Kompella, et al.              Informational                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.2.1.%20%20Separation%20of%20Administrative%20Responsibilities"></a><a class="selflink" href="#section-1.2.1" name="section-1.2.1">1.2.1</a>.  Separation of Administrative Responsibilities</span>

   In a Layer 2 VPN, the Service Provider is responsible for Layer 2
   connectivity; the customer is responsible for Layer 3 connectivity,
   which includes routing.  If the customer says that host x in site A
   cannot reach host y in site B, the Service Provider need only
   demonstrate that site A is connected to site B.  The details of how
   routes for host y reach host x are the customer's responsibility.

   Another important factor is that once a PE provides Layer 2
   connectivity to its connected CE, its job is done.  A misbehaving CE
   can at worst flap its interface, but route flaps in the customer
   network have little effect on the SP network.  On the other hand, a
   misbehaving CE in a Layer 3 VPN can flap its routes, leading to
   instability of the PE router or even the entire SP network.  Thus,
   when offering a Layer 3 VPN, an SP should proactively protect itself
   from Layer 3 instability in the CE network.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.2.2.%20%20Migrating%20from%20Traditional%20Layer%202%20VPNs"></a><a class="selflink" href="#section-1.2.2" name="section-1.2.2">1.2.2</a>.  Migrating from Traditional Layer 2 VPNs</span>

   Since "traditional" Layer 2 VPNs (i.e., real Frame Relay circuits
   connecting sites) are indistinguishable from tunnel-based VPNs from
   the customer's point of view, migrating from one to the other raises
   few issues.  Layer 3 VPNs, on the other hand, require a considerable
   redesign of the customer's Layer 3 routing architecture.
   Furthermore, with Layer 3 VPNs, special care has to be taken that
   routes within the traditional VPN are not preferred over the Layer 3
   VPN routes (the so-called "backdoor routing" problem, whose solution
   requires protocol changes that are somewhat ad hoc).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.2.3.%20%20Privacy%20of%20Routing"></a><a class="selflink" href="#section-1.2.3" name="section-1.2.3">1.2.3</a>.  Privacy of Routing</span>

   In an L2VPN, the privacy of customer routing is a natural fallout of
   the fact that the Service Provider does not participate in routing.
   The SP routers need not do anything special to keep customer routes
   separate from other customers or from the Internet; there is no need
   for per-VPN routing tables and the additional complexity this imposes
   on PE routers.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.2.4.%20%20Layer%203%20Independence"></a><a class="selflink" href="#section-1.2.4" name="section-1.2.4">1.2.4</a>.  Layer 3 Independence</span>

   Since the Service Provider simply provides Layer 2 connectivity, the
   customer can run any Layer 3 protocols they choose.  If the SP were
   participating in customer routing, it would be vital that the
   customer and SP both use the same Layer 3 protocol(s) and routing
   protocols.





<span class="grey">Kompella, et al.              Informational                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   Note that IP-only Layer 2 interworking doesn't have this benefit as
   it restricts the Layer 3 to IP only.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.2.5.%20%20PE%20Scaling"></a><a class="selflink" href="#section-1.2.5" name="section-1.2.5">1.2.5</a>.  PE Scaling</span>

   In the Layer 2 VPN scheme described below, each PE transmits a single
   small chunk of information about every CE that the PE is connected to
   every other PE.  That means that each PE need only maintain a single
   chunk of information from each CE in each VPN and keep a single
   "route" to every site in every VPN.  This means that both the
   Forwarding Information Base and the Routing Information Base scale
   well with the number of sites and number of VPNs.  Furthermore, the
   scaling properties are independent of the customer: the only germane
   quantity is the total number of VPN sites.

   This is to be contrasted with Layer 3 VPNs, where each CE in a VPN
   may have an arbitrary number of routes that need to be carried by the
   SP.  This leads to two issues.  First, both the information stored at
   each PE and the number of routes installed by the PE for a CE in a
   VPN can be (in principle) unbounded, which means in practice that a
   PE must restrict itself to installing routes associated with the VPNs
   of which it is currently a member.  Second, a CE can send a large
   number of routes to its PE, which means that the PE must protect
   itself against such a condition.  Thus, the SP must enforce limits on
   the number of routes accepted from a CE; this, in turn, requires the
   PE router to offer such control.

   The scaling issues of Layer 3 VPNs come into sharp focus at a BGP
   route reflector (RR).  An RR cannot keep all the advertised routes in
   every VPN since the number of routes will be too large.  The
   following solutions/extensions are needed to address this issue:

   1.  RRs could be partitioned so that each RR services a subset of
       VPNs so that no single RR has to carry all the routes.

   2.  An RR could use a preconfigured list of Route Targets for its
       inbound route filtering.  The RR may choose to perform Route
       Target Filtering, described in [<a href="rfc4684.html" title='"Constrained Route Distribution for Border Gateway Protocol/MultiProtocol Label Switching (BGP/MPLS) Internet Protocol (IP) Virtual Private Networks (VPNs)"'>RFC4684</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.2.6.%20%20Ease%20of%20Configuration"></a><a class="selflink" href="#section-1.2.6" name="section-1.2.6">1.2.6</a>.  Ease of Configuration</span>

   Configuring traditional Layer 2 VPNs with dense topologies was a
   burden primarily because of the O(n*n) nature of the task.  If there
   are n CEs in a Frame Relay VPN, say full-mesh connected, n*(n-1)/2
   DLCI (Data Link Connection Identifier) Permanent Virtual Circuits
   (PVCs) must be provisioned across the SP network.  At each CE, (n-1)
   DLCIs must be configured to reach each of the other CEs.
   Furthermore, when a new CE is added, n new DLCI PVCs must be



<span class="grey">Kompella, et al.              Informational                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   provisioned; also, each existing CE must be updated with a new DLCI
   to reach the new CE.  Finally, each PVC requires state in every
   transit switch.

   In our proposal, PVCs are tunneled across the SP network.  The
   tunnels used are provisioned independently of the L2VPNs, using
   signaling protocols (in the case of MPLS, LDP or RSVP - Traffic
   Engineering (RSVP-TE) can be used), or set up by configuration; the
   number of tunnels is independent of the number of L2VPNs.  This
   reduces a large part of the provisioning burden.

   Furthermore, we assume that DLCIs at the CE edge are relatively cheap
   and that VPN labels in the SP network are cheap.  This allows the SP
   to "overprovision" VPNs, for example, allocate 50 CEs to a VPN when
   only 20 are needed.  With this overprovisioning, adding a new CE to a
   VPN requires configuring just the new CE and its associated PE;
   existing CEs and their PEs need not be reconfigured.  Note that if
   DLCIs at the CE edge are expensive, e.g., if these DLCIs are
   provisioned across a switched network, one could provision them as
   and when needed, at the expense of extra configuration.  This need
   not still result in extra state in the SP network, i.e., an
   intelligent implementation can allow overprovisioning of the pool of
   VPN labels.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.3.%20%20Advantages%20of%20Layer%203%20VPNs"></a><a class="selflink" href="#section-1.3" name="section-1.3">1.3</a>.  Advantages of Layer 3 VPNs</span>

   Layer 3 VPNs ([<a href="rfc4364.html" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>] in particular) offer a good solution when the
   customer traffic is wholly IP, customer routing is reasonably simple,
   and the customer sites connect to the SP with a variety of Layer 2
   technologies.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.3.1.%20%20Layer%202%20Independence"></a><a class="selflink" href="#section-1.3.1" name="section-1.3.1">1.3.1</a>.  Layer 2 Independence</span>

   One major restriction in a Layer 2 VPN is that the Layer 2 media with
   which the various sites of a single VPN connect to the SP must be
   uniform.  On the other hand, the various sites of a Layer 3 VPN can
   connect to the SP with any supported media; for example, some sites
   may connect with Frame Relay circuits and others with Ethernet.

   This restriction of Layer 2 VPN is alleviated by the IP-only Layer 2
   interworking proposed in this document.  This comes at the cost of
   losing the Layer 3 independence.

   A corollary to this is that the number of sites that can be in a
   Layer 2 VPN is determined by the number of Layer 2 circuits that the
   Layer 2 technology provides.  For example, if the Layer 2 technology
   is Frame Relay with 2-octet DLCIs, a CE can at most connect to about
   a thousand other CEs in a VPN.



<span class="grey">Kompella, et al.              Informational                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.3.2.%20%20SP%20Routing%20as%20Added%20Value"></a><a class="selflink" href="#section-1.3.2" name="section-1.3.2">1.3.2</a>.  SP Routing as Added Value</span>

   Another problem with Layer 2 VPNs is that the CE router in a VPN must
   be able to deal with having N routing peers, where N is the number of
   sites in the VPN.  This can be alleviated by manipulating the
   topology of the VPN.  For example, a hub-and-spoke VPN architecture
   means that only one CE router (the hub) need deal with N neighbors.
   However, in a Layer 3 VPN, a CE router need only deal with one
   neighbor, the PE router.  Thus, the SP can offer Layer 3 VPNs as a
   value-added service to its customers.

   Moreover, with Layer 2 VPNs, it is up to a customer to build and
   operate the whole network.  With Layer 3 VPNs, a customer is just
   responsible for building and operating routing within each site,
   which is likely to be much simpler than building and operating
   routing for the whole VPN.  That, in turn, makes Layer 3 VPNs more
   suitable for customers who don't have sufficient routing expertise,
   again allowing the SP to provide added value.

   As mentioned later, multicast routing and forwarding is another
   value-added service that an SP can offer.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.3.3.%20%20Class%20of%20Service"></a><a class="selflink" href="#section-1.3.3" name="section-1.3.3">1.3.3</a>.  Class of Service</span>

   Class-of-Service (CoS) issues have been addressed for Layer 3 VPNs.
   Since the PE router has visibility into the network Layer (IP), the
   PE router can take on the tasks of CoS classification and routing.
   This restriction on Layer 2 VPNs is again eased in the case of IP-
   only Layer 2 interworking, as the PE router has visibility into the
   network Layer (IP).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.4.%20%20Multicast%20Routing"></a><a class="selflink" href="#section-1.4" name="section-1.4">1.4</a>.  Multicast Routing</span>

   There are two aspects to multicast routing that we will consider.  On
   the protocol front, supporting IP multicast in a Layer 3 VPN requires
   PE routers to participate in the multicast routing instance of the
   customer and thus keep some related state information.

   In the Layer 2 VPN case, the CE routers run native multicast routing
   directly.  The SP network just provides pipes to connect the CE
   routers; PEs are unaware whether the CEs run multicast or not and
   thus do not have to participate in multicast protocols or keep
   multicast state information.

   On the forwarding front, in a Layer 3 VPN, CE routers do not
   replicate multicast packets; thus, the CE-PE link carries only one
   copy of a multicast packet.  Whether replication occurs at the
   ingress PE or somewhere within the SP network depends on the



<span class="grey">Kompella, et al.              Informational                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   sophistication of the Layer 3 VPN multicast solution.  The simple
   solution where a PE replicates packets for each of its CEs may place
   considerable burden on the PE.  More complex solutions may require
   VPN multicast state in the SP network but may significantly reduce
   the traffic in the SP network by delaying packet replication until
   needed.

   In a Layer 2 VPN, packet replication occurs at the CE.  This has the
   advantage of distributing the burden of replication among the CEs
   rather than focusing it on the PE to which they are attached and thus
   will scale better.  However, the CE-PE link will need to carry
   multiple copies of multicast packets.  However, in the case of
   Virtual Private LAN Service (a specific type of L2VPN; see
   [<a href="rfc4761.html" title='"Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling"'>RFC4761</a>]), the CE-PE link need transport only one copy of a
   multicast packet.

   Thus, just as in the case of unicast routing, the SP has the choice
   to offer a value-added service (multicast routing and forwarding) at
   some cost (multicast state and packet replication) using a Layer 3
   VPN or to keep it simple and use a Layer 2 VPN.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Operation%20of%20a%20Layer%202%20VPN"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Operation of a Layer 2 VPN</span>

   The following simple example of a customer with four sites connected
   to three PE routers in a Service Provider network will hopefully
   illustrate the various aspects of the operation of a Layer 2 VPN.
   For simplicity, we assume that a full-mesh topology is desired.

   In what follows, Frame Relay serves as the Layer 2 media, and each CE
   has multiple DLCIs to its PE, each connecting to another CE in the
   VPN.  If the Layer 2 media were ATM, then each CE would have multiple
   VPIs/VCIs (Virtual Path Identifiers/Virtual Channel Identifiers) to
   connect to other CEs.  For Point-to-Point Protocol (PPP) and Cisco
   High-Level Data Link Control (HDLC), each CE would have multiple
   physical interfaces to connect to other CEs.  In the case of IP-only
   Layer 2 interworking, each CE could have a mix of one or more of the
   above Layer 2 media to connect to other CEs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Network%20Topology"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Network Topology</span>

   Consider a Service Provider network with edge routers PE0, PE1, and
   PE2.  Assume that PE0 and PE1 are IGP neighbors, and PE2 is more than
   one hop away from PE0.

   Suppose that a customer C has four sites S0, S1, S2, and S3, that C
   wants to connect via the Service Provider's network using Frame
   Relay.  Site S0 has CE0 and CE1 both connected to PE0.  Site S1 has
   CE2 connected to PE0.  Site S2 has CE3 connected to PE1 and CE4



<span class="grey">Kompella, et al.              Informational                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   connected to PE2.  Site S3 has CE5 connected to PE2.  (See Figure 1
   below.)  Suppose further that C wants to "overprovision" each current
   site, in expectation that the number of sites will grow to at least
   10 in the near future.  However, CE4 is only provisioned with nine
   DLCIs.  (Note that the signaling mechanism discussed in <a href="rfc4761.html#section-3.2">Section 3.2
   of [RFC4761]</a> will allow a site to grow in terms of connectivity to
   other sites at a later point of time at the cost of additional
   signaling, i.e., overprovisioning is not a must but a
   recommendation).

   Finally, suppose that the CEs have been provisioned with DLCIs as per
   the following:

      CE#  |  Provisioned DLCIs
     --------------------------------------------------------
        0  |  100 through 109
        1  |  200 through 209
        2  |  100 through 109
        3  |  200 through 209
        4  |  107, 209, 265, 301, 414, 555, 654, 777, and 888
        5  |  417 through 426






























<span class="grey">Kompella, et al.              Informational                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


           S0                                                   S3
     ..............                                       ..............
     .            .                                       .            .
     .    +-----+ .                                       .            .
     .    | CE0 |-----------+                             .   +-----+  .
     .    +-----+ .         |                             .   | CE5 |  .
     .            .         |                             .   +--+--+  .
     .    +-----+ .         |                             .      |     .
     .    | CE1 |-------+   |                             .......|......
     .    +-----+ .     |   |                                   /
     .            .     |   |                                  /
     ..............     |   |                                 /
                        |   |         SP Network             /
                   .....|...|.............................../.....
                   .    |   |                              /     .
                   .  +-+---+-+       +-------+           /      .
                   .  |  PE0  |-------|   P   |--        |       .
                   .  +-+---+-+       +-------+  \       |       .
                   .   /    \                     \  +---+---+   .
                   .  |      -----+                --|  PE2  |   .
                   .  |           |                  +---+---+   .
                   .  |       +---+---+                 /        .
                   .  |       |  PE1  |                /         .
                   .  |       +---+---+               /          .
                   .  |            \                 /           .
                   ...|.............|.............../.............
                      |             |              /
                      |             |             /
                      |             |            /
          S1          |             |    S2     /
     ..............   |     ........|........../......
     .            .   |     .       |         |      .
     .    +-----+ .   |     .    +--+--+   +--+--+   .
     .    | CE2 |-----+     .    | CE3 |   | CE4 |   .
     .    +-----+ .         .    +-----+   +-----+   .
     .            .         .                        .
     ..............         ..........................

                    Figure 1: Example Network Topology

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Configuration"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Configuration</span>

   The following sub-sections detail the configuration that is needed to
   provision the above VPN.  For the purpose of exposition, we assume
   that the customer will connect to the SP with Frame Relay circuits.






<span class="grey">Kompella, et al.              Informational                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   While we focus primarily on the configuration that an SP has to do,
   we touch upon the configuration requirements of CEs as well.  The
   main point of contact in CE-PE configuration is that both must agree
   on the DLCIs that will be used on the interface connecting them.

   If the PE-CE connection is Frame Relay, it is recommended to run Link
   Management Interface (LMI) between the PE and CE.  For the case of
   ATM VCs, Operations, Administration, and Maintenance (OAM) cells may
   be used.  For PPP and Cisco HDLC, keepalives may be used directly
   between CEs; however, in this case, PEs would not have visibility as
   to the liveness of customers circuits.

   In the case of IP-only Layer 2 interworking, if CE1, attached to PE0,
   connects to CE3, attached to PE1, via an L2VPN circuit, the Layer 2
   media between CE1 and PE0 is independent of the Layer 2 media between
   CE3 and PE1.  Each side will run its own Layer-2-specific link
   management protocol, e.g., LMI, Link Control Protocol (LCP), etc.
   PE0 will inform PE1 about the status of its local circuit to CE1 via
   the circuit status vector TLV defined in <a href="#section-3.1">Section 3.1</a>.  Similarly, PE1
   will inform PE0 about the status of its local circuit to CE3.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.1.%20%20CE%20Configuration"></a><a class="selflink" href="#section-2.2.1" name="section-2.2.1">2.2.1</a>.  CE Configuration</span>

   Each CE that belongs to a VPN is given a "CE ID".  CE IDs must be
   unique in the context of a VPN.  For the example, we assume that the
   CE ID for CE-k is k.

   Each CE is configured to communicate with its corresponding PE with
   the set of DLCIs given above, for example, CE0 is configured with
   DLCIs 100 through 109.  In general, a CE is configured with a list of
   circuits, all with the same Layer 2 encapsulation type, e.g., DLCIs,
   VCIs, physical PPP interface, etc.  (IP-only Layer 2 interworking
   allows a mix of Layer 2 encapsulation types.)  The size of this list/
   set determines the number of remote CEs with which a given CE can
   communicate.  Denote the size of this list/set as the CE's range.  A
   CE's range must be at least the number of remote CEs that the CE will
   connect to in a given VPN; if the range exceeds this, then the CE is
   overprovisioned, in anticipation of growth of the VPN.

   Each CE also "knows" which DLCI connects it to every other CE.  The
   methodology followed in this example is to use the CE ID of the other
   CE as an index into the DLCI list this CE has (with zero-based
   indexing, i.e., 0 is the first index).  For example, CE0 is connected
   to CE3 through its fourth DLCI, 103; CE4 is connected to CE2 by the
   third DLCI in its list, namely 265.  This is just the methodology
   used in the description here; the actual methodology used to pick the
   DLCI to be used is a local matter.  The key factor is that CE-k may
   communicate with CE-m using a different DLCI from the DLCI that CE-m



<span class="grey">Kompella, et al.              Informational                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   uses to communicate to CE-k, i.e., the SP network effectively acts as
   a giant Frame Relay switch.  This is very important, as it decouples
   the DLCIs used at each CE site, making for much simpler provisioning.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.2.%20%20PE%20Configuration"></a><a class="selflink" href="#section-2.2.2" name="section-2.2.2">2.2.2</a>.  PE Configuration</span>

   Each PE is configured with the VPNs in which it participates.  Each
   VPN is associated with one or more Route Target communities [<a href="rfc4360.html" title='"BGP Extended Communities Attribute"'>RFC4360</a>]
   that serve to define the topology of the VPN.  For each VPN, the PE
   must determine a Route Distinguisher (RD) to use; this may either be
   configured or chosen by the PE.  RDs do not have to be unique across
   the VPN.  For each CE attached to the PE in a given VPN, the PE must
   know the set of virtual circuits (DLCI, VCI/VPI, or VLAN) connecting
   it to the CE and a CE ID identifying the CE within the VPN.  CE IDs
   must be unique in the context of a given VPN.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.3.%20%20Adding%20a%20New%20Site"></a><a class="selflink" href="#section-2.2.3" name="section-2.2.3">2.2.3</a>.  Adding a New Site</span>

   The first step in adding a new site to a VPN is to pick a new CE ID.
   If all current members of the VPN are overprovisioned, i.e., their
   range includes the new CE ID, adding the new site is a purely local
   task.  Otherwise, the sites whose range doesn't include the new CE ID
   and that wish to communicate directly with the new CE must have their
   ranges increased by allocating additional local circuits to
   incorporate the new CE ID.

   The next step is ensuring that the new site has the required
   connectivity.  This usually requires adding a new virtual circuit
   between the PE and CE; in most cases, this configuration is limited
   to the PE in question.

   The rest of the configuration is a local matter between the new CE
   and the PE to which it is attached.  At this point, the PE can signal
   to other PEs that it has a new site in the VPN by advertising a BGP
   Layer 2 route, and traffic connectivity will be set up.

   It bears repeating that the key to making additions easy is
   overprovisioning and the algorithm for mapping a CE ID to a DLCI that
   is used for connecting to the corresponding CE.  However, what is
   being overprovisioned is the number of DLCIs/VCIs that connect the CE
   to the PE.  This is a local matter between the PE and CE; it does not
   affect other PEs or CEs.









<span class="grey">Kompella, et al.              Informational                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.4.%20%20Deleting%20a%20Site"></a><a class="selflink" href="#section-2.2.4" name="section-2.2.4">2.2.4</a>.  Deleting a Site</span>

   Deleting a site consists first of removing the CE ID of the site from
   the configuration of the PE to which the site is attached.  The PE
   will then signal to other PEs that it no longer has access to that
   site by withdrawing its previously advertised BGP Layer 2 route.
   Connectivity to the deleted site will cease.

   The next steps are bookkeeping: decommissioning the attachment
   circuit from the PE to the CE that corresponds to the site being
   removed and noting that the CE ID is now free for future allocation.
   Note that each PE is now (further) overprovisioned; one may choose to
   actively "reap" CE IDs if desired.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.5.%20%20Managing%20CE%20ID%20Mappings"></a><a class="selflink" href="#section-2.2.5" name="section-2.2.5">2.2.5</a>.  Managing CE ID Mappings</span>

   In the data plane, an attachment circuit, identified say by a DLCI,
   is mapped to a label via the control plane abstraction of a CE ID.
   At the egress PE, the label is mapped back to an attachment circuit
   via the same CE ID.  It is up to the VPN administrator

   o  to provision attachment circuits (e.g., DLCIs);

   o  to allocate CE IDs; and

   o  to keep a clear mapping of CE IDs to attachment circuits (and
      reflect this in PE configurations).

   The PEs manage the mappings between attachment circuits and labels,
   i.e., the data plane mappings.

   Note that in the N-to-one modes listed in Table 1, a single
   attachment circuit may correspond to several Layer 2 virtual
   circuits.  Nevertheless, there is a one-to-one mapping between an
   attachment circuit and a CE ID (and thus a label).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.6.%20%20Managing%20Label%20Blocks"></a><a class="selflink" href="#section-2.2.6" name="section-2.2.6">2.2.6</a>.  Managing Label Blocks</span>

   Label blocks and label values are managed by the PEs.  As sites get
   added and removed, labels are allocated and released.  The easiest
   way to manage these is to use fixed-size label blocks rather than
   variable-size blocks, although the signaling described here supports
   either.  If an implementation uses fixed-size blocks, then allocating
   a label for a new site may requiring allocating a new block;
   similarly, freeing a label may require freeing a block.






<span class="grey">Kompella, et al.              Informational                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   If the implementation requires fixed-size blocks, there is probably a
   default block size, but the implementation SHOULD allow the
   administrator to choose a size.  Larger label block sizes mean more
   potential "wasted" labels but less signaling overhead, a trade-off
   that the administrator might want to control.

   Also, as sites get added and deleted, a PE may receive packets with a
   label that reflects a site that has been deleted locally but not yet
   processed by remote PEs or that reflects a new site added remotely
   but not processed locally.  In either of these cases, the PE SHOULD
   silently discard the packet; it may choose to log the event once for
   each such label, but not for every such packet.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20Operations%2C%20Administration%2C%20and%20Maintenance%20%28OAM%29"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  Operations, Administration, and Maintenance (OAM)</span>

   Many Layer 2 mediums have OAM mechanisms.  For example, the PPP has
   Echo Request and Echo Reply messages; Frame Relay has the Local
   Management Interface.  Among other things, OAM is used for
   troubleshooting and as keepalives.

   There are two ways to carry OAM information across Layer 2 VPNs.  The
   first is to convey OAM packets as any other Layer 2 packets across
   the VPN.  This is the most general method; it maintains full Layer 2
   transparency and preserves all OAM information.  The other method
   applies only to the link liveness aspect of OAM; it consists of
   transmitting the status of each attachment circuit across the control
   plane using the circuit status vector (<a href="#section-3.1">Section 3.1</a>).  This method is
   the only one applicable to Layer 2 Interworking VPNs (<a href="#section-4">Section 4</a>),
   since OAM packets are not IP frames and thus cannot be transmitted
   across such Layer 2 VPNs.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20PE%20Information%20Exchange"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  PE Information Exchange</span>

   When a PE is configured with all the required information for a CE,
   it advertises to other PEs the fact that it is participating in a VPN
   via BGP messages, as per <a href="rfc4761.html#section-3">[RFC4761], Section 3</a>.  BGP was chosen as the
   means for exchanging L2VPN information for two reasons: it offers
   mechanisms for both auto-discovery and signaling, and it allows for
   operational convergence, as explained in <a href="#section-1">Section 1</a>.  A bonus for
   using BGP is a robust inter-AS solution for L2VPNs.

   There are two modifications to the formatting of messages.  The first
   is that the set of Encaps Types carried in the L2-info extended
   community has been expanded to include those from Table 1.  The value
   of the Encaps Type field identifies the Layer 2 encapsulation, e.g.,
   ATM, Frame Relay, etc.





<span class="grey">Kompella, et al.              Informational                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   +-----------+-------------------------------------------+-----------+
   | Encaps    | Description                               | Reference |
   | Type      |                                           |           |
   +-----------+-------------------------------------------+-----------+
   | 0         | Reserved                                  | -         |
   |           |                                           |           |
   | 1         | Frame Relay                               | <a href="rfc4446.html">RFC 4446</a>  |
   |           |                                           |           |
   | 2         | ATM AAL5 SDU VCC transport                | <a href="rfc4446.html">RFC 4446</a>  |
   |           |                                           |           |
   | 3         | ATM transparent cell transport            | <a href="rfc4816.html">RFC 4816</a>  |
   |           |                                           |           |
   | 4         | Ethernet (VLAN) Tagged Mode               | <a href="rfc4448.html">RFC 4448</a>  |
   |           |                                           |           |
   | 5         | Ethernet Raw Mode                         | <a href="rfc4448.html">RFC 4448</a>  |
   |           |                                           |           |
   | 6         | Cisco HDLC                                | <a href="rfc4618.html">RFC 4618</a>  |
   |           |                                           |           |
   | 7         | PPP                                       | <a href="rfc4618.html">RFC 4618</a>  |
   |           |                                           |           |
   | 8         | SONET/SDH Circuit Emulation Service       | <a href="rfc4842.html">RFC 4842</a>  |
   |           |                                           |           |
   | 9         | ATM n-to-one VCC cell transport           | <a href="rfc4717.html">RFC 4717</a>  |
   |           |                                           |           |
   | 10        | ATM n-to-one VPC cell transport           | <a href="rfc4717.html">RFC 4717</a>  |
   |           |                                           |           |
   | 11        | IP Layer 2 Transport                      | <a href="rfc3032.html">RFC 3032</a>  |
   |           |                                           |           |
   | 15        | Frame Relay Port mode                     | <a href="rfc4619.html">RFC 4619</a>  |
   |           |                                           |           |
   | 17        | Structure-agnostic E1 over packet         | <a href="rfc4553.html">RFC 4553</a>  |
   |           |                                           |           |
   | 18        | Structure-agnostic T1 (DS1) over packet   | <a href="rfc4553.html">RFC 4553</a>  |
   |           |                                           |           |
   | 19        | VPLS                                      | <a href="rfc4761.html">RFC 4761</a>  |
   |           |                                           |           |
   | 20        | Structure-agnostic T3 (DS3) over packet   | <a href="rfc4553.html">RFC 4553</a>  |
   |           |                                           |           |
   | 21        | Nx64kbit/s Basic Service using            | <a href="rfc5086.html">RFC 5086</a>  |
   |           | Structure-aware                           |           |
   |           |                                           |           |
   | 25        | Frame Relay DLCI                          | <a href="rfc4619.html">RFC 4619</a>  |
   |           |                                           |           |
   | 40        | Structure-agnostic E3 over packet         | <a href="rfc4553.html">RFC 4553</a>  |
   |           |                                           |           |
   | 41 (1)    | Octet-aligned payload for                 | <a href="rfc4553.html">RFC 4553</a>  |
   |           | Structure-agnostic DS1 circuits           |           |
   |           |                                           |           |



<span class="grey">Kompella, et al.              Informational                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   | 42 (2)    | E1 Nx64kbit/s with CAS using              | <a href="rfc5086.html">RFC 5086</a>  |
   |           | Structure-aware                           |           |
   |           |                                           |           |
   | 43        | DS1 (ESF) Nx64kbit/s with CAS using       | <a href="rfc5086.html">RFC 5086</a>  |
   |           | Structure-aware                           |           |
   |           |                                           |           |
   | 44        | DS1 (SF) Nx64kbit/s with CAS using        | <a href="rfc5086.html">RFC 5086</a>  |
   |           | Structure-aware                           |           |
   +-----------+-------------------------------------------+-----------+

                           Table 1: Encaps Types

   Note (1): Allocation of a separate code point for Encaps Type
   eliminates the need for Time Division Multiplexer (TDM) payload size.

   Note (2): Having separate code points for Encaps Types 42-44 allows
   specifying the trunk framing (i.e., E1, T1 ESF, or T1 SF) with
   Channel Associated Signaling (CAS).

   The second is the introduction of TLVs (Type-Length-Value triplets)
   in the VPLS NLRI (Network Layer Reachability Information).  L2VPN
   TLVs can be added to extend the information carried in the NLRI,
   using the format shown in Figure 2.  In L2VPN TLVs, Type is 1 octet,
   and Length is 2 octets and represents the size of the Value field in
   bits.  L2VPN TLVs, if present, occur as the last element of a VPLS
   NLRI.  The length of the NLRI includes the total length of the TLVs,
   including their headers.

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |     Type      |            Length             |     Value     |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Value (continued, if needed) ...                              |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                         Figure 2: Format of TLVs

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Circuit%20Status%20Vector"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Circuit Status Vector</span>

   This sub-TLV carries the status of an L2VPN PVC between a pair of
   PEs.  Note that an L2VPN PVC is bidirectional, composed of two
   simplex connections going in opposite directions.  A simplex
   connection consists of three segments: 1) the local access circuit
   between the source CE and the ingress PE, 2) the tunnel Label
   Switched Path (LSP) between the ingress and egress PEs, and 3) the
   access circuit between the egress PE and the destination CE.




<span class="grey">Kompella, et al.              Informational                    [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   To monitor the status of a PVC, a PE needs to monitor the status of
   both simplex connections.  Since it knows the status of its access
   circuit and the status of the tunnel towards the remote PE, it can
   inform the remote PE of these two.  Similarly, the remote PE can
   inform the status of its access circuit to its local CE and the
   status of the tunnel to the first PE.  Combining the local and the
   remote information, a PE can determine the status of a PVC.

   The basic unit of advertisement in L2VPN for a given CE is a label
   block.  Each label within a label block corresponds to a PVC on the
   CE.  The local status information for all PVCs corresponding to a
   label block is advertised along with the NLRI for the label block
   using the status vector TLV.  The Type field of this TLV is 1.  The
   Length field of the TLV specifies the length of the value field in
   bits.  The Value field of this TLV is a bit-vector, each bit of which
   indicates the status of the PVC associated with the corresponding
   label in the label block.  Bit value 0 corresponds to the PVC
   associated with the first label in the label block and indicates that
   the local circuit and the tunnel LSP to the remote PE is up, while a
   value of 1 indicates that either or both of them are down.  The Value
   field is padded to the nearest octet boundary.

   A PE can determine the status of a PVC from one of its CEs to a
   remote CE as follows.  Say PE A has CE n in VPN X, and PE A gets an
   advertisement from PE B for remote CE m also in VPN X; this
   advertisement includes a label block and a circuit status vector.  To
   determine which label to use for CE m, PE A must determine the index
   corresponding to CE m in the label block that PE B advertised.  The
   status of the PVC between CE n and CE m can be obtained by looking at
   the bit in the circuit status vector corresponding to this index.

                   +----------+-----------------------+
                   | TLV Type |      Description      |
                   +----------+-----------------------+
                   |     1    | Circuit Status Vector |
                   +----------+-----------------------+

                            Table 2: TLV Types

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Generalizing%20the%20VPN%20Topology"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Generalizing the VPN Topology</span>

   In the above, we assumed for simplicity that the VPN was a full mesh.
   To allow for more general VPN topologies, a mechanism based on
   filtering of BGP extended communities can be used.







<span class="grey">Kompella, et al.              Informational                    [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Layer%202%20Interworking"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Layer 2 Interworking</span>

   As defined so far in this document, all CE-PE connections for a given
   Layer 2 VPN must use the same Layer 2 encapsulation, e.g., they must
   all be Frame Relay.  This is often a burdensome restriction.  One
   answer is to use an existing Layer 2 interworking mechanism, for
   example, Frame Relay-ATM interworking.

   In this document, we take a different approach: we postulate that the
   network Layer is IP and base Layer 2 interworking on that.  Thus, one
   can choose between pure Layer 2 VPNs, with a stringent Layer 2
   restriction but with Layer 3 independence, or Layer 2 interworking
   VPNs, where there is no restriction on Layer 2, but Layer 3 must be
   IP.  Of course, a PE may choose to implement Frame Relay-ATM
   interworking.  For example, an ATM Layer 2 VPN could have some CEs
   connect via Frame Relay links, if their PE could translate Frame
   Relay to ATM transparently to the rest of the VPN.  This would be
   private to the CE-PE connection, and such a course is outside the
   scope of this document.

   For Layer 2 interworking as defined here, when an IP packet arrives
   at a PE, its Layer 2 address is noted, then all Layer 2 overhead is
   stripped, leaving just the IP packet.  Next, a VPN label is added,
   and the packet is encapsulated in the PE-PE tunnel (as required by
   the tunnel technology).  Finally, the packet is forwarded.  Note that
   the forwarding decision is made on the basis of the Layer 2
   information, not the IP header.  At the egress, the VPN label
   determines to which CE the packet must be sent and over which virtual
   circuit; from this, the egress PE can also determine the Layer 2
   encapsulation to place on the packet once the VPN label is stripped.

   An added benefit of restricting interworking to IP only as the Layer
   3 technology is that the provider's network can provide IP Diffserv
   or any other IP-based QoS mechanism to the L2VPN customer.  The
   ingress PE can set up IP/TCP/UDP-based classifiers to do Diffserv
   marking and other functions like policing and shaping on the L2
   circuits of the VPN customer.  Note the division of labor: the CE
   determines the destination CE and encodes that in the Layer 2
   address.  The ingress PE thus determines the egress PE and VPN label
   based on the Layer 2 address supplied by the CE, but the ingress PE
   can choose the tunnel to reach the egress PE (in the case that there
   are different tunnels for each CoS/Diffserv code point) or the CoS
   bits to place in the tunnel (in the case where a single tunnel
   carries multiple CoS/Diffserv code points) based on its own
   classification of the packet.






<span class="grey">Kompella, et al.              Informational                    [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Packet%20Transport"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Packet Transport</span>

   When a packet arrives at a PE from a CE in a Layer 2 VPN, the Layer 2
   address of the packet identifies to which remote attachment circuit
   (and thus remote CE) the packet is destined.  The procedure outlined
   above installs a route that maps the Layer 2 address to a tunnel
   (which identifies the PE to which the destination CE is attached) and
   a VPN label (which identifies the destination AC).  If the egress PE
   is the same as the ingress PE, no tunnel or VPN label is needed.

   The packet may then be modified (depending on the Layer 2
   encapsulation).  In case of IP-only Layer 2 interworking, the Layer 2
   header is completely stripped off up to the IP header.  Then, a VPN
   label and tunnel encapsulation are added as specified by the route
   described above, and the packet is sent to the egress PE.

   If the egress PE is the same as the ingress, the packet "arrives"
   with no labels.  Otherwise, the packet arrives with the VPN label,
   which is used to determine which CE is the destination CE.  The
   packet is restored to a fully formed Layer 2 packet and then sent to
   the CE.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Layer%202%20MTU"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Layer 2 MTU</span>

   This document requires that the Layer 2 MTU configured on all the
   access circuits connecting CEs to PEs in an L2VPN be the same.  This
   can be ensured by passing the configured Layer 2 MTU in the Layer2-
   info extended community when advertising L2VPN label blocks.  On
   receiving an L2VPN label block from remote PEs in a VPN, the MTU
   value carried in the Layer2-info extended community should be
   compared against the configured value for the VPN.  If they don't
   match, then the label block should be ignored.

   The MTU on the Layer 2 access links MUST be chosen such that the size
   of the L2 frames plus the L2VPN header does not exceed the MTU of the
   SP network.  Layer 2 frames that exceed the MTU after encapsulation
   MUST be dropped.  For the case of IP-only Layer 2 interworking, the
   IP MTU on the Layer 2 access link must be chosen such that the size
   of the IP packet and the L2VPN header does not exceed the MTU of the
   SP network.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Layer%202%20Frame%20Format"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Layer 2 Frame Format</span>

   The modification to the Layer 2 frame depends on the Layer 2 type.
   This document requires that the encapsulation methods used in
   transporting Layer 2 frames over tunnels be the same as described in
   [<a href="rfc4448.html" title='"Encapsulation Methods for Transport of Ethernet over MPLS Networks"'>RFC4448</a>], [<a href="rfc4618.html" title='"Encapsulation Methods for Transport of PPP/High-Level Data Link Control (HDLC) over MPLS Networks"'>RFC4618</a>], [<a href="rfc4619.html" title='"Encapsulation Methods for Transport of Frame Relay over Multiprotocol Label Switching (MPLS) Networks"'>RFC4619</a>], and [<a href="rfc4717.html" title='"Encapsulation Methods for Transport of Asynchronous Transfer Mode (ATM) over MPLS Networks"'>RFC4717</a>], except in the case of
   IP-only Layer 2 Interworking, which is described next.



<span class="grey">Kompella, et al.              Informational                    [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20IP-Only%20Layer%202%20Interworking"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  IP-Only Layer 2 Interworking</span>

         +-----------------------------------+
         | PSN Transport |  VPN  |    IP     |     VPN label is the
         |     Header    | Label |  Packet   |     demultiplexing field
         +-----------------------------------+

          Figure 3: Format of IP-Only Layer 2 Interworking Packet

   At the ingress PE, an L2 frame's L2 header is completely stripped off
   and is carried over as an IP packet within the SP network (Figure 3).
   The forwarding decision is still based on the L2 address of the
   incoming L2 frame.  At the egress PE, the IP packet is encapsulated
   back in an L2 frame and transported over to the destination CE.  The
   forwarding decision at the egress PE is based on the VPN label as
   before.  The L2 technology between egress PE and CE is independent of
   the L2 technology between ingress PE and CE.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Security Considerations</span>

   <a href="rfc4761.html">RFC 4761</a> [<a href="rfc4761.html" title='"Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling"'>RFC4761</a>], on which this document is based, has a detailed
   discussion of security considerations.  As in <a href="rfc4761.html">RFC 4761</a>, the focus
   here is the privacy of customer VPN data (as opposed to
   confidentiality, integrity, or authentication of said data); to
   achieve the latter, one can use the methods suggested in <a href="rfc4761.html">RFC 4761</a>.
   The techniques described in <a href="rfc4761.html">RFC 4761</a> for securing the control plane
   and protecting the forwarding path apply equally to L2VPNs, as do the
   remarks regarding multi-AS operation.  The mitigation strategies and
   the analogies with <a href="rfc4364.html">RFC 4364</a> [<a href="rfc4364.html" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>] also apply here.

   <a href="rfc4761.html">RFC 4761</a> perhaps should have discussed Denial-of-Service attacks
   based on the fact that VPLS PEs have to learn Media Access Control
   (MAC) addresses and replicate packets (for flooding and multicast).
   However, those considerations don't apply here, as neither of those
   actions are required of PEs implementing the procedures in this
   document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  IANA Considerations</span>

   IANA has created two new registries: the first is for the one-octet
   Encaps Type field of the L2-info extended community.  The name of the
   registry is "BGP Layer 2 Encapsulation Types"; the values already
   allocated are in Table 1 of <a href="#section-3">Section 3</a>.  The allocation policy for new
   entries up to and including value 127 is "Expert Review" [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].
   The allocation policy for values 128 through 251 is "First Come First
   Served".  The values from 252 through 255 are for "Experimental Use".





<span class="grey">Kompella, et al.              Informational                    [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   The second registry is for the one-octet Type field of the TLVs of
   the VPLS NLRI.  The name of the registry is "BGP L2 TLV Types"; the
   sole allocated value is in Table 2 of <a href="#section-3">Section 3</a>.  The allocation
   policy for new entries up to and including value 127 is "Expert
   Review".  The allocation policy for values 128 through 251 is "First
   Come First Served".  The values from 252 through 255 are for
   "Experimental Use".

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Acknowledgments"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Acknowledgments</span>

   The authors would like to thank Chaitanya Kodeboyina, Dennis
   Ferguson, Der-Hwa Gan, Dave Katz, Nischal Sheth, John Stewart, and
   Paul Traina for the enlightening discussions that helped shape the
   ideas presented here.  The authors also thank Ross Callon for his
   valuable comments.

   The idea of using extended communities for more general connectivity
   of a Layer 2 VPN was a contribution by Yakov Rekhter, who also gave
   many useful comments on the text.  Many thanks to him.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Contributors"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Contributors</span>

   The following individuals contributed to this document.

   Manoj Leelanivas, Juniper Networks
   Quaizar Vohra, Juniper Networks
   Javier Achirica, Consultant
   Ronald Bonica, Juniper Networks
   Dave Cooper, Global Crossing
   Chris Liljenstolpe, Telstra
   Eduard Metz, KPN Dutch Telecom
   Hamid Ould-Brahim, Nortel
   Chandramouli Sargor
   Himanshu Shah, Ciena
   Vijay Srinivasan
   Zhaohui Zhang, Juniper Networks

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20References"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC4360" name="ref-RFC4360">RFC4360</a>]  Sangli, S., Tappan, D., and Y. Rekhter, "BGP Extended
              Communities Attribute", <a href="rfc4360.html">RFC 4360</a>, February 2006.





<span class="grey">Kompella, et al.              Informational                    [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   [<a id="ref-RFC4364" name="ref-RFC4364">RFC4364</a>]  Rosen, E. and Y. Rekhter, "BGP/MPLS IP Virtual Private
              Networks (VPNs)", <a href="rfc4364.html">RFC 4364</a>, February 2006.

   [<a id="ref-RFC4446" name="ref-RFC4446">RFC4446</a>]  Martini, L., "IANA Allocations for Pseudowire Edge to Edge
              Emulation (PWE3)", <a href="https://tools.ietf.org/html/bcp116">BCP 116</a>, <a href="rfc4446.html">RFC 4446</a>, April 2006.

   [<a id="ref-RFC4448" name="ref-RFC4448">RFC4448</a>]  Martini, L., Rosen, E., El-Aawar, N., and G. Heron,
              "Encapsulation Methods for Transport of Ethernet over MPLS
              Networks", <a href="rfc4448.html">RFC 4448</a>, April 2006.

   [<a id="ref-RFC4618" name="ref-RFC4618">RFC4618</a>]  Martini, L., Rosen, E., Heron, G., and A. Malis,
              "Encapsulation Methods for Transport of PPP/High-Level
              Data Link Control (HDLC) over MPLS Networks", <a href="rfc4618.html">RFC 4618</a>,
              September 2006.

   [<a id="ref-RFC4619" name="ref-RFC4619">RFC4619</a>]  Martini, L., Kawa, C., and A. Malis, "Encapsulation
              Methods for Transport of Frame Relay over Multiprotocol
              Label Switching (MPLS) Networks", <a href="rfc4619.html">RFC 4619</a>,
              September 2006.

   [<a id="ref-RFC4717" name="ref-RFC4717">RFC4717</a>]  Martini, L., Jayakumar, J., Bocci, M., El-Aawar, N.,
              Brayley, J., and G. Koleyni, "Encapsulation Methods for
              Transport of Asynchronous Transfer Mode (ATM) over MPLS
              Networks", <a href="rfc4717.html">RFC 4717</a>, December 2006.

   [<a id="ref-RFC4761" name="ref-RFC4761">RFC4761</a>]  Kompella, K. and Y. Rekhter, "Virtual Private LAN Service
              (VPLS) Using BGP for Auto-Discovery and Signaling",
              <a href="rfc4761.html">RFC 4761</a>, January 2007.

   [<a id="ref-RFC5226" name="ref-RFC5226">RFC5226</a>]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", <a href="https://tools.ietf.org/html/bcp26">BCP 26</a>, <a href="rfc5226.html">RFC 5226</a>,
              May 2008.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-Kosiur" name="ref-Kosiur">Kosiur</a>]   Kosiur, D., "Building and Managing Virtual Private
              Networks", Wiley Computer Publishing, 1998.

   [<a id="ref-RFC3985" name="ref-RFC3985">RFC3985</a>]  Bryant, S. and P. Pate, "Pseudo Wire Emulation Edge-to-
              Edge (PWE3) Architecture", <a href="rfc3985.html">RFC 3985</a>, March 2005.

   [<a id="ref-RFC4447" name="ref-RFC4447">RFC4447</a>]  Martini, L., Rosen, E., El-Aawar, N., Smith, T., and G.
              Heron, "Pseudowire Setup and Maintenance Using the Label
              Distribution Protocol (LDP)", <a href="rfc4447.html">RFC 4447</a>, April 2006.







<span class="grey">Kompella, et al.              Informational                    [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc6624.html">RFC 6624</a>       BGP Auto-Discovery and Signaling for L2VPN       May 2012</span>


   [<a id="ref-RFC4684" name="ref-RFC4684">RFC4684</a>]  Marques, P., Bonica, R., Fang, L., Martini, L., Raszuk,
              R., Patel, K., and J. Guichard, "Constrained Route
              Distribution for Border Gateway Protocol/MultiProtocol
              Label Switching (BGP/MPLS) Internet Protocol (IP) Virtual
              Private Networks (VPNs)", <a href="rfc4684.html">RFC 4684</a>, November 2006.

   [<a id="ref-RFC4762" name="ref-RFC4762">RFC4762</a>]  Lasserre, M. and V. Kompella, "Virtual Private LAN Service
              (VPLS) Using Label Distribution Protocol (LDP) Signaling",
              <a href="rfc4762.html">RFC 4762</a>, January 2007.

   [<a id="ref-RFC6074" name="ref-RFC6074">RFC6074</a>]  Rosen, E., Davie, B., Radoaca, V., and W. Luo,
              "Provisioning, Auto-Discovery, and Signaling in Layer 2
              Virtual Private Networks (L2VPNs)", <a href="rfc6074.html">RFC 6074</a>,
              January 2011.

Authors' Addresses

   Kireeti Kompella
   Juniper Networks
   1194 N. Mathilda Ave.
   Sunnyvale, CA  94089
   USA

   EMail: kireeti@juniper.net


   Bhupesh Kothari
   Cisco Systems
   3750 Cisco Way
   San Jose, CA  95134
   USA

   EMail: bhupesh@cisco.com


   Rao Cherukuri
   Juniper Networks
   1194 N. Mathilda Ave.
   Sunnyvale, CA  94089
   USA

   EMail: cherukuri@juniper.net









Kompella, et al.              Informational                    [Page 26]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc6624 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:27 GMT --></html>