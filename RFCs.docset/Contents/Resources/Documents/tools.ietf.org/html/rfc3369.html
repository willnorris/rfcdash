<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc3369 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:47 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="rfc2630" name="DC.Relation.Replaces"/>
<meta content="rfc3211" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:3369" name="DC.Identifier"/>
<meta content="August, 2002" name="DC.Date.Issued"/>
<meta content="Russell Housley &lt;rhousley@rsasecurity.com&gt;" name="DC.Creator"/>
<meta content="This document describes the Cryptographic Message Syntax (CMS). This
syntax is used to digitally sign, digest, authenticate, or encrypt
arbitrary message content." name="DC.Description.Abstract"/>
<meta content="Cryptographic Message Syntax" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 3369 - Cryptographic Message Syntax</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgbrown" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc3369.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc3369" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-smime-rfc2630bis" title="draft-ietf-smime-rfc2630bis">draft-ietf-smim...</a>] [<a href="https://datatracker.ietf.org/doc/rfc3369" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc3369" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc3369" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=3369">Errata</a>]</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">Obsoleted by: <a href="rfc3852.html">3852</a>                                     PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                                         R. Housley
Request for Comments: 3369                              RSA Laboratories
Obsoletes: <a href="rfc2630.html">2630</a>, <a href="rfc3211.html">3211</a>                                        August 2002
Category: Standards Track


                   <span class="h1">Cryptographic Message Syntax (CMS)</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

Abstract

   This document describes the Cryptographic Message Syntax (CMS).  This
   syntax is used to digitally sign, digest, authenticate, or encrypt
   arbitrary message content.

Table of Contents

   <a href="#section-1">1</a>.   Introduction ................................................  <a href="#page-3">3</a>
   <a href="#section-1.1">1.1</a>  Changes Since <a href="rfc2630.html">RFC 2630</a> ......................................  <a href="#page-3">3</a>
   <a href="#section-1.2">1.2</a>  Terminology .................................................  <a href="#page-4">4</a>
   <a href="#section-2">2</a>.   General Overview ............................................  <a href="#page-4">4</a>
   <a href="#section-3">3</a>.   General Syntax ..............................................  <a href="#page-5">5</a>
   <a href="#section-4">4</a>.   Data Content Type ...........................................  <a href="#page-5">5</a>
   <a href="#section-5">5</a>.   Signed-data Content Type ....................................  <a href="#page-6">6</a>
   <a href="#section-5.1">5.1</a>  SignedData Type .............................................  <a href="#page-7">7</a>
   <a href="#section-5.2">5.2</a>  EncapsulatedContentInfo Type ................................  <a href="#page-9">9</a>
   <a href="#section-5.2.1">5.2.1</a>  Compatibility with PKCS #7 ................................  <a href="#page-9">9</a>
   <a href="#section-5.3">5.3</a>  SignerInfo Type ............................................. <a href="#page-11">11</a>
   <a href="#section-5.4">5.4</a>  Message Digest Calculation Process .......................... <a href="#page-13">13</a>
   <a href="#section-5.5">5.5</a>  Signature Generation Process ................................ <a href="#page-14">14</a>
   <a href="#section-5.6">5.6</a>  Signature Verification Process .............................. <a href="#page-14">14</a>
   <a href="#section-6">6</a>.   Enveloped-data Content Type ................................. <a href="#page-14">14</a>
   <a href="#section-6.1">6.1</a>  EnvelopedData Type .......................................... <a href="#page-16">16</a>
   <a href="#section-6.2">6.2</a>  RecipientInfo Type .......................................... <a href="#page-18">18</a>
   <a href="#section-6.2.1">6.2.1</a>  KeyTransRecipientInfo Type ................................ <a href="#page-19">19</a>
   <a href="#section-6.2.2">6.2.2</a>  KeyAgreeRecipientInfo Type ................................ <a href="#page-20">20</a>
   <a href="#section-6.2.3">6.2.3</a>  KEKRecipientInfo Type ..................................... <a href="#page-22">22</a>



<span class="grey">Housley                     Standards Track                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   <a href="#section-6.2.4">6.2.4</a>  PasswordRecipientInfo Type ................................ <a href="#page-23">23</a>
   <a href="#section-6.2.5">6.2.5</a>  OtherRecipientInfo Type ................................... <a href="#page-24">24</a>
   <a href="#section-6.3">6.3</a>  Content-encryption Process .................................. <a href="#page-24">24</a>
   <a href="#section-6.4">6.4</a>  Key-encryption Process ...................................... <a href="#page-25">25</a>
   <a href="#section-7">7</a>.   Digested-data Content Type .................................. <a href="#page-25">25</a>
   <a href="#section-8">8</a>.   Encrypted-data Content Type ................................. <a href="#page-26">26</a>
   <a href="#section-9">9</a>.   Authenticated-data Content Type ............................. <a href="#page-27">27</a>
   <a href="#section-9.1">9.1</a>  AuthenticatedData Type ...................................... <a href="#page-28">28</a>
   <a href="#section-9.2">9.2</a>  MAC Generation .............................................. <a href="#page-29">29</a>
   <a href="#section-9.3">9.3</a>  MAC Verification ............................................ <a href="#page-31">31</a>
   <a href="#section-10">10</a>.  Useful Types ................................................ <a href="#page-31">31</a>
   <a href="#section-10.1">10.1</a>  Algorithm Identifier Types ................................. <a href="#page-31">31</a>
   <a href="#section-10.1.1">10.1.1</a>  DigestAlgorithmIdentifier ................................ <a href="#page-31">31</a>
   <a href="#section-10.1.2">10.1.2</a>  SignatureAlgorithmIdentifier ............................. <a href="#page-32">32</a>
   <a href="#section-10.1.3">10.1.3</a>  KeyEncryptionAlgorithmIdentifier ......................... <a href="#page-32">32</a>
   <a href="#section-10.1.4">10.1.4</a>  ContentEncryptionAlgorithmIdentifier ..................... <a href="#page-32">32</a>
   <a href="#section-10.1.5">10.1.5</a>  MessageAuthenticationCodeAlgorithm ....................... <a href="#page-32">32</a>
   <a href="#section-10.1.6">10.1.6</a>  KeyDerivationAlgorithmIdentifier ......................... <a href="#page-33">33</a>
   <a href="#section-10.2">10.2</a>  Other Useful Types ......................................... <a href="#page-33">33</a>
   <a href="#section-10.2.1">10.2.1</a>  CertificateRevocationLists ............................... <a href="#page-33">33</a>
   <a href="#section-10.2.2">10.2.2</a>  CertificateChoices ....................................... <a href="#page-33">33</a>
   <a href="#section-10.2.3">10.2.3</a>  CertificateSet ........................................... <a href="#page-34">34</a>
   <a href="#section-10.2.4">10.2.4</a>  IssuerAndSerialNumber .................................... <a href="#page-34">34</a>
   <a href="#section-10.2.5">10.2.5</a>  CMSVersion ............................................... <a href="#page-35">35</a>
   <a href="#section-10.2.6">10.2.6</a>  UserKeyingMaterial ....................................... <a href="#page-35">35</a>
   <a href="#section-10.2.7">10.2.7</a>  OtherKeyAttribute ........................................ <a href="#page-35">35</a>
   <a href="#section-11">11</a>.  Useful Attributes ........................................... <a href="#page-35">35</a>
   <a href="#section-11.1">11.1</a>  Content Type ............................................... <a href="#page-36">36</a>
   <a href="#section-11.2">11.2</a>  Message Digest ............................................. <a href="#page-36">36</a>
   <a href="#section-11.3">11.3</a>  Signing Time ............................................... <a href="#page-37">37</a>
   <a href="#section-11.4">11.4</a>  Countersignature ........................................... <a href="#page-39">39</a>
   <a href="#section-12">12</a>.  ASN.1 Modules ............................................... <a href="#page-40">40</a>
   <a href="#section-12.1">12.1</a>  CMS ASN.1 Module ........................................... <a href="#page-40">40</a>
   <a href="#section-12.2">12.2</a>  Version 1 Attribute Certificate ASN.1 Module ............... <a href="#page-46">46</a>
   <a href="#section-13">13</a>.  References .................................................. <a href="#page-47">47</a>
   <a href="#section-14">14</a>.  Security Considerations ..................................... <a href="#page-48">48</a>
   <a href="#section-15">15</a>.  Acknowledgments ............................................. <a href="#page-50">50</a>
   <a href="#section-16">16</a>.  Author Address .............................................. <a href="#page-50">50</a>
   <a href="#section-17">17</a>.  Full Copyright Statement .................................... <a href="#page-51">51</a>












<span class="grey">Housley                     Standards Track                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>. Introduction</span>

   This document describes the Cryptographic Message Syntax (CMS).  This
   syntax is used to digitally sign, digest, authenticate, or encrypt
   arbitrary message content.

   The CMS describes an encapsulation syntax for data protection.  It
   supports digital signatures and encryption.  The syntax allows
   multiple encapsulations; one encapsulation envelope can be nested
   inside another.  Likewise, one party can digitally sign some
   previously encapsulated data.  It also allows arbitrary attributes,
   such as signing time, to be signed along with the message content,
   and provides for other attributes such as countersignatures to be
   associated with a signature.

   The CMS can support a variety of architectures for certificate-based
   key management, such as the one defined by the PKIX working group
   [<a href="#ref-PROFILE" title='"Internet X.509 Public Key Infrastructure: Certificate and CRL Profile"'>PROFILE</a>].

   The CMS values are generated using ASN.1 [<a href="#ref-X.208-88">X.208-88</a>], using BER-
   encoding [<a href="#ref-X.209-88">X.209-88</a>].  Values are typically represented as octet
   strings.  While many systems are capable of transmitting arbitrary
   octet strings reliably, it is well known that many electronic mail
   systems are not.  This document does not address mechanisms for
   encoding octet strings for reliable transmission in such
   environments.

   The CMS is derived from PKCS #7 version 1.5 as specified in <a href="rfc2315.html">RFC 2315</a>
   [PKCS#7].  Wherever possible, backward compatibility is preserved;
   however, changes were necessary to accommodate version 1 attribute
   certificate transfer, key agreement and symmetric key-encryption key
   techniques for key management.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1%20%20Changes%20Since%20RFC%202630"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>  Changes Since <a href="rfc2630.html">RFC 2630</a></span>

   This document obsoletes <a href="rfc2630.html">RFC 2630</a> [<a href="#ref-OLDCMS" title='"Cryptographic Message Syntax"'>OLDCMS</a>] and <a href="rfc3211.html">RFC 3211</a> [<a href="#ref-PWRI" title='"Password-based Encryption for S/MIME"'>PWRI</a>].
   Password-based key management is included in the CMS specification,
   and an extension mechanism to support new key management schemes
   without further changes to the CMS is specified.  Backward
   compatibility with <a href="rfc2630.html">RFC 2630</a> and <a href="rfc3211.html">RFC 3211</a> is preserved; however,
   version 2 attribute certificate transfer is added.  The use of
   version 1 attribute certificates is deprecated.

   S/MIME v2 signatures [<a href="#ref-OLDMSG" title='"S/MIME Version 2 Message Specification"'>OLDMSG</a>], which are based on PKCS#7 version 1.5,
   are compatible with S/MIME v3 signatures [<a href="#ref-MSG" title='"S/MIME Version 3 Message Specification"'>MSG</a>], which are based on
   <a href="rfc2630.html">RFC 2630</a>.  However, there are some subtle compatibility issues with
   signatures using PKCS#7 version 1.5 and the CMS.  These issues are
   discussed in <a href="#section-5.2.1">section 5.2.1</a>.



<span class="grey">Housley                     Standards Track                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   Specific cryptographic algorithms are not discussed in this document,
   but they were discussed in <a href="rfc2630.html">RFC 2630</a>.  The discussion of specific
   cryptographic algorithms has been moved to a separate document
   [<a href="#ref-CMSALG" title='"Cryptographic Message Syntax (CMS) Algorithms"'>CMSALG</a>].  Separation of the protocol and algorithm specifications
   allows the IETF to update each document independently.  This
   specification does not require the implementation of any particular
   algorithms.  Rather, protocols that rely on the CMS are expected to
   choose appropriate algorithms for their environment.  The algorithms
   may be selected from [<a href="#ref-CMSALG" title='"Cryptographic Message Syntax (CMS) Algorithms"'>CMSALG</a>] or elsewhere.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2%20%20Terminology"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>  Terminology</span>

   In this document, the key words MUST, MUST NOT, REQUIRED, SHOULD,
   SHOULD NOT, RECOMMENDED, MAY, and OPTIONAL are to be interpreted as
   described in [<a href="#ref-STDWORDS" title='"Key Words for Use in RFCs to Indicate Requirement Levels"'>STDWORDS</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2%20%20General%20Overview"></a><a class="selflink" href="#section-2" name="section-2">2</a>  General Overview</span>

   The CMS is general enough to support many different content types.
   This document defines one protection content, ContentInfo.
   ContentInfo encapsulates a single identified content type, and the
   identified type may provide further encapsulation.  This document
   defines six content types: data, signed-data, enveloped-data,
   digested-data, encrypted-data, and authenticated-data.  Additional
   content types can be defined outside this document.

   An implementation that conforms to this specification MUST implement
   the protection content, ContentInfo, and MUST implement the data,
   signed-data, and enveloped-data content types.  The other content
   types MAY be implemented.

   As a general design philosophy, each content type permits single pass
   processing using indefinite-length Basic Encoding Rules (BER)
   encoding.  Single-pass operation is especially helpful if content is
   large, stored on tapes, or is "piped" from another process.  Single-
   pass operation has one significant drawback: it is difficult to
   perform encode operations using the Distinguished Encoding Rules
   (DER) [<a href="#ref-X.509-88">X.509-88</a>] encoding in a single pass since the lengths of the
   various components may not be known in advance.  However, signed
   attributes within the signed-data content type and authenticated
   attributes within the authenticated-data content type need to be
   transmitted in DER form to ensure that recipients can verify a
   content that contains one or more unrecognized attributes.  Signed
   attributes and authenticated attributes are the only data types used
   in the CMS that require DER encoding.






<span class="grey">Housley                     Standards Track                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3%20%20General%20Syntax"></a><a class="selflink" href="#section-3" name="section-3">3</a>  General Syntax</span>

   The following object identifier identifies the content information
   type:

      id-ct-contentInfo OBJECT IDENTIFIER ::= { iso(1) member-body(2)
         us(840) rsadsi(113549) pkcs(1) pkcs9(9) smime(16) ct(1) 6 }

   The CMS associates a content type identifier with a content.  The
   syntax MUST have ASN.1 type ContentInfo:

      ContentInfo ::= SEQUENCE {
        contentType ContentType,
        content [0] EXPLICIT ANY DEFINED BY contentType }

      ContentType ::= OBJECT IDENTIFIER

   The fields of ContentInfo have the following meanings:

      contentType indicates the type of the associated content.  It is
      an object identifier; it is a unique string of integers assigned
      by an authority that defines the content type.

      content is the associated content.  The type of content can be
      determined uniquely by contentType.  Content types for data,
      signed-data, enveloped-data, digested-data, encrypted-data, and
      authenticated-data are defined in this document.  If additional
      content types are defined in other documents, the ASN.1 type
      defined SHOULD NOT be a CHOICE type.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4%20%20Data%20Content%20Type"></a><a class="selflink" href="#section-4" name="section-4">4</a>  Data Content Type</span>

   The following object identifier identifies the data content type:

      id-data OBJECT IDENTIFIER ::= { iso(1) member-body(2)
         us(840) rsadsi(113549) pkcs(1) pkcs7(7) 1 }

   The data content type is intended to refer to arbitrary octet
   strings, such as ASCII text files; the interpretation is left to the
   application.  Such strings need not have any internal structure
   (although they could have their own ASN.1 definition or other
   structure).

   S/MIME uses id-data to identify MIME encoded content.  The use of
   this content identifier is specified in <a href="rfc2311.html">RFC 2311</a> for S/MIME v2
   [<a href="#ref-OLDMSG" title='"S/MIME Version 2 Message Specification"'>OLDMSG</a>] and <a href="rfc2633.html">RFC 2633</a> for S/MIME v3 [<a href="#ref-MSG" title='"S/MIME Version 3 Message Specification"'>MSG</a>].





<span class="grey">Housley                     Standards Track                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   The data content type is generally encapsulated in the signed-data,
   enveloped-data, digested-data, encrypted-data, or authenticated-data
   content type.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Signed-data%20Content%20Type"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Signed-data Content Type</span>

   The signed-data content type consists of a content of any type and
   zero or more signature values.  Any number of signers in parallel can
   sign any type of content.

   The typical application of the signed-data content type represents
   one signer's digital signature on content of the data content type.
   Another typical application disseminates certificates and certificate
   revocation lists (CRLs).

   The process by which signed-data is constructed involves the
   following steps:

      1.  For each signer, a message digest, or hash value, is computed
      on the content with a signer-specific message-digest algorithm.
      If the signer is signing any information other than the content,
      the message digest of the content and the other information are
      digested with the signer's message digest algorithm (see <a href="#section-5.4">Section</a>
      <a href="#section-5.4">5.4</a>), and the result becomes the "message digest."

      2.  For each signer, the message digest is digitally signed using
      the signer's private key.

      3.  For each signer, the signature value and other signer-specific
      information are collected into a SignerInfo value, as defined in
      <a href="#section-5.3">Section 5.3</a>.  Certificates and CRLs for each signer, and those not
      corresponding to any signer, are collected in this step.

      4.  The message digest algorithms for all the signers and the
      SignerInfo values for all the signers are collected together with
      the content into a SignedData value, as defined in <a href="#section-5.1">Section 5.1</a>.

   A recipient independently computes the message digest.  This message
   digest and the signer's public key are used to verify the signature
   value.  The signer's public key is referenced either by an issuer
   distinguished name along with an issuer-specific serial number or by
   a subject key identifier that uniquely identifies the certificate
   containing the public key.  The signer's certificate can be included
   in the SignedData certificates field.







<span class="grey">Housley                     Standards Track                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   This section is divided into six parts.  The first part describes the
   top-level type SignedData, the second part describes
   EncapsulatedContentInfo, the third part describes the per-signer
   information type SignerInfo, and the fourth, fifth, and sixth parts
   describe the message digest calculation, signature generation, and
   signature verification processes, respectively.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1%20%20SignedData%20Type"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>  SignedData Type</span>

   The following object identifier identifies the signed-data content
   type:

      id-signedData OBJECT IDENTIFIER ::= { iso(1) member-body(2)
         us(840) rsadsi(113549) pkcs(1) pkcs7(7) 2 }

   The signed-data content type shall have ASN.1 type SignedData:

      SignedData ::= SEQUENCE {
        version CMSVersion,
        digestAlgorithms DigestAlgorithmIdentifiers,
        encapContentInfo EncapsulatedContentInfo,
        certificates [0] IMPLICIT CertificateSet OPTIONAL,
        crls [1] IMPLICIT CertificateRevocationLists OPTIONAL,
        signerInfos SignerInfos }

      DigestAlgorithmIdentifiers ::= SET OF DigestAlgorithmIdentifier

      SignerInfos ::= SET OF SignerInfo

   The fields of type SignedData have the following meanings:

      version is the syntax version number.  The appropriate value
      depends on certificates, eContentType, and SignerInfo.  The
      version MUST be assigned as follows:

         IF (certificates is present) AND
             (any version 2 attribute certificates are present)
         THEN version MUST be 4
         ELSE
             IF ((certificates is present) AND
                (any version 1 attribute certificates are present)) OR
                (encapContentInfo eContentType is other than id-data) OR
                (any SignerInfo structures are version 3)
             THEN version MUST be 3
             ELSE version MUST be 1






<span class="grey">Housley                     Standards Track                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


      digestAlgorithms is a collection of message digest algorithm
      identifiers.  There MAY be any number of elements in the
      collection, including zero.  Each element identifies the message
      digest algorithm, along with any associated parameters, used by
      one or more signer.  The collection is intended to list the
      message digest algorithms employed by all of the signers, in any
      order, to facilitate one-pass signature verification.
      Implementations MAY fail to validate signatures that use a digest
      algorithm that is not included in this set.  The message digesting
      process is described in <a href="#section-5.4">Section 5.4</a>.

      encapContentInfo is the signed content, consisting of a content
      type identifier and the content itself.  Details of the
      EncapsulatedContentInfo type are discussed in <a href="#section-5.2">section 5.2</a>.

      certificates is a collection of certificates.  It is intended that
      the set of certificates be sufficient to contain chains from a
      recognized "root" or "top-level certification authority" to all of
      the signers in the signerInfos field.  There may be more
      certificates than necessary, and there may be certificates
      sufficient to contain chains from two or more independent top-
      level certification authorities.  There may also be fewer
      certificates than necessary, if it is expected that recipients
      have an alternate means of obtaining necessary certificates (e.g.,
      from a previous set of certificates).  The signer's certificate
      MAY be included.  The use of version 1 attribute certificates is
      strongly discouraged.

      crls is a collection of certificate revocation lists (CRLs).  It
      is intended that the set contain information sufficient to
      determine whether or not the certificates in the certificates
      field are valid, but such correspondence is not necessary.  There
      MAY be more CRLs than necessary, and there MAY also be fewer CRLs
      than necessary.

      signerInfos is a collection of per-signer information.  There MAY
      be any number of elements in the collection, including zero.  The
      details of the SignerInfo type are discussed in <a href="#section-5.3">section 5.3</a>.
      Since each signer can employ a digital signature technique and
      future specifications could update the syntax, all implementations
      MUST gracefully handle unimplemented versions of SignerInfo.
      Further, since all implementations will not support every possible
      signature algorithm, all implementations MUST gracefully handle
      unimplemented signature algorithms when they are encountered.







<span class="grey">Housley                     Standards Track                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2%20%20EncapsulatedContentInfo%20Type"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>  EncapsulatedContentInfo Type</span>

   The content is represented in the type EncapsulatedContentInfo:

      EncapsulatedContentInfo ::= SEQUENCE {
        eContentType ContentType,
        eContent [0] EXPLICIT OCTET STRING OPTIONAL }

      ContentType ::= OBJECT IDENTIFIER

   The fields of type EncapsulatedContentInfo have the following
   meanings:

      eContentType is an object identifier.  The object identifier
      uniquely specifies the content type.

      eContent is the content itself, carried as an octet string.  The
      eContent need not be DER encoded.

   The optional omission of the eContent within the
   EncapsulatedContentInfo field makes it possible to construct
   "external signatures."  In the case of external signatures, the
   content being signed is absent from the EncapsulatedContentInfo value
   included in the signed-data content type.  If the eContent value
   within EncapsulatedContentInfo is absent, then the signatureValue is
   calculated and the eContentType is assigned as though the eContent
   value was present.

   In the degenerate case where there are no signers, the
   EncapsulatedContentInfo value being "signed" is irrelevant.  In this
   case, the content type within the EncapsulatedContentInfo value being
   "signed" MUST be id-data (as defined in <a href="#section-4">section 4</a>), and the content
   field of the EncapsulatedContentInfo value MUST be omitted.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.1%20%20Compatibility%20with%20PKCS%20%237"></a><a class="selflink" href="#section-5.2.1" name="section-5.2.1">5.2.1</a>  Compatibility with PKCS #7</span>

   This section contains a word of warning to implementers that wish to
   support both the CMS and PKCS #7 [PKCS#7] SignedData content types.
   Both the CMS and PKCS #7 identify the type of the encapsulated
   content with an object identifier, but the ASN.1 type of the content
   itself is variable in PKCS #7 SignedData content type.

   PKCS #7 defines content as:

      content [0] EXPLICIT ANY DEFINED BY contentType OPTIONAL






<span class="grey">Housley                     Standards Track                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   The CMS defines eContent as:

      eContent [0] EXPLICIT OCTET STRING OPTIONAL

   The CMS definition is much easier to use in most applications, and it
   is compatible with both S/MIME v2 and S/MIME v3.  S/MIME signed
   messages using the CMS and PKCS #7 are compatible because identical
   signed message formats are specified in <a href="rfc2311.html">RFC 2311</a> for S/MIME v2
   [<a href="#ref-OLDMSG" title='"S/MIME Version 2 Message Specification"'>OLDMSG</a>] and <a href="rfc2633.html">RFC 2633</a> for S/MIME v3 [<a href="#ref-MSG" title='"S/MIME Version 3 Message Specification"'>MSG</a>].  S/MIME v2 encapsulates
   the MIME content in a Data type (that is, an OCTET STRING) carried in
   the SignedData contentInfo content ANY field, and S/MIME v3 carries
   the MIME content in the SignedData encapContentInfo eContent OCTET
   STRING.  Therefore, in both S/MIME v2 and S/MIME v3, the MIME content
   is placed in an OCTET STRING and the message digest is computed over
   the identical portions of the content.  That is, the message digest
   is computed over the octets comprising the value of the OCTET STRING,
   neither the tag nor length octets are included.

   There are incompatibilities between the CMS and PKCS #7 signedData
   types when the encapsulated content is not formatted using the Data
   type.  For example, when an <a href="rfc2634.html">RFC 2634</a> [<a href="#ref-ESS" title='"Enhanced Security Services for S/MIME"'>ESS</a>] signed receipt is
   encapsulated in the CMS signedData type, then the Receipt SEQUENCE is
   encoded in the signedData encapContentInfo eContent OCTET STRING and
   the message digest is computed using the entire Receipt SEQUENCE
   encoding (including tag, length and value octets).  However, if an
   <a href="rfc2634.html">RFC 2634</a> signed receipt is encapsulated in the PKCS #7 signedData
   type, then the Receipt SEQUENCE is DER encoded [<a href="#ref-X.509-88">X.509-88</a>] in the
   SignedData contentInfo content ANY field (a SEQUENCE, not an OCTET
   STRING).  Therefore, the message digest is computed using only the
   value octets of the Receipt SEQUENCE encoding.

   The following strategy can be used to achieve backward compatibility
   with PKCS #7 when processing SignedData content types.  If the
   implementation is unable to ASN.1 decode the signedData type using
   the CMS signedData encapContentInfo eContent OCTET STRING syntax,
   then the implementation MAY attempt to decode the signedData type
   using the PKCS #7 SignedData contentInfo content ANY syntax and
   compute the message digest accordingly.

   The following strategy can be used to achieve backward compatibility
   with PKCS #7 when creating a SignedData content type in which the
   encapsulated content is not formatted using the Data type.
   Implementations MAY examine the value of the eContentType, and then
   adjust the expected DER encoding of eContent based on the object
   identifier value.  For example, to support Microsoft AuthentiCode,
   the following information MAY be included:





<span class="grey">Housley                     Standards Track                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


      eContentType Object Identifier is set to { 1 3 6 1 4 1 311 2 1 4 }

      eContent contains DER encoded AuthentiCode signing information

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3%20%20SignerInfo%20Type"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>  SignerInfo Type</span>

   Per-signer information is represented in the type SignerInfo:

      SignerInfo ::= SEQUENCE {
        version CMSVersion,
        sid SignerIdentifier,
        digestAlgorithm DigestAlgorithmIdentifier,
        signedAttrs [0] IMPLICIT SignedAttributes OPTIONAL,
        signatureAlgorithm SignatureAlgorithmIdentifier,
        signature SignatureValue,
        unsignedAttrs [1] IMPLICIT UnsignedAttributes OPTIONAL }

      SignerIdentifier ::= CHOICE {
        issuerAndSerialNumber IssuerAndSerialNumber,
        subjectKeyIdentifier [0] SubjectKeyIdentifier }

      SignedAttributes ::= SET SIZE (1..MAX) OF Attribute

      UnsignedAttributes ::= SET SIZE (1..MAX) OF Attribute

      Attribute ::= SEQUENCE {
        attrType OBJECT IDENTIFIER,
        attrValues SET OF AttributeValue }

      AttributeValue ::= ANY

      SignatureValue ::= OCTET STRING

   The fields of type SignerInfo have the following meanings:

      version is the syntax version number.  If the SignerIdentifier is
      the CHOICE issuerAndSerialNumber, then the version MUST be 1.  If
      the SignerIdentifier is subjectKeyIdentifier, then the version
      MUST be 3.

      sid specifies the signer's certificate (and thereby the signer's
      public key).  The signer's public key is needed by the recipient
      to verify the signature.  SignerIdentifier provides two
      alternatives for specifying the signer's public key.  The
      issuerAndSerialNumber alternative identifies the signer's
      certificate by the issuer's distinguished name and the certificate
      serial number; the subjectKeyIdentifier identifies the signer's
      certificate by the X.509 subjectKeyIdentifier extension value.



<span class="grey">Housley                     Standards Track                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


      Implementations MUST support the reception of the
      issuerAndSerialNumber and subjectKeyIdentifier forms of
      SignerIdentifier.  When generating a SignerIdentifier,
      implementations MAY support one of the forms (either
      issuerAndSerialNumber or subjectKeyIdentifier) and always use it,
      or implementations MAY arbitrarily mix the two forms.

      digestAlgorithm identifies the message digest algorithm, and any
      associated parameters, used by the signer.  The message digest is
      computed on either the content being signed or the content
      together with the signed attributes using the process described in
      <a href="#section-5.4">section 5.4</a>.  The message digest algorithm SHOULD be among those
      listed in the digestAlgorithms field of the associated SignerData.
      Implementations MAY fail to validate signatures that use a digest
      algorithm that is not included in the SignedData digestAlgorithms
      set.

      signedAttrs is a collection of attributes that are signed.  The
      field is optional, but it MUST be present if the content type of
      the EncapsulatedContentInfo value being signed is not id-data.
      SignedAttributes MUST be DER encoded, even if the rest of the
      structure is BER encoded.  Useful attribute types, such as signing
      time, are defined in <a href="#section-11">Section 11</a>.  If the field is present, it MUST
      contain, at a minimum, the following two attributes:

         A content-type attribute having as its value the content type
         of the EncapsulatedContentInfo value being signed.  <a href="#section-11.1">Section</a>
         <a href="#section-11.1">11.1</a> defines the content-type attribute.  However, the
         content-type attribute MUST NOT be used as part of a
         countersignature unsigned attribute as defined in <a href="#section-11.4">section 11.4</a>.

         A message-digest attribute, having as its value the message
         digest of the content.  <a href="#section-11.2">Section 11.2</a> defines the message-digest
         attribute.

      signatureAlgorithm identifies the signature algorithm, and any
      associated parameters, used by the signer to generate the digital
      signature.

      signature is the result of digital signature generation, using the
      message digest and the signer's private key.  The details of the
      signature depend on the signature algorithm employed.

      unsignedAttrs is a collection of attributes that are not signed.
      The field is optional.  Useful attribute types, such as
      countersignatures, are defined in <a href="#section-11">Section 11</a>.





<span class="grey">Housley                     Standards Track                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   The fields of type SignedAttribute and UnsignedAttribute have the
   following meanings:

      attrType indicates the type of attribute.  It is an object
      identifier.

      attrValues is a set of values that comprise the attribute.  The
      type of each value in the set can be determined uniquely by
      attrType.  The attrType can impose restrictions on the number of
      items in the set.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.4%20%20Message%20Digest%20Calculation%20Process"></a><a class="selflink" href="#section-5.4" name="section-5.4">5.4</a>  Message Digest Calculation Process</span>

   The message digest calculation process computes a message digest on
   either the content being signed or the content together with the
   signed attributes.  In either case, the initial input to the message
   digest calculation process is the "value" of the encapsulated content
   being signed.  Specifically, the initial input is the
   encapContentInfo eContent OCTET STRING to which the signing process
   is applied.  Only the octets comprising the value of the eContent
   OCTET STRING are input to the message digest algorithm, not the tag
   or the length octets.

   The result of the message digest calculation process depends on
   whether the signedAttrs field is present.  When the field is absent,
   the result is just the message digest of the content as described
   above.  When the field is present, however, the result is the message
   digest of the complete DER encoding of the SignedAttrs value
   contained in the signedAttrs field.  Since the SignedAttrs value,
   when present, must contain the content-type and the message-digest
   attributes, those values are indirectly included in the result.  The
   content-type attribute MUST NOT be included in a countersignature
   unsigned attribute as defined in <a href="#section-11.4">section 11.4</a>.  A separate encoding
   of the signedAttrs field is performed for message digest calculation.
   The IMPLICIT [0] tag in the signedAttrs is not used for the DER
   encoding, rather an EXPLICIT SET OF tag is used.  That is, the DER
   encoding of the EXPLICIT SET OF tag, rather than of the IMPLICIT [0]
   tag, MUST be included in the message digest calculation along with
   the length and content octets of the SignedAttributes value.

   When the signedAttrs field is absent, only the octets comprising the
   value of the signedData encapContentInfo eContent OCTET STRING (e.g.,
   the contents of a file) are input to the message digest calculation.
   This has the advantage that the length of the content being signed
   need not be known in advance of the signature generation process.






<span class="grey">Housley                     Standards Track                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   Although the encapContentInfo eContent OCTET STRING tag and length
   octets are not included in the message digest calculation, they are
   protected by other means.  The length octets are protected by the
   nature of the message digest algorithm since it is computationally
   infeasible to find any two distinct message contents of any length
   that have the same message digest.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.5%20%20Signature%20Generation%20Process"></a><a class="selflink" href="#section-5.5" name="section-5.5">5.5</a>  Signature Generation Process</span>

   The input to the signature generation process includes the result of
   the message digest calculation process and the signer's private key.
   The details of the signature generation depend on the signature
   algorithm employed.  The object identifier, along with any
   parameters, that specifies the signature algorithm employed by the
   signer is carried in the signatureAlgorithm field.  The signature
   value generated by the signer MUST be encoded as an OCTET STRING and
   carried in the signature field.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.6%20%20Signature%20Verification%20Process"></a><a class="selflink" href="#section-5.6" name="section-5.6">5.6</a>  Signature Verification Process</span>

   The input to the signature verification process includes the result
   of the message digest calculation process and the signer's public
   key.  The recipient MAY obtain the correct public key for the signer
   by any means, but the preferred method is from a certificate obtained
   from the SignedData certificates field.  The selection and validation
   of the signer's public key MAY be based on certification path
   validation (see [<a href="#ref-PROFILE" title='"Internet X.509 Public Key Infrastructure: Certificate and CRL Profile"'>PROFILE</a>]) as well as other external context, but is
   beyond the scope of this document.  The details of the signature
   verification depend on the signature algorithm employed.

   The recipient MUST NOT rely on any message digest values computed by
   the originator.  If the SignedData signerInfo includes
   signedAttributes, then the content message digest MUST be calculated
   as described in <a href="#section-5.4">section 5.4</a>.  For the signature to be valid, the
   message digest value calculated by the recipient MUST be the same as
   the value of the messageDigest attribute included in the
   signedAttributes of the SignedData signerInfo.

   If the SignedData signerInfo includes signedAttributes, then the
   content-type attribute value MUST match the SignedData
   encapContentInfo eContentType value.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Enveloped-data%20Content%20Type"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Enveloped-data Content Type</span>

   The enveloped-data content type consists of an encrypted content of
   any type and encrypted content-encryption keys for one or more
   recipients.  The combination of the encrypted content and one
   encrypted content-encryption key for a recipient is a "digital



<span class="grey">Housley                     Standards Track                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   envelope" for that recipient.  Any type of content can be enveloped
   for an arbitrary number of recipients using any of the three key
   management techniques for each recipient.

   The typical application of the enveloped-data content type will
   represent one or more recipients' digital envelopes on content of the
   data or signed-data content types.

   Enveloped-data is constructed by the following steps:

      1.  A content-encryption key for a particular content-encryption
      algorithm is generated at random.

      2.  The content-encryption key is encrypted for each recipient.
      The details of this encryption depend on the key management
      algorithm used, but four general techniques are supported:

         key transport:  the content-encryption key is encrypted in the
         recipient's public key;

         key agreement:  the recipient's public key and the sender's
         private key are used to generate a pairwise symmetric key, then
         the content-encryption key is encrypted in the pairwise
         symmetric key;

         symmetric key-encryption keys:  the content-encryption key is
         encrypted in a previously distributed symmetric key-encryption
         key; and

         passwords: the content-encryption key is encrypted in a key-
         encryption key that is derived from a password or other shared
         secret value.

      3.  For each recipient, the encrypted content-encryption key and
      other recipient-specific information are collected into a
      RecipientInfo value, defined in <a href="#section-6.2">Section 6.2</a>.

      4.  The content is encrypted with the content-encryption key.
      Content encryption may require that the content be padded to a
      multiple of some block size; see <a href="#section-6.3">Section 6.3</a>.

      5.  The RecipientInfo values for all the recipients are collected
      together with the encrypted content to form an EnvelopedData value
      as defined in <a href="#section-6.1">Section 6.1</a>.







<span class="grey">Housley                     Standards Track                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   A recipient opens the digital envelope by decrypting one of the
   encrypted content-encryption keys and then decrypting the encrypted
   content with the recovered content-encryption key.

   This section is divided into four parts.  The first part describes
   the top-level type EnvelopedData, the second part describes the per-
   recipient information type RecipientInfo, and the third and fourth
   parts describe the content-encryption and key-encryption processes.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1%20%20EnvelopedData%20Type"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>  EnvelopedData Type</span>

   The following object identifier identifies the enveloped-data content
   type:

      id-envelopedData OBJECT IDENTIFIER ::= { iso(1) member-body(2)
          us(840) rsadsi(113549) pkcs(1) pkcs7(7) 3 }

   The enveloped-data content type shall have ASN.1 type EnvelopedData:

      EnvelopedData ::= SEQUENCE {
         version CMSVersion,
         originatorInfo [0] IMPLICIT OriginatorInfo OPTIONAL,
         recipientInfos RecipientInfos,
         encryptedContentInfo EncryptedContentInfo,
         unprotectedAttrs [1] IMPLICIT UnprotectedAttributes OPTIONAL }

      OriginatorInfo ::= SEQUENCE {
         certs [0] IMPLICIT CertificateSet OPTIONAL,
         crls [1] IMPLICIT CertificateRevocationLists OPTIONAL }

      RecipientInfos ::= SET SIZE (1..MAX) OF RecipientInfo

      EncryptedContentInfo ::= SEQUENCE {
        contentType ContentType,
        contentEncryptionAlgorithm ContentEncryptionAlgorithmIdentifier,
        encryptedContent [0] IMPLICIT EncryptedContent OPTIONAL }

      EncryptedContent ::= OCTET STRING

      UnprotectedAttributes ::= SET SIZE (1..MAX) OF Attribute

   The fields of type EnvelopedData have the following meanings:

      version is the syntax version number.  The appropriate value
      depends on originatorInfo, RecipientInfo, and unprotectedAttrs.
      The version MUST be assigned as follows:





<span class="grey">Housley                     Standards Track                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


         IF ((originatorInfo is present) AND
             (any version 2 attribute certificates are present)) OR
            (any RecipientInfo structures include pwri) OR
            (any RecipientInfo structures include ori)
         THEN version is 3
         ELSE
            IF (originatorInfo is present) OR
               (unprotectedAttrs is present) OR
               (any RecipientInfo structures are a version other than 0)
            THEN version is 2
            ELSE version is 0

      originatorInfo optionally provides information about the
      originator.  It is present only if required by the key management
      algorithm.  It may contain certificates and CRLs:

         certs is a collection of certificates.  certs may contain
         originator certificates associated with several different key
         management algorithms.  certs may also contain attribute
         certificates associated with the originator.  The certificates
         contained in certs are intended to be sufficient for all
         recipients to build certification paths from a recognized
         "root" or "top-level certification authority."  However, certs
         may contain more certificates than necessary, and there may be
         certificates sufficient to make certification paths from two or
         more independent top-level certification authorities.
         Alternatively, certs may contain fewer certificates than
         necessary, if it is expected that recipients have an alternate
         means of obtaining necessary certificates (e.g., from a
         previous set of certificates).

         crls is a collection of CRLs.  It is intended that the set
         contain information sufficient to determine whether or not the
         certificates in the certs field are valid, but such
         correspondence is not necessary.  There MAY be more CRLs than
         necessary, and there MAY also be fewer CRLs than necessary.

      recipientInfos is a collection of per-recipient information.
      There MUST be at least one element in the collection.

      encryptedContentInfo is the encrypted content information.

      unprotectedAttrs is a collection of attributes that are not
      encrypted.  The field is optional.  Useful attribute types are
      defined in <a href="#section-11">Section 11</a>.






<span class="grey">Housley                     Standards Track                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   The fields of type EncryptedContentInfo have the following meanings:

      contentType indicates the type of content.

      contentEncryptionAlgorithm identifies the content-encryption
      algorithm, and any associated parameters, used to encrypt the
      content.  The content-encryption process is described in <a href="#section-6.3">Section</a>
      <a href="#section-6.3">6.3</a>.  The same content-encryption algorithm and content-encryption
      key are used for all recipients.

      encryptedContent is the result of encrypting the content.  The
      field is optional, and if the field is not present, its intended
      value must be supplied by other means.

   The recipientInfos field comes before the encryptedContentInfo field
   so that an EnvelopedData value may be processed in a single pass.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2%20%20RecipientInfo%20Type"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>  RecipientInfo Type</span>

   Per-recipient information is represented in the type RecipientInfo.
   RecipientInfo has a different format for each of the supported key
   management techniques.  Any of the key management techniques can be
   used for each recipient of the same encrypted content.  In all cases,
   the encrypted content-encryption key is transferred to one or more
   recipients.

   Since all implementations will not support every possible key
   management algorithm, all implementations MUST gracefully handle
   unimplemented algorithms when they are encountered.  For example, if
   a recipient receives a content-encryption key encrypted in their RSA
   public key using RSA-OAEP and the implementation only supports RSA
   PKCS #1 v1.5, then a graceful failure must be implemented.

   Implementations MUST support key transport, key agreement, and
   previously distributed symmetric key-encryption keys, as represented
   by ktri, kari, and kekri, respectively.  Implementations MAY support
   the password-based key management as represented by pwri.
   Implementations MAY support any other key management technique as
   represented by ori.  Since each recipient can employ a different key
   management technique and future specifications could define
   additional key management techniques, all implementations MUST
   gracefully handle unimplemented alternatives within the RecipientInfo
   CHOICE, all implementations MUST gracefully handle unimplemented
   versions of otherwise supported alternatives within the RecipientInfo
   CHOICE, and all implementations MUST gracefully handle unimplemented
   or unknown ori alternatives.





<span class="grey">Housley                     Standards Track                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


      RecipientInfo ::= CHOICE {
        ktri KeyTransRecipientInfo,
        kari [1] KeyAgreeRecipientInfo,
        kekri [2] KEKRecipientInfo,
        pwri [3] PasswordRecipientinfo,
        ori [4] OtherRecipientInfo }

      EncryptedKey ::= OCTET STRING

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.1%20%20KeyTransRecipientInfo%20Type"></a><a class="selflink" href="#section-6.2.1" name="section-6.2.1">6.2.1</a>  KeyTransRecipientInfo Type</span>

   Per-recipient information using key transport is represented in the
   type KeyTransRecipientInfo.  Each instance of KeyTransRecipientInfo
   transfers the content-encryption key to one recipient.

      KeyTransRecipientInfo ::= SEQUENCE {
        version CMSVersion,  -- always set to 0 or 2
        rid RecipientIdentifier,
        keyEncryptionAlgorithm KeyEncryptionAlgorithmIdentifier,
        encryptedKey EncryptedKey }

      RecipientIdentifier ::= CHOICE {
        issuerAndSerialNumber IssuerAndSerialNumber,
        subjectKeyIdentifier [0] SubjectKeyIdentifier }

   The fields of type KeyTransRecipientInfo have the following meanings:

      version is the syntax version number.  If the RecipientIdentifier
      is the CHOICE issuerAndSerialNumber, then the version MUST be 0.
      If the RecipientIdentifier is subjectKeyIdentifier, then the
      version MUST be 2.

      rid specifies the recipient's certificate or key that was used by
      the sender to protect the content-encryption key.  The
      RecipientIdentifier provides two alternatives for specifying the
      recipient's certificate, and thereby the recipient's public key.
      The recipient's certificate must contain a key transport public
      key.  Therefore, a recipient X.509 version 3 certificate that
      contains a key usage extension MUST assert the keyEncipherment
      bit.  The content-encryption key is encrypted with the recipient's
      public key.  The issuerAndSerialNumber alternative identifies the
      recipient's certificate by the issuer's distinguished name and the
      certificate serial number; the subjectKeyIdentifier identifies the
      recipient's certificate by the X.509 subjectKeyIdentifier
      extension value.  For recipient processing, implementations MUST
      support both of these alternatives for specifying the recipient's
      certificate; and for sender processing, implementations MUST
      support at least one of these alternatives.



<span class="grey">Housley                     Standards Track                    [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


      keyEncryptionAlgorithm identifies the key-encryption algorithm,
      and any associated parameters, used to encrypt the content-
      encryption key for the recipient.  The key-encryption process is
      described in <a href="#section-6.4">Section 6.4</a>.

      encryptedKey is the result of encrypting the content-encryption
      key for the recipient.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.2%20%20KeyAgreeRecipientInfo%20Type"></a><a class="selflink" href="#section-6.2.2" name="section-6.2.2">6.2.2</a>  KeyAgreeRecipientInfo Type</span>

   Recipient information using key agreement is represented in the type
   KeyAgreeRecipientInfo.  Each instance of KeyAgreeRecipientInfo will
   transfer the content-encryption key to one or more recipients that
   use the same key agreement algorithm and domain parameters for that
   algorithm.

      KeyAgreeRecipientInfo ::= SEQUENCE {
        version CMSVersion,  -- always set to 3
        originator [0] EXPLICIT OriginatorIdentifierOrKey,
        ukm [1] EXPLICIT UserKeyingMaterial OPTIONAL,
        keyEncryptionAlgorithm KeyEncryptionAlgorithmIdentifier,
        recipientEncryptedKeys RecipientEncryptedKeys }

      OriginatorIdentifierOrKey ::= CHOICE {
        issuerAndSerialNumber IssuerAndSerialNumber,
        subjectKeyIdentifier [0] SubjectKeyIdentifier,
        originatorKey [1] OriginatorPublicKey }

      OriginatorPublicKey ::= SEQUENCE {
        algorithm AlgorithmIdentifier,
        publicKey BIT STRING }

      RecipientEncryptedKeys ::= SEQUENCE OF RecipientEncryptedKey

      RecipientEncryptedKey ::= SEQUENCE {
        rid KeyAgreeRecipientIdentifier,
        encryptedKey EncryptedKey }

      KeyAgreeRecipientIdentifier ::= CHOICE {
        issuerAndSerialNumber IssuerAndSerialNumber,
        rKeyId [0] IMPLICIT RecipientKeyIdentifier }

      RecipientKeyIdentifier ::= SEQUENCE {
        subjectKeyIdentifier SubjectKeyIdentifier,
        date GeneralizedTime OPTIONAL,
        other OtherKeyAttribute OPTIONAL }

      SubjectKeyIdentifier ::= OCTET STRING



<span class="grey">Housley                     Standards Track                    [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   The fields of type KeyAgreeRecipientInfo have the following meanings:

      version is the syntax version number.  It MUST always be 3.

      originator is a CHOICE with three alternatives specifying the
      sender's key agreement public key.  The sender uses the
      corresponding private key and the recipient's public key to
      generate a pairwise key.  The content-encryption key is encrypted
      in the pairwise key.  The issuerAndSerialNumber alternative
      identifies the sender's certificate, and thereby the sender's
      public key, by the issuer's distinguished name and the certificate
      serial number.  The subjectKeyIdentifier alternative identifies
      the sender's certificate, and thereby the sender's public key, by
      the X.509 subjectKeyIdentifier extension value.  The originatorKey
      alternative includes the algorithm identifier and sender's key
      agreement public key.  This alternative permits originator
      anonymity since the public key is not certified.  Implementations
      MUST support all three alternatives for specifying the sender's
      public key.

      ukm is optional.  With some key agreement algorithms, the sender
      provides a User Keying Material (UKM) to ensure that a different
      key is generated each time the same two parties generate a
      pairwise key.  Implementations MUST support recipient processing
      of a KeyAgreeRecipientInfo SEQUENCE that includes a ukm field.
      Implementations that do not support key agreement algorithms that
      make use of UKMs MUST gracefully handle the presence of UKMs.

      keyEncryptionAlgorithm identifies the key-encryption algorithm,
      and any associated parameters, used to encrypt the content-
      encryption key with the key-encryption key.  The key-encryption
      process is described in <a href="#section-6.4">Section 6.4</a>.

      recipientEncryptedKeys includes a recipient identifier and
      encrypted key for one or more recipients.  The
      KeyAgreeRecipientIdentifier is a CHOICE with two alternatives
      specifying the recipient's certificate, and thereby the
      recipient's public key, that was used by the sender to generate a
      pairwise key-encryption key.  The recipient's certificate must
      contain a key agreement public key.  Therefore, a recipient X.509
      version 3 certificate that contains a key usage extension MUST
      assert the keyAgreement bit.  The content-encryption key is
      encrypted in the pairwise key-encryption key.  The
      issuerAndSerialNumber alternative identifies the recipient's
      certificate by the issuer's distinguished name and the certificate
      serial number; the RecipientKeyIdentifier is described below.  The
      encryptedKey is the result of encrypting the content-encryption




<span class="grey">Housley                     Standards Track                    [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


      key in the pairwise key-encryption key generated using the key
      agreement algorithm.  Implementations MUST support both
      alternatives for specifying the recipient's certificate.

   The fields of type RecipientKeyIdentifier have the following
   meanings:

      subjectKeyIdentifier identifies the recipient's certificate by the
      X.509 subjectKeyIdentifier extension value.

      date is optional.  When present, the date specifies which of the
      recipient's previously distributed UKMs was used by the sender.

      other is optional.  When present, this field contains additional
      information used by the recipient to locate the public keying
      material used by the sender.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.3%20%20KEKRecipientInfo%20Type"></a><a class="selflink" href="#section-6.2.3" name="section-6.2.3">6.2.3</a>  KEKRecipientInfo Type</span>

   Recipient information using previously distributed symmetric keys is
   represented in the type KEKRecipientInfo.  Each instance of
   KEKRecipientInfo will transfer the content-encryption key to one or
   more recipients who have the previously distributed key-encryption
   key.

      KEKRecipientInfo ::= SEQUENCE {
        version CMSVersion,  -- always set to 4
        kekid KEKIdentifier,
        keyEncryptionAlgorithm KeyEncryptionAlgorithmIdentifier,
        encryptedKey EncryptedKey }

      KEKIdentifier ::= SEQUENCE {
        keyIdentifier OCTET STRING,
        date GeneralizedTime OPTIONAL,
        other OtherKeyAttribute OPTIONAL }

   The fields of type KEKRecipientInfo have the following meanings:

      version is the syntax version number.  It MUST always be 4.

      kekid specifies a symmetric key-encryption key that was previously
      distributed to the sender and one or more recipients.

      keyEncryptionAlgorithm identifies the key-encryption algorithm,
      and any associated parameters, used to encrypt the content-
      encryption key with the key-encryption key.  The key-encryption
      process is described in <a href="#section-6.4">Section 6.4</a>.




<span class="grey">Housley                     Standards Track                    [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


      encryptedKey is the result of encrypting the content-encryption
      key in the key-encryption key.

   The fields of type KEKIdentifier have the following meanings:

      keyIdentifier identifies the key-encryption key that was
      previously distributed to the sender and one or more recipients.

      date is optional.  When present, the date specifies a single key-
      encryption key from a set that was previously distributed.

      other is optional.  When present, this field contains additional
      information used by the recipient to determine the key-encryption
      key used by the sender.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.4%20%20PasswordRecipientInfo%20Type"></a><a class="selflink" href="#section-6.2.4" name="section-6.2.4">6.2.4</a>  PasswordRecipientInfo Type</span>

   Recipient information using a password or shared secret value is
   represented in the type PasswordRecipientInfo.  Each instance of
   PasswordRecipientInfo will transfer the content-encryption key to one
   or more recipients who possess the password or shared secret value.

   The PasswordRecipientInfo Type is specified in <a href="rfc3211.html">RFC 3211</a> [<a href="#ref-PWRI" title='"Password-based Encryption for S/MIME"'>PWRI</a>].  The
   PasswordRecipientInfo structure is repeated here for completeness.

      PasswordRecipientInfo ::= SEQUENCE {
        version CMSVersion,   -- Always set to 0
        keyDerivationAlgorithm [0] KeyDerivationAlgorithmIdentifier
                                   OPTIONAL,
        keyEncryptionAlgorithm KeyEncryptionAlgorithmIdentifier,
        encryptedKey EncryptedKey }

   The fields of type PasswordRecipientInfo have the following meanings:

      version is the syntax version number.  It MUST always be 0.

      keyDerivationAlgorithm identifies the key-derivation algorithm,
      and any associated parameters, used to derive the key-encryption
      key from the password or shared secret value.  If this field is
      absent, the key-encryption key is supplied from an external
      source, for example a hardware crypto token such as a smart card.

      keyEncryptionAlgorithm identifies the encryption algorithm, and
      any associated parameters, used to encrypt the content-encryption
      key with the key-encryption key.

      encryptedKey is the result of encrypting the content-encryption
      key with the key-encryption key.



<span class="grey">Housley                     Standards Track                    [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.5%20%20OtherRecipientInfo%20Type"></a><a class="selflink" href="#section-6.2.5" name="section-6.2.5">6.2.5</a>  OtherRecipientInfo Type</span>

   Recipient information for additional key management techniques are
   represented in the type OtherRecipientInfo.  The OtherRecipientInfo
   type allows key management techniques beyond key transport, key
   agreement, previously distributed symmetric key-encryption keys, and
   password-based key management to be specified in future documents.
   An object identifier uniquely identifies such key management
   techniques.

      OtherRecipientInfo ::= SEQUENCE {
        oriType OBJECT IDENTIFIER,
        oriValue ANY DEFINED BY oriType }

   The fields of type OtherRecipientInfo have the following meanings:

      oriType identifies the key management technique.

      oriValue contains the protocol data elements needed by a recipient
      using the identified key management technique.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3%20%20Content-encryption%20Process"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>  Content-encryption Process</span>

   The content-encryption key for the desired content-encryption
   algorithm is randomly generated.  The data to be protected is padded
   as described below, then the padded data is encrypted using the
   content-encryption key.  The encryption operation maps an arbitrary
   string of octets (the data) to another string of octets (the
   ciphertext) under control of a content-encryption key.  The encrypted
   data is included in the envelopedData encryptedContentInfo
   encryptedContent OCTET STRING.

   Some content-encryption algorithms assume the input length is a
   multiple of k octets, where k is greater than one.  For such
   algorithms, the input shall be padded at the trailing end with
   k-(lth mod k) octets all having value k-(lth mod k), where lth is
   the length of the input.  In other words, the input is padded at
   the trailing end with one of the following strings:

                     01 -- if lth mod k = k-1
                  02 02 -- if lth mod k = k-2
                      .
                      .
                      .
            k k ... k k -- if lth mod k = 0






<span class="grey">Housley                     Standards Track                    [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   The padding can be removed unambiguously since all input is padded,
   including input values that are already a multiple of the block size,
   and no padding string is a suffix of another.  This padding method is
   well defined if and only if k is less than 256.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.4%20%20Key-encryption%20Process"></a><a class="selflink" href="#section-6.4" name="section-6.4">6.4</a>  Key-encryption Process</span>

   The input to the key-encryption process -- the value supplied to the
   recipient's key-encryption algorithm -- is just the "value" of the
   content-encryption key.

   Any of the aforementioned key management techniques can be used for
   each recipient of the same encrypted content.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Digested-data%20Content%20Type"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Digested-data Content Type</span>

   The digested-data content type consists of content of any type and a
   message digest of the content.

   Typically, the digested-data content type is used to provide content
   integrity, and the result generally becomes an input to the
   enveloped-data content type.

   The following steps construct digested-data:

      1.  A message digest is computed on the content with a message-
      digest algorithm.

      2.  The message-digest algorithm and the message digest are
      collected together with the content into a DigestedData value.

   A recipient verifies the message digest by comparing the message
   digest to an independently computed message digest.

   The following object identifier identifies the digested-data content
   type:

      id-digestedData OBJECT IDENTIFIER ::= { iso(1) member-body(2)
          us(840) rsadsi(113549) pkcs(1) pkcs7(7) 5 }












<span class="grey">Housley                     Standards Track                    [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   The digested-data content type shall have ASN.1 type DigestedData:

      DigestedData ::= SEQUENCE {
        version CMSVersion,
        digestAlgorithm DigestAlgorithmIdentifier,
        encapContentInfo EncapsulatedContentInfo,
        digest Digest }

      Digest ::= OCTET STRING

   The fields of type DigestedData have the following meanings:

      version is the syntax version number.  If the encapsulated content
      type is id-data, then the value of version MUST be 0; however, if
      the encapsulated content type is other than id-data, then the
      value of version MUST be 2.

      digestAlgorithm identifies the message digest algorithm, and any
      associated parameters, under which the content is digested.  The
      message-digesting process is the same as in <a href="#section-5.4">Section 5.4</a> in the
      case when there are no signed attributes.

      encapContentInfo is the content that is digested, as defined in
      <a href="#section-5.2">section 5.2</a>.

      digest is the result of the message-digesting process.

   The ordering of the digestAlgorithm field, the encapContentInfo
   field, and the digest field makes it possible to process a
   DigestedData value in a single pass.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Encrypted-data%20Content%20Type"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Encrypted-data Content Type</span>

   The encrypted-data content type consists of encrypted content of any
   type.  Unlike the enveloped-data content type, the encrypted-data
   content type has neither recipients nor encrypted content-encryption
   keys.  Keys MUST be managed by other means.

   The typical application of the encrypted-data content type will be to
   encrypt the content of the data content type for local storage,
   perhaps where the encryption key is derived from a password.

   The following object identifier identifies the encrypted-data content
   type:

      id-encryptedData OBJECT IDENTIFIER ::= { iso(1) member-body(2)
          us(840) rsadsi(113549) pkcs(1) pkcs7(7) 6 }




<span class="grey">Housley                     Standards Track                    [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   The encrypted-data content type shall have ASN.1 type EncryptedData:

      EncryptedData ::= SEQUENCE {
        version CMSVersion,
        encryptedContentInfo EncryptedContentInfo,
        unprotectedAttrs [1] IMPLICIT UnprotectedAttributes OPTIONAL }


   The fields of type EncryptedData have the following meanings:

      version is the syntax version number.  If unprotectedAttrs is
      present, then version MUST be 2.  If unprotectedAttrs is absent,
      then version MUST be 0.

      encryptedContentInfo is the encrypted content information, as
      defined in <a href="#section-6.1">Section 6.1</a>.

      unprotectedAttrs is a collection of attributes that are not
      encrypted.  The field is optional.  Useful attribute types are
      defined in <a href="#section-11">Section 11</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Authenticated-data%20Content%20Type"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Authenticated-data Content Type</span>

   The authenticated-data content type consists of content of any type,
   a message authentication code (MAC), and encrypted authentication
   keys for one or more recipients.  The combination of the MAC and one
   encrypted authentication key for a recipient is necessary for that
   recipient to verify the integrity of the content.  Any type of
   content can be integrity protected for an arbitrary number of
   recipients.

   The process by which authenticated-data is constructed involves the
   following steps:

      1.  A message-authentication key for a particular message-
      authentication algorithm is generated at random.

      2.  The message-authentication key is encrypted for each
      recipient.  The details of this encryption depend on the key
      management algorithm used.

      3.  For each recipient, the encrypted message-authentication key
      and other recipient-specific information are collected into a
      RecipientInfo value, defined in <a href="#section-6.2">Section 6.2</a>.

      4.  Using the message-authentication key, the originator computes
      a MAC value on the content.  If the originator is authenticating
      any information in addition to the content (see <a href="#section-9.2">Section 9.2</a>), a



<span class="grey">Housley                     Standards Track                    [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


      message digest is calculated on the content, the message digest of
      the content and the other information are authenticated using the
      message-authentication key, and the result becomes the "MAC
      value."

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1%20%20AuthenticatedData%20Type"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>  AuthenticatedData Type</span>

   The following object identifier identifies the authenticated-data
   content type:

      id-ct-authData OBJECT IDENTIFIER ::= { iso(1) member-body(2)
          us(840) rsadsi(113549) pkcs(1) pkcs-9(9) smime(16)
          ct(1) 2 }

   The authenticated-data content type shall have ASN.1 type
   AuthenticatedData:

      AuthenticatedData ::= SEQUENCE {
        version CMSVersion,
        originatorInfo [0] IMPLICIT OriginatorInfo OPTIONAL,
        recipientInfos RecipientInfos,
        macAlgorithm MessageAuthenticationCodeAlgorithm,
        digestAlgorithm [1] DigestAlgorithmIdentifier OPTIONAL,
        encapContentInfo EncapsulatedContentInfo,
        authAttrs [2] IMPLICIT AuthAttributes OPTIONAL,
        mac MessageAuthenticationCode,
        unauthAttrs [3] IMPLICIT UnauthAttributes OPTIONAL }

      AuthAttributes ::= SET SIZE (1..MAX) OF Attribute

      UnauthAttributes ::= SET SIZE (1..MAX) OF Attribute

      MessageAuthenticationCode ::= OCTET STRING

   The fields of type AuthenticatedData have the following meanings:

      version is the syntax version number.  The version MUST be
      assigned as follows:

         IF ((originatorInfo is present) AND
             (any version 2 attribute certificates are present))
         THEN version is 1
         ELSE version is 0

      originatorInfo optionally provides information about the
      originator.  It is present only if required by the key management
      algorithm.  It MAY contain certificates, attribute certificates,
      and CRLs, as defined in <a href="#section-6.1">Section 6.1</a>.



<span class="grey">Housley                     Standards Track                    [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


      recipientInfos is a collection of per-recipient information, as
      defined in <a href="#section-6.1">Section 6.1</a>.  There MUST be at least one element in the
      collection.

      macAlgorithm is a message authentication code (MAC) algorithm
      identifier.  It identifies the MAC algorithm, along with any
      associated parameters, used by the originator.  Placement of the
      macAlgorithm field facilitates one-pass processing by the
      recipient.

      digestAlgorithm identifies the message digest algorithm, and any
      associated parameters, used to compute a message digest on the
      encapsulated content if authenticated attributes are present.  The
      message digesting process is described in <a href="#section-9.2">Section 9.2</a>.  Placement
      of the digestAlgorithm field facilitates one-pass processing by
      the recipient.  If the digestAlgorithm field is present, then the
      authAttrs field MUST also be present.

      encapContentInfo is the content that is authenticated, as defined
      in <a href="#section-5.2">section 5.2</a>.

      authAttrs is a collection of authenticated attributes.  The
      authAttrs structure is optional, but it MUST be present if the
      content type of the EncapsulatedContentInfo value being
      authenticated is not id-data.  If the authAttrs field is present,
      then the digestAlgorithm field MUST also be present.  The
      AuthAttributes structure MUST be DER encoded, even if the rest of
      the structure is BER encoded.  Useful attribute types are defined
      in <a href="#section-11">Section 11</a>.  If the authAttrs field is present, it MUST
      contain, at a minimum, the following two attributes:

         A content-type attribute having as its value the content type
         of the EncapsulatedContentInfo value being authenticated.
         <a href="#section-11.1">Section 11.1</a> defines the content-type attribute.

         A message-digest attribute, having as its value the message
         digest of the content.  <a href="#section-11.2">Section 11.2</a> defines the message-digest
         attribute.

      mac is the message authentication code.

      unauthAttrs is a collection of attributes that are not
      authenticated.  The field is optional.  To date, no attributes
      have been defined for use as unauthenticated attributes, but other
      useful attribute types are defined in <a href="#section-11">Section 11</a>.






<span class="grey">Housley                     Standards Track                    [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2%20%20MAC%20Generation"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>  MAC Generation</span>

   The MAC calculation process computes a message authentication code
   (MAC) on either the content being authenticated or a message digest
   of content being authenticated together with the originator's
   authenticated attributes.

   If authAttrs field is absent, the input to the MAC calculation
   process is the value of the encapContentInfo eContent OCTET STRING.
   Only the octets comprising the value of the eContent OCTET STRING are
   input to the MAC algorithm; the tag and the length octets are
   omitted.  This has the advantage that the length of the content being
   authenticated need not be known in advance of the MAC generation
   process.

   If authAttrs field is present, the content-type attribute (as
   described in <a href="#section-11.1">Section 11.1</a>) and the message-digest attribute (as
   described in <a href="#section-11.2">section 11.2</a>) MUST be included, and the input to the MAC
   calculation process is the DER encoding of authAttrs.  A separate
   encoding of the authAttrs field is performed for message digest
   calculation.  The IMPLICIT [2] tag in the authAttrs field is not used
   for the DER encoding, rather an EXPLICIT SET OF tag is used.  That
   is, the DER encoding of the SET OF tag, rather than of the IMPLICIT
   [2] tag, is to be included in the message digest calculation along
   with the length and content octets of the authAttrs value.

   The message digest calculation process computes a message digest on
   the content being authenticated.  The initial input to the message
   digest calculation process is the "value" of the encapsulated content
   being authenticated.  Specifically, the input is the encapContentInfo
   eContent OCTET STRING to which the authentication process is applied.
   Only the octets comprising the value of the encapContentInfo eContent
   OCTET STRING are input to the message digest algorithm, not the tag
   or the length octets.  This has the advantage that the length of the
   content being authenticated need not be known in advance.  Although
   the encapContentInfo eContent OCTET STRING tag and length octets are
   not included in the message digest calculation, they are still
   protected by other means.  The length octets are protected by the
   nature of the message digest algorithm since it is computationally
   infeasible to find any two distinct contents of any length that have
   the same message digest.

   The input to the MAC calculation process includes the MAC input data,
   defined above, and an authentication key conveyed in a recipientInfo
   structure.  The details of MAC calculation depend on the MAC
   algorithm employed (e.g., HMAC).  The object identifier, along with
   any parameters, that specifies the MAC algorithm employed by the




<span class="grey">Housley                     Standards Track                    [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   originator is carried in the macAlgorithm field.  The MAC value
   generated by the originator is encoded as an OCTET STRING and carried
   in the mac field.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.3%20%20MAC%20Verification"></a><a class="selflink" href="#section-9.3" name="section-9.3">9.3</a>  MAC Verification</span>

   The input to the MAC verification process includes the input data
   (determined based on the presence or absence of the authAttrs field,
   as defined in 9.2), and the authentication key conveyed in
   recipientInfo.  The details of the MAC verification process depend on
   the MAC algorithm employed.

   The recipient MUST NOT rely on any MAC values or message digest
   values computed by the originator.  The content is authenticated as
   described in <a href="#section-9.2">section 9.2</a>.  If the originator includes authenticated
   attributes, then the content of the authAttrs is authenticated as
   described in <a href="#section-9.2">section 9.2</a>.  For authentication to succeed, the MAC
   value calculated by the recipient MUST be the same as the value of
   the mac field.  Similarly, for authentication to succeed when the
   authAttrs field is present, the content message digest value
   calculated by the recipient MUST be the same as the message digest
   value included in the authAttrs message-digest attribute.

   If the AuthenticatedData includes authAttrs, then the content-type
   attribute value MUST match the AuthenticatedData encapContentInfo
   eContentType value.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Useful%20Types"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Useful Types</span>

   This section is divided into two parts.  The first part defines
   algorithm identifiers, and the second part defines other useful
   types.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1%20%20Algorithm%20Identifier%20Types"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>  Algorithm Identifier Types</span>

   All of the algorithm identifiers have the same type:
   AlgorithmIdentifier.  The definition of AlgorithmIdentifier is taken
   from X.509 [<a href="#ref-X.509-88">X.509-88</a>].

   There are many alternatives for each algorithm type.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.1.1%20%20DigestAlgorithmIdentifier"></a><a class="selflink" href="#section-10.1.1" name="section-10.1.1">10.1.1</a>  DigestAlgorithmIdentifier</span>

   The DigestAlgorithmIdentifier type identifies a message-digest
   algorithm.  Examples include SHA-1, MD2, and MD5.  A message-digest
   algorithm maps an octet string (the content) to another octet string
   (the message digest).




<span class="grey">Housley                     Standards Track                    [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


      DigestAlgorithmIdentifier ::= AlgorithmIdentifier

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.1.2%20%20SignatureAlgorithmIdentifier"></a><a class="selflink" href="#section-10.1.2" name="section-10.1.2">10.1.2</a>  SignatureAlgorithmIdentifier</span>

   The SignatureAlgorithmIdentifier type identifies a signature
   algorithm.  Examples include RSA, DSA, and ECDSA.  A signature
   algorithm supports signature generation and verification operations.
   The signature generation operation uses the message digest and the
   signer's private key to generate a signature value.  The signature
   verification operation uses the message digest and the signer's
   public key to determine whether or not a signature value is valid.
   Context determines which operation is intended.

      SignatureAlgorithmIdentifier ::= AlgorithmIdentifier

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.1.3%20%20KeyEncryptionAlgorithmIdentifier"></a><a class="selflink" href="#section-10.1.3" name="section-10.1.3">10.1.3</a>  KeyEncryptionAlgorithmIdentifier</span>

   The KeyEncryptionAlgorithmIdentifier type identifies a key-encryption
   algorithm used to encrypt a content-encryption key.  The encryption
   operation maps an octet string (the key) to another octet string (the
   encrypted key) under control of a key-encryption key.  The decryption
   operation is the inverse of the encryption operation.  Context
   determines which operation is intended.

   The details of encryption and decryption depend on the key management
   algorithm used.  Key transport, key agreement, previously distributed
   symmetric key-encrypting keys, and symmetric key-encrypting keys
   derived from passwords are supported.

      KeyEncryptionAlgorithmIdentifier ::= AlgorithmIdentifier

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.1.4%20%20ContentEncryptionAlgorithmIdentifier"></a><a class="selflink" href="#section-10.1.4" name="section-10.1.4">10.1.4</a>  ContentEncryptionAlgorithmIdentifier</span>

   The ContentEncryptionAlgorithmIdentifier type identifies a content-
   encryption algorithm.  Examples include Triple-DES and RC2.  A
   content-encryption algorithm supports encryption and decryption
   operations.  The encryption operation maps an octet string (the
   plaintext) to another octet string (the ciphertext) under control of
   a content-encryption key.  The decryption operation is the inverse of
   the encryption operation.  Context determines which operation is
   intended.

      ContentEncryptionAlgorithmIdentifier ::= AlgorithmIdentifier








<span class="grey">Housley                     Standards Track                    [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.1.5%20%20MessageAuthenticationCodeAlgorithm"></a><a class="selflink" href="#section-10.1.5" name="section-10.1.5">10.1.5</a>  MessageAuthenticationCodeAlgorithm</span>

   The MessageAuthenticationCodeAlgorithm type identifies a message
   authentication code (MAC) algorithm.  Examples include DES-MAC and
   HMAC-SHA-1.  A MAC algorithm supports generation and verification
   operations.  The MAC generation and verification operations use the
   same symmetric key.  Context determines which operation is intended.

      MessageAuthenticationCodeAlgorithm ::= AlgorithmIdentifier

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.1.6%20%20KeyDerivationAlgorithmIdentifier"></a><a class="selflink" href="#section-10.1.6" name="section-10.1.6">10.1.6</a>  KeyDerivationAlgorithmIdentifier</span>

   The KeyDerivationAlgorithmIdentifier type is specified in <a href="rfc3211.html">RFC 3211</a>
   [<a href="#ref-PWRI" title='"Password-based Encryption for S/MIME"'>PWRI</a>].  The KeyDerivationAlgorithmIdentifier definition is repeated
   here for completeness.

   Key derivation algorithms convert a password or shared secret value
   into a key-encryption key.

      KeyDerivationAlgorithmIdentifier ::= AlgorithmIdentifier

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2%20%20Other%20Useful%20Types"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>  Other Useful Types</span>

   This section defines types that are used other places in the
   document.  The types are not listed in any particular order.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.1%20%20CertificateRevocationLists"></a><a class="selflink" href="#section-10.2.1" name="section-10.2.1">10.2.1</a>  CertificateRevocationLists</span>

   The CertificateRevocationLists type gives a set of certificate
   revocation lists (CRLs).  It is intended that the set contain
   information sufficient to determine whether the certificates and
   attribute certificates with which the set is associated are revoked.
   However, there may be more CRLs than necessary or there MAY be fewer
   CRLs than necessary.

   The CertificateList may contain a CRL, an Authority Revocation List
   (ARL), a Delta CRL, or an Attribute Certificate Revocation List.  All
   of these lists share a common syntax.

   CRLs are specified in X.509 [<a href="#ref-X.509-97">X.509-97</a>], and they are profiled for use
   in the Internet in <a href="rfc3280.html">RFC 3280</a> [<a href="#ref-PROFILE" title='"Internet X.509 Public Key Infrastructure: Certificate and CRL Profile"'>PROFILE</a>].

   The definition of CertificateList is taken from X.509.

      CertificateRevocationLists ::= SET OF CertificateList






<span class="grey">Housley                     Standards Track                    [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.2%20%20CertificateChoices"></a><a class="selflink" href="#section-10.2.2" name="section-10.2.2">10.2.2</a>  CertificateChoices</span>

   The CertificateChoices type gives either a PKCS #6 extended
   certificate [PKCS#6], an X.509 certificate, a version 1 X.509
   attribute certificate (ACv1) [<a href="#ref-X.509-97">X.509-97</a>], or a version 2 X.509
   attribute certificate (ACv2) [<a href="#ref-X.509-00">X.509-00</a>].  The PKCS #6 extended
   certificate is obsolete.  The PKCS #6 certificate is included for
   backward compatibility, and PKCS #6 certificates SHOULD NOT be used.
   The ACv1 is also obsolete.  ACv1 is included for backward
   compatibility, and ACv1 SHOULD NOT be used.  The Internet profile of
   X.509 certificates is specified in the "Internet X.509 Public Key
   Infrastructure: Certificate and CRL Profile" [<a href="#ref-PROFILE" title='"Internet X.509 Public Key Infrastructure: Certificate and CRL Profile"'>PROFILE</a>].  The Internet
   profile of ACv2 is specified in the "An Internet Attribute
   Certificate Profile for Authorization" [<a href="#ref-ACPROFILE" title='"An Internet Attribute Certificate Profile for Authorization"'>ACPROFILE</a>].

   The definition of Certificate is taken from X.509.

   The definitions of AttributeCertificate are taken from X.509-1997 and
   X.509-2000.  The definition from X.509-1997 is assigned to
   AttributeCertificateV1 (see <a href="#section-12.2">section 12.2</a>), and the definition from
   X.509-2000 is assigned to AttributeCertificateV2.

      CertificateChoices ::= CHOICE {
      certificate Certificate,
      extendedCertificate [0] IMPLICIT ExtendedCertificate,  -- Obsolete
      v1AttrCert [1] IMPLICIT AttributeCertificateV1,        -- Obsolete
      v2AttrCert [2] IMPLICIT AttributeCertificateV2 }

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.3%20%20CertificateSet"></a><a class="selflink" href="#section-10.2.3" name="section-10.2.3">10.2.3</a>  CertificateSet</span>

   The CertificateSet type provides a set of certificates.  It is
   intended that the set be sufficient to contain chains from a
   recognized "root" or "top-level certification authority" to all of
   the sender certificates with which the set is associated.  However,
   there may be more certificates than necessary, or there MAY be fewer
   than necessary.

   The precise meaning of a "chain" is outside the scope of this
   document.  Some applications may impose upper limits on the length of
   a chain; others may enforce certain relationships between the
   subjects and issuers of certificates within a chain.

      CertificateSet ::= SET OF CertificateChoices








<span class="grey">Housley                     Standards Track                    [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.4%20%20IssuerAndSerialNumber"></a><a class="selflink" href="#section-10.2.4" name="section-10.2.4">10.2.4</a>  IssuerAndSerialNumber</span>

   The IssuerAndSerialNumber type identifies a certificate, and thereby
   an entity and a public key, by the distinguished name of the
   certificate issuer and an issuer-specific certificate serial number.

   The definition of Name is taken from X.501 [<a href="#ref-X.501-88">X.501-88</a>], and the
   definition of CertificateSerialNumber is taken from X.509 [<a href="#ref-X.509-97">X.509-97</a>].

      IssuerAndSerialNumber ::= SEQUENCE {
        issuer Name,
        serialNumber CertificateSerialNumber }

      CertificateSerialNumber ::= INTEGER

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.5%20%20CMSVersion"></a><a class="selflink" href="#section-10.2.5" name="section-10.2.5">10.2.5</a>  CMSVersion</span>

   The CMSVersion type gives a syntax version number, for compatibility
   with future revisions of this specification.

      CMSVersion ::= INTEGER  { v0(0), v1(1), v2(2), v3(3), v4(4) }

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.6%20%20UserKeyingMaterial"></a><a class="selflink" href="#section-10.2.6" name="section-10.2.6">10.2.6</a>  UserKeyingMaterial</span>

   The UserKeyingMaterial type gives a syntax for user keying material
   (UKM).  Some key agreement algorithms require UKMs to ensure that a
   different key is generated each time the same two parties generate a
   pairwise key.  The sender provides a UKM for use with a specific key
   agreement algorithm.

      UserKeyingMaterial ::= OCTET STRING

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.7%20%20OtherKeyAttribute"></a><a class="selflink" href="#section-10.2.7" name="section-10.2.7">10.2.7</a>  OtherKeyAttribute</span>

   The OtherKeyAttribute type gives a syntax for the inclusion of other
   key attributes that permit the recipient to select the key used by
   the sender.  The attribute object identifier must be registered along
   with the syntax of the attribute itself.  Use of this structure
   should be avoided since it might impede interoperability.

      OtherKeyAttribute ::= SEQUENCE {
        keyAttrId OBJECT IDENTIFIER,
        keyAttr ANY DEFINED BY keyAttrId OPTIONAL }








<span class="grey">Housley                     Standards Track                    [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Useful%20Attributes"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Useful Attributes</span>

   This section defines attributes that may be used with signed-data,
   enveloped-data, encrypted-data, or authenticated-data.  The syntax of
   Attribute is compatible with X.501 [<a href="#ref-X.501-88">X.501-88</a>] and <a href="rfc3280.html">RFC 3280</a> [<a href="#ref-PROFILE" title='"Internet X.509 Public Key Infrastructure: Certificate and CRL Profile"'>PROFILE</a>].
   Some of the attributes defined in this section were originally
   defined in PKCS #9 [PKCS#9]; others were originally defined in a
   previous version of this specification [<a href="#ref-OLDCMS" title='"Cryptographic Message Syntax"'>OLDCMS</a>].  The attributes are
   not listed in any particular order.

   Additional attributes are defined in many places, notably the S/MIME
   Version 3 Message Specification [<a href="#ref-MSG" title='"S/MIME Version 3 Message Specification"'>MSG</a>] and the Enhanced Security
   Services for S/MIME [<a href="#ref-ESS" title='"Enhanced Security Services for S/MIME"'>ESS</a>], which also include recommendations on the
   placement of these attributes.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1%20%20Content%20Type"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>  Content Type</span>

   The content-type attribute type specifies the content type of the
   ContentInfo within signed-data or authenticated-data.  The content-
   type attribute type MUST be present whenever signed attributes are
   present in signed-data or authenticated attributes present in
   authenticated-data.  The content-type attribute value MUST match the
   encapContentInfo eContentType value in the signed-data or
   authenticated-data.

   The content-type attribute MUST be a signed attribute or an
   authenticated attribute; it MUST NOT be an unsigned attribute,
   unauthenticated attribute, or unprotected attribute.

   The following object identifier identifies the content-type
   attribute:

      id-contentType OBJECT IDENTIFIER ::= { iso(1) member-body(2)
          us(840) rsadsi(113549) pkcs(1) pkcs9(9) 3 }

   Content-type attribute values have ASN.1 type ContentType:

      ContentType ::= OBJECT IDENTIFIER

   Even though the syntax is defined as a SET OF AttributeValue, a
   content-type attribute MUST have a single attribute value; zero or
   multiple instances of AttributeValue are not permitted.

   The SignedAttributes and AuthAttributes syntaxes are each defined as
   a SET OF Attributes.  The SignedAttributes in a signerInfo MUST NOT
   include multiple instances of the content-type attribute.  Similarly,
   the AuthAttributes in an AuthenticatedData MUST NOT include multiple
   instances of the content-type attribute.



<span class="grey">Housley                     Standards Track                    [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.2%20%20Message%20Digest"></a><a class="selflink" href="#section-11.2" name="section-11.2">11.2</a>  Message Digest</span>

   The message-digest attribute type specifies the message digest of the
   encapContentInfo eContent OCTET STRING being signed in signed-data
   (see <a href="#section-5.4">section 5.4</a>) or authenticated in authenticated-data (see <a href="#section-9.2">section</a>
   <a href="#section-9.2">9.2</a>).  For signed-data, the message digest is computed using the
   signer's message digest algorithm.  For authenticated-data, the
   message digest is computed using the originator's message digest
   algorithm.

   Within signed-data, the message-digest signed attribute type MUST be
   present when there are any signed attributes present.  Within
   authenticated-data, the message-digest authenticated attribute type
   MUST be present when there are any authenticated attributes present.

   The message-digest attribute MUST be a signed attribute or an
   authenticated attribute; it MUST NOT be an unsigned attribute,
   unauthenticated attribute, or unprotected attribute.

   The following object identifier identifies the message-digest
   attribute:

      id-messageDigest OBJECT IDENTIFIER ::= { iso(1) member-body(2)
          us(840) rsadsi(113549) pkcs(1) pkcs9(9) 4 }

   Message-digest attribute values have ASN.1 type MessageDigest:

      MessageDigest ::= OCTET STRING

   A message-digest attribute MUST have a single attribute value, even
   though the syntax is defined as a SET OF AttributeValue.  There MUST
   NOT be zero or multiple instances of AttributeValue present.

   The SignedAttributes syntax and AuthAttributes syntax are each
   defined as a SET OF Attributes.  The SignedAttributes in a signerInfo
   MUST include only one instance of the message-digest attribute.
   Similarly, the AuthAttributes in an AuthenticatedData MUST include
   only one instance of the message-digest attribute.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.3%20%20Signing%20Time"></a><a class="selflink" href="#section-11.3" name="section-11.3">11.3</a>  Signing Time</span>

   The signing-time attribute type specifies the time at which the
   signer (purportedly) performed the signing process.  The signing-time
   attribute type is intended for use in signed-data.







<span class="grey">Housley                     Standards Track                    [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   The signing-time attribute MUST be a signed attribute or an
   authenticated attribute; it MUST NOT be an unsigned attribute,
   unauthenticated attribute, or unprotected attribute.

   The following object identifier identifies the signing-time
   attribute:

      id-signingTime OBJECT IDENTIFIER ::= { iso(1) member-body(2)
          us(840) rsadsi(113549) pkcs(1) pkcs9(9) 5 }

   Signing-time attribute values have ASN.1 type SigningTime:

      SigningTime ::= Time

      Time ::= CHOICE {
        utcTime          UTCTime,
        generalizedTime  GeneralizedTime }

   Note: The definition of Time matches the one specified in the 1997
   version of X.509 [<a href="#ref-X.509-97">X.509-97</a>].

   Dates between 1 January 1950 and 31 December 2049 (inclusive) MUST be
   encoded as UTCTime.  Any dates with year values before 1950 or after
   2049 MUST be encoded as GeneralizedTime.

   UTCTime values MUST be expressed in Greenwich Mean Time (Zulu) and
   MUST include seconds (i.e., times are YYMMDDHHMMSSZ), even where the
   number of seconds is zero.  Midnight (GMT) MUST be represented as
   "YYMMDD000000Z".  Century information is implicit, and the century
   MUST be determined as follows:

      Where YY is greater than or equal to 50, the year MUST be
      interpreted as 19YY; and

      Where YY is less than 50, the year MUST be interpreted as 20YY.

   GeneralizedTime values MUST be expressed in Greenwich Mean Time
   (Zulu) and MUST include seconds (i.e., times are YYYYMMDDHHMMSSZ),
   even where the number of seconds is zero.  GeneralizedTime values
   MUST NOT include fractional seconds.

   A signing-time attribute MUST have a single attribute value, even
   though the syntax is defined as a SET OF AttributeValue.  There MUST
   NOT be zero or multiple instances of AttributeValue present.







<span class="grey">Housley                     Standards Track                    [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   The SignedAttributes syntax and the AuthAttributes syntax are each
   defined as a SET OF Attributes.  The SignedAttributes in a signerInfo
   MUST NOT include multiple instances of the signing-time attribute.
   Similarly, the AuthAttributes in an AuthenticatedData MUST NOT
   include multiple instances of the signing-time attribute.

   No requirement is imposed concerning the correctness of the signing
   time, and acceptance of a purported signing time is a matter of a
   recipient's discretion.  It is expected, however, that some signers,
   such as time-stamp servers, will be trusted implicitly.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.4%20%20Countersignature"></a><a class="selflink" href="#section-11.4" name="section-11.4">11.4</a>  Countersignature</span>

   The countersignature attribute type specifies one or more signatures
   on the contents octets of the DER encoding of the signatureValue
   field of a SignerInfo value in signed-data.  Thus, the
   countersignature attribute type countersigns (signs in serial)
   another signature.

   The countersignature attribute MUST be an unsigned attribute; it MUST
   NOT be a signed attribute, an authenticated attribute, an
   unauthenticated attribute, or an unprotected attribute.

   The following object identifier identifies the countersignature
   attribute:

      id-countersignature OBJECT IDENTIFIER ::= { iso(1) member-body(2)
          us(840) rsadsi(113549) pkcs(1) pkcs9(9) 6 }

   Countersignature attribute values have ASN.1 type Countersignature:

      Countersignature ::= SignerInfo

   Countersignature values have the same meaning as SignerInfo values
   for ordinary signatures, except that:

      1.  The signedAttributes field MUST NOT contain a content-type
      attribute; there is no content type for countersignatures.

      2.  The signedAttributes field MUST contain a message-digest
      attribute if it contains any other attributes.

      3.  The input to the message-digesting process is the contents
      octets of the DER encoding of the signatureValue field of the
      SignerInfo value with which the attribute is associated.






<span class="grey">Housley                     Standards Track                    [Page 39]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-40" id="page-40" name="page-40"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   A countersignature attribute can have multiple attribute values.  The
   syntax is defined as a SET OF AttributeValue, and there MUST be one
   or more instances of AttributeValue present.

   The UnsignedAttributes syntax is defined as a SET OF Attributes.  The
   UnsignedAttributes in a signerInfo may include multiple instances of
   the countersignature attribute.

   A countersignature, since it has type SignerInfo, can itself contain
   a countersignature attribute.  Thus, it is possible to construct an
   arbitrarily long series of countersignatures.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20ASN.1%20Modules"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  ASN.1 Modules</span>

   <a href="#section-12.1">Section 12.1</a> contains the ASN.1 module for the CMS, and <a href="#section-12.2">section 12.2</a>
   contains the ASN.1 module for the Version 1 Attribute Certificate.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.1%20%20CMS%20ASN.1%20Module"></a><a class="selflink" href="#section-12.1" name="section-12.1">12.1</a>  CMS ASN.1 Module</span>

   CryptographicMessageSyntax
       { iso(1) member-body(2) us(840) rsadsi(113549)
         pkcs(1) pkcs-9(9) smime(16) modules(0) cms-2001(14) }

   DEFINITIONS IMPLICIT TAGS ::=
   BEGIN

   -- EXPORTS All
   -- The types and values defined in this module are exported for use
   -- in the other ASN.1 modules.  Other applications may use them for
   -- their own purposes.

   IMPORTS

     -- Imports from <a href="rfc3280.html">RFC 3280</a> [<a href="#ref-PROFILE" title='"Internet X.509 Public Key Infrastructure: Certificate and CRL Profile"'>PROFILE</a>], <a href="#appendix-A.1">Appendix A.1</a>
           AlgorithmIdentifier, Certificate, CertificateList,
           CertificateSerialNumber, Name
              FROM PKIX1Explicit88 { iso(1)
                   identified-organization(3) dod(6) internet(1)
                   security(5) mechanisms(5) pkix(7) mod(0)
                   pkix1-explicit(18) }

     -- Imports from <a href="rfc3281.html">RFC 3281</a> [<a href="#ref-ACPROFILE" title='"An Internet Attribute Certificate Profile for Authorization"'>ACPROFILE</a>], <a href="#appendix-B">Appendix B</a>
           AttributeCertificate
              FROM PKIXAttributeCertificate { iso(1)
                   identified-organization(3) dod(6) internet(1)
                   security(5) mechanisms(5) pkix(7) mod(0)
                   attribute-cert(12) }




<span class="grey">Housley                     Standards Track                    [Page 40]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-41" id="page-41" name="page-41"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


     -- Imports from <a href="#appendix-B">Appendix B</a> of this document
           AttributeCertificateV1
              FROM AttributeCertificateVersion1 { iso(1) member-body(2)
                   us(840) rsadsi(113549) pkcs(1) pkcs-9(9) smime(16)
                   modules(0) v1AttrCert(15) } ;

   -- Cryptographic Message Syntax

   ContentInfo ::= SEQUENCE {
     contentType ContentType,
     content [0] EXPLICIT ANY DEFINED BY contentType }

   ContentType ::= OBJECT IDENTIFIER
   SignedData ::= SEQUENCE {
     version CMSVersion,
     digestAlgorithms DigestAlgorithmIdentifiers,
     encapContentInfo EncapsulatedContentInfo,
     certificates [0] IMPLICIT CertificateSet OPTIONAL,
     crls [1] IMPLICIT CertificateRevocationLists OPTIONAL,
     signerInfos SignerInfos }

   DigestAlgorithmIdentifiers ::= SET OF DigestAlgorithmIdentifier

   SignerInfos ::= SET OF SignerInfo

   EncapsulatedContentInfo ::= SEQUENCE {
     eContentType ContentType,
     eContent [0] EXPLICIT OCTET STRING OPTIONAL }

   SignerInfo ::= SEQUENCE {
     version CMSVersion,
     sid SignerIdentifier,
     digestAlgorithm DigestAlgorithmIdentifier,
     signedAttrs [0] IMPLICIT SignedAttributes OPTIONAL,
     signatureAlgorithm SignatureAlgorithmIdentifier,
     signature SignatureValue,
     unsignedAttrs [1] IMPLICIT UnsignedAttributes OPTIONAL }

   SignerIdentifier ::= CHOICE {
     issuerAndSerialNumber IssuerAndSerialNumber,
     subjectKeyIdentifier [0] SubjectKeyIdentifier }

   SignedAttributes ::= SET SIZE (1..MAX) OF Attribute

   UnsignedAttributes ::= SET SIZE (1..MAX) OF Attribute






<span class="grey">Housley                     Standards Track                    [Page 41]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-42" id="page-42" name="page-42"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   Attribute ::= SEQUENCE {
     attrType OBJECT IDENTIFIER,
     attrValues SET OF AttributeValue }

   AttributeValue ::= ANY

   SignatureValue ::= OCTET STRING

   EnvelopedData ::= SEQUENCE {
     version CMSVersion,
     originatorInfo [0] IMPLICIT OriginatorInfo OPTIONAL,
     recipientInfos RecipientInfos,
     encryptedContentInfo EncryptedContentInfo,
     unprotectedAttrs [1] IMPLICIT UnprotectedAttributes OPTIONAL }

   OriginatorInfo ::= SEQUENCE {
     certs [0] IMPLICIT CertificateSet OPTIONAL,
     crls [1] IMPLICIT CertificateRevocationLists OPTIONAL }

   RecipientInfos ::= SET SIZE (1..MAX) OF RecipientInfo

   EncryptedContentInfo ::= SEQUENCE {
     contentType ContentType,
     contentEncryptionAlgorithm ContentEncryptionAlgorithmIdentifier,
     encryptedContent [0] IMPLICIT EncryptedContent OPTIONAL }

   EncryptedContent ::= OCTET STRING

   UnprotectedAttributes ::= SET SIZE (1..MAX) OF Attribute

   RecipientInfo ::= CHOICE {
     ktri KeyTransRecipientInfo,
     kari [1] KeyAgreeRecipientInfo,
     kekri [2] KEKRecipientInfo,
     pwri [3] PasswordRecipientInfo,
     ori [4] OtherRecipientInfo }

   EncryptedKey ::= OCTET STRING

   KeyTransRecipientInfo ::= SEQUENCE {
     version CMSVersion,  -- always set to 0 or 2
     rid RecipientIdentifier,
     keyEncryptionAlgorithm KeyEncryptionAlgorithmIdentifier,
     encryptedKey EncryptedKey }

   RecipientIdentifier ::= CHOICE {
     issuerAndSerialNumber IssuerAndSerialNumber,
     subjectKeyIdentifier [0] SubjectKeyIdentifier }



<span class="grey">Housley                     Standards Track                    [Page 42]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-43" id="page-43" name="page-43"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   KeyAgreeRecipientInfo ::= SEQUENCE {
     version CMSVersion,  -- always set to 3
     originator [0] EXPLICIT OriginatorIdentifierOrKey,
     ukm [1] EXPLICIT UserKeyingMaterial OPTIONAL,
     keyEncryptionAlgorithm KeyEncryptionAlgorithmIdentifier,
     recipientEncryptedKeys RecipientEncryptedKeys }

   OriginatorIdentifierOrKey ::= CHOICE {
     issuerAndSerialNumber IssuerAndSerialNumber,
     subjectKeyIdentifier [0] SubjectKeyIdentifier,
     originatorKey [1] OriginatorPublicKey }
   OriginatorPublicKey ::= SEQUENCE {
     algorithm AlgorithmIdentifier,
     publicKey BIT STRING }

   RecipientEncryptedKeys ::= SEQUENCE OF RecipientEncryptedKey

   RecipientEncryptedKey ::= SEQUENCE {
     rid KeyAgreeRecipientIdentifier,
     encryptedKey EncryptedKey }

   KeyAgreeRecipientIdentifier ::= CHOICE {
     issuerAndSerialNumber IssuerAndSerialNumber,
     rKeyId [0] IMPLICIT RecipientKeyIdentifier }

   RecipientKeyIdentifier ::= SEQUENCE {
     subjectKeyIdentifier SubjectKeyIdentifier,
     date GeneralizedTime OPTIONAL,
     other OtherKeyAttribute OPTIONAL }

   SubjectKeyIdentifier ::= OCTET STRING

   KEKRecipientInfo ::= SEQUENCE {
     version CMSVersion,  -- always set to 4
     kekid KEKIdentifier,
     keyEncryptionAlgorithm KeyEncryptionAlgorithmIdentifier,
     encryptedKey EncryptedKey }

   KEKIdentifier ::= SEQUENCE {
     keyIdentifier OCTET STRING,
     date GeneralizedTime OPTIONAL,
     other OtherKeyAttribute OPTIONAL }









<span class="grey">Housley                     Standards Track                    [Page 43]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-44" id="page-44" name="page-44"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   PasswordRecipientInfo ::= SEQUENCE {
     version CMSVersion,   -- always set to 0
     keyDerivationAlgorithm [0] KeyDerivationAlgorithmIdentifier
                                OPTIONAL,
     keyEncryptionAlgorithm KeyEncryptionAlgorithmIdentifier,
     encryptedKey EncryptedKey }

   OtherRecipientInfo ::= SEQUENCE {
     oriType OBJECT IDENTIFIER,
     oriValue ANY DEFINED BY oriType }

   DigestedData ::= SEQUENCE {
     version CMSVersion,
     digestAlgorithm DigestAlgorithmIdentifier,
     encapContentInfo EncapsulatedContentInfo,
     digest Digest }

   Digest ::= OCTET STRING

   EncryptedData ::= SEQUENCE {
     version CMSVersion,
     encryptedContentInfo EncryptedContentInfo,
     unprotectedAttrs [1] IMPLICIT UnprotectedAttributes OPTIONAL }

   AuthenticatedData ::= SEQUENCE {
     version CMSVersion,
     originatorInfo [0] IMPLICIT OriginatorInfo OPTIONAL,
     recipientInfos RecipientInfos,
     macAlgorithm MessageAuthenticationCodeAlgorithm,
     digestAlgorithm [1] DigestAlgorithmIdentifier OPTIONAL,
     encapContentInfo EncapsulatedContentInfo,
     authAttrs [2] IMPLICIT AuthAttributes OPTIONAL,
     mac MessageAuthenticationCode,
     unauthAttrs [3] IMPLICIT UnauthAttributes OPTIONAL }

   AuthAttributes ::= SET SIZE (1..MAX) OF Attribute

   UnauthAttributes ::= SET SIZE (1..MAX) OF Attribute

   MessageAuthenticationCode ::= OCTET STRING

   DigestAlgorithmIdentifier ::= AlgorithmIdentifier

   SignatureAlgorithmIdentifier ::= AlgorithmIdentifier

   KeyEncryptionAlgorithmIdentifier ::= AlgorithmIdentifier

   ContentEncryptionAlgorithmIdentifier ::= AlgorithmIdentifier



<span class="grey">Housley                     Standards Track                    [Page 44]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-45" id="page-45" name="page-45"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   MessageAuthenticationCodeAlgorithm ::= AlgorithmIdentifier

   KeyDerivationAlgorithmIdentifier ::= AlgorithmIdentifier

   CertificateRevocationLists ::= SET OF CertificateList

   CertificateChoices ::= CHOICE {
     certificate Certificate,
     extendedCertificate [0] IMPLICIT ExtendedCertificate,  -- Obsolete
     v1AttrCert [1] IMPLICIT AttributeCertificateV1,        -- Obsolete
     v2AttrCert [2] IMPLICIT AttributeCertificateV2 }

   AttributeCertificateV2 ::= AttributeCertificate

   CertificateSet ::= SET OF CertificateChoices

   IssuerAndSerialNumber ::= SEQUENCE {
     issuer Name,
     serialNumber CertificateSerialNumber }

   CMSVersion ::= INTEGER  { v0(0), v1(1), v2(2), v3(3), v4(4) }

   UserKeyingMaterial ::= OCTET STRING

   OtherKeyAttribute ::= SEQUENCE {
     keyAttrId OBJECT IDENTIFIER,
     keyAttr ANY DEFINED BY keyAttrId OPTIONAL }

   -- The CMS Attributes

   MessageDigest ::= OCTET STRING

   SigningTime  ::= Time

   Time ::= CHOICE {
     utcTime UTCTime,
     generalTime GeneralizedTime }

   Countersignature ::= SignerInfo

   -- Attribute Object Identifiers

   id-contentType OBJECT IDENTIFIER ::= { iso(1) member-body(2)
       us(840) rsadsi(113549) pkcs(1) pkcs9(9) 3 }

   id-messageDigest OBJECT IDENTIFIER ::= { iso(1) member-body(2)
       us(840) rsadsi(113549) pkcs(1) pkcs9(9) 4 }




<span class="grey">Housley                     Standards Track                    [Page 45]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-46" id="page-46" name="page-46"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   id-signingTime OBJECT IDENTIFIER ::= { iso(1) member-body(2)
       us(840) rsadsi(113549) pkcs(1) pkcs9(9) 5 }

   id-countersignature OBJECT IDENTIFIER ::= { iso(1) member-body(2)
       us(840) rsadsi(113549) pkcs(1) pkcs9(9) 6 }

   -- Obsolete Extended Certificate syntax from PKCS#6

   ExtendedCertificateOrCertificate ::= CHOICE {
     certificate Certificate,
     extendedCertificate [0] IMPLICIT ExtendedCertificate }
   ExtendedCertificate ::= SEQUENCE {
     extendedCertificateInfo ExtendedCertificateInfo,
     signatureAlgorithm SignatureAlgorithmIdentifier,
     signature Signature }

   ExtendedCertificateInfo ::= SEQUENCE {
     version CMSVersion,
     certificate Certificate,
     attributes UnauthAttributes }

   Signature ::= BIT STRING

   END -- of CryptographicMessageSyntax

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.2%20%20Version%201%20Attribute%20Certificate%20ASN.1%20Module"></a><a class="selflink" href="#section-12.2" name="section-12.2">12.2</a>  Version 1 Attribute Certificate ASN.1 Module</span>

   AttributeCertificateVersion1
       { iso(1) member-body(2) us(840) rsadsi(113549)
         pkcs(1) pkcs-9(9) smime(16) modules(0) v1AttrCert(15) }

   DEFINITIONS IMPLICIT TAGS ::=
   BEGIN

   -- EXPORTS All

   IMPORTS

     -- Imports from <a href="rfc3280.html">RFC 3280</a> [<a href="#ref-PROFILE" title='"Internet X.509 Public Key Infrastructure: Certificate and CRL Profile"'>PROFILE</a>], <a href="#appendix-A.1">Appendix A.1</a>
           AlgorithmIdentifier, Attribute, CertificateSerialNumber,
           Extensions, UniqueIdentifier
              FROM PKIX1Explicit88 { iso(1)
                   identified-organization(3) dod(6) internet(1)
                   security(5) mechanisms(5) pkix(7) mod(0)
                   pkix1-explicit(18) }






<span class="grey">Housley                     Standards Track                    [Page 46]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-47" id="page-47" name="page-47"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


     -- Imports from <a href="rfc3280.html">RFC 3280</a> [<a href="#ref-PROFILE" title='"Internet X.509 Public Key Infrastructure: Certificate and CRL Profile"'>PROFILE</a>], <a href="#appendix-A.2">Appendix A.2</a>
           GeneralNames
              FROM PKIX1Implicit88 { iso(1)
                   identified-organization(3) dod(6) internet(1)
                   security(5) mechanisms(5) pkix(7) mod(0)
                   pkix1-implicit(19) }

     -- Imports from <a href="rfc3281.html">RFC 3281</a> [<a href="#ref-ACPROFILE" title='"An Internet Attribute Certificate Profile for Authorization"'>ACPROFILE</a>], <a href="#appendix-B">Appendix B</a>
           AttCertValidityPeriod, IssuerSerial
              FROM PKIXAttributeCertificate { iso(1)
                   identified-organization(3) dod(6) internet(1)
                   security(5) mechanisms(5) pkix(7) mod(0)
                   attribute-cert(12) } ;


   -- Definition extracted from X.509-1997 [<a href="#ref-X.509-97">X.509-97</a>], but
   -- different type names are used to avoid collisions.

   AttributeCertificateV1 ::= SEQUENCE {
     acInfo AttributeCertificateInfoV1,
     signatureAlgorithm AlgorithmIdentifier,
     signature BIT STRING }

   AttributeCertificateInfoV1 ::= SEQUENCE {
     version AttCertVersionV1 DEFAULT v1,
     subject CHOICE {
       baseCertificateID [0] IssuerSerial,
         -- associated with a Public Key Certificate
       subjectName [1] GeneralNames },
         -- associated with a name
     issuer GeneralNames,
     signature AlgorithmIdentifier,
     serialNumber CertificateSerialNumber,
     attCertValidityPeriod AttCertValidityPeriod,
     attributes SEQUENCE OF Attribute,
     issuerUniqueID UniqueIdentifier OPTIONAL,
     extensions Extensions OPTIONAL }

   AttCertVersionV1 ::= INTEGER { v1(0) }

   END -- of AttributeCertificateVersion1










<span class="grey">Housley                     Standards Track                    [Page 47]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-48" id="page-48" name="page-48"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20References"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  References</span>

   [<a id="ref-ACPROFILE" name="ref-ACPROFILE">ACPROFILE</a>] Farrell, S. and R. Housley, "An Internet Attribute
               Certificate Profile for Authorization", <a href="rfc3281.html">RFC 3281</a>, April
               2002.

   [<a id="ref-CMSALG" name="ref-CMSALG">CMSALG</a>]    Housley, R., "Cryptographic Message Syntax (CMS)
               Algorithms", <a href="rfc3269.html">RFC 3269</a>, August 2002.

   [<a id="ref-DSS" name="ref-DSS">DSS</a>]       National Institute of Standards and Technology.  FIPS Pub
               186: Digital Signature Standard.  19 May 1994.

   [<a id="ref-ESS" name="ref-ESS">ESS</a>]       Hoffman, P., "Enhanced Security Services for S/MIME", <a href="rfc2634.html">RFC</a>
               <a href="rfc2634.html">2634</a>, June 1999.

   [<a id="ref-MSG" name="ref-MSG">MSG</a>]       Ramsdell, B., "S/MIME Version 3 Message Specification",
               <a href="rfc2633.html">RFC 2633</a>, June 1999.

   [<a id="ref-OLDCMS" name="ref-OLDCMS">OLDCMS</a>]    Housley, R., "Cryptographic Message Syntax", <a href="rfc2630.html">RFC 2630</a>,
               June 1999.

   [<a id="ref-OLDMSG" name="ref-OLDMSG">OLDMSG</a>]    Dusse, S., Hoffman, P., Ramsdell, B., Lundblade, L. and
               L. Repka, "S/MIME Version 2 Message Specification", <a href="rfc2311.html">RFC</a>
               <a href="rfc2311.html">2311</a>, March 1998.

   [<a id="ref-PROFILE" name="ref-PROFILE">PROFILE</a>]   Housley, R., Polk, W., Ford, W. and D. Solo, "Internet
               X.509 Public Key Infrastructure: Certificate and CRL
               Profile", <a href="rfc3280.html">RFC 3280</a>, April 2002.

   [PKCS#6]    RSA Laboratories.  PKCS #6: Extended-Certificate Syntax
               Standard, Version 1.5.  November 1993.

   [PKCS#7]    Kaliski, B., "PKCS #7: Cryptographic Message Syntax,
               Version 1.5.", <a href="rfc2315.html">RFC 2315</a>, March 1998.

   [PKCS#9]    RSA Laboratories.  PKCS #9: Selected Attribute Types,
               Version 1.1.  November 1993.

   [<a id="ref-PWRI" name="ref-PWRI">PWRI</a>]      Gutmann, P., "Password-based Encryption for S/MIME", <a href="rfc3211.html">RFC</a>
               <a href="rfc3211.html">3211</a>, December 2001.

   [<a id="ref-RANDOM" name="ref-RANDOM">RANDOM</a>]    Eastlake, D., Crocker, S. and J. Schiller, "Randomness
               Recommendations for Security", <a href="rfc1750.html">RFC 1750</a>, December 1994.

   [<a id="ref-STDWORDS" name="ref-STDWORDS">STDWORDS</a>]  Bradner, S., "Key Words for Use in RFCs to Indicate
               Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.





<span class="grey">Housley                     Standards Track                    [Page 48]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-49" id="page-49" name="page-49"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   [<a id="ref-X.208-88" name="ref-X.208-88">X.208-88</a>]  CCITT.  Recommendation X.208: Specification of Abstract
               Syntax Notation One (ASN.1).  1988.

   [<a id="ref-X.209-88" name="ref-X.209-88">X.209-88</a>]  CCITT.  Recommendation X.209: Specification of Basic
               Encoding Rules for Abstract Syntax Notation One (ASN.1).
               1988.

   [<a id="ref-X.501-88" name="ref-X.501-88">X.501-88</a>]  CCITT.  Recommendation X.501: The Directory - Models.
               1988.

   [<a id="ref-X.509-88" name="ref-X.509-88">X.509-88</a>]  CCITT.  Recommendation X.509: The Directory -
               Authentication Framework.  1988.

   [<a id="ref-X.509-97" name="ref-X.509-97">X.509-97</a>]  ITU-T.  Recommendation X.509: The Directory -
               Authentication Framework.  1997.

   [<a id="ref-X.509-00" name="ref-X.509-00">X.509-00</a>]  ITU-T.  Recommendation X.509: The Directory -
               Authentication Framework.  2000.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14.%20%20Security%20Considerations"></a><a class="selflink" href="#section-14" name="section-14">14</a>.  Security Considerations</span>

   The Cryptographic Message Syntax provides a method for digitally
   signing data, digesting data, encrypting data, and authenticating
   data.

   Implementations must protect the signer's private key.  Compromise of
   the signer's private key permits masquerade.

   Implementations must protect the key management private key, the
   key-encryption key, and the content-encryption key.  Compromise of
   the key management private key or the key-encryption key may result
   in the disclosure of all contents protected with that key.
   Similarly, compromise of the content-encryption key may result in
   disclosure of the associated encrypted content.

   Implementations must protect the key management private key and the
   message-authentication key.  Compromise of the key management private
   key permits masquerade of authenticated data.  Similarly, compromise
   of the message-authentication key may result in undetectable
   modification of the authenticated content.

   The key management technique employed to distribute message-
   authentication keys must itself provide data origin authentication,
   otherwise the contents are delivered with integrity from an unknown
   source.  Neither RSA [PKCS#1, NEWPKCS#1] nor Ephemeral-Static
   Diffie-Hellman [DH-X9.42] provide the necessary data origin
   authentication.  Static-Static Diffie-Hellman [DH-X9.42] does provide




<span class="grey">Housley                     Standards Track                    [Page 49]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-50" id="page-50" name="page-50"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   the necessary data origin authentication when both the originator and
   recipient public keys are bound to appropriate identities in X.509
   certificates.

   When more than two parties share the same message-authentication key,
   data origin authentication is not provided.  Any party that knows the
   message-authentication key can compute a valid MAC, therefore the
   contents could originate from any one of the parties.

   Implementations must randomly generate content-encryption keys,
   message-authentication keys, initialization vectors (IVs), and
   padding.  Also, the generation of public/private key pairs relies on
   a random numbers.  The use of inadequate pseudo-random number
   generators (PRNGs) to generate cryptographic keys can result in
   little or no security.  An attacker may find it much easier to
   reproduce the PRNG environment that produced the keys, searching the
   resulting small set of possibilities, rather than brute force
   searching the whole key space.  The generation of quality random
   numbers is difficult.  <a href="rfc1750.html">RFC 1750</a> [<a href="#ref-RANDOM" title='"Randomness Recommendations for Security"'>RANDOM</a>] offers important guidance in
   this area, and Appendix 3 of FIPS Pub 186 [<a href="#ref-DSS">DSS</a>] provides one quality
   PRNG technique.

   When using key agreement algorithms or previously distributed
   symmetric key-encryption keys, a key-encryption key is used to
   encrypt the content-encryption key.  If the key-encryption and
   content-encryption algorithms are different, the effective security
   is determined by the weaker of the two algorithms.  If, for example,
   content is encrypted with Triple-DES using a 168-bit Triple-DES
   content-encryption key, and the content-encryption key is wrapped
   with RC2 using a 40-bit RC2 key-encryption key, then at most 40 bits
   of protection is provided.  A trivial search to determine the value
   of the 40-bit RC2 key can recover the Triple-DES key, and then the
   Triple-DES key can be used to decrypt the content.  Therefore,
   implementers must ensure that key-encryption algorithms are as strong
   or stronger than content-encryption algorithms.

   Implementers should be aware that cryptographic algorithms become
   weaker with time.  As new cryptoanalysis techniques are developed and
   computing performance improves, the work factor to break a particular
   cryptographic algorithm will be reduced.  Therefore, cryptographic
   algorithm implementations should be modular, allowing new algorithms
   to be readily inserted.  That is, implementors should be prepared for
   the set of algorithms that must be supported to change over time.

   The countersignature unsigned attribute includes a digital signature
   that is computed on the content signature value, thus the
   countersigning process need not know the original signed content.
   This structure permits implementation efficiency advantages; however,



<span class="grey">Housley                     Standards Track                    [Page 50]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-51" id="page-51" name="page-51"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


   this structure may also permit the countersigning of an inappropriate
   signature value.  Therefore, implementations that perform
   countersignatures should either verify the original signature value
   prior to countersigning it (this verification requires processing of
   the original content), or implementations should perform
   countersigning in a context that ensures that only appropriate
   signature values are countersigned.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/15.%20%20Acknowledgments"></a><a class="selflink" href="#section-15" name="section-15">15</a>.  Acknowledgments</span>

   This document is the result of contributions from many professionals.
   I appreciate the hard work of all members of the IETF S/MIME Working
   Group.  I extend a special thanks to Rich Ankney, Simon Blake-Wilson,
   Tim Dean, Steve Dusse, Carl Ellison, Peter Gutmann, Bob Jueneman,
   Stephen Henson, Paul Hoffman, Scott Hollenbeck, Don Johnson, Burt
   Kaliski, John Linn, John Pawling, Blake Ramsdell, Francois Rousseau,
   Jim Schaad, and Dave Solo for their efforts and support.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/16.%20%20Authors%27%20Address"></a><a class="selflink" href="#section-16" name="section-16">16</a>.  Authors' Address</span>

   Russell Housley
   RSA Laboratories
   918 Spring Knoll Drive
   Herndon, VA 20170
   USA
   EMail: rhousley@rsasecurity.com

























<span class="grey">Housley                     Standards Track                    [Page 51]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-52" id="page-52" name="page-52"> </a>
<span class="grey"><a href="rfc3369.html">RFC 3369</a>              Cryptographic Message Syntax           August 2002</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/17.%20%20Full%20Copyright%20Statement"></a><a class="selflink" href="#section-17" name="section-17">17</a>.  Full Copyright Statement</span>

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.



















Housley                     Standards Track                    [Page 52]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc3369 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:47 GMT --></html>